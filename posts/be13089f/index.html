<!-- build time:Tue Aug 18 2020 21:54:23 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><meta name="baidu-site-verification" content="CpUtq7PVXz"><meta name="baidu-site-verification" content="yBAdXP3M7c"><meta name="google-site-verification" content="BDfwg8yARZd_uEasrK3RvZGmWmUg37NQSE3cumBTgMI"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="baidu-site-verification" content="64WFuMirLucMnUVd"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.4.2",exturl:!0,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"},sidebarPadding:40}</script><meta name="description" content="Win32第一章编码的发展asciigb2312unicodewin32宽字符宽字符，win底层都是用宽字符实现的练习练习使用带w的函数1234567891011121314151617181920&#x2F;&#x2F; WChar.cpp : Defines the entry point for the console application.&#x2F;&#x2F;#include &quot;stdafx.h&quot;#include &amp;lt;"><meta name="keywords" content="reverse,逆向"><meta property="og:type" content="article"><meta property="og:title" content="17-Win32"><meta property="og:url" content="https:&#x2F;&#x2F;noonegroup.xyz&#x2F;posts&#x2F;be13089f&#x2F;index.html"><meta property="og:site_name" content="NoOne"><meta property="og:description" content="Win32第一章编码的发展asciigb2312unicodewin32宽字符宽字符，win底层都是用宽字符实现的练习练习使用带w的函数1234567891011121314151617181920&#x2F;&#x2F; WChar.cpp : Defines the entry point for the console application.&#x2F;&#x2F;#include &quot;stdafx.h&quot;#include &amp;lt;"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200324213204.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200324213309.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200324224333.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000443.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000444.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000445.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000446.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000447.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000448.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000449.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000450.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000451.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000452.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000453.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000454.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000455.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000456.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000457.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000458.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000459.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000500.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000501.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000502.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000503.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000504.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000505.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000506.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000507.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000508.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000509.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000510.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000511.png"><meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200405000512.png"><meta property="og:updated_time" content="2020-08-18T12:45:06.528Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;NoOne-hub&#x2F;picture&#x2F;raw&#x2F;master&#x2F;img&#x2F;20200324213204.png"><link rel="canonical" href="https://noonegroup.xyz/posts/be13089f/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>17-Win32 | NoOne</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">NoOne</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>友链</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Searching..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL05vT25lLWh1Yg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></span><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans"><link itemprop="mainEntityOfPage" href="https://noonegroup.xyz/posts/be13089f/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/photo.jpg"><meta itemprop="name" content="NoOne"><meta itemprop="description" content></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="NoOne"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">17-Win32</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-02-10 15:22:04" itemprop="dateCreated datePublished" datetime="2020-02-10T15:22:04+08:00">2020-02-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2020-08-18 20:45:06" itemprop="dateModified" datetime="2020-08-18T20:45:06+08:00">2020-08-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/bin/" itemprop="url" rel="index"><span itemprop="name">bin</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/bin/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">逆向</span> </a></span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/bin/%E9%80%86%E5%90%91/%E6%BB%B4%E6%B0%B4%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">滴水逆向</span> </a></span></span><span id="/posts/be13089f/" class="post-meta-item leancloud_visitors" data-flag-title="17-Win32" title="Views"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span class="leancloud-visitors-count"></span> </span><span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Views: </span><span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine: </span><a title="valine" href="/posts/be13089f/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/be13089f/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>13k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>11 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Win32"><a href="#Win32" class="headerlink" title="Win32"></a>Win32</h1><h2 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h2><h3 id="编码的发展"><a href="#编码的发展" class="headerlink" title="编码的发展"></a>编码的发展</h3><ol><li>ascii</li><li>gb2312</li><li>unicode</li></ol><h3 id="win32宽字符"><a href="#win32宽字符" class="headerlink" title="win32宽字符"></a>win32宽字符</h3><p>宽字符，win底层都是用宽字符实现的</p><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>练习使用带w的函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WChar.cpp : Defines the entry point for the console application.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;locale&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	setlocale(LC_ALL, <span class="string">""</span>);</span><br><span class="line"> 	<span class="comment">// <span class="doctag">TODO:</span> Place code here.</span></span><br><span class="line">	<span class="keyword">wchar_t</span> wStr[] = <span class="string">L"中国"</span>;</span><br><span class="line">	wprintf(<span class="string">L"%s\n"</span>, wStr);</span><br><span class="line">	<span class="keyword">int</span> length = wcslen(wStr);</span><br><span class="line">	<span class="keyword">wchar_t</span> wAim[<span class="number">10</span>];</span><br><span class="line">	wcscpy(wAim,wStr);</span><br><span class="line">	wcscat(wAim,wStr);</span><br><span class="line">	<span class="keyword">int</span> result = wcscmp(wAim,wStr);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span>* test = wcsstr(wAim, wStr);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>了解WinMain参数</p><ul><li><em>hInstance</em> is something called a “handle to an instance” or “handle to a module.” The operating system uses this value to identify the executable (EXE) when it is loaded in memory. The instance handle is needed for certain Windows functions—for example, to load icons or bitmaps.</li><li><em>hPrevInstance</em> has no meaning. It was used in 16-bit Windows, but is now always zero.</li><li><em>pCmdLine</em> contains the command-line arguments as a Unicode string.</li><li><em>nCmdShow</em> is a flag that says whether the main application window will be minimized, maximized, or shown normally.</li></ul><p>The function returns an <strong>int</strong> value. The return value is not used by the operating system, but you can use the return value to convey a status code to some other program that you write.</p><h2 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h2><h3 id="win32初次调试"><a href="#win32初次调试" class="headerlink" title="win32初次调试"></a>win32初次调试</h3><p>这里查文档直接用在线的，msdn文档太大了，懒得下载了</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200324213204.png" alt></p><p>可以看到这里errorCode为1400，查文档为</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200324213309.png" alt></p><p>调试打印语句</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.cpp</span></span><br><span class="line"><span class="keyword">void</span> __<span class="function">cdecl <span class="title">OutputDebugStringF</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *format, ...)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    va_list vlArgs;  </span><br><span class="line">    <span class="keyword">char</span>    *strBuffer = (<span class="keyword">char</span>*)GlobalAlloc(GPTR, <span class="number">4096</span>);  </span><br><span class="line"></span><br><span class="line">    va_start(vlArgs, format);  </span><br><span class="line">    _vsnprintf(strBuffer, <span class="number">4096</span> - <span class="number">1</span>, format, vlArgs);  </span><br><span class="line">    va_end(vlArgs);  </span><br><span class="line">    <span class="built_in">strcat</span>(strBuffer, <span class="string">"\n"</span>);  </span><br><span class="line">    OutputDebugStringA(strBuffer);  </span><br><span class="line">    GlobalFree(strBuffer);  </span><br><span class="line">    <span class="keyword">return</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">//.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DbgPrintf   OutputDebugStringF  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DbgPrintf  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="windows事件和消息"><a href="#windows事件和消息" class="headerlink" title="windows事件和消息"></a>windows事件和消息</h3><p>系统消息队列与应用程序消息队列：</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200324224333.png" alt></p><h3 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMSG</span> &#123;</span></span><br><span class="line">  HWND   hwnd;</span><br><span class="line">  UINT   message;</span><br><span class="line">  WPARAM wParam;</span><br><span class="line">  LPARAM lParam;</span><br><span class="line">  DWORD  time;</span><br><span class="line">  POINT  pt;</span><br><span class="line">  DWORD  lPrivate;</span><br><span class="line">&#125; MSG, *PMSG, *NPMSG, *LPMSG;</span><br></pre></td></tr></table></figure><h4 id="Members"><a href="#Members" class="headerlink" title="Members"></a>Members</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hwnd</span><br></pre></td></tr></table></figure><p>Type: <strong>HWND</strong></p><p>A handle to the window whose window procedure receives the message. This member is <strong>NULL</strong> when the message is a thread message.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message</span><br></pre></td></tr></table></figure><p>Type: <strong>UINT</strong></p><p>The message identifier. Applications can only use the low word; the high word is reserved by the system.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wParam</span><br></pre></td></tr></table></figure><p>Type: <strong>WPARAM</strong></p><p>Additional information about the message. The exact meaning depends on the value of the <strong>message</strong> member.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lParam</span><br></pre></td></tr></table></figure><p>Type: <strong>LPARAM</strong></p><p>Additional information about the message. The exact meaning depends on the value of the <strong>message</strong> member.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time</span><br></pre></td></tr></table></figure><p>Type: <strong>DWORD</strong></p><p>The time at which the message was posted.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pt</span><br></pre></td></tr></table></figure><p>Type: <strong><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcHJldmlvdXMtdmVyc2lvbnMvZGQxNjI4MDUodj12cy44NSk=" title="https://docs.microsoft.com/previous-versions/dd162805(v=vs.85)">POINT<i class="fa fa-external-link"></i></span></strong></p><p>The cursor position, in screen coordinates, when the message was posted.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lPrivate</span><br></pre></td></tr></table></figure><p>左上角是(0,0) 假设为1024*768,右上角为(1024,0)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagPOINT</span> &#123;</span></span><br><span class="line">  LONG x;</span><br><span class="line">  LONG y;</span><br><span class="line">&#125; POINT, *PPOINT, *NPPOINT, *LPPOINT;</span><br></pre></td></tr></table></figure><h3 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h3><ol><li>创建一个窗口程序，学习如何查询文档</li><li>查一下Windows有多少种消息，概要了解一下每个消息的作业.</li><li>WNDCLASS wndclass = { 0 };<br>和 WNDCLASS wndclass;区别</li></ol><h4 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h4><p>由于vs studio封装的太好，新建项目啥都做好了，这里自己删掉自己做一遍</p><p>设计思路</p><ol><li><p>系统/用户触发的某个动作</p></li><li><p>系统将这些信息存储到MSG结构体中</p></li><li><p>系统将该消息存储到相关应用程序的消息队列中</p></li><li><pre><code class="c"><span class="keyword">while</span>(GetMessage(&amp;Msg,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="number">0</span>))  
{                            
    TranslateMessage(&amp;Msg);<span class="comment">//翻译消息      </span>
    DispatchMessage(&amp;Msg);<span class="comment">//分派消息        </span>
}                        
&lt;!--￼<span class="number">11</span>--&gt;
</code></pre></li></ol><p>这里大部分需要自己查文档</p><h4 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a>练习2</h4><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hcGkvX3dpbm1zZy8=" title="https://docs.microsoft.com/en-us/windows/win32/api/_winmsg/">消息太多了<i class="fa fa-external-link"></i></span>自己查看下吧</p><h4 id="练习3"><a href="#练习3" class="headerlink" title="练习3"></a>练习3</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WNDCLASS wndclass = &#123; <span class="number">0</span> &#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">00DB1A8E  xor         eax,eax  </span><br><span class="line">00DB1A90  mov         dword ptr [ebp-54h],eax  </span><br><span class="line">00DB1A93  mov         dword ptr [ebp-50h],eax  </span><br><span class="line">00DB1A96  mov         dword ptr [ebp-4Ch],eax  </span><br><span class="line">00DB1A99  mov         dword ptr [ebp-48h],eax  </span><br><span class="line">00DB1A9C  mov         dword ptr [ebp-44h],eax  </span><br><span class="line">00DB1A9F  mov         dword ptr [ebp-40h],eax  </span><br><span class="line">00DB1AA2  mov         dword ptr [ebp-3Ch],eax  </span><br><span class="line">00DB1AA5  mov         dword ptr [ebp-38h],eax  </span><br><span class="line">00DB1AA8  mov         dword ptr [ebp-34h],eax</span><br></pre></td></tr></table></figure><p>不加没有初始化，也就是随机数值，跟学结构体那会类似</p><h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><h3 id="win32入口识别"><a href="#win32入口识别" class="headerlink" title="win32入口识别"></a>win32入口识别</h3><p>win32入口为4个参数，在开始时候我们已经学过了，在这里我们需要自己从汇编角度识别win32入口</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000443.png" alt="image-20200325120252920"></p><p>看到这里，便是win32入口了，理由如下</p><ol><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hcGkvbGlibG9hZGVyYXBpL25mLWxpYmxvYWRlcmFwaS1nZXRtb2R1bGVoYW5kbGVh" title="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea">GetModuleHandleA<i class="fa fa-external-link"></i></span>这里刚好要获取程序基地址，因为win32入口有个参数就是hInstance</li><li>这里刚好为4个参数,开头push 0xA,pop eax,push eax这里只是还是相当于push了一个参数，接下来是push [local.25]和push esi，后面那个push esi是为了GetModuleHandleA的参数的，最后获取到的返回值放入eax，同时push进去，这里还可以从我们认为的入口跟进去看看</li></ol><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000444.png" alt="image-20200325120701432"></p><p>这里看到确实是0x10，这是__stdcall，从右往左压参数，然后内平栈</p><h3 id="esp寻址"><a href="#esp寻址" class="headerlink" title="esp寻址"></a>esp寻址</h3><p>我们原来编译的都是debug，通常外面的都是发布版本，所以我们编译成release进行调试</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000445.png" alt="image-20200325120842663"></p><p>先说点题外话，vs sutdio编译的跟vc6编译的结果不怎么一致，自己可以测试，我这里用vc6重新编译了一份进行调试</p><p>这里跟进我们的winMain发觉不跟以前的一样了，这里是esp寻址</p><p>esp寻址最大的变化就是esp一直会改变，所以需要运行时才能确定具体位置，esp+0xc这种</p><p>这里可以看到一句关键的,mov dword ptr ss:[esp],eax</p><p>这里是最初的名称赋值，所有才有后面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">004010A8  |.  8D4C24 08     lea ecx,dword ptr ss:[esp+0x8]</span><br><span class="line">004010AC  |.  52            push edx                                          ; /pWndClass = 6E695720</span><br><span class="line">004010AD  |.  C74424 54 040&gt;mov dword ptr ss:[esp+0x54],0x4                   ; |</span><br><span class="line">004010B5  |.  C74424 3C 001&gt;mov dword ptr ss:[esp+0x3C],Win32_1.00401000      ; |</span><br><span class="line">004010BD  |.  894C24 5C     mov dword ptr ss:[esp+0x5C],ecx                   ; |</span><br><span class="line">004010C1  |.  897424 48     mov dword ptr ss:[esp+0x48],esi                   ; |Win32_1.00400000</span><br><span class="line">004010C5  |.  FF15 B0504000 call dword ptr ds:[&lt;&amp;USER32.RegisterClassA&gt;]      ; \RegisterClassA</span><br></pre></td></tr></table></figure><p>这里可以看到有趣的是传参跟以往不一样了，注意，你看RegisterClassA这里，他是先push一个edx，然后才mov的，由于RegisterClassA是单参数的，可以确定edx便是函数的参数，而其余部分我们跟随edx看看</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000446.png" alt="image-20200325185815133"></p><p>看堆栈窗口，我们edx传的是地址，然后他4次mov都给edx指向的结构体赋了值，这个结构体相信你们都知道是谁了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagWNDCLASSA</span> &#123;</span></span><br><span class="line">  UINT      style;</span><br><span class="line">  WNDPROC   lpfnWndProc;</span><br><span class="line">  <span class="keyword">int</span>       cbClsExtra;</span><br><span class="line">  <span class="keyword">int</span>       cbWndExtra;</span><br><span class="line">  HINSTANCE hInstance;</span><br><span class="line">  HICON     hIcon;</span><br><span class="line">  HCURSOR   hCursor;</span><br><span class="line">  HBRUSH    hbrBackground;</span><br><span class="line">  LPCSTR    lpszMenuName;</span><br><span class="line">  LPCSTR    lpszClassName;</span><br><span class="line">&#125; WNDCLASSA, *PWNDCLASSA, *NPWNDCLASSA, *LPWNDCLASSA;</span><br></pre></td></tr></table></figure><p>这里是10个成员，而堆栈窗口也是10个成员</p><h3 id="窗口回调函数的定位"><a href="#窗口回调函数的定位" class="headerlink" title="窗口回调函数的定位"></a>窗口回调函数的定位</h3><p>这里回调函数从上一节结构体分析可以直接接下来，回调函数便是结构体第二个成员，跟过去看看</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000447.png" alt="image-20200325190251332"></p><p>可以看到这里便是回调函数了</p><h3 id="具体事件的处理的定位"><a href="#具体事件的处理的定位" class="headerlink" title="具体事件的处理的定位"></a>具体事件的处理的定位</h3><p>事件是一直在处理的，所以回调函数会一直被调用，这时候我们需要的便是条件断点了</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000448.png" alt="image-20200325190429321"></p><p>编辑条件，输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[esp+0x8] == code</span><br></pre></td></tr></table></figure><p>code替换为相应的宏对应的数值，随便举个例子便是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define WM_KEYDOWN                      0x0100</span><br></pre></td></tr></table></figure><p>将code替换为0x100便是在键盘按下的时候下断，或者替换为WM_KEYDOWN也是可以的，他会识别宏，到这里便分析完成了，接下来是练习</p><h3 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h3><p>这个逆向跟前面的练习很类似，很容易找到关键</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000449.png" alt="image-20200325211818222"></p><p>也就是0x41,0x46,0x67转换为字符为‘A’ ‘F’ ‘g’ ，最有意思的是，我发觉键盘无论怎么按，key down是不会识别小写字母的，查看<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9pbnB1dGRldi92aXJ0dWFsLWtleS1jb2Rlcw==" title="https://docs.microsoft.com/en-us/windows/win32/inputdev/virtual-key-codes">官方文档<i class="fa fa-external-link"></i></span></p><p>真有意思，Virtual-Key code居然没有小写字母，所以无论我怎么按都是无法得到‘g’的，还有个就是不能按shift+英文字母，因为他会获取到shift先，在获取的英文字母，单次中断无法响应两次的结果</p><p>最后发觉是数字7可以达到目的</p><p>逆向到这暂时告一段落</p><h2 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h2><h3 id="按钮是什么"><a href="#按钮是什么" class="headerlink" title="按钮是什么"></a>按钮是什么</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Win32_1.cpp : Defines the entry point for the application.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"></span><br><span class="line">HINSTANCE hAppInstance;							</span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(  								</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  HWND hwnd,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  UINT uMsg,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  WPARAM wParam,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  LPARAM lParam  	</span></span></span><br><span class="line"><span class="function"><span class="params">							)</span>  	</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateButton</span><span class="params">(HWND hwnd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> APIENTRY <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">                     LPSTR     lpCmdLine,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">int</span>       nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	hAppInstance = hInstance;</span><br><span class="line"><span class="comment">//窗口类名</span></span><br><span class="line">	TCHAR className[] = <span class="string">"My First Window"</span>;</span><br><span class="line">	<span class="comment">//创建窗口对象</span></span><br><span class="line">	WNDCLASS wndclass= &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	wndclass.hbrBackground = (HBRUSH)COLOR_MENU; <span class="comment">// Window BackGround</span></span><br><span class="line">	wndclass.lpfnWndProc = WindowProc; <span class="comment">// Message Deal</span></span><br><span class="line">	wndclass.lpszClassName = className;<span class="comment">// class name</span></span><br><span class="line">	wndclass.hInstance = hInstance;<span class="comment">// hInstance</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//注册该窗口对象</span></span><br><span class="line">	RegisterClass(&amp;wndclass);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	HWND hwnd = CreateWindow(</span><br><span class="line">		className, <span class="comment">//class name</span></span><br><span class="line">		TEXT(<span class="string">"我的第一个窗口"</span>),<span class="comment">//window title</span></span><br><span class="line">		WS_OVERLAPPEDWINDOW, <span class="comment">//window </span></span><br><span class="line">		<span class="number">10</span>, <span class="comment">//X</span></span><br><span class="line">		<span class="number">10</span>, <span class="comment">//Y</span></span><br><span class="line">		<span class="number">600</span>,<span class="comment">// width</span></span><br><span class="line">		<span class="number">300</span>, <span class="comment">//height</span></span><br><span class="line">		<span class="literal">NULL</span>, <span class="comment">// hwndparent</span></span><br><span class="line">		<span class="literal">NULL</span>, <span class="comment">// hwndmenu</span></span><br><span class="line">		hInstance, <span class="comment">//application hwnd</span></span><br><span class="line">		<span class="literal">NULL</span> <span class="comment">//addtional data</span></span><br><span class="line">		);</span><br><span class="line">	<span class="comment">//whether create or not</span></span><br><span class="line">	<span class="keyword">if</span> (hwnd == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	CreateButton(hwnd);</span><br><span class="line">	<span class="comment">// show window</span></span><br><span class="line">	ShowWindow(hwnd, SW_SHOW);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Message loop</span></span><br><span class="line">	MSG msg;</span><br><span class="line">	<span class="keyword">while</span>(GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		TranslateMessage(&amp;msg);</span><br><span class="line">		DispatchMessage(&amp;msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateButton</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HWND hwndPushButton;</span><br><span class="line">	HWND hwndCheckBox;</span><br><span class="line">	HWND hwndRadio;</span><br><span class="line"></span><br><span class="line">	hwndPushButton = CreateWindow(</span><br><span class="line">		TEXT(<span class="string">"button"</span>),</span><br><span class="line">		TEXT(<span class="string">"普通按钮"</span>),</span><br><span class="line">		WS_CHILD|WS_VISIBLE|BS_PUSHBUTTON|BS_DEFPUSHBUTTON,</span><br><span class="line">		<span class="number">10</span>,<span class="number">10</span>,</span><br><span class="line">		<span class="number">80</span>,<span class="number">20</span>,</span><br><span class="line">		hwnd,</span><br><span class="line">		(HMENU)<span class="number">1001</span>,</span><br><span class="line">		hAppInstance,</span><br><span class="line">		<span class="literal">NULL</span>);</span><br><span class="line">	hwndCheckBox = CreateWindow ( 							</span><br><span class="line">	TEXT(<span class="string">"button"</span>), 						</span><br><span class="line">	TEXT(<span class="string">"复选框"</span>),						</span><br><span class="line">	<span class="comment">//WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX,						</span></span><br><span class="line">	WS_CHILD | WS_VISIBLE | BS_CHECKBOX |BS_AUTOCHECKBOX ,						</span><br><span class="line">	<span class="number">10</span>, <span class="number">40</span>,						</span><br><span class="line">	<span class="number">80</span>, <span class="number">20</span>,						</span><br><span class="line">	hwnd, 						</span><br><span class="line">	(HMENU)<span class="number">1002</span>,		<span class="comment">//子窗口ID				</span></span><br><span class="line">	hAppInstance, 						</span><br><span class="line">	<span class="literal">NULL</span>);						</span><br><span class="line">							</span><br><span class="line">	hwndRadio = CreateWindow ( 							</span><br><span class="line">	TEXT(<span class="string">"button"</span>), 						</span><br><span class="line">	TEXT(<span class="string">"单选按钮"</span>),						</span><br><span class="line">	<span class="comment">//WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON,						</span></span><br><span class="line">	WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON  ,						</span><br><span class="line">	<span class="number">10</span>, <span class="number">70</span>,						</span><br><span class="line">	<span class="number">80</span>, <span class="number">20</span>,						</span><br><span class="line">	hwnd, 						</span><br><span class="line">	(HMENU)<span class="number">1003</span>,		<span class="comment">//子窗口ID				</span></span><br><span class="line">	hAppInstance, 						</span><br><span class="line">	<span class="literal">NULL</span>);						</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(  								</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  HWND hwnd,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  UINT uMsg,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  WPARAM wParam,  	</span></span></span><br><span class="line"><span class="function"><span class="params">							IN  LPARAM lParam  	</span></span></span><br><span class="line"><span class="function"><span class="params">							)</span>  	</span></span><br><span class="line"><span class="function"></span>&#123;  				</span><br><span class="line">				</span><br><span class="line">	<span class="keyword">switch</span>(uMsg)							</span><br><span class="line">	&#123;							</span><br><span class="line">		<span class="comment">//窗口消息						</span></span><br><span class="line">	<span class="keyword">case</span> WM_CREATE: 							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_CREATE %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">			CREATESTRUCT* createst = (CREATESTRUCT*)lParam;					</span><br><span class="line">			DbgPrintf(<span class="string">"CREATESTRUCT %s\n"</span>,createst-&gt;lpszClass);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">	<span class="keyword">case</span> WM_MOVE:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_MOVE %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">			POINTS points = MAKEPOINTS(lParam);					</span><br><span class="line">			DbgPrintf(<span class="string">"X Y %d %d\n"</span>,points.x,points.y);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">	<span class="keyword">case</span> WM_SIZE:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_SIZE %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">			<span class="keyword">int</span> newWidth  = (<span class="keyword">int</span>)(<span class="keyword">short</span>) LOWORD(lParam);    					</span><br><span class="line">			<span class="keyword">int</span> newHeight  = (<span class="keyword">int</span>)(<span class="keyword">short</span>) HIWORD(lParam);   					</span><br><span class="line">			DbgPrintf(<span class="string">"WM_SIZE %d %d\n"</span>,newWidth,newHeight);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_DESTROY %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">			PostQuitMessage(<span class="number">0</span>);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">		<span class="comment">//键盘消息						</span></span><br><span class="line">	<span class="keyword">case</span> WM_KEYUP:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_KEYUP %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">	<span class="keyword">case</span> WM_KEYDOWN:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_KEYDOWN %x %x\n"</span>,wParam,lParam);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">		<span class="comment">//鼠标消息						</span></span><br><span class="line">	<span class="keyword">case</span> WM_LBUTTONDOWN:							</span><br><span class="line">		&#123;						</span><br><span class="line">			DbgPrintf(<span class="string">"WM_LBUTTONDOWN %d %d\n"</span>,wParam,lParam);					</span><br><span class="line">			POINTS points = MAKEPOINTS(lParam);					</span><br><span class="line">			DbgPrintf(<span class="string">"WM_LBUTTONDOWN %d %d\n"</span>,points.x,points.y);					</span><br><span class="line">								</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;					</span><br><span class="line">		&#125;						</span><br><span class="line">	&#125;							</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hwnd,uMsg,wParam,lParam);							</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按钮其实就是一个窗口</p><h3 id="按钮事件的处理"><a href="#按钮事件的处理" class="headerlink" title="按钮事件的处理"></a>按钮事件的处理</h3><p>这里进行调试代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateButton</span><span class="params">(HWND hwnd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HWND hwndPushButton;</span><br><span class="line">	HWND hwndCheckBox;</span><br><span class="line">	HWND hwndRadio;</span><br><span class="line"></span><br><span class="line">	hwndPushButton = CreateWindow(</span><br><span class="line">		TEXT(<span class="string">"button"</span>),</span><br><span class="line">		TEXT(<span class="string">"普通按钮"</span>),</span><br><span class="line">		WS_CHILD|WS_VISIBLE|BS_PUSHBUTTON|BS_DEFPUSHBUTTON,</span><br><span class="line">		<span class="number">10</span>,<span class="number">10</span>,</span><br><span class="line">		<span class="number">80</span>,<span class="number">20</span>,</span><br><span class="line">		hwnd,</span><br><span class="line">		(HMENU)<span class="number">1001</span>,</span><br><span class="line">		hAppInstance,</span><br><span class="line">		<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	TCHAR szBuffer[<span class="number">0x20</span>];</span><br><span class="line">	GetClassName(hwndPushButton, szBuffer, <span class="number">0x20</span>);</span><br><span class="line">	WNDCLASS wc;</span><br><span class="line">	GetClassInfo(hAppInstance, szBuffer, &amp;wc);</span><br><span class="line">	OutputDebugStringF(<span class="string">"--&gt;%s\n"</span>,wc.lpszClassName);					</span><br><span class="line">	OutputDebugStringF(<span class="string">"--&gt;%x\n"</span>,wc.lpfnWndProc);					</span><br><span class="line"></span><br><span class="line">	hwndCheckBox = CreateWindow ( 							</span><br><span class="line">	TEXT(<span class="string">"button"</span>), 						</span><br><span class="line">	TEXT(<span class="string">"复选框"</span>),						</span><br><span class="line">	<span class="comment">//WS_CHILD | WS_VISIBLE | BS_CHECKBOX | BS_AUTOCHECKBOX,						</span></span><br><span class="line">	WS_CHILD | WS_VISIBLE | BS_CHECKBOX |BS_AUTOCHECKBOX ,						</span><br><span class="line">	<span class="number">10</span>, <span class="number">40</span>,						</span><br><span class="line">	<span class="number">80</span>, <span class="number">20</span>,						</span><br><span class="line">	hwnd, 						</span><br><span class="line">	(HMENU)<span class="number">1002</span>,		<span class="comment">//子窗口ID				</span></span><br><span class="line">	hAppInstance, 						</span><br><span class="line">	<span class="literal">NULL</span>);						</span><br><span class="line">							</span><br><span class="line">	hwndRadio = CreateWindow ( 							</span><br><span class="line">	TEXT(<span class="string">"button"</span>), 						</span><br><span class="line">	TEXT(<span class="string">"单选按钮"</span>),						</span><br><span class="line">	<span class="comment">//WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON | BS_AUTORADIOBUTTON,						</span></span><br><span class="line">	WS_CHILD | WS_VISIBLE | BS_RADIOBUTTON  ,						</span><br><span class="line">	<span class="number">10</span>, <span class="number">70</span>,						</span><br><span class="line">	<span class="number">80</span>, <span class="number">20</span>,						</span><br><span class="line">	hwnd, 						</span><br><span class="line">	(HMENU)<span class="number">1003</span>,		<span class="comment">//子窗口ID				</span></span><br><span class="line">	hAppInstance, 						</span><br><span class="line">	<span class="literal">NULL</span>);						</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000450.png" alt="image-20200326201911760"></p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000451.png" alt="image-20200326201955447"></p><p>注意，如果这里不理解，无法继续，因为按钮单击事件由父窗口WinProc处理</p><p>这里宏定义为WM_COMMAND，而具体窗口编号由wParam传递</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000452.png" alt="image-20200326202224716"></p><h3 id="消息堆栈"><a href="#消息堆栈" class="headerlink" title="消息堆栈"></a>消息堆栈</h3><p>这里已经分析过了，这是由于传参的原因</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000453.png" alt="image-20200326202719632"></p><p>不再具体分析，调用回调函数的时候，就是这个栈结构，所以wParam就在第三个参数里，uMsg为事件编号，WM_COMMAND对应的是0x111</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000454.png" alt="image-20200326202955858"></p><p>这里看堆栈，0x3E9我点的是第一个按钮，所以编号为这个</p><h3 id="按钮事件处理逻辑定位"><a href="#按钮事件处理逻辑定位" class="headerlink" title="按钮事件处理逻辑定位"></a>按钮事件处理逻辑定位</h3><p>具体处理某个按钮可以这么做</p><ol><li>获取该按钮id</li><li>找到回调函数</li><li>下条件断点</li></ol><p>具体如下:</p><p>ollydbg点w可以获取到窗口id</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000455.png" alt="image-20200326203142661"></p><p>这里三个id都有，然后找到回调函数，已经找到过，下条件断点</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000456.png" alt="image-20200326203255101"></p><p>这里要两个参数，一个是wParam,一个是uMsg，uMsg作为按钮事件定位，wParam作为具体按钮定位</p><h3 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h3><p>这里找出三个按钮不同之处，</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000457.png" alt="image-20200326223825654"></p><p>我发觉除了id号不同好像没什么区别了</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000458.png" alt="image-20200326223626478"></p><h2 id="第五章"><a href="#第五章" class="headerlink" title="第五章"></a>第五章</h2><h3 id="资源文件，创建对话框，文本框，按钮"><a href="#资源文件，创建对话框，文本框，按钮" class="headerlink" title="资源文件，创建对话框，文本框，按钮"></a>资源文件，创建对话框，文本框，按钮</h3><p>通过<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hcGkvd2ludXNlci9uZi13aW51c2VyLWRpYWxvZ2JveGE=" title="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-dialogboxa">DialogBox<i class="fa fa-external-link"></i></span> 创建对话框</p><p>至于资源文件部分，自己看视频吧</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Win32_2.cpp : Defines the entry point for the application.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"resource.h"</span></span></span><br><span class="line"><span class="function">BOOL CALLBACK <span class="title">DialogProc</span><span class="params">(									</span></span></span><br><span class="line"><span class="function"><span class="params">						 HWND hwndDlg,  <span class="comment">// handle to dialog box			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 UINT uMsg,     <span class="comment">// message			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 WPARAM wParam, <span class="comment">// first message parameter			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 LPARAM lParam  <span class="comment">// second message parameter			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> APIENTRY <span class="title">WinMain</span><span class="params">(HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">                     LPSTR     lpCmdLine,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">int</span>       nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DialogBox(hInstance, MAKEINTRESOURCE(IDD_DIALOG1), <span class="literal">NULL</span>, DialogProc);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL CALLBACK <span class="title">DialogProc</span><span class="params">(									</span></span></span><br><span class="line"><span class="function"><span class="params">						 HWND hwndDlg,  <span class="comment">// handle to dialog box			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 UINT uMsg,     <span class="comment">// message			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 WPARAM wParam, <span class="comment">// first message parameter			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 LPARAM lParam  <span class="comment">// second message parameter			</span></span></span></span><br><span class="line"><span class="function"><span class="params">						 )</span>			</span></span><br><span class="line"><span class="function"></span>&#123;									</span><br><span class="line">									</span><br><span class="line">	<span class="keyword">switch</span>(uMsg)								</span><br><span class="line">	&#123;								</span><br><span class="line">	<span class="keyword">case</span>  WM_INITDIALOG :								</span><br><span class="line">									</span><br><span class="line">		<span class="comment">//MessageBox(NULL,TEXT("WM_INITDIALOG"),TEXT("INIT"),MB_OK);							</span></span><br><span class="line">									</span><br><span class="line">		<span class="keyword">return</span> TRUE ;							</span><br><span class="line">									</span><br><span class="line">	<span class="keyword">case</span>  WM_COMMAND :								</span><br><span class="line">									</span><br><span class="line">		<span class="keyword">switch</span> (LOWORD (wParam))							</span><br><span class="line">		&#123;							</span><br><span class="line">		<span class="keyword">case</span>   btn_Login :				</span><br><span class="line">			&#123;			</span><br><span class="line">			MessageBox(<span class="literal">NULL</span>,TEXT(<span class="string">"btn_Login"</span>),TEXT(<span class="string">"OK"</span>),MB_OK);						</span><br><span class="line">			<span class="comment">//1.获取文本框句柄</span></span><br><span class="line">			HWND Username =  GetDlgItem(hwndDlg, txt_Username);</span><br><span class="line">			HWND Password =  GetDlgItem(hwndDlg, txt_Password);</span><br><span class="line">			<span class="comment">//2.获取文本框内容</span></span><br><span class="line">			TCHAR szUserBuff[<span class="number">0x50</span>];</span><br><span class="line">			TCHAR szPasswordBuff[<span class="number">0x50</span>];</span><br><span class="line">			GetWindowText(Username,szUserBuff,<span class="number">0x50</span>);</span><br><span class="line">			GetWindowText(Password,szPasswordBuff,<span class="number">0x50</span>);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> TRUE;						</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">case</span>   btn_Cancel:							</span><br><span class="line">									</span><br><span class="line">			<span class="comment">//MessageBox(NULL,TEXT("btn_Cancel"),TEXT("Cancel"),MB_OK);						</span></span><br><span class="line">									</span><br><span class="line">			EndDialog(hwndDlg, <span class="number">0</span>);						</span><br><span class="line">									</span><br><span class="line">			<span class="keyword">return</span> TRUE;						</span><br><span class="line">		&#125;							</span><br><span class="line">		<span class="keyword">break</span> ;								</span><br><span class="line">    &#125;									</span><br><span class="line">								</span><br><span class="line">	<span class="keyword">return</span> FALSE ;								</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里需要注意的是</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DialogBox(hInstance, MAKEINTRESOURCE(IDD_DIALOG1), <span class="literal">NULL</span>, DialogProc);</span><br></pre></td></tr></table></figure><p>这个函数，以及</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> GetDlgItem(hwndDlg, txt_Password);</span><br><span class="line"><span class="comment">//2.获取文本框内容</span></span><br><span class="line">TCHAR szUserBuff[<span class="number">0x50</span>];</span><br><span class="line">TCHAR szPasswordBuff[<span class="number">0x50</span>];		GetWindowText(Username,szUserBuff,<span class="number">0x50</span>);</span><br></pre></td></tr></table></figure><p>难度不大</p><h3 id="对话框回调函数的定位"><a href="#对话框回调函数的定位" class="headerlink" title="对话框回调函数的定位"></a>对话框回调函数的定位</h3><p>编译成release自己调试，这里需要注意，断点需要下好，不然会一直卡在文本框，或者先不点进去文本框</p><h4 id="常规找法"><a href="#常规找法" class="headerlink" title="常规找法"></a>常规找法</h4><p>这里常规可以找到</p><ol><li>找win32入口</li><li>找到DialogBox</li><li>他的参数有个回调函数</li><li>跟随条件断点就可以了</li></ol><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000459.png" alt="image-20200326234757705"></p><h4 id="非常规找法"><a href="#非常规找法" class="headerlink" title="非常规找法"></a>非常规找法</h4><p>前面学过，创建一个窗口的话，不指定回调函数的话，他会使用系统默认的回调函数，而如果我们指定了回调函数的话，他就会从系统指定的回调函数中将控制权交换给我们自己的回调函数，理解这个过程的话就简单多了，首先加载起来，打开w界面</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000500.png" alt="image-20200326235045121"></p><p>这里可以看到ClsProc，我们ClsProc便是系统指定的回调函数，我们可以直接对其下断</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000501.png" alt="image-20200326235220200"></p><p>直接切换断点，然后运行便可以断下了</p><p>又或者，消息断点，这里注意，消息断点不是下WM_COMMAND，我们原来下WM_COMMAND是因为在主窗口里下的断点，而我们现在是在Button里下的消息断点，所以该是什么就是什么</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000502.png" alt="image-20200326235452221"></p><p>这里选择202 WM_LBUTTONUP也就是鼠标左键按起后，接下来才是关键，运行，断下</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000503.png" alt="image-20200326235652127"></p><p>这里断下在系统dll部分，我们要返回我们的代码段，我们学过pe结构，代码通常是放在.text段，所以，我们在.text段下个内存访问断点，访问代码时候便断下，就可以回到程序领空了，点m</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000504.png" alt="image-20200326235759800"></p><p>下内存访问断点，运行，这里断下了</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000505.png" alt="image-20200326235909030"></p><p>注意堆栈窗口，我们点的login，wParam应该为0x3EC，而这里明显不是，我们单步，追到系统领空后再次直接运行，返回后</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000506.png" alt="image-20200327000323081"></p><p>这里便是了，wParam是0x3EC</p><p>同时，其实消息断点就是条件断点</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000507.png" alt="image-20200327001438518"></p><p>这里延伸下，这明显就是ollydbg返回到程序领空的方法啊，alt+f9的方法</p><p>未来写调试器的那一天可能会用到</p><h3 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h3><h4 id="练习1-1"><a href="#练习1-1" class="headerlink" title="练习1"></a>练习1</h4><p>似乎很简单，就是应用刚刚学到的知识,找到Find Me 1,2,3对应的回调函数</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000508.png" alt="image-20200327000902975"></p><p>Find me 1</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000509.png" alt="image-20200327000712634"></p><p>Find me 2</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000510.png" alt="image-20200327000852706"></p><h4 id="练习2-1"><a href="#练习2-1" class="headerlink" title="练习2"></a>练习2</h4><p>逆向获得正确的账号和密码</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000511.png" alt="image-20200327001026968"></p><p>应该不难，同样用非常规找回调</p><p><img src="https://gitee.com/NoOne-hub/picture/raw/master/img/20200405000512.png" alt="image-20200327001352323"></p><p>找到回调后先下个条件断点吧，然后取消掉其余的</p><p>这里注意下，他的退出变成了0x10的编号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0040105C  |.  8D7C24 0C     lea edi,dword ptr ss:[esp+0xC]</span><br><span class="line">00401060  |.  83C9 FF       or ecx,-0x1</span><br><span class="line">00401063  |.  33C0          xor eax,eax</span><br><span class="line">00401065  |.  F2:AE         repne scas byte ptr es:[edi]</span><br><span class="line">00401067  |.  F7D1          not ecx</span><br><span class="line">00401069  |.  49            dec ecx</span><br><span class="line">0040106A  |.  83F9 03       cmp ecx,0x3</span><br><span class="line">0040106D  |.  75 20         jnz short ReverseT.0040108F</span><br><span class="line">0040106F  |.  8D7C24 5C     lea edi,dword ptr ss:[esp+0x5C]</span><br><span class="line">00401073  |.  83C9 FF       or ecx,-0x1</span><br><span class="line">00401076  |.  F2:AE         repne scas byte ptr es:[edi]</span><br><span class="line">00401078  |.  F7D1          not ecx</span><br><span class="line">0040107A  |.  49            dec ecx</span><br><span class="line">0040107B  |.  83F9 05       cmp ecx,0x5</span><br></pre></td></tr></table></figure><p>算法部分，第一部分长度为3，第二部分长度为5就可以通过，似乎不难，不过挺有趣的</p><p>这个居然是strlen的优化编译代码，真有趣</p><h2 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h2><p><strong>本文作者</strong>：NoOne<br><strong>本文地址</strong>： <a href="https://noonegroup.xyz/posts/be13089f/">https://noonegroup.xyz/posts/be13089f/</a><br><strong>版权声明</strong>：转载请注明出处！</p></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/reverse-%E9%80%86%E5%90%91/" rel="tag"># reverse,逆向</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/6e2e265a/" rel="next" title="逆向笔记之基础学习(一)"><i class="fa fa-chevron-left"></i> 逆向笔记之基础学习(一)</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/806264cf/" rel="prev" title="逆向笔记之C基础(二)">逆向笔记之C基础(二) <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="comments"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Win32"><span class="nav-number">1.</span> <span class="nav-text">Win32</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一章"><span class="nav-number">1.1.</span> <span class="nav-text">第一章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编码的发展"><span class="nav-number">1.1.1.</span> <span class="nav-text">编码的发展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#win32宽字符"><span class="nav-number">1.1.2.</span> <span class="nav-text">win32宽字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">1.1.3.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二章"><span class="nav-number">1.2.</span> <span class="nav-text">第二章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#win32初次调试"><span class="nav-number">1.2.1.</span> <span class="nav-text">win32初次调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows事件和消息"><span class="nav-number">1.2.2.</span> <span class="nav-text">windows事件和消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息"><span class="nav-number">1.2.3.</span> <span class="nav-text">消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Members"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">Members</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-1"><span class="nav-number">1.2.4.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#练习1"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">练习1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习2"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">练习2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习3"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">练习3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三章"><span class="nav-number">1.3.</span> <span class="nav-text">第三章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#win32入口识别"><span class="nav-number">1.3.1.</span> <span class="nav-text">win32入口识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#esp寻址"><span class="nav-number">1.3.2.</span> <span class="nav-text">esp寻址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#窗口回调函数的定位"><span class="nav-number">1.3.3.</span> <span class="nav-text">窗口回调函数的定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#具体事件的处理的定位"><span class="nav-number">1.3.4.</span> <span class="nav-text">具体事件的处理的定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-2"><span class="nav-number">1.3.5.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四章"><span class="nav-number">1.4.</span> <span class="nav-text">第四章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#按钮是什么"><span class="nav-number">1.4.1.</span> <span class="nav-text">按钮是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按钮事件的处理"><span class="nav-number">1.4.2.</span> <span class="nav-text">按钮事件的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息堆栈"><span class="nav-number">1.4.3.</span> <span class="nav-text">消息堆栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按钮事件处理逻辑定位"><span class="nav-number">1.4.4.</span> <span class="nav-text">按钮事件处理逻辑定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-3"><span class="nav-number">1.4.5.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第五章"><span class="nav-number">1.5.</span> <span class="nav-text">第五章</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#资源文件，创建对话框，文本框，按钮"><span class="nav-number">1.5.1.</span> <span class="nav-text">资源文件，创建对话框，文本框，按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对话框回调函数的定位"><span class="nav-number">1.5.2.</span> <span class="nav-text">对话框回调函数的定位</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#常规找法"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">常规找法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#非常规找法"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">非常规找法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-4"><span class="nav-number">1.5.3.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#练习1-1"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">练习1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习2-1"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">练习2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第六章"><span class="nav-number">1.6.</span> <span class="nav-text">第六章</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="NoOne" src="/images/photo.jpg"><p class="site-author-name" itemprop="name">NoOne</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">187</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">44</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">60</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05vT25lLWh1Yg==" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;NoOne-hub"><i class="fa fa-fw fa-github"></i>GitHub</span> </span><span class="links-of-author-item"><span class="exturl" data-url="Tm9PbmU6ZG90YWVyZGF5QGdtYWlsLmNvbQ==" title="E-Mail &amp;rarr; NoOne:dotaerday@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">NoOne</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="Symbols count total">1m</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="Reading time total">15:46</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="Total Visitors"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="Total Views"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script src="//code.tidio.co/4fgjfhjokt1utyyp9l0cra3v0uw4uuwf.js"></script><script>NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'v5gtaUCUdFsLSpiQc2h4QM2E-MdYXbMMI',
    appKey: 'v5Re9AbMl3E5Y38ILfYDfkCj',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);</script></body></html><!-- rebuild by neat -->